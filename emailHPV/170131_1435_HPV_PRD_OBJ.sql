---------------------------------------------------
-- Export file for user HPV                      --
-- Created by hpvjea on 1/31/2017, 2:37:01 p. m. --
---------------------------------------------------

set define off
spool 170131_1435_HPV_PRD_OBJ.log

prompt
prompt Creating table ENC_SATISFACP1
prompt =============================
prompt
create table HPV.ENC_SATISFACP1
(
  periodo        NUMBER,
  grupo          NUMBER,
  a26facilitador NUMBER,
  divipola       VARCHAR2(20),
  departamento   VARCHAR2(100),
  municipio      VARCHAR2(100),
  cc_facilitador VARCHAR2(20),
  facilitador    VARCHAR2(200),
  taller         NUMBER,
  no_preg        NUMBER,
  pregunta       VARCHAR2(500),
  respuesta      NUMBER,
  no_rtas        NUMBER,
  prc_rtas       VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table ENC_SATISFACP1_CON
prompt =================================
prompt
create table HPV.ENC_SATISFACP1_CON
(
  periodo     NUMBER,
  grupo       NUMBER,
  taller      NUMBER,
  contestadas NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table ENC_SATISFACP1_ENV
prompt =================================
prompt
create table HPV.ENC_SATISFACP1_ENV
(
  periodo  NUMBER,
  grupo    NUMBER,
  taller   NUMBER,
  enviadas NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table ENVIOCORREOS
prompt ===========================
prompt
create table HPV.ENVIOCORREOS
(
  tipoemail         VARCHAR2(100),
  fechaenvio        DATE,
  periodo           NUMBER,
  tipodocumento     VARCHAR2(100),
  documento         VARCHAR2(100),
  nombreinscrito    VARCHAR2(100),
  email             VARCHAR2(100),
  telefono          VARCHAR2(100),
  movil             VARCHAR2(100),
  movilalt          VARCHAR2(100),
  condicionespecial VARCHAR2(100),
  nomdepartamento   VARCHAR2(100),
  nommunicipio      VARCHAR2(100),
  dia               VARCHAR2(100),
  horario           VARCHAR2(100),
  grupo             VARCHAR2(100),
  siglagrupo        VARCHAR2(100),
  lugar             VARCHAR2(100),
  direccion         VARCHAR2(100),
  nombrefacilitador VARCHAR2(100),
  nombrecoordinador VARCHAR2(100),
  pri_dia           VARCHAR2(100),
  pri_cupo          VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.ENVIOCORREOS
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T01DBO_PARTICIPANTES
prompt =======================================
prompt
create table HPV.MIG_T01DBO_PARTICIPANTES
(
  a01codigo                    NUMBER(11) not null,
  a01codigobeneficiario        NUMBER(11) not null,
  a01tipodocumento             NUMBER(4) not null,
  a01documento                 VARCHAR2(15) not null,
  a01primernombre              VARCHAR2(100) not null,
  a01segundonombre             VARCHAR2(100),
  a01primerapellido            VARCHAR2(100) not null,
  a01segundoapellido           VARCHAR2(100),
  a01fechanacimiento           VARCHAR2(10),
  a01municipioestudio          VARCHAR2(150),
  a01tipoformacion             VARCHAR2(150),
  a01nivelformacion            VARCHAR2(150),
  a01fichasnies                VARCHAR2(50),
  a01fechaultmes               VARCHAR2(10),
  a01fechafinsemestrescursados VARCHAR2(10),
  a01finfechaetapapractica     VARCHAR2(10),
  a01codigoconvenio            VARCHAR2(150),
  a01snies_ies                 VARCHAR2(150),
  a01programaestado            VARCHAR2(150),
  a01email                     VARCHAR2(150),
  a01telefono                  VARCHAR2(150),
  a01celular                   VARCHAR2(150),
  a01celularalterno            VARCHAR2(150),
  a01institucion               VARCHAR2(250),
  a01inscrito                  NUMBER(11)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.MIG_T01DBO_PARTICIPANTES
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T02DBC_DEPARTAMENTOS
prompt =======================================
prompt
create table HPV.MIG_T02DBC_DEPARTAMENTOS
(
  a02codigo            NUMBER not null,
  a02nombre            VARCHAR2(100) not null,
  a02dane              VARCHAR2(2) not null,
  a02indicativo        NUMBER not null,
  a02estado            CHAR(1) not null,
  a02fechacreacion     VARCHAR2(100),
  a02fechamodificacion VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T02DBC_DEPARTAMENTOS
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T03DBC_MUNICIPIOS
prompt ====================================
prompt
create table HPV.MIG_T03DBC_MUNICIPIOS
(
  a03codigo            NUMBER not null,
  a03departamento      NUMBER not null,
  a03nombre            VARCHAR2(100) not null,
  a03dane              VARCHAR2(5) not null,
  a03estado            CHAR(1) not null,
  a03fechacreacion     VARCHAR2(100),
  a03fechamodificacion VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T03DBC_MUNICIPIOS
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T06WEB_USUARIOS
prompt ==================================
prompt
create table HPV.MIG_T06WEB_USUARIOS
(
  a06codigo            NUMBER not null,
  a06rol               NUMBER not null,
  a06usuario           VARCHAR2(15) not null,
  a06clave             VARCHAR2(32),
  a06intentos          NUMBER,
  a06fechaclave        VARCHAR2(100),
  a06estado            CHAR(1) not null,
  a06prueba            CHAR(1) not null,
  a06fechacreacion     VARCHAR2(100),
  a06fechamodificacion VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T06WEB_USUARIOS
  is 'TEMPORAL MIGRACION MySQL P1';
alter table HPV.MIG_T06WEB_USUARIOS
  add constraint PK_MIG_T06 primary key (A06CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255;

prompt
prompt Creating table MIG_T07WEB_PERSONAS
prompt ==================================
prompt
create table HPV.MIG_T07WEB_PERSONAS
(
  a07codigo             NUMBER,
  a07usuario            NUMBER,
  a07ciudad             NUMBER,
  a07tipoidentificacion NUMBER,
  a07identificacion     VARCHAR2(15),
  a07primernombre       VARCHAR2(200),
  a07segundonombre      VARCHAR2(200),
  a07primerapellido     VARCHAR2(200),
  a07segundoapellido    VARCHAR2(200),
  a07fechanacimiento    VARCHAR2(100),
  a07email              VARCHAR2(200),
  a07telefono           VARCHAR2(25),
  a07movil              VARCHAR2(30),
  a07movilalt           VARCHAR2(30),
  a07estado             CHAR(1),
  a07fechacreacion      VARCHAR2(100),
  a07fechamodificacion  VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T07WEB_PERSONAS
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T13DBO_PREGUNTAS
prompt ===================================
prompt
create table HPV.MIG_T13DBO_PREGUNTAS
(
  a13codigo            NUMBER not null,
  a13numero            NUMBER not null,
  a13pregunta          VARCHAR2(500) not null,
  a13tipo              CHAR(1),
  a13estado            CHAR(1),
  a13fechacreacion     VARCHAR2(100),
  a13fechamodificacion VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T13DBO_PREGUNTAS
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T14DBO_RESPUESTAS
prompt ====================================
prompt
create table HPV.MIG_T14DBO_RESPUESTAS
(
  a14codigo            NUMBER not null,
  a14letra             CHAR(1) not null,
  a14respuesta         VARCHAR2(500) not null,
  a14correcta          CHAR(1) not null,
  a14estado            CHAR(1) not null,
  a14fechacreacion     VARCHAR2(100),
  a14fechamodificacion VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T14DBO_RESPUESTAS
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T15WEB_INSCRITOS
prompt ===================================
prompt
create table HPV.MIG_T15WEB_INSCRITOS
(
  a15codigo              NUMBER not null,
  a15participante        NUMBER,
  a15grupo               NUMBER not null,
  a15tipodocumento       NUMBER not null,
  a15documento           VARCHAR2(15) not null,
  a15codigobeneficiario  NUMBER,
  a15primernombre        VARCHAR2(200) not null,
  a15segundonombre       VARCHAR2(200),
  a15primerapellido      VARCHAR2(200) not null,
  a15segundoapellido     VARCHAR2(200),
  a15fechanacimiento     VARCHAR2(100),
  a15email               VARCHAR2(200) not null,
  a15telefono            VARCHAR2(25),
  a15movil               VARCHAR2(30) not null,
  a15movilalt            VARCHAR2(30),
  a15confirmacion        CHAR(1),
  a15correoenviado       CHAR(1),
  a15estado              CHAR(1) not null,
  a15usuariocreacion     NUMBER,
  a15fechacreacion       VARCHAR2(100),
  a15usuariomodificacion NUMBER,
  a15fechamodificacion   VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T15WEB_INSCRITOS
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T16WEB_INSCRITOENCUESTA
prompt ==========================================
prompt
create table HPV.MIG_T16WEB_INSCRITOENCUESTA
(
  a16codigo              NUMBER,
  a16inscrito            NUMBER,
  a16pregunta            NUMBER,
  a16respuesta           NUMBER,
  a16estado              CHAR(1),
  a16usuariocreacion     NUMBER,
  a16fechacreacion       VARCHAR2(30),
  a16usuariomodificacion NUMBER,
  a16fechamodificacion   VARCHAR2(30)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.MIG_T16WEB_INSCRITOENCUESTA
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T21WEB_REALIZACIONTALLER
prompt ===========================================
prompt
create table HPV.MIG_T21WEB_REALIZACIONTALLER
(
  a21codigo                  NUMBER not null,
  a21grupo                   NUMBER not null,
  a21taller                  NUMBER not null,
  a21fechataller             VARCHAR2(100) not null,
  a21asistenciacondicion     CHAR(1),
  a21asistenciaobservaciones VARCHAR2(4000),
  a21estado                  CHAR(1),
  a21usuariocreacion         NUMBER not null,
  a21fechacreacion           VARCHAR2(100),
  a21usuariomodificacion     NUMBER,
  a21fechamodificacion       VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T21WEB_REALIZACIONTALLER
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T26WEB_GRUPOSFAC
prompt ===================================
prompt
create table HPV.MIG_T26WEB_GRUPOSFAC
(
  a26codigo              NUMBER not null,
  a26periodo             NUMBER not null,
  a26facilitador         NUMBER not null,
  a26ciudad              NUMBER not null,
  a26grupo               NUMBER not null,
  a26dia                 NUMBER not null,
  a26horario             NUMBER not null,
  a26lugar               VARCHAR2(255) not null,
  a26direccion           VARCHAR2(255) not null,
  a26condicion           CHAR(1),
  a26observaciones       VARCHAR2(4000),
  a26estado              CHAR(1) not null,
  a26usuariocreacion     NUMBER not null,
  a26fechacreacion       VARCHAR2(1000),
  a26usuariomodificacion NUMBER,
  a26fechamodificacion   VARCHAR2(1000)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;

prompt
prompt Creating table MIG_T28DBO_FACILITADORCOORD
prompt ==========================================
prompt
create table HPV.MIG_T28DBO_FACILITADORCOORD
(
  a28facilitador       NUMBER not null,
  a28coordinador       NUMBER not null,
  a28estado            CHAR(1) not null,
  a28fechacreacion     VARCHAR2(100),
  a28fechamodificacion VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T28DBO_FACILITADORCOORD
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T30BDO_PREGUNTARESPUESTAS
prompt ============================================
prompt
create table HPV.MIG_T30BDO_PREGUNTARESPUESTAS
(
  a30pregunta          NUMBER not null,
  a30respuesta         NUMBER not null,
  a30estado            CHAR(1) not null,
  a30fechacreacion     VARCHAR2(100),
  a30fechamodificacion VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T30BDO_PREGUNTARESPUESTAS
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T32WEB_TALLERASISTENCIA
prompt ==========================================
prompt
create table HPV.MIG_T32WEB_TALLERASISTENCIA
(
  a32taller              NUMBER not null,
  a32grupo               NUMBER not null,
  a32inscrito            NUMBER not null,
  a32asistencia          CHAR(1) not null,
  a32correo              CHAR(1),
  a32estado              CHAR(1) not null,
  a32usuariocreacion     NUMBER not null,
  a32fechacreacion       VARCHAR2(100),
  a32usuariomodificacion NUMBER,
  a32fechamodificacion   VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T32WEB_TALLERASISTENCIA
  is 'TEMPORAL MIGRACION MySQL P1';

prompt
prompt Creating table MIG_T35DBO_ENCUESTAPREGUNTAS
prompt ===========================================
prompt
create table HPV.MIG_T35DBO_ENCUESTAPREGUNTAS
(
  a35encuesta          NUMBER not null,
  a35pregunta          NUMBER not null,
  a35estado            CHAR(1) not null,
  a35fechacreacion     VARCHAR2(100),
  a35fechamodificacion VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.MIG_T35DBO_ENCUESTAPREGUNTAS
  is 'TEMPORAL MIGRACION MYSQL P1';

prompt
prompt Creating table TMPACTDATPAR
prompt ===========================
prompt
create table HPV.TMPACTDATPAR
(
  tipodocin    VARCHAR2(2),
  docin        VARCHAR2(15),
  tipodoc      VARCHAR2(2),
  doc          VARCHAR2(15),
  fec_nac      DATE,
  pri_nombre   VARCHAR2(50),
  seg_nombre   VARCHAR2(50),
  pri_apellido VARCHAR2(50),
  seg_apellido VARCHAR2(50),
  email        VARCHAR2(50),
  fecha        DATE default SYSDATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.TMPACTDATPAR
  is 'TEMPORAL ACTUALIZACION DATOS';

prompt
prompt Creating table TMPT01
prompt =====================
prompt
create table HPV.TMPT01
(
  idpersona          NUMBER,
  idtipodocumento    NUMBER,
  documento          VARCHAR2(15),
  primernombre       VARCHAR2(100),
  segundonombre      VARCHAR2(100),
  primerapellido     VARCHAR2(100),
  segundoapellido    VARCHAR2(100),
  genero             VARCHAR2(100),
  tipopoblacion      VARCHAR2(100),
  nivel_formacion    VARCHAR2(100),
  nombre_institucion VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.TMPT01
  is 'TEMPORAL ACTUALIZACION DATOS';

prompt
prompt Creating table TMP160915
prompt ========================
prompt
create table HPV.TMP160915
(
  a15documento          VARCHAR2(15),
  a15codigobeneficiario NUMBER,
  "docasis"             NUMBER,
  "benasis"             NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.TMP160915
  is 'TEMPORAL ACTUALIZACION DATOS';

prompt
prompt Creating table TMP161019
prompt ========================
prompt
create table HPV.TMP161019
(
  participante VARCHAR2(15),
  faciltiador  VARCHAR2(15)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.TMP161019
  is 'TEMPORAL ACTUALIZACION DATOS';

prompt
prompt Creating table T04_TIPOSDOCUMENTO
prompt =================================
prompt
create table HPV.T04_TIPOSDOCUMENTO
(
  a04tipodocumento       VARCHAR2(2) not null,
  a04nombre              VARCHAR2(100),
  a04estado              CHAR(1),
  a04fechacreacion       DATE,
  a04fechamodificacion   DATE,
  a04usuariocreacion     NUMBER,
  a04usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T04_TIPOSDOCUMENTO
  is 'Tabla que contiene información de los tipos de documentos';
comment on column HPV.T04_TIPOSDOCUMENTO.a04tipodocumento
  is 'Identificación única del registro';
comment on column HPV.T04_TIPOSDOCUMENTO.a04nombre
  is 'Descripción del tipo documento';
comment on column HPV.T04_TIPOSDOCUMENTO.a04estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T04_TIPOSDOCUMENTO.a04fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T04_TIPOSDOCUMENTO.a04fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T04_TIPOSDOCUMENTO.a04usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T04_TIPOSDOCUMENTO.a04usuariomodificacion
  is 'Usuario ultima modificacion';
alter table HPV.T04_TIPOSDOCUMENTO
  add constraint PK_T04_TIPOSDOCUMENTO primary key (A04TIPODOCUMENTO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T01_PARTICIPANTES
prompt ================================
prompt
create table HPV.T01_PARTICIPANTES
(
  a01codigo              NUMBER not null,
  a01tipodocumento       VARCHAR2(2),
  a01documento           VARCHAR2(15),
  a01codigobeneficiario  NUMBER,
  a01primernombre        VARCHAR2(100),
  a01segundonombre       VARCHAR2(100),
  a01primerapellido      VARCHAR2(100),
  a01segundoapellido     VARCHAR2(100),
  a01fechanacimiento     DATE,
  a01municipioestudio    VARCHAR2(100),
  a01noconvenio          VARCHAR2(50),
  a01movil               VARCHAR2(15),
  a01movilalt            VARCHAR2(15),
  a01email               VARCHAR2(200),
  a01finetapapractica    DATE,
  a01finsemestre         DATE,
  a01ultimomes           DATE,
  a01fichasnies          NUMBER,
  a01nivelformacion      VARCHAR2(100),
  a01sniesies            NUMBER,
  a01telefono            VARCHAR2(15),
  a01tipoformcion        VARCHAR2(100),
  a01estado              NUMBER(22,1),
  a01fechacreacion       DATE,
  a01fechamodificacion   DATE,
  a01usuariocreacion     NUMBER,
  a01usuariomodificacion NUMBER,
  a01condicion           VARCHAR2(100),
  a01estadopersona       VARCHAR2(100),
  a01genero              VARCHAR2(100),
  a01nombreinstitucion   VARCHAR2(200)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T01_PARTICIPANTES
  is 'Tabla que contiene todos los posibles participantes';
comment on column HPV.T01_PARTICIPANTES.a01codigo
  is 'Identificación única del registro';
comment on column HPV.T01_PARTICIPANTES.a01tipodocumento
  is 'Tipo de documento';
comment on column HPV.T01_PARTICIPANTES.a01documento
  is 'Numero de documento del participante';
comment on column HPV.T01_PARTICIPANTES.a01codigobeneficiario
  is 'Codigo unico asignado por PS';
comment on column HPV.T01_PARTICIPANTES.a01primernombre
  is 'Primer nombre';
comment on column HPV.T01_PARTICIPANTES.a01segundonombre
  is 'Segundo nombre';
comment on column HPV.T01_PARTICIPANTES.a01primerapellido
  is 'Primer apellido';
comment on column HPV.T01_PARTICIPANTES.a01segundoapellido
  is 'Segundo apellido';
comment on column HPV.T01_PARTICIPANTES.a01fechanacimiento
  is 'Fecha de nacimiento';
comment on column HPV.T01_PARTICIPANTES.a01municipioestudio
  is 'Municipio donde se realizo ';
comment on column HPV.T01_PARTICIPANTES.a01noconvenio
  is 'Convenio del participante';
comment on column HPV.T01_PARTICIPANTES.a01movil
  is 'Movil';
comment on column HPV.T01_PARTICIPANTES.a01movilalt
  is 'Movil alterno';
comment on column HPV.T01_PARTICIPANTES.a01email
  is 'Correo electronico';
comment on column HPV.T01_PARTICIPANTES.a01finetapapractica
  is 'Fecha Final de la Etapa Practica';
comment on column HPV.T01_PARTICIPANTES.a01finsemestre
  is 'Fecha Final del Semestre';
comment on column HPV.T01_PARTICIPANTES.a01ultimomes
  is 'Fecha del Ultimo Mes';
comment on column HPV.T01_PARTICIPANTES.a01fichasnies
  is 'Ficha Snies';
comment on column HPV.T01_PARTICIPANTES.a01nivelformacion
  is 'Nivel de Formacion';
comment on column HPV.T01_PARTICIPANTES.a01sniesies
  is 'Nro Snies_Ies';
comment on column HPV.T01_PARTICIPANTES.a01telefono
  is 'Telefono';
comment on column HPV.T01_PARTICIPANTES.a01tipoformcion
  is 'Tipo de Formacion';
comment on column HPV.T01_PARTICIPANTES.a01estado
  is 'Estado de la persona';
comment on column HPV.T01_PARTICIPANTES.a01fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T01_PARTICIPANTES.a01fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T01_PARTICIPANTES.a01usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T01_PARTICIPANTES.a01usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T01_PARTICIPANTES.a01condicion
  is 'Condiciondel inscrito';
comment on column HPV.T01_PARTICIPANTES.a01estadopersona
  is 'Estado persona';
comment on column HPV.T01_PARTICIPANTES.a01genero
  is 'Genero de persona';
comment on column HPV.T01_PARTICIPANTES.a01nombreinstitucion
  is 'Nombre institucion';
alter table HPV.T01_PARTICIPANTES
  add constraint PK_T01_PARTICIPANTES primary key (A01CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T01_PARTICIPANTES
  add constraint FK_T01_T04 foreign key (A01TIPODOCUMENTO)
  references HPV.T04_TIPOSDOCUMENTO (A04TIPODOCUMENTO);

prompt
prompt Creating table T02_DEPARTAMENTOS
prompt ================================
prompt
create table HPV.T02_DEPARTAMENTOS
(
  a02codigo              NUMBER not null,
  a02nombre              VARCHAR2(100),
  a02dane                VARCHAR2(2),
  a02indicativo          NUMBER,
  a02estado              CHAR(1),
  a02fechacreacion       DATE,
  a02fechamodificacion   DATE,
  a02usuariocreacion     NUMBER,
  a02usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T02_DEPARTAMENTOS
  is 'Tabla que contiene informacion de los departamentos';
comment on column HPV.T02_DEPARTAMENTOS.a02codigo
  is 'Identificación única del registro';
comment on column HPV.T02_DEPARTAMENTOS.a02nombre
  is 'Nombre de departamento';
comment on column HPV.T02_DEPARTAMENTOS.a02dane
  is 'Codigo DANE del departamento';
comment on column HPV.T02_DEPARTAMENTOS.a02indicativo
  is 'Indicativo del departamento';
comment on column HPV.T02_DEPARTAMENTOS.a02estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T02_DEPARTAMENTOS.a02fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T02_DEPARTAMENTOS.a02fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T02_DEPARTAMENTOS.a02usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T02_DEPARTAMENTOS.a02usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T02_DEPARTAMENTOS
  add constraint PK_T02_DEPARTAMENTOS primary key (A02CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T02_DEPARTAMENTOS
  add constraint CK_A02ESTADO
  check (A02ESTADO IN ('A','I'));

prompt
prompt Creating table T03_MUNICIPIOS
prompt =============================
prompt
create table HPV.T03_MUNICIPIOS
(
  a03codigo              NUMBER not null,
  a03departamento        NUMBER,
  a03nombre              VARCHAR2(100),
  a03dane                VARCHAR2(5),
  a03estado              CHAR(1),
  a03fechacreacion       DATE,
  a03fechamodificacion   DATE,
  a03usuariocreacion     NUMBER,
  a03usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T03_MUNICIPIOS
  is 'Tabla que contiene informacion de los municipios';
comment on column HPV.T03_MUNICIPIOS.a03codigo
  is 'Identificación única del registro';
comment on column HPV.T03_MUNICIPIOS.a03departamento
  is 'FK de la tabla T02_DEPARTAMENTOS ID del departamento asociado al municipio';
comment on column HPV.T03_MUNICIPIOS.a03nombre
  is 'Nombre del municipio';
comment on column HPV.T03_MUNICIPIOS.a03dane
  is 'Codigo DANE';
comment on column HPV.T03_MUNICIPIOS.a03estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T03_MUNICIPIOS.a03fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T03_MUNICIPIOS.a03fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T03_MUNICIPIOS.a03usuariocreacion
  is 'Usuario que creo el sistema';
comment on column HPV.T03_MUNICIPIOS.a03usuariomodificacion
  is 'Usuario que realiza ultima modificacion';
alter table HPV.T03_MUNICIPIOS
  add constraint PK_T03_MUNICIPIOS primary key (A03CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T03_MUNICIPIOS
  add constraint FK_T03_T02 foreign key (A03DEPARTAMENTO)
  references HPV.T02_DEPARTAMENTOS (A02CODIGO);
alter table HPV.T03_MUNICIPIOS
  add constraint CK_A03ESTADO
  check (A03ESTADO IN ('A','I'));

prompt
prompt Creating table T05_ROLES
prompt ========================
prompt
create table HPV.T05_ROLES
(
  a05codigo              NUMBER not null,
  a05nombre              VARCHAR2(50),
  a05estado              CHAR(1),
  a05fechacreacion       DATE,
  a05fechamodificacion   DATE,
  a05usuariocreacion     NUMBER,
  a05usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T05_ROLES
  is 'Tabla que contiene información de los que manejara el sistema';
comment on column HPV.T05_ROLES.a05codigo
  is 'Identificación única del registro';
comment on column HPV.T05_ROLES.a05nombre
  is 'Nombre del rol';
comment on column HPV.T05_ROLES.a05estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T05_ROLES.a05fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T05_ROLES.a05fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T05_ROLES.a05usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T05_ROLES.a05usuariomodificacion
  is 'Usuario ultima modificacion';
alter table HPV.T05_ROLES
  add constraint PK_T05_ROLES primary key (A05CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T92_PERFILESUSUARIO
prompt ==================================
prompt
create table HPV.T92_PERFILESUSUARIO
(
  a92codigo              NUMBER not null,
  a92nombre              VARCHAR2(200),
  a92estado              CHAR(1),
  a92fechacreacion       DATE,
  a92fechamodificacion   DATE,
  a92usuariocreacion     NUMBER,
  a92usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T92_PERFILESUSUARIO
  is 'Tabla que contiene la información de los perfiles configurados en el sistema';
comment on column HPV.T92_PERFILESUSUARIO.a92codigo
  is 'Identificacion unica del registro';
comment on column HPV.T92_PERFILESUSUARIO.a92nombre
  is 'Nombre del perfil';
comment on column HPV.T92_PERFILESUSUARIO.a92estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T92_PERFILESUSUARIO.a92fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T92_PERFILESUSUARIO.a92fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T92_PERFILESUSUARIO.a92usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T92_PERFILESUSUARIO.a92usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T92_PERFILESUSUARIO
  add constraint PK_T92_PERFILESUSUARIO primary key (A92CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T06_USUARIOS
prompt ===========================
prompt
create table HPV.T06_USUARIOS
(
  a06codigo              NUMBER not null,
  a06rol                 NUMBER,
  a06perfil              NUMBER,
  a06coordinador         NUMBER,
  a06usuario             VARCHAR2(15),
  a06clave               VARCHAR2(64),
  a06intentos            NUMBER,
  a06fechaclave          DATE,
  a06fechaultimoingreso  DATE,
  a06estado              CHAR(1),
  a06fechacreacion       DATE,
  a06fechamodificacion   DATE,
  a06usuariocreacion     NUMBER,
  a06usuariomodificacion NUMBER,
  a06fechafin            DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T06_USUARIOS
  is 'Tabla que contiene la información de los usuarios a los que se les permite ingresar al sistema con login (parametros de ingreso)';
comment on column HPV.T06_USUARIOS.a06codigo
  is 'Identificación única del registro';
comment on column HPV.T06_USUARIOS.a06rol
  is 'Rol al que pertenece el usuario';
comment on column HPV.T06_USUARIOS.a06perfil
  is 'Perfil del sistea asignado al usuario';
comment on column HPV.T06_USUARIOS.a06coordinador
  is 'Identificador del coordinador asignado al usuario';
comment on column HPV.T06_USUARIOS.a06usuario
  is 'Nombre de usuario para ingreso al sistema (alias)';
comment on column HPV.T06_USUARIOS.a06clave
  is 'Clave del usuario para ingresar al sistema';
comment on column HPV.T06_USUARIOS.a06intentos
  is 'Numero de intentos fallidos de ingreso al sistema';
comment on column HPV.T06_USUARIOS.a06fechaclave
  is 'Fecha del ultimo cambio de clave';
comment on column HPV.T06_USUARIOS.a06fechaultimoingreso
  is 'Fecha del ultimo ingreso exitoso al sistema';
comment on column HPV.T06_USUARIOS.a06estado
  is 'Estado del usuario A:Activo I:Inactivo B:Bloqueado';
comment on column HPV.T06_USUARIOS.a06fechacreacion
  is 'Fecha de creacion del usuario';
comment on column HPV.T06_USUARIOS.a06fechamodificacion
  is 'Fecha de modificacion delregistro';
comment on column HPV.T06_USUARIOS.a06usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T06_USUARIOS.a06usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T06_USUARIOS.a06fechafin
  is 'Fecha Fin Contrato';
create unique index HPV.UK_T06_A06USUARIO on HPV.T06_USUARIOS (A06USUARIO)
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T06_USUARIOS
  add constraint PK_T06_USUARIOS primary key (A06CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T06_USUARIOS
  add constraint FK_T06_T05 foreign key (A06ROL)
  references HPV.T05_ROLES (A05CODIGO);
alter table HPV.T06_USUARIOS
  add constraint FK_T06_T92 foreign key (A06PERFIL)
  references HPV.T92_PERFILESUSUARIO (A92CODIGO);
alter table HPV.T06_USUARIOS
  add constraint CK_A06ESTADO
  check (A06ESTADO IN ('A','B','I'));

prompt
prompt Creating table T07_PERSONAS
prompt ===========================
prompt
create table HPV.T07_PERSONAS
(
  a07codigo              NUMBER not null,
  a07usuario             NUMBER,
  a07tipodocumento       VARCHAR2(2),
  a07identificacion      VARCHAR2(15),
  a07primernombre        VARCHAR2(200),
  a07segundonombre       VARCHAR2(200),
  a07primerapellido      VARCHAR2(200),
  a07segundoapellido     VARCHAR2(200),
  a07fechanacimiento     DATE,
  a07email               VARCHAR2(200),
  a07telefono            VARCHAR2(25),
  a07movil               VARCHAR2(30),
  a07movilalt            VARCHAR2(30),
  a07fechacreacion       DATE,
  a07fechamodificacion   DATE,
  a07usuariocreacion     NUMBER,
  a07usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T07_PERSONAS
  is 'Tabla que contiene la información complementaria del usuario que ingresa al sistema con login';
comment on column HPV.T07_PERSONAS.a07codigo
  is 'Identificación única del registro';
comment on column HPV.T07_PERSONAS.a07usuario
  is 'FK de la tabla T06_USUARIOS ID del usuario';
comment on column HPV.T07_PERSONAS.a07tipodocumento
  is 'Tipo de identificacion';
comment on column HPV.T07_PERSONAS.a07identificacion
  is 'Numero de identificacion';
comment on column HPV.T07_PERSONAS.a07primernombre
  is 'Primer nombre';
comment on column HPV.T07_PERSONAS.a07segundonombre
  is 'Segundo nombre';
comment on column HPV.T07_PERSONAS.a07primerapellido
  is 'Primer apellido';
comment on column HPV.T07_PERSONAS.a07segundoapellido
  is 'Segundo apellido';
comment on column HPV.T07_PERSONAS.a07fechanacimiento
  is 'Fecha de nacimiento';
comment on column HPV.T07_PERSONAS.a07email
  is 'Correo electronico';
comment on column HPV.T07_PERSONAS.a07telefono
  is 'Telefono del usuario';
comment on column HPV.T07_PERSONAS.a07movil
  is 'Movil ';
comment on column HPV.T07_PERSONAS.a07movilalt
  is 'Movil alterno';
comment on column HPV.T07_PERSONAS.a07fechacreacion
  is 'Fecha creacion ';
comment on column HPV.T07_PERSONAS.a07fechamodificacion
  is 'Fecha modificacion';
comment on column HPV.T07_PERSONAS.a07usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T07_PERSONAS.a07usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T07_PERSONAS
  add constraint PK_T07_PERSONAS primary key (A07CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T07_PERSONAS
  add constraint UK_T07_PERSONAS unique (A07EMAIL)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T07_PERSONAS
  add constraint FK_T07_T04 foreign key (A07TIPODOCUMENTO)
  references HPV.T04_TIPOSDOCUMENTO (A04TIPODOCUMENTO);
alter table HPV.T07_PERSONAS
  add constraint FK_T07_T06 foreign key (A07USUARIO)
  references HPV.T06_USUARIOS (A06CODIGO);

prompt
prompt Creating table T08_PARAMETROS
prompt =============================
prompt
create table HPV.T08_PARAMETROS
(
  a08codigo              NUMBER not null,
  a08nombre              VARCHAR2(50),
  a08valor               VARCHAR2(500),
  a08descripcion         VARCHAR2(100),
  a08estado              CHAR(1),
  a08fechacreacion       DATE,
  a08fechamodificacion   DATE,
  a08usuariocreacion     NUMBER,
  a08usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T08_PARAMETROS
  is 'Tabla que contiene la información de los parametros generales del sistema';
comment on column HPV.T08_PARAMETROS.a08codigo
  is 'Identificación única del registro';
comment on column HPV.T08_PARAMETROS.a08nombre
  is 'Nombre del parametro';
comment on column HPV.T08_PARAMETROS.a08valor
  is 'Valor del parametro';
comment on column HPV.T08_PARAMETROS.a08descripcion
  is 'Descripcion de uso del parametro';
comment on column HPV.T08_PARAMETROS.a08estado
  is 'Estado del parametro A:Activo I:Inactivo';
comment on column HPV.T08_PARAMETROS.a08fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T08_PARAMETROS.a08fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T08_PARAMETROS.a08usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T08_PARAMETROS.a08usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T08_PARAMETROS
  add constraint PK_T08_PARAMETROS primary key (A08CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T08_PARAMETROS160718
prompt ===================================
prompt
create table HPV.T08_PARAMETROS160718
(
  a08codigo              NUMBER not null,
  a08nombre              VARCHAR2(50),
  a08valor               VARCHAR2(500),
  a08descripcion         VARCHAR2(100),
  a08estado              CHAR(1),
  a08fechacreacion       DATE,
  a08fechamodificacion   DATE,
  a08usuariocreacion     NUMBER,
  a08usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T08_PARAMETROS160718
  is 'temporal backup';

prompt
prompt Creating table T09_MENU
prompt =======================
prompt
create table HPV.T09_MENU
(
  a09codigo              NUMBER not null,
  a09nombre              VARCHAR2(50),
  a09tag                 VARCHAR2(30),
  a09orden               NUMBER,
  a09estado              CHAR(1),
  a09fechacreacion       DATE,
  a09fechamodificacion   DATE,
  a09usuariocreacion     NUMBER,
  a09usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T09_MENU
  is 'Tabla que contiene la información de los menus del sistema';
comment on column HPV.T09_MENU.a09codigo
  is 'Identificación única del registro';
comment on column HPV.T09_MENU.a09nombre
  is 'Nombre del menu';
comment on column HPV.T09_MENU.a09tag
  is 'Tag interno del menu';
comment on column HPV.T09_MENU.a09orden
  is 'Orden de aparicion del menu';
comment on column HPV.T09_MENU.a09estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T09_MENU.a09fechacreacion
  is 'Fecha creacion';
comment on column HPV.T09_MENU.a09fechamodificacion
  is 'Fecha modificacion';
comment on column HPV.T09_MENU.a09usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T09_MENU.a09usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T09_MENU
  add constraint PK_T09_MENU primary key (A09CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T10_OPCIONES
prompt ===========================
prompt
create table HPV.T10_OPCIONES
(
  a10codigo              NUMBER not null,
  a10nombre              VARCHAR2(50),
  a10tag                 VARCHAR2(30),
  a10orden               NUMBER,
  a10estado              CHAR(1),
  a10fechacreacion       DATE,
  a10fechamodificacion   DATE,
  a10usuariocreacion     NUMBER,
  a10usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T10_OPCIONES
  is 'Tabla que contiene la información de las opciones disponibles del sistema';
comment on column HPV.T10_OPCIONES.a10codigo
  is 'Identificación única del registro';
comment on column HPV.T10_OPCIONES.a10nombre
  is 'Nombre de la opcion';
comment on column HPV.T10_OPCIONES.a10tag
  is 'Tag asociado ala opcion';
comment on column HPV.T10_OPCIONES.a10orden
  is 'Orden en el que se despliega';
comment on column HPV.T10_OPCIONES.a10estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T10_OPCIONES.a10fechacreacion
  is 'Fecha creacion';
comment on column HPV.T10_OPCIONES.a10fechamodificacion
  is 'Fecha modificacion';
comment on column HPV.T10_OPCIONES.a10usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T10_OPCIONES.a10usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T10_OPCIONES
  add constraint PK_T10_OPCIONES primary key (A10CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T100_NIVELLOG
prompt ============================
prompt
create table HPV.T100_NIVELLOG
(
  a100codigo              NUMBER not null,
  a100descripcion         VARCHAR2(50),
  a100estado              CHAR(1),
  a100fechacreacion       DATE,
  a100fechamodificacion   DATE,
  a100usuariocreacion     NUMBER,
  a100usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T100_NIVELLOG
  is 'Tabla que contiene la información del nivel del log de las transacciones del sistema';
comment on column HPV.T100_NIVELLOG.a100codigo
  is 'Identificación única del registro';
comment on column HPV.T100_NIVELLOG.a100descripcion
  is 'Descripcion del nivel del log';
comment on column HPV.T100_NIVELLOG.a100estado
  is 'Estado del nivel del log A:Activo I:Inactivo';
comment on column HPV.T100_NIVELLOG.a100fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T100_NIVELLOG.a100fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T100_NIVELLOG.a100usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T100_NIVELLOG.a100usuariomodificacion
  is 'Usuario ultima modificacion';

prompt
prompt Creating table T101_RPT_TRAZABILIDAD
prompt ====================================
prompt
create table HPV.T101_RPT_TRAZABILIDAD
(
  periodo                   NUMBER,
  idinscrito                NUMBER,
  nomdepartamento           VARCHAR2(100),
  nommunicipio              VARCHAR2(100),
  nombrecoordinador         VARCHAR2(803),
  cc_facilitador            VARCHAR2(15),
  nombrefacilitador         VARCHAR2(803),
  documento_inscrito        VARCHAR2(15),
  codigo_beneficiario       NUMBER,
  primernombre              VARCHAR2(200),
  segundonombre             VARCHAR2(200),
  primerapellido            VARCHAR2(200),
  segundoapellido           VARCHAR2(200),
  email                     VARCHAR2(200),
  telefono                  VARCHAR2(25),
  movil                     VARCHAR2(30),
  movilalt                  VARCHAR2(30),
  municipioestudio          VARCHAR2(100),
  tipoformacion             VARCHAR2(100),
  nivelformacion            VARCHAR2(100),
  fichasnies                NUMBER,
  fechaultmes               DATE,
  fechafinsemestrescursados DATE,
  finfechaetapapractica     DATE,
  codigoconvenio            VARCHAR2(50),
  snies_ies                 NUMBER,
  programaestado            VARCHAR2(20),
  institucion               VARCHAR2(200),
  encuesta_inicial          DATE,
  encuesta_satisfaccion     DATE,
  encuesta_final            DATE,
  taller1                   DATE,
  taller2                   DATE,
  taller3                   DATE,
  taller4                   DATE,
  taller5                   DATE,
  taller6                   DATE,
  taller7                   DATE,
  taller8                   DATE,
  porcasistencia            NUMBER,
  certifica                 CHAR(1),
  fecha_expedicion          DATE,
  estado                    CHAR(1),
  vida                      CHAR(1),
  liderazgo                 CHAR(1),
  exito                     CHAR(1),
  genero                    CHAR(1),
  condicion                 VARCHAR2(50),
  siglagrupo                VARCHAR2(50),
  grupofacilitador          NUMBER,
  idfacilitador             NUMBER,
  idcoordinador             NUMBER,
  iddepartamento            NUMBER,
  idmunicipio               NUMBER,
  tipo_corte                VARCHAR2(20) default 'A',
  fec_corte                 VARCHAR2(10) default to_char(sysdate,'yyyy-mm-dd'),
  fecultinscrip             DATE,
  reinscrito                VARCHAR2(10),
  comoseentero              VARCHAR2(50),
  divipola                  VARCHAR2(20),
  condicion_especial        VARCHAR2(100),
  tipodocumento             VARCHAR2(10),
  grupoinscripcion          VARCHAR2(50),
  idcondicionespecial       NUMBER,
  encuesta_final_act        DATE,
  fecha_expedicion_act      DATE,
  xcodbent01                VARCHAR2(50),
  xdocidt01                 VARCHAR2(50),
  t1                        VARCHAR2(20),
  t2                        VARCHAR2(20),
  t3                        VARCHAR2(20),
  t4                        VARCHAR2(20),
  t5                        VARCHAR2(20),
  t6                        VARCHAR2(20),
  t7                        VARCHAR2(20),
  t8                        VARCHAR2(20),
  valido                    VARCHAR2(20)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T101_RPT_TRAZABILIDAD
  is 'Repoorte Trazabilidad Participantes';
create index HPV.INX_IDINSCRITO on HPV.T101_RPT_TRAZABILIDAD (IDINSCRITO, PERIODO)
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T101_RPT_TRAZABILIDADOK
prompt ======================================
prompt
create table HPV.T101_RPT_TRAZABILIDADOK
(
  periodo                   NUMBER,
  idinscrito                NUMBER,
  nomdepartamento           VARCHAR2(100),
  nommunicipio              VARCHAR2(100),
  nombrecoordinador         VARCHAR2(803),
  cc_facilitador            VARCHAR2(15),
  nombrefacilitador         VARCHAR2(803),
  documento_inscrito        VARCHAR2(15),
  codigo_beneficiario       NUMBER,
  primernombre              VARCHAR2(200),
  segundonombre             VARCHAR2(200),
  primerapellido            VARCHAR2(200),
  segundoapellido           VARCHAR2(200),
  email                     VARCHAR2(200),
  telefono                  VARCHAR2(25),
  movil                     VARCHAR2(30),
  movilalt                  VARCHAR2(30),
  municipioestudio          VARCHAR2(100),
  tipoformacion             VARCHAR2(100),
  nivelformacion            VARCHAR2(100),
  fichasnies                NUMBER,
  fechaultmes               DATE,
  fechafinsemestrescursados DATE,
  finfechaetapapractica     DATE,
  codigoconvenio            VARCHAR2(50),
  snies_ies                 NUMBER,
  programaestado            VARCHAR2(20),
  institucion               VARCHAR2(200),
  encuesta_inicial          DATE,
  encuesta_satisfaccion     DATE,
  encuesta_final            DATE,
  taller1                   DATE,
  taller2                   DATE,
  taller3                   DATE,
  taller4                   DATE,
  taller5                   DATE,
  taller6                   DATE,
  taller7                   DATE,
  taller8                   DATE,
  porcasistencia            NUMBER,
  certifica                 CHAR(1),
  fecha_expedicion          DATE,
  estado                    CHAR(1),
  vida                      CHAR(1),
  liderazgo                 CHAR(1),
  exito                     CHAR(1),
  genero                    CHAR(1),
  condicion                 VARCHAR2(50),
  siglagrupo                VARCHAR2(50),
  grupofacilitador          NUMBER,
  idfacilitador             NUMBER,
  idcoordinador             NUMBER,
  iddepartamento            NUMBER,
  idmunicipio               NUMBER,
  tipo_corte                VARCHAR2(20),
  fec_corte                 VARCHAR2(10),
  fecultinscrip             DATE,
  reinscrito                VARCHAR2(10),
  comoseentero              VARCHAR2(50),
  divipola                  VARCHAR2(20)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T101_RPT_TRAZABILIDADOK
  is 'temporal backup';

prompt
prompt Creating table T101_RPT_TRAZABILIDAD160701
prompt ==========================================
prompt
create table HPV.T101_RPT_TRAZABILIDAD160701
(
  periodo                   NUMBER,
  idinscrito                NUMBER,
  nomdepartamento           VARCHAR2(100),
  nommunicipio              VARCHAR2(100),
  nombrecoordinador         VARCHAR2(803),
  cc_facilitador            VARCHAR2(15),
  nombrefacilitador         VARCHAR2(803),
  documento_inscrito        VARCHAR2(15),
  codigo_beneficiario       NUMBER,
  primernombre              VARCHAR2(200),
  segundonombre             VARCHAR2(200),
  primerapellido            VARCHAR2(200),
  segundoapellido           VARCHAR2(200),
  email                     VARCHAR2(200),
  telefono                  VARCHAR2(25),
  movil                     VARCHAR2(30),
  movilalt                  VARCHAR2(30),
  municipioestudio          VARCHAR2(100),
  tipoformacion             VARCHAR2(100),
  nivelformacion            VARCHAR2(100),
  fichasnies                NUMBER,
  fechaultmes               DATE,
  fechafinsemestrescursados DATE,
  finfechaetapapractica     DATE,
  codigoconvenio            VARCHAR2(50),
  snies_ies                 NUMBER,
  programaestado            VARCHAR2(20),
  institucion               VARCHAR2(200),
  encuesta_inicial          DATE,
  encuesta_satisfaccion     DATE,
  encuesta_final            DATE,
  taller1                   DATE,
  taller2                   DATE,
  taller3                   DATE,
  taller4                   DATE,
  taller5                   DATE,
  taller6                   DATE,
  taller7                   DATE,
  taller8                   DATE,
  porcasistencia            NUMBER,
  certifica                 CHAR(1),
  fecha_expedicion          DATE,
  estado                    CHAR(1),
  vida                      CHAR(1),
  liderazgo                 CHAR(1),
  exito                     CHAR(1),
  genero                    CHAR(1),
  condicion                 VARCHAR2(50),
  siglagrupo                VARCHAR2(50),
  grupofacilitador          NUMBER,
  idfacilitador             NUMBER,
  idcoordinador             NUMBER,
  iddepartamento            NUMBER,
  idmunicipio               NUMBER,
  fec_corte                 DATE,
  tipo_corte                VARCHAR2(20),
  codbeneficiariows         NUMBER,
  codbeneficiariosija       NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T101_RPT_TRAZABILIDAD160701
  is 'temporal backup';

prompt
prompt Creating table T101_RPT_TRAZABILIDAD160718
prompt ==========================================
prompt
create table HPV.T101_RPT_TRAZABILIDAD160718
(
  periodo                   NUMBER,
  idinscrito                NUMBER,
  nomdepartamento           VARCHAR2(100),
  nommunicipio              VARCHAR2(100),
  nombrecoordinador         VARCHAR2(803),
  cc_facilitador            VARCHAR2(15),
  nombrefacilitador         VARCHAR2(803),
  documento_inscrito        VARCHAR2(15),
  codigo_beneficiario       NUMBER,
  primernombre              VARCHAR2(200),
  segundonombre             VARCHAR2(200),
  primerapellido            VARCHAR2(200),
  segundoapellido           VARCHAR2(200),
  email                     VARCHAR2(200),
  telefono                  VARCHAR2(25),
  movil                     VARCHAR2(30),
  movilalt                  VARCHAR2(30),
  municipioestudio          VARCHAR2(100),
  tipoformacion             VARCHAR2(100),
  nivelformacion            VARCHAR2(100),
  fichasnies                NUMBER,
  fechaultmes               DATE,
  fechafinsemestrescursados DATE,
  finfechaetapapractica     DATE,
  codigoconvenio            VARCHAR2(50),
  snies_ies                 NUMBER,
  programaestado            VARCHAR2(20),
  institucion               VARCHAR2(200),
  encuesta_inicial          DATE,
  encuesta_satisfaccion     DATE,
  encuesta_final            DATE,
  taller1                   DATE,
  taller2                   DATE,
  taller3                   DATE,
  taller4                   DATE,
  taller5                   DATE,
  taller6                   DATE,
  taller7                   DATE,
  taller8                   DATE,
  porcasistencia            NUMBER,
  certifica                 CHAR(1),
  fecha_expedicion          DATE,
  estado                    CHAR(1),
  vida                      CHAR(1),
  liderazgo                 CHAR(1),
  exito                     CHAR(1),
  genero                    CHAR(1),
  condicion                 VARCHAR2(50),
  siglagrupo                VARCHAR2(50),
  grupofacilitador          NUMBER,
  idfacilitador             NUMBER,
  idcoordinador             NUMBER,
  iddepartamento            NUMBER,
  idmunicipio               NUMBER,
  tipo_corte                VARCHAR2(20),
  fec_corte                 VARCHAR2(10),
  fecultinscrip             DATE,
  reinscrito                VARCHAR2(10),
  comoseentero              VARCHAR2(50),
  divipola                  VARCHAR2(20)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T101_RPT_TRAZABILIDAD160718
  is 'temporal backup';

prompt
prompt Creating table T101_RPT_TRAZABILIDAD160912
prompt ==========================================
prompt
create table HPV.T101_RPT_TRAZABILIDAD160912
(
  periodo                   NUMBER,
  idinscrito                NUMBER,
  nomdepartamento           VARCHAR2(100),
  nommunicipio              VARCHAR2(100),
  nombrecoordinador         VARCHAR2(803),
  cc_facilitador            VARCHAR2(15),
  nombrefacilitador         VARCHAR2(803),
  documento_inscrito        VARCHAR2(15),
  codigo_beneficiario       NUMBER,
  primernombre              VARCHAR2(200),
  segundonombre             VARCHAR2(200),
  primerapellido            VARCHAR2(200),
  segundoapellido           VARCHAR2(200),
  email                     VARCHAR2(200),
  telefono                  VARCHAR2(25),
  movil                     VARCHAR2(30),
  movilalt                  VARCHAR2(30),
  municipioestudio          VARCHAR2(100),
  tipoformacion             VARCHAR2(100),
  nivelformacion            VARCHAR2(100),
  fichasnies                NUMBER,
  fechaultmes               DATE,
  fechafinsemestrescursados DATE,
  finfechaetapapractica     DATE,
  codigoconvenio            VARCHAR2(50),
  snies_ies                 NUMBER,
  programaestado            VARCHAR2(20),
  institucion               VARCHAR2(200),
  encuesta_inicial          DATE,
  encuesta_satisfaccion     DATE,
  encuesta_final            DATE,
  taller1                   DATE,
  taller2                   DATE,
  taller3                   DATE,
  taller4                   DATE,
  taller5                   DATE,
  taller6                   DATE,
  taller7                   DATE,
  taller8                   DATE,
  porcasistencia            NUMBER,
  certifica                 CHAR(1),
  fecha_expedicion          DATE,
  estado                    CHAR(1),
  vida                      CHAR(1),
  liderazgo                 CHAR(1),
  exito                     CHAR(1),
  genero                    CHAR(1),
  condicion                 VARCHAR2(50),
  siglagrupo                VARCHAR2(50),
  grupofacilitador          NUMBER,
  idfacilitador             NUMBER,
  idcoordinador             NUMBER,
  iddepartamento            NUMBER,
  idmunicipio               NUMBER,
  tipo_corte                VARCHAR2(20),
  fec_corte                 VARCHAR2(10),
  fecultinscrip             DATE,
  reinscrito                VARCHAR2(10),
  comoseentero              VARCHAR2(50),
  divipola                  VARCHAR2(20),
  condicion_especial        VARCHAR2(100),
  tipodocumento             VARCHAR2(10),
  grupoinscripcion          VARCHAR2(50),
  idcondicionespecial       NUMBER,
  encuesta_final_act        DATE,
  fecha_expedicion_act      DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T101_RPT_TRAZABILIDAD160912
  is 'temporal backup';

prompt
prompt Creating table T101_RPT_TRAZABILIDAD610808
prompt ==========================================
prompt
create table HPV.T101_RPT_TRAZABILIDAD610808
(
  periodo                   NUMBER,
  idinscrito                NUMBER,
  nomdepartamento           VARCHAR2(100),
  nommunicipio              VARCHAR2(100),
  nombrecoordinador         VARCHAR2(803),
  cc_facilitador            VARCHAR2(15),
  nombrefacilitador         VARCHAR2(803),
  documento_inscrito        VARCHAR2(15),
  codigo_beneficiario       NUMBER,
  primernombre              VARCHAR2(200),
  segundonombre             VARCHAR2(200),
  primerapellido            VARCHAR2(200),
  segundoapellido           VARCHAR2(200),
  email                     VARCHAR2(200),
  telefono                  VARCHAR2(25),
  movil                     VARCHAR2(30),
  movilalt                  VARCHAR2(30),
  municipioestudio          VARCHAR2(100),
  tipoformacion             VARCHAR2(100),
  nivelformacion            VARCHAR2(100),
  fichasnies                NUMBER,
  fechaultmes               DATE,
  fechafinsemestrescursados DATE,
  finfechaetapapractica     DATE,
  codigoconvenio            VARCHAR2(50),
  snies_ies                 NUMBER,
  programaestado            VARCHAR2(20),
  institucion               VARCHAR2(200),
  encuesta_inicial          DATE,
  encuesta_satisfaccion     DATE,
  encuesta_final            DATE,
  taller1                   DATE,
  taller2                   DATE,
  taller3                   DATE,
  taller4                   DATE,
  taller5                   DATE,
  taller6                   DATE,
  taller7                   DATE,
  taller8                   DATE,
  porcasistencia            NUMBER,
  certifica                 CHAR(1),
  fecha_expedicion          DATE,
  estado                    CHAR(1),
  vida                      CHAR(1),
  liderazgo                 CHAR(1),
  exito                     CHAR(1),
  genero                    CHAR(1),
  condicion                 VARCHAR2(50),
  siglagrupo                VARCHAR2(50),
  grupofacilitador          NUMBER,
  idfacilitador             NUMBER,
  idcoordinador             NUMBER,
  iddepartamento            NUMBER,
  idmunicipio               NUMBER,
  tipo_corte                VARCHAR2(20),
  fec_corte                 VARCHAR2(10),
  fecultinscrip             DATE,
  reinscrito                VARCHAR2(10),
  comoseentero              VARCHAR2(50),
  divipola                  VARCHAR2(20),
  condicion_especial        VARCHAR2(100)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T101_RPT_TRAZABILIDAD610808
  is 'temporal backup';

prompt
prompt Creating table T101_RPT_TRAZAB161019
prompt ====================================
prompt
create table HPV.T101_RPT_TRAZAB161019
(
  periodo                   NUMBER,
  idinscrito                NUMBER,
  nomdepartamento           VARCHAR2(100),
  nommunicipio              VARCHAR2(100),
  nombrecoordinador         VARCHAR2(803),
  cc_facilitador            VARCHAR2(15),
  nombrefacilitador         VARCHAR2(803),
  documento_inscrito        VARCHAR2(15),
  codigo_beneficiario       NUMBER,
  primernombre              VARCHAR2(200),
  segundonombre             VARCHAR2(200),
  primerapellido            VARCHAR2(200),
  segundoapellido           VARCHAR2(200),
  email                     VARCHAR2(200),
  telefono                  VARCHAR2(25),
  movil                     VARCHAR2(30),
  movilalt                  VARCHAR2(30),
  municipioestudio          VARCHAR2(100),
  tipoformacion             VARCHAR2(100),
  nivelformacion            VARCHAR2(100),
  fichasnies                NUMBER,
  fechaultmes               DATE,
  fechafinsemestrescursados DATE,
  finfechaetapapractica     DATE,
  codigoconvenio            VARCHAR2(50),
  snies_ies                 NUMBER,
  programaestado            VARCHAR2(20),
  institucion               VARCHAR2(200),
  encuesta_inicial          DATE,
  encuesta_satisfaccion     DATE,
  encuesta_final            DATE,
  taller1                   DATE,
  taller2                   DATE,
  taller3                   DATE,
  taller4                   DATE,
  taller5                   DATE,
  taller6                   DATE,
  taller7                   DATE,
  taller8                   DATE,
  porcasistencia            NUMBER,
  certifica                 CHAR(1),
  fecha_expedicion          DATE,
  estado                    CHAR(1),
  vida                      CHAR(1),
  liderazgo                 CHAR(1),
  exito                     CHAR(1),
  genero                    CHAR(1),
  condicion                 VARCHAR2(50),
  siglagrupo                VARCHAR2(50),
  grupofacilitador          NUMBER,
  idfacilitador             NUMBER,
  idcoordinador             NUMBER,
  iddepartamento            NUMBER,
  idmunicipio               NUMBER,
  tipo_corte                VARCHAR2(20),
  fec_corte                 VARCHAR2(10),
  fecultinscrip             DATE,
  reinscrito                VARCHAR2(10),
  comoseentero              VARCHAR2(50),
  divipola                  VARCHAR2(20),
  condicion_especial        VARCHAR2(100),
  tipodocumento             VARCHAR2(10),
  grupoinscripcion          VARCHAR2(50),
  idcondicionespecial       NUMBER,
  encuesta_final_act        DATE,
  fecha_expedicion_act      DATE,
  xcodbent01                VARCHAR2(50),
  xdocidt01                 VARCHAR2(50)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T101_RPT_TRAZAB161019
  is 'temporal backup';

prompt
prompt Creating table T102_RPT_ENCSATOBS
prompt =================================
prompt
create table HPV.T102_RPT_ENCSATOBS
(
  periodo           NUMBER,
  divipola          VARCHAR2(100),
  nomdepartamento   VARCHAR2(100),
  nommunicipio      VARCHAR2(100),
  nombrecoordinador VARCHAR2(803),
  cc_facilitador    VARCHAR2(15),
  nombrefacilitador VARCHAR2(803),
  grupofacilitador  NUMBER,
  siglagrupo        VARCHAR2(50),
  taller            NUMBER,
  idgrupo           NUMBER not null,
  observacion       VARCHAR2(1000),
  idinscrito        NUMBER,
  idmunicipio       NUMBER,
  iddepartamento    NUMBER,
  idfacilitador     NUMBER,
  idcoordinador     NUMBER,
  tipo_corte        VARCHAR2(20) default 'A',
  fec_corte         VARCHAR2(10) default to_char(sysdate,'yyyy-mm-dd')
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T102_RPT_ENCSATOBS
  is 'Reporte Observaciones Enc Satisfaccion';

prompt
prompt Creating table T102_RPT_ENCSATTMP
prompt =================================
prompt
create table HPV.T102_RPT_ENCSATTMP
(
  a51periodo          NUMBER,
  a51grupofacilitador NUMBER,
  a51tallerrealizado  NUMBER,
  a16inscrito         NUMBER,
  a16encuesta         NUMBER,
  a16pregunta         NUMBER,
  a16respuesta        NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T102_RPT_ENCSATTMP
  is 'Reporte Encuesta de Satisfaccion';

prompt
prompt Creating table T102_RPT_ENCSATTMPOBS
prompt ====================================
prompt
create table HPV.T102_RPT_ENCSATTMPOBS
(
  a51periodo          NUMBER,
  a51grupofacilitador NUMBER,
  a51tallerrealizado  NUMBER,
  a56inscrito         NUMBER,
  a56observacion      VARCHAR2(1000)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T102_RPT_ENCSATTMPOBS
  is 'Reporte Observaciones Enc Satisfaccion';

prompt
prompt Creating table T102_RPT_ENCUESTASATISFACCION
prompt ============================================
prompt
create table HPV.T102_RPT_ENCUESTASATISFACCION
(
  periodo           NUMBER,
  divipola          VARCHAR2(100),
  nomdepartamento   VARCHAR2(100),
  nommunicipio      VARCHAR2(100),
  nombrecoordinador VARCHAR2(803),
  cc_facilitador    VARCHAR2(15),
  nombrefacilitador VARCHAR2(803),
  grupofacilitador  NUMBER,
  siglagrupo        VARCHAR2(50),
  taller            NUMBER,
  idgrupo           NUMBER not null,
  nropregunta       NUMBER,
  pregunta          VARCHAR2(500),
  respuesta         CHAR(1),
  nrorptas          NUMBER,
  porcrptas         NUMBER,
  idpregunta        NUMBER,
  idrespuesta       NUMBER,
  idmunicipio       NUMBER,
  iddepartamento    NUMBER,
  idfacilitador     NUMBER,
  idcoordinador     NUMBER,
  tipo_corte        VARCHAR2(20) default 'A',
  fec_corte         VARCHAR2(10) default to_char(sysdate,'yyyy-mm-dd')
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T102_RPT_ENCUESTASATISFACCION
  is 'Reporte Encuestas de Satisfaccion';

prompt
prompt Creating table T102_RPT_ENCUESTASATISF160711
prompt ============================================
prompt
create table HPV.T102_RPT_ENCUESTASATISF160711
(
  periodo        NUMBER,
  divipola       VARCHAR2(5),
  departamento   VARCHAR2(100),
  municipio      VARCHAR2(100),
  facilitador    VARCHAR2(1000),
  grupo          VARCHAR2(20),
  taller         NUMBER,
  idgrupo        NUMBER not null,
  nropregunta    NUMBER,
  pregunta       VARCHAR2(500),
  respuesta      CHAR(1),
  nrorptas       NUMBER,
  porcrptas      NUMBER,
  idpregunta     NUMBER,
  idrespuesta    NUMBER,
  idmunicipio    NUMBER,
  iddepartamento NUMBER,
  idfacilitador  NUMBER,
  idcoordinador  NUMBER,
  tipo_corte     VARCHAR2(20),
  fec_corte      VARCHAR2(10)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T102_RPT_ENCUESTASATISF160711
  is 'temporal backup';

prompt
prompt Creating table T102_RPT_ENCUESTASATISF160718
prompt ============================================
prompt
create table HPV.T102_RPT_ENCUESTASATISF160718
(
  periodo           NUMBER,
  divipola          VARCHAR2(100),
  nomdepartamento   VARCHAR2(100),
  nommunicipio      VARCHAR2(100),
  nombrecoordinador VARCHAR2(803),
  cc_facilitador    VARCHAR2(15),
  nombrefacilitador VARCHAR2(803),
  grupofacilitador  NUMBER,
  siglagrupo        VARCHAR2(50),
  taller            NUMBER,
  idgrupo           NUMBER not null,
  nropregunta       NUMBER,
  pregunta          VARCHAR2(500),
  respuesta         CHAR(1),
  nrorptas          NUMBER,
  porcrptas         NUMBER,
  idpregunta        NUMBER,
  idrespuesta       NUMBER,
  idmunicipio       NUMBER,
  iddepartamento    NUMBER,
  idfacilitador     NUMBER,
  idcoordinador     NUMBER,
  tipo_corte        VARCHAR2(20),
  fec_corte         VARCHAR2(10)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T102_RPT_ENCUESTASATISF160718
  is 'temporal backup';

prompt
prompt Creating table T103_RPT_CRONOGRAMATALLER
prompt ========================================
prompt
create table HPV.T103_RPT_CRONOGRAMATALLER
(
  periodo            NUMBER,
  idgrupofacilitador NUMBER not null,
  divipola           VARCHAR2(5),
  nomdepartamento    VARCHAR2(100),
  nommunicipio       VARCHAR2(100),
  nomcoordinador     VARCHAR2(803),
  nombrefacilitador  VARCHAR2(803),
  idgrupo            NUMBER,
  dia                VARCHAR2(10),
  horario            VARCHAR2(15),
  inscritos          NUMBER,
  taller1            DATE,
  taller2            DATE,
  taller3            DATE,
  taller4            DATE,
  taller5            DATE,
  taller6            DATE,
  taller7            DATE,
  taller8            DATE,
  t1plane            VARCHAR2(10),
  t1ejecu            VARCHAR2(10),
  t1asist            VARCHAR2(10),
  t1noasi            VARCHAR2(10),
  t1noved            VARCHAR2(100),
  t1saten            VARCHAR2(10),
  t1satco            VARCHAR2(10),
  t2plane            VARCHAR2(10),
  t2ejecu            VARCHAR2(10),
  t2asist            VARCHAR2(10),
  t2noasi            VARCHAR2(10),
  t2noved            VARCHAR2(100),
  t2saten            VARCHAR2(10),
  t2satco            VARCHAR2(10),
  t3plane            VARCHAR2(10),
  t3ejecu            VARCHAR2(10),
  t3asist            VARCHAR2(10),
  t3noasi            VARCHAR2(10),
  t3noved            VARCHAR2(100),
  t3saten            VARCHAR2(10),
  t3satco            VARCHAR2(10),
  t4plane            VARCHAR2(10),
  t4ejecu            VARCHAR2(10),
  t4asist            VARCHAR2(10),
  t4noasi            VARCHAR2(10),
  t4noved            VARCHAR2(100),
  t4saten            VARCHAR2(10),
  t4satco            VARCHAR2(10),
  t5plane            VARCHAR2(10),
  t5ejecu            VARCHAR2(10),
  t5asist            VARCHAR2(10),
  t5noasi            VARCHAR2(10),
  t5noved            VARCHAR2(100),
  t5saten            VARCHAR2(10),
  t5satco            VARCHAR2(10),
  t6plane            VARCHAR2(10),
  t6ejecu            VARCHAR2(10),
  t6asist            VARCHAR2(10),
  t6noasi            VARCHAR2(10),
  t6noved            VARCHAR2(100),
  t6saten            VARCHAR2(10),
  t6satco            VARCHAR2(10),
  t7plane            VARCHAR2(10),
  t7ejecu            VARCHAR2(10),
  t7asist            VARCHAR2(10),
  t7noasi            VARCHAR2(10),
  t7noved            VARCHAR2(100),
  t7saten            VARCHAR2(10),
  t7satco            VARCHAR2(10),
  t8plane            VARCHAR2(10),
  t8ejecu            VARCHAR2(10),
  t8asist            VARCHAR2(10),
  t8noasi            VARCHAR2(10),
  t8noved            VARCHAR2(100),
  t8saten            VARCHAR2(10),
  t8satco            VARCHAR2(10),
  lugar              VARCHAR2(255),
  direccion          VARCHAR2(255),
  sigla              VARCHAR2(20),
  iddepartamento     NUMBER not null,
  idmunicipio        NUMBER not null,
  idfacilitador      NUMBER,
  idcoordinador      NUMBER,
  tipo_corte         VARCHAR2(20),
  fec_corte          VARCHAR2(10),
  estado             VARCHAR2(10)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T103_RPT_CRONOGRAMATALLER
  is 'Reporte Seguimiento Talleres';

prompt
prompt Creating table T103_RPT_CRONOGRAMATAL160718
prompt ===========================================
prompt
create table HPV.T103_RPT_CRONOGRAMATAL160718
(
  periodo            NUMBER,
  idgrupofacilitador NUMBER not null,
  divipola           VARCHAR2(5),
  nomdepartamento    VARCHAR2(100),
  nommunicipio       VARCHAR2(100),
  nomcoordinador     VARCHAR2(803),
  nombrefacilitador  VARCHAR2(803),
  idgrupo            NUMBER,
  dia                VARCHAR2(10),
  horario            VARCHAR2(15),
  inscritos          NUMBER,
  taller1            DATE,
  taller2            DATE,
  taller3            DATE,
  taller4            DATE,
  taller5            DATE,
  taller6            DATE,
  taller7            DATE,
  taller8            DATE,
  t1plane            VARCHAR2(10),
  t1ejecu            VARCHAR2(10),
  t1asist            VARCHAR2(10),
  t1noasi            VARCHAR2(10),
  t1noved            VARCHAR2(100),
  t1saten            VARCHAR2(10),
  t1satco            VARCHAR2(10),
  t2plane            VARCHAR2(10),
  t2ejecu            VARCHAR2(10),
  t2asist            VARCHAR2(10),
  t2noasi            VARCHAR2(10),
  t2noved            VARCHAR2(100),
  t2saten            VARCHAR2(10),
  t2satco            VARCHAR2(10),
  t3plane            VARCHAR2(10),
  t3ejecu            VARCHAR2(10),
  t3asist            VARCHAR2(10),
  t3noasi            VARCHAR2(10),
  t3noved            VARCHAR2(100),
  t3saten            VARCHAR2(10),
  t3satco            VARCHAR2(10),
  t4plane            VARCHAR2(10),
  t4ejecu            VARCHAR2(10),
  t4asist            VARCHAR2(10),
  t4noasi            VARCHAR2(10),
  t4noved            VARCHAR2(100),
  t4saten            VARCHAR2(10),
  t4satco            VARCHAR2(10),
  t5plane            VARCHAR2(10),
  t5ejecu            VARCHAR2(10),
  t5asist            VARCHAR2(10),
  t5noasi            VARCHAR2(10),
  t5noved            VARCHAR2(100),
  t5saten            VARCHAR2(10),
  t5satco            VARCHAR2(10),
  t6plane            VARCHAR2(10),
  t6ejecu            VARCHAR2(10),
  t6asist            VARCHAR2(10),
  t6noasi            VARCHAR2(10),
  t6noved            VARCHAR2(100),
  t6saten            VARCHAR2(10),
  t6satco            VARCHAR2(10),
  t7plane            VARCHAR2(10),
  t7ejecu            VARCHAR2(10),
  t7asist            VARCHAR2(10),
  t7noasi            VARCHAR2(10),
  t7noved            VARCHAR2(100),
  t7saten            VARCHAR2(10),
  t7satco            VARCHAR2(10),
  t8plane            VARCHAR2(10),
  t8ejecu            VARCHAR2(10),
  t8asist            VARCHAR2(10),
  t8noasi            VARCHAR2(10),
  t8noved            VARCHAR2(100),
  t8saten            VARCHAR2(10),
  t8satco            VARCHAR2(10),
  lugar              VARCHAR2(255),
  direccion          VARCHAR2(255),
  sigla              VARCHAR2(20),
  iddepartamento     NUMBER not null,
  idmunicipio        NUMBER not null,
  idfacilitador      NUMBER,
  idcoordinador      NUMBER,
  tipo_corte         VARCHAR2(20),
  fec_corte          VARCHAR2(10)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T103_RPT_CRONOGRAMATAL160718
  is 'temporal backup';

prompt
prompt Creating table T103_RPT_CRONOGTALLER160711
prompt ==========================================
prompt
create table HPV.T103_RPT_CRONOGTALLER160711
(
  periodo            NUMBER,
  idgrupofacilitador NUMBER not null,
  divipola           VARCHAR2(5),
  nomdepartamento    VARCHAR2(100),
  nommunicipio       VARCHAR2(100),
  nomcoordinador     VARCHAR2(803),
  nombrefacilitador  VARCHAR2(803),
  idgrupo            NUMBER,
  dia                VARCHAR2(10),
  horario            VARCHAR2(15),
  inscritos          NUMBER,
  taller1            DATE,
  taller2            DATE,
  taller3            DATE,
  taller4            DATE,
  taller5            DATE,
  taller6            DATE,
  taller7            DATE,
  taller8            DATE,
  iddepartamento     NUMBER not null,
  idmunicipio        NUMBER not null,
  idfacilitador      NUMBER,
  idcoordinador      NUMBER,
  tipo_corte         VARCHAR2(20),
  fec_corte          VARCHAR2(10)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T104_RPT_ENC_ENT_SAL
prompt ===================================
prompt
create table HPV.T104_RPT_ENC_ENT_SAL
(
  periodo            NUMBER,
  idinscrito         NUMBER,
  divipola           VARCHAR2(100),
  nomdepartamento    VARCHAR2(100),
  nommunicipio       VARCHAR2(100),
  nombrecoordinador  VARCHAR2(803),
  cc_facilitador     VARCHAR2(15),
  nombrefacilitador  VARCHAR2(803),
  grupofacilitador   NUMBER,
  siglagrupo         VARCHAR2(50),
  tipodocumento      VARCHAR2(10),
  documento          VARCHAR2(20),
  codigobeneficiario VARCHAR2(20),
  genero             VARCHAR2(50),
  condicion          VARCHAR2(50),
  estado             VARCHAR2(50),
  e01                VARCHAR2(10),
  e02                VARCHAR2(10),
  e03                VARCHAR2(10),
  e04                VARCHAR2(10),
  e05                VARCHAR2(10),
  e06                VARCHAR2(10),
  e07                VARCHAR2(10),
  e08                VARCHAR2(10),
  e09                VARCHAR2(10),
  e10                VARCHAR2(10),
  e11                VARCHAR2(10),
  e12                VARCHAR2(10),
  e13                VARCHAR2(10),
  e14                VARCHAR2(10),
  e15                VARCHAR2(10),
  e16                VARCHAR2(10),
  e17                VARCHAR2(10),
  e18                VARCHAR2(10),
  e19                VARCHAR2(10),
  e20                VARCHAR2(10),
  e21                VARCHAR2(10),
  s01                VARCHAR2(10),
  s02                VARCHAR2(10),
  s03                VARCHAR2(10),
  s04                VARCHAR2(10),
  s05                VARCHAR2(10),
  s06                VARCHAR2(10),
  s07                VARCHAR2(10),
  s08                VARCHAR2(10),
  s09                VARCHAR2(10),
  s10                VARCHAR2(10),
  s11                VARCHAR2(10),
  s12                VARCHAR2(10),
  s13                VARCHAR2(10),
  s14                VARCHAR2(10),
  s15                VARCHAR2(10),
  s16                VARCHAR2(10),
  idmunicipio        NUMBER,
  iddepartamento     NUMBER,
  idfacilitador      NUMBER,
  idcoordinador      NUMBER,
  tipo_corte         VARCHAR2(20),
  fec_corte          VARCHAR2(10),
  fec_tmp            DATE,
  tipoformacion      VARCHAR2(100),
  primeraee          NUMBER,
  primeraes          NUMBER,
  fec_es             DATE,
  valido             VARCHAR2(20)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T104_RPT_ENC_ENT_SAL
  is 'Reporte Encuestas Entrada y Salida';

prompt
prompt Creating table T104_RPT_ENC_ENT_SAL160711
prompt =========================================
prompt
create table HPV.T104_RPT_ENC_ENT_SAL160711
(
  periodo           NUMBER,
  idinscrito        NUMBER,
  nomdepartamento   VARCHAR2(100),
  nommunicipio      VARCHAR2(100),
  nombrecoordinador VARCHAR2(803),
  cc_facilitador    VARCHAR2(15),
  nombrefacilitador VARCHAR2(803),
  grupofacilitador  NUMBER,
  siglagrupo        VARCHAR2(50),
  e01               VARCHAR2(10),
  e02               VARCHAR2(10),
  e03               VARCHAR2(10),
  e04               VARCHAR2(10),
  e05               VARCHAR2(10),
  e06               VARCHAR2(10),
  e07               VARCHAR2(10),
  e08               VARCHAR2(10),
  e09               VARCHAR2(10),
  e10               VARCHAR2(10),
  e11               VARCHAR2(10),
  e12               VARCHAR2(10),
  e13               VARCHAR2(10),
  e14               VARCHAR2(10),
  e15               VARCHAR2(10),
  e16               VARCHAR2(10),
  e17               VARCHAR2(10),
  e18               VARCHAR2(10),
  e19               VARCHAR2(10),
  e20               VARCHAR2(10),
  e21               VARCHAR2(10),
  s01               VARCHAR2(10),
  s02               VARCHAR2(10),
  s03               VARCHAR2(10),
  s04               VARCHAR2(10),
  s05               VARCHAR2(10),
  s06               VARCHAR2(10),
  s07               VARCHAR2(10),
  s08               VARCHAR2(10),
  s09               VARCHAR2(10),
  s10               VARCHAR2(10),
  s11               VARCHAR2(10),
  s12               VARCHAR2(10),
  s13               VARCHAR2(10),
  s14               VARCHAR2(10),
  s15               VARCHAR2(10),
  s16               VARCHAR2(10),
  idmunicipio       NUMBER,
  iddepartamento    NUMBER,
  idfacilitador     NUMBER,
  idcoordinador     NUMBER,
  tipo_corte        VARCHAR2(20),
  fec_corte         VARCHAR2(10)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T104_RPT_ENC_ENT_SAL160711
  is 'temporal backup';

prompt
prompt Creating table T104_RPT_ENC_ENT_SAL160718
prompt =========================================
prompt
create table HPV.T104_RPT_ENC_ENT_SAL160718
(
  periodo            NUMBER,
  idinscrito         NUMBER,
  divipola           VARCHAR2(100),
  nomdepartamento    VARCHAR2(100),
  nommunicipio       VARCHAR2(100),
  nombrecoordinador  VARCHAR2(803),
  cc_facilitador     VARCHAR2(15),
  nombrefacilitador  VARCHAR2(803),
  grupofacilitador   NUMBER,
  siglagrupo         VARCHAR2(50),
  tipodocumento      VARCHAR2(10),
  documento          VARCHAR2(20),
  codigobeneficiario VARCHAR2(20),
  genero             VARCHAR2(50),
  condicion          VARCHAR2(50),
  estado             VARCHAR2(50),
  e01                VARCHAR2(10),
  e02                VARCHAR2(10),
  e03                VARCHAR2(10),
  e04                VARCHAR2(10),
  e05                VARCHAR2(10),
  e06                VARCHAR2(10),
  e07                VARCHAR2(10),
  e08                VARCHAR2(10),
  e09                VARCHAR2(10),
  e10                VARCHAR2(10),
  e11                VARCHAR2(10),
  e12                VARCHAR2(10),
  e13                VARCHAR2(10),
  e14                VARCHAR2(10),
  e15                VARCHAR2(10),
  e16                VARCHAR2(10),
  e17                VARCHAR2(10),
  e18                VARCHAR2(10),
  e19                VARCHAR2(10),
  e20                VARCHAR2(10),
  e21                VARCHAR2(10),
  s01                VARCHAR2(10),
  s02                VARCHAR2(10),
  s03                VARCHAR2(10),
  s04                VARCHAR2(10),
  s05                VARCHAR2(10),
  s06                VARCHAR2(10),
  s07                VARCHAR2(10),
  s08                VARCHAR2(10),
  s09                VARCHAR2(10),
  s10                VARCHAR2(10),
  s11                VARCHAR2(10),
  s12                VARCHAR2(10),
  s13                VARCHAR2(10),
  s14                VARCHAR2(10),
  s15                VARCHAR2(10),
  s16                VARCHAR2(10),
  idmunicipio        NUMBER,
  iddepartamento     NUMBER,
  idfacilitador      NUMBER,
  idcoordinador      NUMBER,
  tipo_corte         VARCHAR2(20),
  fec_corte          VARCHAR2(10)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T104_RPT_ENC_ENT_SAL160718
  is 'temporal backup';

prompt
prompt Creating table T105_RPT_CANDIDATOS
prompt ==================================
prompt
create table HPV.T105_RPT_CANDIDATOS
(
  periodo            NUMBER,
  tipodocumento      VARCHAR2(2),
  documento          VARCHAR2(15),
  primernombre       VARCHAR2(200),
  segundonombre      VARCHAR2(200),
  primerapellido     VARCHAR2(200),
  segundoapellido    VARCHAR2(200),
  fechanacimiento    DATE,
  email              VARCHAR2(200),
  telefono           VARCHAR2(25),
  movil              VARCHAR2(30),
  movilalt           VARCHAR2(30),
  condicionespecial  NUMBER,
  codigobeneficiario NUMBER,
  estado             CHAR(1),
  fechacreacion      DATE,
  tipo_corte         CHAR(1),
  fec_corte          CHAR(10)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T105_RPT_CANDIDATOS
  is 'Reporte Candidatos';

prompt
prompt Creating table T105_RPT_CANDIDATOS160718
prompt ========================================
prompt
create table HPV.T105_RPT_CANDIDATOS160718
(
  periodo            NUMBER,
  tipodocumento      VARCHAR2(2),
  documento          VARCHAR2(15),
  primernombre       VARCHAR2(200),
  segundonombre      VARCHAR2(200),
  primerapellido     VARCHAR2(200),
  segundoapellido    VARCHAR2(200),
  fechanacimiento    DATE,
  email              VARCHAR2(200),
  telefono           VARCHAR2(25),
  movil              VARCHAR2(30),
  movilalt           VARCHAR2(30),
  condicionespecial  NUMBER,
  codigobeneficiario NUMBER,
  estado             CHAR(1),
  fechacreacion      DATE,
  tipo_corte         CHAR(1),
  fec_corte          CHAR(10)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T105_RPT_CANDIDATOS160718
  is 'temporal backup';

prompt
prompt Creating table T106_RPT_ENCSATISFACCIONOBS
prompt ==========================================
prompt
create table HPV.T106_RPT_ENCSATISFACCIONOBS
(
  periodo                       CHAR(1),
  divipola                      CHAR(5),
  nombre_departamento           CHAR(13),
  nombre_municipio              CHAR(9),
  nombre_facilitador            CHAR(19),
  sigla_grupo                   CHAR(10),
  primer_nombre_participante    CHAR(6),
  segundo_nombre_participante   CHAR(6),
  primer_apellido_participante  CHAR(7),
  segundo_apellido_participante CHAR(10),
  tipo_documento                CHAR(6),
  documento                     CHAR(8),
  codigo_beneficiario           CHAR(6),
  taller                        CHAR(1),
  observaciones                 CHAR(17)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T106_RPT_ENCSATISFACCIONOBS
  is 'Reporte Encuesta de Satisfaccion';

prompt
prompt Creating table T107_RPT_CASOSEXITO
prompt ==================================
prompt
create table HPV.T107_RPT_CASOSEXITO
(
  periodo                      NUMBER,
  divipola                     VARCHAR2(100),
  nombre_departamento          VARCHAR2(100),
  nombre_municipio             VARCHAR2(100),
  nombre_coordinador           VARCHAR2(100),
  cedula_facilitador           VARCHAR2(15),
  nombre_facilitador           VARCHAR2(100),
  sigla_grupo                  VARCHAR2(50),
  documento_participante       VARCHAR2(20),
  codigo_beneficiario          VARCHAR2(20),
  primernombre_participante    VARCHAR2(100),
  segundonombre_participante   VARCHAR2(100),
  primerapellido_participante  VARCHAR2(100),
  segundoapellido_participante VARCHAR2(100),
  genero                       VARCHAR2(100),
  condicion                    VARCHAR2(100),
  tipo_formacion               VARCHAR2(100),
  nivel_formacion              VARCHAR2(100),
  asistencias                  VARCHAR2(100),
  r1                           VARCHAR2(100),
  r2                           VARCHAR2(100),
  r3                           VARCHAR2(100),
  r4                           VARCHAR2(100),
  r5                           VARCHAR2(100),
  r6                           VARCHAR2(100),
  r7                           VARCHAR2(100),
  r8                           VARCHAR2(100),
  r9                           VARCHAR2(100),
  r10                          VARCHAR2(100),
  observaciones                VARCHAR2(4000),
  estado                       VARCHAR2(100),
  idmunicipio                  NUMBER,
  iddepartamento               NUMBER,
  idfacilitador                NUMBER,
  idcoordinador                NUMBER,
  idcodigogrupo                NUMBER,
  tipo_corte                   VARCHAR2(20),
  fec_corte                    VARCHAR2(10),
  tipo_documento_participante  VARCHAR2(10),
  idinscrito                   NUMBER,
  idcasoexito                  NUMBER,
  r1p                          NUMBER default 0,
  r2p                          NUMBER default 0,
  r3p                          NUMBER default 0,
  r4p                          NUMBER default 0,
  r5p                          NUMBER default 0,
  r6p                          NUMBER default 0,
  r7p                          NUMBER default 0,
  r8p                          NUMBER default 0,
  r9p                          NUMBER default 0,
  r10p                         NUMBER default 0,
  rtp                          NUMBER default 0,
  t1_1                         NUMBER,
  t1_2                         NUMBER,
  t1_3                         NUMBER,
  t1_t                         NUMBER,
  t2_4                         NUMBER,
  t2_5                         NUMBER,
  t2_t                         NUMBER,
  t3_6                         NUMBER,
  t3_t                         NUMBER,
  t4_7                         NUMBER,
  t4_8                         NUMBER,
  t4_t                         NUMBER,
  t5_9                         NUMBER,
  t5_10                        NUMBER,
  t5_t                         NUMBER,
  t6_11                        NUMBER,
  t6_12                        NUMBER,
  t6_t                         NUMBER,
  t7_13                        NUMBER,
  t7_14                        NUMBER,
  t7_t                         NUMBER,
  t8_15                        NUMBER,
  t8_16                        NUMBER,
  t8_17                        NUMBER,
  t8_18                        NUMBER,
  t8_19                        NUMBER,
  t8_t                         NUMBER,
  tlogros_t                    NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T107_RPT_CASOSEXITO
  is 'Reporte caso de exito';

prompt
prompt Creating table T108_RPT_EJEMLIDERAZGO
prompt =====================================
prompt
create table HPV.T108_RPT_EJEMLIDERAZGO
(
  periodo                      NUMBER,
  divipola                     VARCHAR2(100),
  nombre_departamento          VARCHAR2(100),
  nombre_municipio             VARCHAR2(100),
  nombre_coordinador           VARCHAR2(100),
  cedula_facilitador           VARCHAR2(15),
  nombre_facilitador           VARCHAR2(100),
  sigla_grupo                  VARCHAR2(50),
  tipo_documento_participante  VARCHAR2(10),
  documento_participante       VARCHAR2(20),
  codigo_beneficiario          VARCHAR2(20),
  primernombre_participante    VARCHAR2(100),
  segundonombre_participante   VARCHAR2(100),
  primerapellido_participante  VARCHAR2(100),
  segundoapellido_participante VARCHAR2(100),
  genero                       VARCHAR2(100),
  condicion                    VARCHAR2(100),
  tipo_formacion               VARCHAR2(100),
  nivel_formacion              VARCHAR2(100),
  asistencias                  VARCHAR2(100),
  r1                           VARCHAR2(100),
  r2                           VARCHAR2(100),
  r3                           VARCHAR2(100),
  r4                           VARCHAR2(100),
  r5                           VARCHAR2(100),
  r6                           VARCHAR2(100),
  r7                           VARCHAR2(100),
  r8                           VARCHAR2(100),
  observaciones                VARCHAR2(4000),
  estado                       VARCHAR2(100),
  idmunicipio                  NUMBER,
  iddepartamento               NUMBER,
  idfacilitador                NUMBER,
  idcoordinador                NUMBER,
  idcodigogrupo                NUMBER,
  tipo_corte                   VARCHAR2(20),
  fec_corte                    VARCHAR2(10),
  idinscrito                   NUMBER,
  idejemplider                 NUMBER,
  r1p                          NUMBER default 0,
  r2p                          NUMBER default 0,
  r3p                          NUMBER default 0,
  r4p                          NUMBER default 0,
  r5p                          NUMBER default 0,
  r6p                          NUMBER default 0,
  r7p                          NUMBER default 0,
  r8p                          NUMBER default 0,
  rtp                          NUMBER default 0
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T108_RPT_EJEMLIDERAZGO
  is 'Reporte Ejemplo de Liderazgo';

prompt
prompt Creating table T109_RPT_HISTVIDA
prompt ================================
prompt
create table HPV.T109_RPT_HISTVIDA
(
  periodo                      NUMBER,
  divipola                     VARCHAR2(100),
  nombre_departamento          VARCHAR2(100),
  nombre_municipio             VARCHAR2(100),
  nombre_coordinador           VARCHAR2(100),
  cedula_facilitador           VARCHAR2(15),
  nombre_facilitador           VARCHAR2(100),
  sigla_grupo                  VARCHAR2(50),
  tipo_documento_participante  VARCHAR2(10),
  documento_participante       VARCHAR2(20),
  codigo_beneficiario          VARCHAR2(20),
  primernombre_participante    VARCHAR2(100),
  segundonombre_participante   VARCHAR2(100),
  primerapellido_participante  VARCHAR2(100),
  segundoapellido_participante VARCHAR2(100),
  genero                       VARCHAR2(100),
  condicion                    VARCHAR2(100),
  tipo_formacion               VARCHAR2(100),
  nivel_formacion              VARCHAR2(100),
  asistencias                  VARCHAR2(100),
  consideracion                VARCHAR2(4000),
  circunstancias               VARCHAR2(4000),
  habilidades                  VARCHAR2(4000),
  leccion                      VARCHAR2(4000),
  entregable                   VARCHAR2(100),
  observaciones                VARCHAR2(4000),
  estado                       VARCHAR2(100),
  idmunicipio                  NUMBER,
  iddepartamento               NUMBER,
  idfacilitador                NUMBER,
  idcoordinador                NUMBER,
  idcodigogrupo                NUMBER,
  tipo_corte                   VARCHAR2(20),
  fec_corte                    VARCHAR2(10),
  idinscrito                   NUMBER,
  idhistvida                   NUMBER,
  hvtipo1                      VARCHAR2(10),
  hvtipo2                      VARCHAR2(10),
  hvtipo3                      VARCHAR2(10),
  hvtipo4                      VARCHAR2(10),
  hvtipo5                      VARCHAR2(10)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T109_RPT_HISTVIDA
  is 'Reporte Historia de vida';

prompt
prompt Creating table T11_MENUOPCIONES
prompt ===============================
prompt
create table HPV.T11_MENUOPCIONES
(
  a11menu                NUMBER not null,
  a11opcion              NUMBER not null,
  a11estado              CHAR(1),
  a11fechacreacion       DATE,
  a11fechamodificacion   DATE,
  a11usuariocreacion     NUMBER,
  a11usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T11_MENUOPCIONES
  is 'Tabla que contiene la información de las opciones del sistema asociadas a un menú';
comment on column HPV.T11_MENUOPCIONES.a11menu
  is 'FK de la tabla T09_MENU ID del menú';
comment on column HPV.T11_MENUOPCIONES.a11opcion
  is 'FK de la tabla T10_OPCIONES ID de la opción';
comment on column HPV.T11_MENUOPCIONES.a11estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T11_MENUOPCIONES.a11fechacreacion
  is 'Fecha creacion';
comment on column HPV.T11_MENUOPCIONES.a11fechamodificacion
  is 'Fecha modificacion';
comment on column HPV.T11_MENUOPCIONES.a11usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T11_MENUOPCIONES.a11usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T11_MENUOPCIONES
  add constraint PK_T11_MENUOPCIONES primary key (A11MENU, A11OPCION)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T11_MENUOPCIONES
  add constraint FK_T11_T09 foreign key (A11MENU)
  references HPV.T09_MENU (A09CODIGO);
alter table HPV.T11_MENUOPCIONES
  add constraint FK_T11_T10 foreign key (A11OPCION)
  references HPV.T10_OPCIONES (A10CODIGO);

prompt
prompt Creating table T110_PARTCONTINGENCIAS
prompt =====================================
prompt
create table HPV.T110_PARTCONTINGENCIAS
(
  a110documento NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T110_PARTCONTINGENCIAS
  is 'Tabla de participantes contingentes';

prompt
prompt Creating table T111_OPCIONESAUDIT
prompt =================================
prompt
create table HPV.T111_OPCIONESAUDIT
(
  codigo      NUMBER,
  nombre      VARCHAR2(100),
  descripcion VARCHAR2(1000),
  sqltxt      VARCHAR2(4000)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T111_OPCIONESAUDIT
  is 'Tabla que contiene las opciones de auditoria';

prompt
prompt Creating table T112_RPT_GESTESPACIOS
prompt ====================================
prompt
create table HPV.T112_RPT_GESTESPACIOS
(
  periodo            NUMBER,
  idgrupofacilitador NUMBER not null,
  divipola           VARCHAR2(5),
  nomdepartamento    VARCHAR2(100),
  nommunicipio       VARCHAR2(100),
  nomcoordinador     VARCHAR2(803),
  nombrefacilitador  VARCHAR2(803),
  idgrupo            NUMBER,
  dia                VARCHAR2(10),
  horario            VARCHAR2(15),
  lugar              VARCHAR2(255),
  direccion          VARCHAR2(255),
  sigla              VARCHAR2(20),
  iddepartamento     NUMBER not null,
  idmunicipio        NUMBER not null,
  idfacilitador      NUMBER,
  idcoordinador      NUMBER,
  tipo_corte         VARCHAR2(20),
  fec_corte          VARCHAR2(10),
  estado             VARCHAR2(10),
  fec_modifica       DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T112_RPT_GESTESPACIOS
  is 'Reporte de Gestion de espacios';

prompt
prompt Creating table T113_CONTRATOS
prompt =============================
prompt
create table HPV.T113_CONTRATOS
(
  a113idusuario           NUMBER not null,
  a113idusuario_rem       NUMBER,
  a113fechaini            DATE,
  a113fechafin            DATE,
  a113estado              CHAR(1),
  a113fechacreacion       DATE,
  a113fechamodificacion   DATE,
  a113usuariocreacion     NUMBER,
  a113usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T12_PERIODOS
prompt ===========================
prompt
create table HPV.T12_PERIODOS
(
  a12codigo              NUMBER not null,
  a12nombre              VARCHAR2(50),
  a12fechainicio         DATE,
  a12fechafin            DATE,
  a12noperiodo           NUMBER,
  a12estado              CHAR(1),
  a12fechacreacion       DATE,
  a12fechamodificacion   DATE,
  a12usuariocreacion     NUMBER,
  a12usuariomodificacion NUMBER,
  a12fechainitaller      DATE,
  a12fechacertificado    DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T12_PERIODOS
  is 'Tabla que contiene la información de los periodos para realizar los talleres';
comment on column HPV.T12_PERIODOS.a12codigo
  is 'Identificación única del registro';
comment on column HPV.T12_PERIODOS.a12nombre
  is 'Nombre del periodo';
comment on column HPV.T12_PERIODOS.a12fechainicio
  is 'Fecha de inicio del periodo';
comment on column HPV.T12_PERIODOS.a12fechafin
  is 'Fecha de finalizacion del periodo';
comment on column HPV.T12_PERIODOS.a12noperiodo
  is 'Numero del periodo maximo 5 periodos por año';
comment on column HPV.T12_PERIODOS.a12estado
  is 'Estado A:Activo I:Inactivo; P:Inscripcion ';
comment on column HPV.T12_PERIODOS.a12fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T12_PERIODOS.a12fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T12_PERIODOS.a12usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T12_PERIODOS.a12usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T12_PERIODOS.a12fechainitaller
  is 'Fecha inicial de talleres para el periodo, debe ser martes';
comment on column HPV.T12_PERIODOS.a12fechacertificado
  is 'Fecha de generacion certificado';
alter table HPV.T12_PERIODOS
  add constraint PK_T12_PERIODOS primary key (A12CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T12_PERIODOS
  add constraint CK_A12ESTADO
  check (A12ESTADO IN ('A','I', 'P'));

prompt
prompt Creating table T50_ENCUESTA
prompt ===========================
prompt
create table HPV.T50_ENCUESTA
(
  a50codigo              NUMBER not null,
  a50descripcion         VARCHAR2(100),
  a50periodo             NUMBER,
  a50tipoencuesta        CHAR(1),
  a50estado              CHAR(1),
  a50fechacreacion       DATE,
  a50fechamodificacion   DATE,
  a50usuariocreacion     NUMBER,
  a50usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T50_ENCUESTA
  is 'Tabla que contiene la información de la encuestas';
comment on column HPV.T50_ENCUESTA.a50codigo
  is 'Identificacion unica del registro';
comment on column HPV.T50_ENCUESTA.a50descripcion
  is 'Descripcion de la encuesta';
comment on column HPV.T50_ENCUESTA.a50periodo
  is 'FK de la tabla T12_PERIODOS Periodo al cual pertenece la encuesta';
comment on column HPV.T50_ENCUESTA.a50tipoencuesta
  is 'I: Inscripcion, T:Taller, F:Finalizacion';
comment on column HPV.T50_ENCUESTA.a50estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T50_ENCUESTA.a50fechacreacion
  is 'Fecha de creacion del registro';
comment on column HPV.T50_ENCUESTA.a50fechamodificacion
  is 'Fecha de modificacion del registro';
comment on column HPV.T50_ENCUESTA.a50usuariocreacion
  is 'Usuario que realizo la creacion del registro';
comment on column HPV.T50_ENCUESTA.a50usuariomodificacion
  is 'Usuario que realizo modificacion';
create unique index HPV.PK_T50_ENCUESTA on HPV.T50_ENCUESTA (A50CODIGO)
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T50_ENCUESTA
  add constraint PK_T50DBO_ENCUESTA primary key (A50CODIGO);
alter table HPV.T50_ENCUESTA
  add constraint FK_T50_T12 foreign key (A50PERIODO)
  references HPV.T12_PERIODOS (A12CODIGO);

prompt
prompt Creating table T13_ENCUESTAPREGUNTAS
prompt ====================================
prompt
create table HPV.T13_ENCUESTAPREGUNTAS
(
  a13codigo              NUMBER not null,
  a13numero              NUMBER,
  a13pregunta            VARCHAR2(500),
  a13encuesta            NUMBER,
  a13estado              CHAR(1),
  a13fechacreacion       DATE,
  a13fechamodificacion   DATE,
  a13usuariocreacion     NUMBER,
  a13usuariomodificacion NUMBER,
  a13comoseentero        CHAR(1)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T13_ENCUESTAPREGUNTAS
  is 'Tabla que contiene la información de las preguntas reallizadas en una encuesta';
comment on column HPV.T13_ENCUESTAPREGUNTAS.a13codigo
  is 'Identificación única del registro';
comment on column HPV.T13_ENCUESTAPREGUNTAS.a13numero
  is 'Numero para mostrar en pantalla de la pregunta';
comment on column HPV.T13_ENCUESTAPREGUNTAS.a13pregunta
  is 'Descripcion de la pregunta';
comment on column HPV.T13_ENCUESTAPREGUNTAS.a13encuesta
  is 'FK de la tabla T50_ENCUESTA ID de la encuesta a la que pertenece la pregunta';
comment on column HPV.T13_ENCUESTAPREGUNTAS.a13estado
  is 'Estado de la pregunta A:Activo I:Inactivo';
comment on column HPV.T13_ENCUESTAPREGUNTAS.a13fechacreacion
  is 'Fecha creacion';
comment on column HPV.T13_ENCUESTAPREGUNTAS.a13fechamodificacion
  is 'Fecha modificacion';
comment on column HPV.T13_ENCUESTAPREGUNTAS.a13usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T13_ENCUESTAPREGUNTAS.a13usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T13_ENCUESTAPREGUNTAS.a13comoseentero
  is 'S si la pregunta es el Como se Entero';
alter table HPV.T13_ENCUESTAPREGUNTAS
  add constraint PK_T13_ENCUESTAPREGUNTAS primary key (A13CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T13_ENCUESTAPREGUNTAS
  add constraint FK_T13_T50 foreign key (A13ENCUESTA)
  references HPV.T50_ENCUESTA (A50CODIGO);

prompt
prompt Creating table T14_ENCUESTARESPUESTAS
prompt =====================================
prompt
create table HPV.T14_ENCUESTARESPUESTAS
(
  a14codigo              NUMBER not null,
  a14pregunta            NUMBER,
  a14letra               CHAR(1),
  a14respuesta           VARCHAR2(500),
  a14correcta            CHAR(1),
  a14estado              CHAR(1),
  a14fechacreacion       DATE,
  a14fechamodificacion   DATE,
  a14usuariocreacion     NUMBER,
  a14usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T14_ENCUESTARESPUESTAS
  is 'Tabla que contiene la información de las respuestas asociadas a una pregunta';
comment on column HPV.T14_ENCUESTARESPUESTAS.a14codigo
  is 'Identificación única del registro';
comment on column HPV.T14_ENCUESTARESPUESTAS.a14pregunta
  is 'FK de la tabla T13_ENCUESTAPREGUNTAS
 ID de la pregunta asociada a las respuetas';
comment on column HPV.T14_ENCUESTARESPUESTAS.a14letra
  is 'Letra asignada a la pregunta';
comment on column HPV.T14_ENCUESTARESPUESTAS.a14respuesta
  is 'Descripción de la respuesta';
comment on column HPV.T14_ENCUESTARESPUESTAS.a14correcta
  is 'Valor para indicar si la respuesta es la correcta S:Correcta N: No correcta';
comment on column HPV.T14_ENCUESTARESPUESTAS.a14estado
  is 'Estado de la pregunta A:Activo I:Inactivo';
comment on column HPV.T14_ENCUESTARESPUESTAS.a14fechacreacion
  is 'Fecha creacion';
comment on column HPV.T14_ENCUESTARESPUESTAS.a14fechamodificacion
  is 'Fecha modificacion';
comment on column HPV.T14_ENCUESTARESPUESTAS.a14usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T14_ENCUESTARESPUESTAS.a14usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T14_ENCUESTARESPUESTAS
  add constraint PK_T14_ENCUESTARESPUESTAS primary key (A14CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T14_ENCUESTARESPUESTAS
  add constraint FK_T14_T13 foreign key (A14PREGUNTA)
  references HPV.T13_ENCUESTAPREGUNTAS (A13CODIGO);

prompt
prompt Creating table T14_ENCUESTARESPUESTAS160717
prompt ===========================================
prompt
create table HPV.T14_ENCUESTARESPUESTAS160717
(
  a14codigo              NUMBER not null,
  a14pregunta            NUMBER,
  a14letra               CHAR(1),
  a14respuesta           VARCHAR2(500),
  a14correcta            CHAR(1),
  a14estado              CHAR(1),
  a14fechacreacion       DATE,
  a14fechamodificacion   DATE,
  a14usuariocreacion     NUMBER,
  a14usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T14_ENCUESTARESPUESTAS160717
  is 'temporal backup';

prompt
prompt Creating table T90_ESTADOSESPACIOFISICO
prompt =======================================
prompt
create table HPV.T90_ESTADOSESPACIOFISICO
(
  a90codigo              VARCHAR2(10) not null,
  a90nombre              VARCHAR2(200),
  a90estado              CHAR(1),
  a90fechacreacion       DATE,
  a90fechamodificacion   DATE,
  a90usuariocreacion     NUMBER,
  a90usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T90_ESTADOSESPACIOFISICO
  is 'Tabla que contiene la información de los estados de los espacios fisicos configurados en el sistema';
comment on column HPV.T90_ESTADOSESPACIOFISICO.a90codigo
  is 'Identificacion unica del registro';
comment on column HPV.T90_ESTADOSESPACIOFISICO.a90nombre
  is 'Nombre del estado';
comment on column HPV.T90_ESTADOSESPACIOFISICO.a90estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T90_ESTADOSESPACIOFISICO.a90fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T90_ESTADOSESPACIOFISICO.a90fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T90_ESTADOSESPACIOFISICO.a90usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T90_ESTADOSESPACIOFISICO.a90usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T90_ESTADOSESPACIOFISICO
  add constraint PK_T90_ESTADOSESPACIOFISICO primary key (A90CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T23_DIAS
prompt =======================
prompt
create table HPV.T23_DIAS
(
  a23codigo              NUMBER not null,
  a23nombre              VARCHAR2(10),
  a23estado              CHAR(1),
  a23fechacreacion       DATE,
  a23fechamodificacion   DATE,
  a23usuariocreacion     NUMBER,
  a23usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T23_DIAS
  is 'Tabla que contiene la información de los días de la semana';
comment on column HPV.T23_DIAS.a23codigo
  is 'Identificación única del registro';
comment on column HPV.T23_DIAS.a23nombre
  is 'Nombre del día';
comment on column HPV.T23_DIAS.a23estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T23_DIAS.a23fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T23_DIAS.a23fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T23_DIAS.a23usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T23_DIAS.a23usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T23_DIAS
  add constraint PK_T23_DIAS primary key (A23CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T23_DIAS
  add constraint CK_A23ESTADO
  check (A23ESTADO IN ('A','I'));

prompt
prompt Creating table T24_HORARIOS
prompt ===========================
prompt
create table HPV.T24_HORARIOS
(
  a24codigo              NUMBER not null,
  a24horario             VARCHAR2(15),
  a24estado              CHAR(1),
  a24fechacreacion       DATE,
  a24fechamodificacion   DATE,
  a24usuariocreacion     NUMBER,
  a24usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T24_HORARIOS
  is 'Tabla que contiene la información de los horarios definidos para realizar los talleres';
comment on column HPV.T24_HORARIOS.a24codigo
  is 'Identificación única del registro';
comment on column HPV.T24_HORARIOS.a24horario
  is 'Descripcion del horario';
comment on column HPV.T24_HORARIOS.a24estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T24_HORARIOS.a24fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T24_HORARIOS.a24fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T24_HORARIOS.a24usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T24_HORARIOS.a24usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T24_HORARIOS
  add constraint PK_T24_HORARIOS primary key (A24CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T24_HORARIOS
  add constraint CK_A24ESTADO
  check (A24ESTADO IN ('A','I'));

prompt
prompt Creating table T25_GRUPOS
prompt =========================
prompt
create table HPV.T25_GRUPOS
(
  a25codigo              NUMBER not null,
  a25nombre              VARCHAR2(50),
  a25numero              NUMBER,
  a25estado              CHAR(1),
  a25fechacreacion       DATE,
  a25fechamodificacion   DATE,
  a25usuariocreacion     NUMBER,
  a25usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T25_GRUPOS
  is 'Tabla que contiene la información de los grupos definidos para realizar los talleres';
comment on column HPV.T25_GRUPOS.a25codigo
  is 'Identificación única del registro';
comment on column HPV.T25_GRUPOS.a25nombre
  is 'Nombre del grupo';
comment on column HPV.T25_GRUPOS.a25numero
  is 'Numero del grupo';
comment on column HPV.T25_GRUPOS.a25estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T25_GRUPOS.a25fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T25_GRUPOS.a25fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T25_GRUPOS.a25usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T25_GRUPOS.a25usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T25_GRUPOS
  add constraint PK_T25_GRUPOS primary key (A25CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T25_GRUPOS
  add constraint CK_A25ESTADO
  check (A25ESTADO IN ('A','I'));

prompt
prompt Creating table T26_GRUPOSFACILITADOR
prompt ====================================
prompt
create table HPV.T26_GRUPOSFACILITADOR
(
  a26codigo              NUMBER not null,
  a26facilitador         NUMBER,
  a26ciudad              NUMBER,
  a26grupo               NUMBER,
  a26dia                 NUMBER,
  a26horario             NUMBER,
  a26lugar               VARCHAR2(255),
  a26direccion           VARCHAR2(255),
  a26sigla               VARCHAR2(20),
  a26periodo             NUMBER,
  a26condicion           CHAR(1),
  a26observaciones       VARCHAR2(1000),
  a26motivorechazo       VARCHAR2(1000),
  a26estado              VARCHAR2(10),
  a26fechacreacion       DATE,
  a26fechamodificacion   DATE,
  a26usuariocreacion     NUMBER,
  a26usuariomodificacion NUMBER,
  a26inscritos           NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T26_GRUPOSFACILITADOR
  is 'Tabla que contiene la información de grupos asociados al facilitador';
comment on column HPV.T26_GRUPOSFACILITADOR.a26codigo
  is 'Identificacion unica del registro';
comment on column HPV.T26_GRUPOSFACILITADOR.a26facilitador
  is 'FK de la tabla T06_USUARIOS ID del facilitador';
comment on column HPV.T26_GRUPOSFACILITADOR.a26ciudad
  is 'FK de la tabla T03_MUNICIPIOS ID del municipio';
comment on column HPV.T26_GRUPOSFACILITADOR.a26grupo
  is 'FK de la tabla T25_GRUPOS ID del grupo';
comment on column HPV.T26_GRUPOSFACILITADOR.a26dia
  is 'FK de la tabla T23_DIAS ID del dia';
comment on column HPV.T26_GRUPOSFACILITADOR.a26horario
  is 'FK de la tabla T24_HORARIOS ID del horario';
comment on column HPV.T26_GRUPOSFACILITADOR.a26lugar
  is 'Nombre del lugar';
comment on column HPV.T26_GRUPOSFACILITADOR.a26direccion
  is 'Dirección del lugar';
comment on column HPV.T26_GRUPOSFACILITADOR.a26sigla
  is 'Sigla del grupo';
comment on column HPV.T26_GRUPOSFACILITADOR.a26periodo
  is 'FK de la tabla T12_PERIODOS ID del periodo';
comment on column HPV.T26_GRUPOSFACILITADOR.a26condicion
  is 'Condición del grupo';
comment on column HPV.T26_GRUPOSFACILITADOR.a26observaciones
  is 'Observaciones del registro';
comment on column HPV.T26_GRUPOSFACILITADOR.a26motivorechazo
  is 'Descripción del motivo de rechazo';
comment on column HPV.T26_GRUPOSFACILITADOR.a26estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T26_GRUPOSFACILITADOR.a26fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T26_GRUPOSFACILITADOR.a26fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T26_GRUPOSFACILITADOR.a26usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T26_GRUPOSFACILITADOR.a26usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T26_GRUPOSFACILITADOR.a26inscritos
  is 'Numero de inscritos ';
alter table HPV.T26_GRUPOSFACILITADOR
  add constraint PK_T26_GRUPOSFACILITADOR primary key (A26CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T26_GRUPOSFACILITADOR
  add constraint FK_T26_T03 foreign key (A26CIUDAD)
  references HPV.T03_MUNICIPIOS (A03CODIGO);
alter table HPV.T26_GRUPOSFACILITADOR
  add constraint FK_T26_T12 foreign key (A26PERIODO)
  references HPV.T12_PERIODOS (A12CODIGO);
alter table HPV.T26_GRUPOSFACILITADOR
  add constraint FK_T26_T23 foreign key (A26DIA)
  references HPV.T23_DIAS (A23CODIGO);
alter table HPV.T26_GRUPOSFACILITADOR
  add constraint FK_T26_T24 foreign key (A26HORARIO)
  references HPV.T24_HORARIOS (A24CODIGO);
alter table HPV.T26_GRUPOSFACILITADOR
  add constraint FK_T26_T25 foreign key (A26GRUPO)
  references HPV.T25_GRUPOS (A25CODIGO);
alter table HPV.T26_GRUPOSFACILITADOR
  add constraint FK_T26_T90 foreign key (A26ESTADO)
  references HPV.T90_ESTADOSESPACIOFISICO (A90CODIGO);

prompt
prompt Creating table T87_CONDICIONESPECIAL
prompt ====================================
prompt
create table HPV.T87_CONDICIONESPECIAL
(
  a87codigo              NUMBER not null,
  a87condicion           VARCHAR2(100),
  a87estado              CHAR(1),
  a87fechacreacion       DATE,
  a87fechamodificacion   DATE,
  a87usuariocreacion     NUMBER,
  a87usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on column HPV.T87_CONDICIONESPECIAL.a87codigo
  is 'Identifiacion unica de registro';
comment on column HPV.T87_CONDICIONESPECIAL.a87condicion
  is 'descripcion de la condicion especial';
comment on column HPV.T87_CONDICIONESPECIAL.a87estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T87_CONDICIONESPECIAL.a87fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T87_CONDICIONESPECIAL.a87fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T87_CONDICIONESPECIAL.a87usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T87_CONDICIONESPECIAL.a87usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T87_CONDICIONESPECIAL
  add constraint PK_T87 primary key (A87CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T15_INSCRITOS
prompt ============================
prompt
create table HPV.T15_INSCRITOS
(
  a15codigo              NUMBER not null,
  a15grupofacilitador    NUMBER,
  a15tipodocumento       VARCHAR2(2),
  a15documento           VARCHAR2(15),
  a15codigobeneficiario  NUMBER,
  a15primernombre        VARCHAR2(200),
  a15segundonombre       VARCHAR2(200),
  a15primerapellido      VARCHAR2(200),
  a15segundoapellido     VARCHAR2(200),
  a15fechanacimiento     DATE,
  a15email               VARCHAR2(200),
  a15telefono            VARCHAR2(25),
  a15movil               VARCHAR2(30),
  a15movilalt            VARCHAR2(30),
  a15estado              CHAR(1),
  a15fechacreacion       DATE,
  a15fechamodificacion   DATE,
  a15usuariocreacion     NUMBER,
  a15usuariomodificacion NUMBER,
  a15condicionespecial   NUMBER,
  a15genero              CHAR(1),
  a15condicion           VARCHAR2(50),
  a15institucion         VARCHAR2(200),
  a15fechaencuestafinal  DATE,
  a15numasistencia       NUMBER,
  a15fechacertificacion  DATE,
  a15codigocorreo        NUMBER,
  a15msjcorreo           VARCHAR2(1000),
  a15fechaenvio          DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T15_INSCRITOS
  is 'Tabla que contiene la información de las personas inscritos para realizar un taller';
comment on column HPV.T15_INSCRITOS.a15codigo
  is 'Identificación única del registro';
comment on column HPV.T15_INSCRITOS.a15grupofacilitador
  is 'FK de la tabla T26_GRUPOSFACILITADOR ID del grupo facilitador';
comment on column HPV.T15_INSCRITOS.a15tipodocumento
  is 'Tipo de documento';
comment on column HPV.T15_INSCRITOS.a15documento
  is 'Nro documento';
comment on column HPV.T15_INSCRITOS.a15codigobeneficiario
  is 'Código del beneficiario';
comment on column HPV.T15_INSCRITOS.a15primernombre
  is 'Primer nombre';
comment on column HPV.T15_INSCRITOS.a15segundonombre
  is 'Segundo nombre';
comment on column HPV.T15_INSCRITOS.a15primerapellido
  is 'Primer apellido';
comment on column HPV.T15_INSCRITOS.a15segundoapellido
  is 'Segundo apellido';
comment on column HPV.T15_INSCRITOS.a15fechanacimiento
  is 'Fecha de nacimiento';
comment on column HPV.T15_INSCRITOS.a15email
  is 'Correo electrónico';
comment on column HPV.T15_INSCRITOS.a15telefono
  is 'Nro. Telefono';
comment on column HPV.T15_INSCRITOS.a15movil
  is 'Nro celular';
comment on column HPV.T15_INSCRITOS.a15movilalt
  is 'Nro celular alternativo';
comment on column HPV.T15_INSCRITOS.a15estado
  is 'Estado A:Activo I:Inactivo P:Pendiente';
comment on column HPV.T15_INSCRITOS.a15fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T15_INSCRITOS.a15fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T15_INSCRITOS.a15usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T15_INSCRITOS.a15usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T15_INSCRITOS.a15condicionespecial
  is 'Condicion especial';
comment on column HPV.T15_INSCRITOS.a15institucion
  is 'Institucion';
comment on column HPV.T15_INSCRITOS.a15fechaencuestafinal
  is 'Fecha en la que diligencio encuesta final';
comment on column HPV.T15_INSCRITOS.a15numasistencia
  is 'Numero de talleres a los cuales asistio';
comment on column HPV.T15_INSCRITOS.a15fechacertificacion
  is 'Fecha en la que se genero primer certificado';
comment on column HPV.T15_INSCRITOS.a15codigocorreo
  is 'Codigo de respuesta de envio de correo de inscripcion';
comment on column HPV.T15_INSCRITOS.a15msjcorreo
  is 'Mensaje de proceso de envio de correo de inscripcion';
comment on column HPV.T15_INSCRITOS.a15fechaenvio
  is 'Fecha de envio de correo';
alter table HPV.T15_INSCRITOS
  add constraint PK_T15_INSCRITOS primary key (A15CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T15_INSCRITOS
  add constraint FK_T15_T04 foreign key (A15TIPODOCUMENTO)
  references HPV.T04_TIPOSDOCUMENTO (A04TIPODOCUMENTO);
alter table HPV.T15_INSCRITOS
  add constraint FK_T15_T26 foreign key (A15GRUPOFACILITADOR)
  references HPV.T26_GRUPOSFACILITADOR (A26CODIGO);
alter table HPV.T15_INSCRITOS
  add constraint FK_T15_T87 foreign key (A15CONDICIONESPECIAL)
  references HPV.T87_CONDICIONESPECIAL (A87CODIGO);
alter table HPV.T15_INSCRITOS
  add constraint CK_A15ESTADO
  check (A15ESTADO IN ('A','I','P', 'S','N'));

prompt
prompt Creating table T15_INSCRITOS_AUD
prompt ================================
prompt
create table HPV.T15_INSCRITOS_AUD
(
  a15codigo              NUMBER not null,
  a15grupofacilitador    NUMBER,
  a15tipodocumento       VARCHAR2(2),
  a15documento           VARCHAR2(15),
  a15codigobeneficiario  NUMBER,
  a15primernombre        VARCHAR2(200),
  a15segundonombre       VARCHAR2(200),
  a15primerapellido      VARCHAR2(200),
  a15segundoapellido     VARCHAR2(200),
  a15fechanacimiento     DATE,
  a15email               VARCHAR2(200),
  a15telefono            VARCHAR2(25),
  a15movil               VARCHAR2(30),
  a15movilalt            VARCHAR2(30),
  a15estado              CHAR(1),
  a15fechacreacion       DATE,
  a15fechamodificacion   DATE,
  a15usuariocreacion     NUMBER,
  a15usuariomodificacion NUMBER,
  a15condicionespecial   NUMBER,
  a15genero              CHAR(1),
  a15condicion           VARCHAR2(50),
  a15institucion         VARCHAR2(200),
  a15fechaencuestafinal  DATE,
  a15numasistencia       NUMBER,
  a15fechacertificacion  DATE,
  a15codigocorreo        NUMBER,
  a15msjcorreo           VARCHAR2(1000),
  a15fechaenvio          DATE,
  a15fecha_audit         DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T15_INSCRITOS_AUD
  is 'Tabla de auditoria que almacena las modificaciones de la t15';

prompt
prompt Creating table T15_INSCRITOS160812
prompt ==================================
prompt
create table HPV.T15_INSCRITOS160812
(
  a15codigo              NUMBER not null,
  a15grupofacilitador    NUMBER,
  a15tipodocumento       VARCHAR2(2),
  a15documento           VARCHAR2(15),
  a15codigobeneficiario  NUMBER,
  a15primernombre        VARCHAR2(200),
  a15segundonombre       VARCHAR2(200),
  a15primerapellido      VARCHAR2(200),
  a15segundoapellido     VARCHAR2(200),
  a15fechanacimiento     DATE,
  a15email               VARCHAR2(200),
  a15telefono            VARCHAR2(25),
  a15movil               VARCHAR2(30),
  a15movilalt            VARCHAR2(30),
  a15estado              CHAR(1),
  a15fechacreacion       DATE,
  a15fechamodificacion   DATE,
  a15usuariocreacion     NUMBER,
  a15usuariomodificacion NUMBER,
  a15condicionespecial   NUMBER,
  a15genero              CHAR(1),
  a15condicion           VARCHAR2(50),
  a15institucion         VARCHAR2(200),
  a15fechaencuestafinal  DATE,
  a15numasistencia       NUMBER,
  a15fechacertificacion  DATE,
  a15codigocorreo        NUMBER,
  a15msjcorreo           VARCHAR2(1000),
  a15fechaenvio          DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T15_INSCRITOS160812
  is 'temporal backup';

prompt
prompt Creating table T15_INSCRITOS160924
prompt ==================================
prompt
create table HPV.T15_INSCRITOS160924
(
  a15codigo              NUMBER not null,
  a15grupofacilitador    NUMBER,
  a15tipodocumento       VARCHAR2(2),
  a15documento           VARCHAR2(15),
  a15codigobeneficiario  NUMBER,
  a15primernombre        VARCHAR2(200),
  a15segundonombre       VARCHAR2(200),
  a15primerapellido      VARCHAR2(200),
  a15segundoapellido     VARCHAR2(200),
  a15fechanacimiento     DATE,
  a15email               VARCHAR2(200),
  a15telefono            VARCHAR2(25),
  a15movil               VARCHAR2(30),
  a15movilalt            VARCHAR2(30),
  a15estado              CHAR(1),
  a15fechacreacion       DATE,
  a15fechamodificacion   DATE,
  a15usuariocreacion     NUMBER,
  a15usuariomodificacion NUMBER,
  a15condicionespecial   NUMBER,
  a15genero              CHAR(1),
  a15condicion           VARCHAR2(50),
  a15institucion         VARCHAR2(200),
  a15fechaencuestafinal  DATE,
  a15numasistencia       NUMBER,
  a15fechacertificacion  DATE,
  a15codigocorreo        NUMBER,
  a15msjcorreo           VARCHAR2(1000),
  a15fechaenvio          DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T15_INSCRITOS160924
  is 'temporal backup';

prompt
prompt Creating table T15_INSCRITOS_20160515
prompt =====================================
prompt
create table HPV.T15_INSCRITOS_20160515
(
  a15codigo              NUMBER not null,
  a15grupofacilitador    NUMBER,
  a15tipodocumento       VARCHAR2(2),
  a15documento           VARCHAR2(15),
  a15codigobeneficiario  NUMBER,
  a15primernombre        VARCHAR2(200),
  a15segundonombre       VARCHAR2(200),
  a15primerapellido      VARCHAR2(200),
  a15segundoapellido     VARCHAR2(200),
  a15fechanacimiento     DATE,
  a15email               VARCHAR2(200),
  a15telefono            VARCHAR2(25),
  a15movil               VARCHAR2(30),
  a15movilalt            VARCHAR2(30),
  a15estado              CHAR(1),
  a15fechacreacion       DATE,
  a15fechamodificacion   DATE,
  a15usuariocreacion     NUMBER,
  a15usuariomodificacion NUMBER,
  a15condicionespecial   NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T15_INSCRITOS_20160515
  is 'temporal backup';

prompt
prompt Creating table T15_INSCRITOS_20160518
prompt =====================================
prompt
create table HPV.T15_INSCRITOS_20160518
(
  a15codigo              NUMBER not null,
  a15grupofacilitador    NUMBER,
  a15tipodocumento       VARCHAR2(2),
  a15documento           VARCHAR2(15),
  a15codigobeneficiario  NUMBER,
  a15primernombre        VARCHAR2(200),
  a15segundonombre       VARCHAR2(200),
  a15primerapellido      VARCHAR2(200),
  a15segundoapellido     VARCHAR2(200),
  a15fechanacimiento     DATE,
  a15email               VARCHAR2(200),
  a15telefono            VARCHAR2(25),
  a15movil               VARCHAR2(30),
  a15movilalt            VARCHAR2(30),
  a15estado              CHAR(1),
  a15fechacreacion       DATE,
  a15fechamodificacion   DATE,
  a15usuariocreacion     NUMBER,
  a15usuariomodificacion NUMBER,
  a15condicionespecial   NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T15_INSCRITOS_20160518
  is 'temporal backup';

prompt
prompt Creating table T15WEB_INSCRITOS
prompt ===============================
prompt
create table HPV.T15WEB_INSCRITOS
(
  a15codigo              NUMBER(11),
  a15participante        NUMBER(11),
  a15grupo               NUMBER(11),
  a15tipodocumento       NUMBER(4),
  a15documento           VARCHAR2(15),
  a15codigobeneficiario  NUMBER(11),
  a15primernombre        VARCHAR2(200),
  a15segundonombre       VARCHAR2(200),
  a15primerapellido      VARCHAR2(200),
  a15segundoapellido     VARCHAR2(200),
  a15fechanacimiento     VARCHAR2(30),
  a15email               VARCHAR2(200),
  a15telefono            VARCHAR2(25),
  a15movil               VARCHAR2(30),
  a15movilalt            VARCHAR2(30),
  a15confirmacion        CHAR(1),
  a15correoenviado       CHAR(1),
  a15estado              CHAR(1),
  a15periodo             NUMBER(4),
  a15usuariocreacion     NUMBER(11),
  a15fechacreacion       VARCHAR2(30),
  a15usuariomodificacion NUMBER(11),
  a15fechamodificacion   VARCHAR2(30),
  idinsora               NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T15WEB_INSCRITOS
  is 'Tabla que almacena los participantes validos inscritos';

prompt
prompt Creating table T16_INSCRITOENCUESTA
prompt ===================================
prompt
create table HPV.T16_INSCRITOENCUESTA
(
  a16codigo              NUMBER not null,
  a16inscrito            NUMBER,
  a16encuesta            NUMBER,
  a16pregunta            NUMBER,
  a16respuesta           NUMBER,
  a16fechacreacion       DATE,
  a16fechamodificacion   DATE,
  a16usuariocreacion     NUMBER,
  a16usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T16_INSCRITOENCUESTA
  is 'Tabla que contiene la información de la encuesta asociada a un inscrito';
comment on column HPV.T16_INSCRITOENCUESTA.a16codigo
  is 'Identificación única del registro';
comment on column HPV.T16_INSCRITOENCUESTA.a16inscrito
  is 'FK de la tabla T15_INSCRITOS ID del inscrito';
comment on column HPV.T16_INSCRITOENCUESTA.a16encuesta
  is 'FK de la tabla T50_ENCUESTA ID de la encuesta';
comment on column HPV.T16_INSCRITOENCUESTA.a16pregunta
  is 'FK de la tabla T13_ENCUESTAPREGUNTAS
 ID de la pregunta';
comment on column HPV.T16_INSCRITOENCUESTA.a16respuesta
  is 'FK de la tabla T14_ENCUESTARESPUESTAS
 ID de la respuesta';
comment on column HPV.T16_INSCRITOENCUESTA.a16fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T16_INSCRITOENCUESTA.a16fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T16_INSCRITOENCUESTA.a16usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T16_INSCRITOENCUESTA.a16usuariomodificacion
  is 'Usuario modificacion';
create index HPV.INX_A16INSCRITO on HPV.T16_INSCRITOENCUESTA (A16INSCRITO)
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T16_INSCRITOENCUESTA
  add constraint PK_T16_INSCRITOENCUESTA primary key (A16CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T16_INSCRITOENCUESTA
  add constraint FK_T16_T13 foreign key (A16PREGUNTA)
  references HPV.T13_ENCUESTAPREGUNTAS (A13CODIGO);
alter table HPV.T16_INSCRITOENCUESTA
  add constraint FK_T16_T14 foreign key (A16RESPUESTA)
  references HPV.T14_ENCUESTARESPUESTAS (A14CODIGO);
alter table HPV.T16_INSCRITOENCUESTA
  add constraint FK_T16_T50 foreign key (A16ENCUESTA)
  references HPV.T50_ENCUESTA (A50CODIGO);

prompt
prompt Creating table T16_INSCRITOENCUESTA160717
prompt =========================================
prompt
create table HPV.T16_INSCRITOENCUESTA160717
(
  a16codigo              NUMBER not null,
  a16inscrito            NUMBER,
  a16encuesta            NUMBER,
  a16pregunta            NUMBER,
  a16respuesta           NUMBER,
  a16fechacreacion       DATE,
  a16fechamodificacion   DATE,
  a16usuariocreacion     NUMBER,
  a16usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T16_INSCRITOENCUESTA160717
  is 'temporal backup';

prompt
prompt Creating table T16_INSCRITOENCUESTA161213
prompt =========================================
prompt
create table HPV.T16_INSCRITOENCUESTA161213
(
  a16codigo              NUMBER not null,
  a16inscrito            NUMBER,
  a16encuesta            NUMBER,
  a16pregunta            NUMBER,
  a16respuesta           NUMBER,
  a16fechacreacion       DATE,
  a16fechamodificacion   DATE,
  a16usuariocreacion     NUMBER,
  a16usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T16WEB_INSCRITOENCUESTA
prompt ======================================
prompt
create table HPV.T16WEB_INSCRITOENCUESTA
(
  a16inscrito            NUMBER,
  a16pregunta            NUMBER,
  a16respuesta           NUMBER,
  a16estado              CHAR(1),
  a16usuariocreacion     NUMBER,
  a16fechacreacion       VARCHAR2(30),
  a16usuariomodificacion NUMBER,
  a16fechamodificacion   VARCHAR2(30),
  migra                  CHAR(1)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 16K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T16WEB_INSCRITOENCUESTA
  is 'Tabla que contiene las respuestas de todas las encuestas';

prompt
prompt Creating table T17_TALLERES
prompt ===========================
prompt
create table HPV.T17_TALLERES
(
  a17codigo              NUMBER not null,
  a17nombre              VARCHAR2(100),
  a17descripcion         VARCHAR2(500),
  a17orden               NUMBER,
  a17estado              CHAR(1),
  a17fechacreacion       DATE,
  a17fechamodificacion   DATE,
  a17usuariocreacion     NUMBER,
  a17usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T17_TALLERES
  is 'Tabla que contiene la información de los talleres a realizar';
comment on column HPV.T17_TALLERES.a17codigo
  is 'Identificación única del registro';
comment on column HPV.T17_TALLERES.a17nombre
  is 'Nombre del taller';
comment on column HPV.T17_TALLERES.a17descripcion
  is 'Descripción del taller';
comment on column HPV.T17_TALLERES.a17orden
  is 'Orden en el que se despliega';
comment on column HPV.T17_TALLERES.a17estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T17_TALLERES.a17fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T17_TALLERES.a17fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T17_TALLERES.a17usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T17_TALLERES.a17usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T17_TALLERES
  add constraint PK_T17_TALLERES primary key (A17CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T18_ENTREGABLES
prompt ==============================
prompt
create table HPV.T18_ENTREGABLES
(
  a18codigo              NUMBER not null,
  a18nombre              VARCHAR2(150),
  a18orden               NUMBER,
  a18asistencia          CHAR(1),
  a18tipoarchivo         VARCHAR2(150),
  a18tipo                VARCHAR2(100),
  a18estado              CHAR(1),
  a18fechacreacion       DATE,
  a18fechamodificacion   DATE,
  a18usuariocreacion     NUMBER,
  a18usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T18_ENTREGABLES
  is 'Tabla que contiene la información de los entregables en los talleres';
comment on column HPV.T18_ENTREGABLES.a18codigo
  is 'Identificación única del registro';
comment on column HPV.T18_ENTREGABLES.a18nombre
  is 'Nombre del entregable';
comment on column HPV.T18_ENTREGABLES.a18orden
  is 'Orden en el que se despliega';
comment on column HPV.T18_ENTREGABLES.a18asistencia
  is 'Valor que indica si el entregable es asistencia 1: Asistencia';
comment on column HPV.T18_ENTREGABLES.a18tipoarchivo
  is 'Tipo del archivo a generarse';
comment on column HPV.T18_ENTREGABLES.a18tipo
  is 'Extension del tipo del archivo a generarse';
comment on column HPV.T18_ENTREGABLES.a18estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T18_ENTREGABLES.a18fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T18_ENTREGABLES.a18fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T18_ENTREGABLES.a18usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T18_ENTREGABLES.a18usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T18_ENTREGABLES
  add constraint PK_T18_ENTREGABLES primary key (A18CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T19_TALLERENTREGABLES
prompt ====================================
prompt
create table HPV.T19_TALLERENTREGABLES
(
  a19taller              NUMBER not null,
  a19entregable          NUMBER not null,
  a19estado              CHAR(1),
  a19fechacreacion       DATE,
  a19fechamodificacion   DATE,
  a19usuariocreacion     NUMBER,
  a19usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T19_TALLERENTREGABLES
  is 'Tabla que contiene la información de los entregables del taller';
comment on column HPV.T19_TALLERENTREGABLES.a19taller
  is 'FK de la tabla T17_TALLERES ID del taller';
comment on column HPV.T19_TALLERENTREGABLES.a19entregable
  is 'FK de la tabla T18_ENTREGABLES ID del entregable';
comment on column HPV.T19_TALLERENTREGABLES.a19estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T19_TALLERENTREGABLES.a19fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T19_TALLERENTREGABLES.a19fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T19_TALLERENTREGABLES.a19usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T19_TALLERENTREGABLES.a19usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T19_TALLERENTREGABLES
  add constraint PK_T19_TALLERENTREGABLES primary key (A19TALLER, A19ENTREGABLE)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T19_TALLERENTREGABLES
  add constraint FK_T19_T17 foreign key (A19TALLER)
  references HPV.T17_TALLERES (A17CODIGO);
alter table HPV.T19_TALLERENTREGABLES
  add constraint FK_T19_T18 foreign key (A19ENTREGABLE)
  references HPV.T18_ENTREGABLES (A18CODIGO);

prompt
prompt Creating table T20_ENTREGABLESCARGADOS
prompt ======================================
prompt
create table HPV.T20_ENTREGABLESCARGADOS
(
  a20codigo              NUMBER not null,
  a20grupo               NUMBER,
  a20taller              NUMBER,
  a20entregable          NUMBER,
  a20ruta                VARCHAR2(1000),
  a20facilitador         NUMBER,
  a20periodo             NUMBER,
  a20estado              CHAR(1),
  a20motivorechazo       VARCHAR2(200),
  a20fechacreacion       DATE,
  a20fechamodificacion   DATE,
  a20usuariocreacion     NUMBER,
  a20usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T20_ENTREGABLESCARGADOS
  is 'Tabla que contiene la información de los entregables cargados por el facilitador';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20codigo
  is 'Identificación única del registro';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20grupo
  is 'FK de la tabla T25_GRUPOS ID del grupo';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20taller
  is 'FK de la tabla T17_TALLERES ID del taller';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20entregable
  is 'FK de la tabla T20_ENTREGABLESCARGADOS ID del entregable';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20ruta
  is 'Ruta donde se carga el entregable';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20facilitador
  is 'FK de la tabla T06_USUARIOS ID del usuario';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20periodo
  is 'FK de la tabla T12_PERIODOS ID del periodo';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20motivorechazo
  is 'Descripción del motivo de rechazo';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T20_ENTREGABLESCARGADOS.a20usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T20_ENTREGABLESCARGADOS
  add constraint PK_T20_ENTREGABLESCARGADOS primary key (A20CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T20_ENTREGABLESCARGADOS
  add constraint FK_T20_T17 foreign key (A20TALLER)
  references HPV.T17_TALLERES (A17CODIGO);
alter table HPV.T20_ENTREGABLESCARGADOS
  add constraint FK_T20_T18 foreign key (A20ENTREGABLE)
  references HPV.T18_ENTREGABLES (A18CODIGO);

prompt
prompt Creating table T20_ENTREGABLESCARGADOS_BCK
prompt ==========================================
prompt
create table HPV.T20_ENTREGABLESCARGADOS_BCK
(
  a20codigo              NUMBER not null,
  a20grupo               NUMBER,
  a20taller              NUMBER,
  a20entregable          NUMBER,
  a20ruta                VARCHAR2(1000),
  a20facilitador         NUMBER,
  a20periodo             NUMBER,
  a20estado              CHAR(1),
  a20motivorechazo       VARCHAR2(200),
  a20fechacreacion       DATE,
  a20fechamodificacion   DATE,
  a20usuariocreacion     NUMBER,
  a20usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T20_ENTREGABLESCARGADOS_BCK
  is 'tabla temporal';

prompt
prompt Creating table T20_ENTREGABLESCARGADOS_RES
prompt ==========================================
prompt
create table HPV.T20_ENTREGABLESCARGADOS_RES
(
  a20codigo              NUMBER not null,
  a20grupo               NUMBER,
  a20taller              NUMBER,
  a20entregable          NUMBER,
  a20ruta                VARCHAR2(1000),
  a20facilitador         NUMBER,
  a20periodo             NUMBER,
  a20estado              CHAR(1),
  a20motivorechazo       VARCHAR2(200),
  a20fechacreacion       DATE,
  a20fechamodificacion   DATE,
  a20usuariocreacion     NUMBER,
  a20usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T20_ENTREGABLESCARGADOS_RES
  is 'Tabla que contiene la información de los entregables cargados por el facilitador';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20codigo
  is 'Identificación única del registro';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20grupo
  is 'FK de la tabla T25_GRUPOS ID del grupo';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20taller
  is 'FK de la tabla T17_TALLERES ID del taller';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20entregable
  is 'FK de la tabla T20_ENTREGABLESCARGADOS ID del entregable';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20ruta
  is 'Ruta donde se carga el entregable';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20facilitador
  is 'FK de la tabla T06_USUARIOS ID del usuario';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20periodo
  is 'FK de la tabla T12_PERIODOS ID del periodo';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20motivorechazo
  is 'Descripción del motivo de rechazo';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T20_ENTREGABLESCARGADOS_RES.a20usuariomodificacion
  is 'Usuario modificacion';

prompt
prompt Creating table T20_ENTREGABLESCARGADOS160926
prompt ============================================
prompt
create table HPV.T20_ENTREGABLESCARGADOS160926
(
  a20codigo              NUMBER not null,
  a20grupo               NUMBER,
  a20taller              NUMBER,
  a20entregable          NUMBER,
  a20ruta                VARCHAR2(1000),
  a20facilitador         NUMBER,
  a20periodo             NUMBER,
  a20estado              CHAR(1),
  a20motivorechazo       VARCHAR2(200),
  a20fechacreacion       DATE,
  a20fechamodificacion   DATE,
  a20usuariocreacion     NUMBER,
  a20usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T20_ENTREGABLESCARGADOS160926
  is 'tabla temporal';

prompt
prompt Creating table T21_REALIZACIONTALLER
prompt ====================================
prompt
create table HPV.T21_REALIZACIONTALLER
(
  a21codigo              NUMBER not null,
  a21grupo               NUMBER,
  a21taller              NUMBER,
  a21fechataller         DATE,
  a21facilitador         NUMBER,
  a21periodo             NUMBER,
  a21estado              CHAR(1),
  a21fechacreacion       DATE,
  a21fechamodificacion   DATE,
  a21usuariocreacion     NUMBER,
  a21usuariomodificacion NUMBER,
  a21motivorechazo       VARCHAR2(1000),
  a21asistentes          NUMBER,
  a21noasistentes        NUMBER,
  a21fechaencuesta       DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T21_REALIZACIONTALLER
  is 'Tabla que contiene la información de realización del taller';
comment on column HPV.T21_REALIZACIONTALLER.a21codigo
  is 'Identificación única del registro';
comment on column HPV.T21_REALIZACIONTALLER.a21grupo
  is 'FK de la tabla T25_GRUPOS ID del grupo';
comment on column HPV.T21_REALIZACIONTALLER.a21taller
  is 'FK de la tabla T17_TALLERES';
comment on column HPV.T21_REALIZACIONTALLER.a21fechataller
  is 'Fecha de realización del taller';
comment on column HPV.T21_REALIZACIONTALLER.a21facilitador
  is 'FK de la tabla T06_USUARIOS ID del usuario';
comment on column HPV.T21_REALIZACIONTALLER.a21periodo
  is 'FK de la tabla T12_PERIODOS ID del periodo';
comment on column HPV.T21_REALIZACIONTALLER.a21estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T21_REALIZACIONTALLER.a21fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T21_REALIZACIONTALLER.a21fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T21_REALIZACIONTALLER.a21usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T21_REALIZACIONTALLER.a21usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T21_REALIZACIONTALLER.a21motivorechazo
  is 'Motivo de rechazo de la asistencia';
comment on column HPV.T21_REALIZACIONTALLER.a21asistentes
  is 'Numero de asistentes';
comment on column HPV.T21_REALIZACIONTALLER.a21noasistentes
  is 'Numero de no asistentes';
comment on column HPV.T21_REALIZACIONTALLER.a21fechaencuesta
  is 'Fecha en la que se envio encuesta de satisfaccionalos asistentes';
create index HPV.INX_REALIZA on HPV.T21_REALIZACIONTALLER (A21GRUPO, A21TALLER)
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T21_REALIZACIONTALLER
  add constraint PK_T21_REALIZACIONTALLER primary key (A21CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T21_REALIZACIONTALLER
  add constraint FK_T21_T17 foreign key (A21TALLER)
  references HPV.T17_TALLERES (A17CODIGO);

prompt
prompt Creating table T21_REALIZACIONTALLER_BCK
prompt ========================================
prompt
create table HPV.T21_REALIZACIONTALLER_BCK
(
  a21codigo              NUMBER not null,
  a21grupo               NUMBER,
  a21taller              NUMBER,
  a21fechataller         DATE,
  a21facilitador         NUMBER,
  a21periodo             NUMBER,
  a21estado              CHAR(1),
  a21fechacreacion       DATE,
  a21fechamodificacion   DATE,
  a21usuariocreacion     NUMBER,
  a21usuariomodificacion NUMBER,
  a21motivorechazo       VARCHAR2(1000),
  a21asistentes          NUMBER,
  a21noasistentes        NUMBER,
  a21fechaencuesta       DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T21_REALIZACIONTALLER_BCK
  is 'tabla temporal';

prompt
prompt Creating table T21_REALIZACIONTALLER_RES
prompt ========================================
prompt
create table HPV.T21_REALIZACIONTALLER_RES
(
  a21codigo              NUMBER not null,
  a21grupo               NUMBER,
  a21taller              NUMBER,
  a21fechataller         DATE,
  a21facilitador         NUMBER,
  a21periodo             NUMBER,
  a21estado              CHAR(1),
  a21fechacreacion       DATE,
  a21fechamodificacion   DATE,
  a21usuariocreacion     NUMBER,
  a21usuariomodificacion NUMBER,
  a21motivorechazo       VARCHAR2(200),
  a21asistentes          NUMBER,
  a21noasistentes        NUMBER,
  a21fechaencuesta       DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T21_REALIZACIONTALLER_RES
  is 'Tabla que contiene la información de realización del taller';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21codigo
  is 'Identificación única del registro';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21grupo
  is 'FK de la tabla T25_GRUPOS ID del grupo';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21taller
  is 'FK de la tabla T17_TALLERES';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21fechataller
  is 'Fecha de realización del taller';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21facilitador
  is 'FK de la tabla T06_USUARIOS ID del usuario';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21periodo
  is 'FK de la tabla T12_PERIODOS ID del periodo';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21motivorechazo
  is 'Motivo de rechazo de la asistencia';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21asistentes
  is 'Numero de asistentes';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21noasistentes
  is 'Numero de no asistentes';
comment on column HPV.T21_REALIZACIONTALLER_RES.a21fechaencuesta
  is 'Fecha en la que se envio encuesta de satisfaccionalos asistentes';

prompt
prompt Creating table T21_REALIZACIONTALLER_0614
prompt =========================================
prompt
create table HPV.T21_REALIZACIONTALLER_0614
(
  a21codigo              NUMBER not null,
  a21grupo               NUMBER,
  a21taller              NUMBER,
  a21fechataller         DATE,
  a21facilitador         NUMBER,
  a21periodo             NUMBER,
  a21estado              CHAR(1),
  a21fechacreacion       DATE,
  a21fechamodificacion   DATE,
  a21usuariocreacion     NUMBER,
  a21usuariomodificacion NUMBER,
  a21motivorechazo       VARCHAR2(1000),
  a21asistentes          NUMBER,
  a21noasistentes        NUMBER,
  a21fechaencuesta       DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T21_REALIZACIONTALLER_0614
  is 'tabla temporal';

prompt
prompt Creating table T21_REALIZACIONTALLER160717
prompt ==========================================
prompt
create table HPV.T21_REALIZACIONTALLER160717
(
  a21codigo              NUMBER not null,
  a21grupo               NUMBER,
  a21taller              NUMBER,
  a21fechataller         DATE,
  a21facilitador         NUMBER,
  a21periodo             NUMBER,
  a21estado              CHAR(1),
  a21fechacreacion       DATE,
  a21fechamodificacion   DATE,
  a21usuariocreacion     NUMBER,
  a21usuariomodificacion NUMBER,
  a21motivorechazo       VARCHAR2(1000),
  a21asistentes          NUMBER,
  a21noasistentes        NUMBER,
  a21fechaencuesta       DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T21_REALIZACIONTALLER160717
  is 'tabla temporal';

prompt
prompt Creating table T21_REALIZACIONTALLER160926
prompt ==========================================
prompt
create table HPV.T21_REALIZACIONTALLER160926
(
  a21codigo              NUMBER not null,
  a21grupo               NUMBER,
  a21taller              NUMBER,
  a21fechataller         DATE,
  a21facilitador         NUMBER,
  a21periodo             NUMBER,
  a21estado              CHAR(1),
  a21fechacreacion       DATE,
  a21fechamodificacion   DATE,
  a21usuariocreacion     NUMBER,
  a21usuariomodificacion NUMBER,
  a21motivorechazo       VARCHAR2(1000),
  a21asistentes          NUMBER,
  a21noasistentes        NUMBER,
  a21fechaencuesta       DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T21_REALIZACIONTALLER160926
  is 'tabla temporal';

prompt
prompt Creating table T22_CORREOS
prompt ==========================
prompt
create table HPV.T22_CORREOS
(
  a22codigo              NUMBER not null,
  a22tarea               VARCHAR2(100),
  a22asunto              VARCHAR2(100),
  a22destinatario        VARCHAR2(250),
  a22copia               VARCHAR2(250),
  a22copiaoculta         VARCHAR2(250),
  a22imagencabecera      VARCHAR2(100),
  a22imagenpie           VARCHAR2(100),
  a22cuerpo              VARCHAR2(4000),
  a22estado              CHAR(1),
  a22fechacreacion       DATE,
  a22fechamodificacion   DATE,
  a22usuariocreacion     NUMBER,
  a22usuariomodificacion NUMBER,
  a22cuerpo2             VARCHAR2(4000),
  a22cuerpo3             VARCHAR2(4000)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T22_CORREOS
  is 'Tabla que contiene la información de los correos predefinidos';
comment on column HPV.T22_CORREOS.a22codigo
  is 'Identificación única del registro';
comment on column HPV.T22_CORREOS.a22tarea
  is 'Descripción de la tarea';
comment on column HPV.T22_CORREOS.a22asunto
  is 'Asunto del correo';
comment on column HPV.T22_CORREOS.a22destinatario
  is 'Destinatarios a quien va el correo';
comment on column HPV.T22_CORREOS.a22copia
  is 'Copia a destinatarios';
comment on column HPV.T22_CORREOS.a22copiaoculta
  is 'Copia oculta a destinatarios';
comment on column HPV.T22_CORREOS.a22imagencabecera
  is 'Imagen cabecera correo';
comment on column HPV.T22_CORREOS.a22imagenpie
  is 'Imagen pie de pagina del correo';
comment on column HPV.T22_CORREOS.a22cuerpo
  is 'Cuerpo del correo';
comment on column HPV.T22_CORREOS.a22estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T22_CORREOS.a22fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T22_CORREOS.a22fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T22_CORREOS.a22usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T22_CORREOS.a22usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T22_CORREOS.a22cuerpo2
  is 'Cuerpo del correo';
comment on column HPV.T22_CORREOS.a22cuerpo3
  is 'Cuerpo del correo';
alter table HPV.T22_CORREOS
  add constraint PK_T22_CORREOS primary key (A22CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T26_GRUPOSFACILITADOR_AUD
prompt ========================================
prompt
create table HPV.T26_GRUPOSFACILITADOR_AUD
(
  a26codigo              NUMBER not null,
  a26facilitador         NUMBER,
  a26ciudad              NUMBER,
  a26grupo               NUMBER,
  a26dia                 NUMBER,
  a26horario             NUMBER,
  a26lugar               VARCHAR2(255),
  a26direccion           VARCHAR2(255),
  a26sigla               VARCHAR2(20),
  a26periodo             NUMBER,
  a26condicion           CHAR(1),
  a26observaciones       VARCHAR2(1000),
  a26motivorechazo       VARCHAR2(1000),
  a26estado              VARCHAR2(10),
  a26fechacreacion       DATE,
  a26fechamodificacion   DATE,
  a26usuariocreacion     NUMBER,
  a26usuariomodificacion NUMBER,
  a26fecha_audit         DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T26_GRUPOSFACILITADOR_AUD
  is 'Tabla de auditoria que almacena todos los cambios de la t26';

prompt
prompt Creating table T27_TEXTO
prompt ========================
prompt
create table HPV.T27_TEXTO
(
  a27codigo              NUMBER not null,
  a27variable            VARCHAR2(100),
  a27texto               VARCHAR2(4000),
  a27estado              CHAR(1),
  a27fechacreacion       DATE,
  a27fechamodificacion   DATE,
  a27usuariocreacion     NUMBER,
  a27usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.T27_TEXTO
  is 'Tabla que contiene variables de texto';
alter table HPV.T27_TEXTO
  add constraint PK_T27_MENSAJES primary key (A27CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255;

prompt
prompt Creating table T29_CONSULTAPARTICIPANTES
prompt ========================================
prompt
create table HPV.T29_CONSULTAPARTICIPANTES
(
  a29codigo              NUMBER not null,
  a29participante        NUMBER not null,
  a29documento           VARCHAR2(15),
  a29codigobeneficiario  NUMBER,
  a29tipodocumento       VARCHAR2(2),
  a29primernombre        VARCHAR2(100),
  a29segundonombre       VARCHAR2(100),
  a29primerapellido      VARCHAR2(100),
  a29segundoapellido     VARCHAR2(100),
  a29fechanacimiento     DATE,
  a29municipioestudio    VARCHAR2(100),
  a29noconvenio          VARCHAR2(50),
  a29movil               VARCHAR2(15),
  a29movilalt            VARCHAR2(15),
  a29email               VARCHAR2(200),
  a29finetapapractica    DATE,
  a29finsemestre         DATE,
  a29ultimomes           DATE,
  a29fichasnies          NUMBER,
  a29nivelformacion      VARCHAR2(100),
  a29sniesies            NUMBER,
  a29telefono            VARCHAR2(15),
  a29tipoformcion        VARCHAR2(100),
  a29estado              NUMBER(22,1),
  a29fechaconsulta       DATE,
  a29fechacreacion       DATE,
  a29fechamodificacion   DATE,
  a29usuariocreacion     NUMBER,
  a29usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T29_CONSULTAPARTICIPANTES
  is 'Tabla que contiene todas las consultas de los posibles participantes';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29codigo
  is 'Identificacion unica del registro';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29participante
  is 'Codigo participante';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29documento
  is 'Numero de documento del participante';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29codigobeneficiario
  is 'Codigo unico asignado por PS';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29tipodocumento
  is 'Tipo de documento';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29primernombre
  is 'Primer nombre';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29segundonombre
  is 'Segundo nombre';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29primerapellido
  is 'Primer apellido';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29segundoapellido
  is 'Segundo apellido';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29fechanacimiento
  is 'Fecha de nacimiento';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29municipioestudio
  is 'Municipio donde se realizo ';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29noconvenio
  is 'Convenio del participante';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29movil
  is 'Movil';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29movilalt
  is 'Movil alterno';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29email
  is 'Correo electronico';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29finetapapractica
  is 'Fecha Final de la Etapa Practica';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29finsemestre
  is 'Fecha Final del Semestre';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29ultimomes
  is 'Fecha del Ultimo Mes';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29fichasnies
  is 'Ficha Snies';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29nivelformacion
  is 'Nivel de Formacion';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29sniesies
  is 'Nro Snies_Ies';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29telefono
  is 'Telefono';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29tipoformcion
  is 'Tipo de Formacion';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29estado
  is 'Estado de la persona';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29fechaconsulta
  is 'Fecha en que se realiza la consulta';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T29_CONSULTAPARTICIPANTES.a29usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T29_CONSULTAPARTICIPANTES
  add constraint PK_T29_CONSULTAPARTICIPANTES primary key (A29CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T30_CIUDADESUSUARIO
prompt ==================================
prompt
create table HPV.T30_CIUDADESUSUARIO
(
  a30codigo              NUMBER not null,
  a30ciudad              NUMBER,
  a30usuario             NUMBER,
  a30estado              CHAR(1),
  a30fechacreacion       DATE,
  a30fechamodificacion   DATE,
  a30usuariocreacion     NUMBER,
  a30usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T30_CIUDADESUSUARIO
  is 'Tabla que contiene la información de las ciudades asociadas al usuario';
comment on column HPV.T30_CIUDADESUSUARIO.a30codigo
  is 'Identificacion unica del registro';
comment on column HPV.T30_CIUDADESUSUARIO.a30ciudad
  is 'FK de la tabla T03_MUNICIPIOS ID del municipio';
comment on column HPV.T30_CIUDADESUSUARIO.a30usuario
  is 'FK de la tabla T06_USUARIOS ID del usuario';
comment on column HPV.T30_CIUDADESUSUARIO.a30estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T30_CIUDADESUSUARIO.a30fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T30_CIUDADESUSUARIO.a30fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T30_CIUDADESUSUARIO.a30usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T30_CIUDADESUSUARIO.a30usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T30_CIUDADESUSUARIO
  add constraint PK_T30_CIUDADESUSUARIO primary key (A30CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T30_CIUDADESUSUARIO
  add constraint FK_A30T03 foreign key (A30CIUDAD)
  references HPV.T03_MUNICIPIOS (A03CODIGO);
alter table HPV.T30_CIUDADESUSUARIO
  add constraint FK_T30_T06 foreign key (A30USUARIO)
  references HPV.T06_USUARIOS (A06CODIGO);
alter table HPV.T30_CIUDADESUSUARIO
  add constraint CK_A30ESTADO
  check ("A30ESTADO"='A' OR "A30ESTADO"='I');

prompt
prompt Creating table T51_ASISTENCIATALLER
prompt ===================================
prompt
create table HPV.T51_ASISTENCIATALLER
(
  a51codigo                  NUMBER not null,
  a51tallerrealizado         NUMBER,
  a51inscrito                NUMBER,
  a51facilitadorreporta      NUMBER,
  a51grupofacilitador        NUMBER,
  a51periodo                 NUMBER,
  a51fechareporte            DATE,
  a51fechacreacion           DATE,
  a51fechamodificacion       DATE,
  a51usuariocreacion         NUMBER,
  a51usuariomodificacion     NUMBER,
  a51asistencia              CHAR(1),
  a51estado                  CHAR(1),
  a51orden                   NUMBER,
  a51fechaenvioencuesta      DATE,
  a51codrptacorreo           NUMBER,
  a51msjrptacorreo           VARCHAR2(4000),
  a51tokenenviado            VARCHAR2(100),
  a51fechadiligenciaencuesta DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T51_ASISTENCIATALLER
  is 'Tabla que contiene la información de las asistencias al taller';
comment on column HPV.T51_ASISTENCIATALLER.a51codigo
  is 'Identificacion unica del registro';
comment on column HPV.T51_ASISTENCIATALLER.a51tallerrealizado
  is 'FK de la tabla T21_REALIZACIONTALLER ID Taller al cual asistio';
comment on column HPV.T51_ASISTENCIATALLER.a51inscrito
  is 'FK de la tabla T15_INSCRITOS ID ID Inscrito que asistio al taller';
comment on column HPV.T51_ASISTENCIATALLER.a51facilitadorreporta
  is 'FK de la tabla T06_USUARIOS ID Facilitador que reporto asistencia';
comment on column HPV.T51_ASISTENCIATALLER.a51grupofacilitador
  is 'FK de la tabla T26_GRUPOFACILITADOR ID del grupo';
comment on column HPV.T51_ASISTENCIATALLER.a51periodo
  is 'FK de la tabla T12_PERIODOS ID del periodo';
comment on column HPV.T51_ASISTENCIATALLER.a51fechareporte
  is 'Fecha en la que se reporta la asistencia';
comment on column HPV.T51_ASISTENCIATALLER.a51fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T51_ASISTENCIATALLER.a51fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T51_ASISTENCIATALLER.a51usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T51_ASISTENCIATALLER.a51usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T51_ASISTENCIATALLER.a51asistencia
  is 'Indicador de si asistio A:Asistio N:No asitio';
comment on column HPV.T51_ASISTENCIATALLER.a51estado
  is 'A:Activo I:Inactivo';
comment on column HPV.T51_ASISTENCIATALLER.a51orden
  is 'Orden de presentacion';
comment on column HPV.T51_ASISTENCIATALLER.a51fechaenvioencuesta
  is 'Fecha en la que se le envio la encuesta de satisfaccion';
comment on column HPV.T51_ASISTENCIATALLER.a51codrptacorreo
  is 'Codigo de respuesta del correo';
comment on column HPV.T51_ASISTENCIATALLER.a51msjrptacorreo
  is 'Mensaje de respuesta del envio de correo';
comment on column HPV.T51_ASISTENCIATALLER.a51tokenenviado
  is 'Token enviado para la encuesta satisfaccion';
comment on column HPV.T51_ASISTENCIATALLER.a51fechadiligenciaencuesta
  is 'Fecha en la que diligencia la encuesta';
create index HPV.INX_ASITENCIA on HPV.T51_ASISTENCIATALLER (A51INSCRITO, A51TALLERREALIZADO, A51ASISTENCIA)
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T51_ASISTENCIATALLER
  add constraint PK_T51_ASISTENCIATALLER primary key (A51CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T51_ASISTENCIATALLER_BCK
prompt =======================================
prompt
create table HPV.T51_ASISTENCIATALLER_BCK
(
  a51codigo                  NUMBER not null,
  a51tallerrealizado         NUMBER,
  a51inscrito                NUMBER,
  a51facilitadorreporta      NUMBER,
  a51grupofacilitador        NUMBER,
  a51periodo                 NUMBER,
  a51fechareporte            DATE,
  a51fechacreacion           DATE,
  a51fechamodificacion       DATE,
  a51usuariocreacion         NUMBER,
  a51usuariomodificacion     NUMBER,
  a51asistencia              CHAR(1),
  a51estado                  CHAR(1),
  a51orden                   NUMBER,
  a51fechaenvioencuesta      DATE,
  a51codrptacorreo           NUMBER,
  a51msjrptacorreo           VARCHAR2(4000),
  a51tokenenviado            VARCHAR2(100),
  a51fechadiligenciaencuesta DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T51_ASISTENCIATALLER_BCK
  is 'tabla backup';

prompt
prompt Creating table T51_ASISTENCIATALLER_RES
prompt =======================================
prompt
create table HPV.T51_ASISTENCIATALLER_RES
(
  a51codigo                  NUMBER not null,
  a51tallerrealizado         NUMBER,
  a51inscrito                NUMBER,
  a51facilitadorreporta      NUMBER,
  a51grupofacilitador        NUMBER,
  a51periodo                 NUMBER,
  a51fechareporte            DATE,
  a51fechacreacion           DATE,
  a51fechamodificacion       DATE,
  a51usuariocreacion         NUMBER,
  a51usuariomodificacion     NUMBER,
  a51asistencia              CHAR(1),
  a51estado                  CHAR(1),
  a51orden                   NUMBER,
  a51fechaenvioencuesta      DATE,
  a51codrptacorreo           NUMBER,
  a51msjrptacorreo           VARCHAR2(4000),
  a51tokenenviado            VARCHAR2(100),
  a51fechadiligenciaencuesta DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T51_ASISTENCIATALLER_RES
  is 'Tabla que contiene la información de las asistencias al taller';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51codigo
  is 'Identificacion unica del registro';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51tallerrealizado
  is 'FK de la tabla T21_REALIZACIONTALLER ID Taller al cual asistio';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51inscrito
  is 'FK de la tabla T15_INSCRITOS ID ID Inscrito que asistio al taller';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51facilitadorreporta
  is 'FK de la tabla T06_USUARIOS ID Facilitador que reporto asistencia';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51grupofacilitador
  is 'FK de la tabla T26_GRUPOFACILITADOR ID del grupo';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51periodo
  is 'FK de la tabla T12_PERIODOS ID del periodo';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51fechareporte
  is 'Fecha en la que se reporta la asistencia';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51asistencia
  is 'Indicador de si asistio A:Asistio N:No asitio';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51estado
  is 'A:Activo I:Inactivo';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51orden
  is 'Orden de presentacion';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51fechaenvioencuesta
  is 'Fecha en la que se le envio la encuesta de satisfaccion';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51codrptacorreo
  is 'Codigo de respuesta del correo';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51msjrptacorreo
  is 'Mensaje de respuesta del envio de correo';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51tokenenviado
  is 'Token enviado para la encuesta satisfaccion';
comment on column HPV.T51_ASISTENCIATALLER_RES.a51fechadiligenciaencuesta
  is 'Fecha en la que diligencia la encuesta';

prompt
prompt Creating table T51_ASISTENCIATALLER_0717
prompt ========================================
prompt
create table HPV.T51_ASISTENCIATALLER_0717
(
  a51codigo                  NUMBER not null,
  a51tallerrealizado         NUMBER,
  a51inscrito                NUMBER,
  a51facilitadorreporta      NUMBER,
  a51grupofacilitador        NUMBER,
  a51periodo                 NUMBER,
  a51fechareporte            DATE,
  a51fechacreacion           DATE,
  a51fechamodificacion       DATE,
  a51usuariocreacion         NUMBER,
  a51usuariomodificacion     NUMBER,
  a51asistencia              CHAR(1),
  a51estado                  CHAR(1),
  a51orden                   NUMBER,
  a51fechaenvioencuesta      DATE,
  a51codrptacorreo           NUMBER,
  a51msjrptacorreo           VARCHAR2(4000),
  a51tokenenviado            VARCHAR2(100),
  a51fechadiligenciaencuesta DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T51_ASISTENCIATALLER_0717
  is 'tabla backup';

prompt
prompt Creating table T51_ASISTENCIATALLER160629
prompt =========================================
prompt
create table HPV.T51_ASISTENCIATALLER160629
(
  a51codigo                  NUMBER not null,
  a51tallerrealizado         NUMBER,
  a51inscrito                NUMBER,
  a51facilitadorreporta      NUMBER,
  a51grupofacilitador        NUMBER,
  a51periodo                 NUMBER,
  a51fechareporte            DATE,
  a51fechacreacion           DATE,
  a51fechamodificacion       DATE,
  a51usuariocreacion         NUMBER,
  a51usuariomodificacion     NUMBER,
  a51asistencia              CHAR(1),
  a51estado                  CHAR(1),
  a51orden                   NUMBER,
  a51fechaenvioencuesta      DATE,
  a51codrptacorreo           NUMBER,
  a51msjrptacorreo           VARCHAR2(4000),
  a51tokenenviado            VARCHAR2(100),
  a51fechadiligenciaencuesta DATE
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T51_ASISTENCIATALLER160629
  is 'tabla backup';

prompt
prompt Creating table T52_CANDIDATOS
prompt =============================
prompt
create table HPV.T52_CANDIDATOS
(
  a52codigo              NUMBER not null,
  a52periodo             NUMBER,
  a52tipodocumento       VARCHAR2(2),
  a52documento           VARCHAR2(15),
  a52primernombre        VARCHAR2(200),
  a52segundonombre       VARCHAR2(200),
  a52primerapellido      VARCHAR2(200),
  a52segundoapellido     VARCHAR2(200),
  a52fechanacimiento     DATE,
  a52email               VARCHAR2(200),
  a52telefono            VARCHAR2(25),
  a52movil               VARCHAR2(30),
  a52movilalt            VARCHAR2(30),
  a52condicionespecial   NUMBER,
  a52codigobeneficiario  NUMBER,
  a52estado              CHAR(1),
  a52fechacreacion       DATE,
  a52fechamodificacion   DATE,
  a52usuariocreacion     NUMBER,
  a52usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T52_CANDIDATOS
  is 'Tabla que contiene la información de las personas candidatas al programa que estan interesadas';
comment on column HPV.T52_CANDIDATOS.a52codigo
  is 'Identificación única del registro';
comment on column HPV.T52_CANDIDATOS.a52periodo
  is 'Periodo de intento de inscripcion';
comment on column HPV.T52_CANDIDATOS.a52tipodocumento
  is 'Tipo de documento';
comment on column HPV.T52_CANDIDATOS.a52documento
  is 'Nro documento';
comment on column HPV.T52_CANDIDATOS.a52primernombre
  is 'Primer nombre';
comment on column HPV.T52_CANDIDATOS.a52segundonombre
  is 'Segundo nombre';
comment on column HPV.T52_CANDIDATOS.a52primerapellido
  is 'Primer apellido';
comment on column HPV.T52_CANDIDATOS.a52segundoapellido
  is 'Segundo apellido';
comment on column HPV.T52_CANDIDATOS.a52fechanacimiento
  is 'Fecha de nacimiento';
comment on column HPV.T52_CANDIDATOS.a52email
  is 'Correo electrónico';
comment on column HPV.T52_CANDIDATOS.a52telefono
  is 'Nro. Telefono';
comment on column HPV.T52_CANDIDATOS.a52movil
  is 'Nro celular';
comment on column HPV.T52_CANDIDATOS.a52movilalt
  is 'Nro celular alternativo';
comment on column HPV.T52_CANDIDATOS.a52condicionespecial
  is 'Condicion especial';
comment on column HPV.T52_CANDIDATOS.a52codigobeneficiario
  is 'Codigo beneficiario';
comment on column HPV.T52_CANDIDATOS.a52estado
  is 'Estado A:Activo I:Inactivo P:Pendiente';
comment on column HPV.T52_CANDIDATOS.a52fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T52_CANDIDATOS.a52fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T52_CANDIDATOS.a52usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T52_CANDIDATOS.a52usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T52_CANDIDATOS
  add constraint PK_T52_CANDIDATOS primary key (A52CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T52_CANDIDATOS
  add constraint FK_T52_T04 foreign key (A52TIPODOCUMENTO)
  references HPV.T04_TIPOSDOCUMENTO (A04TIPODOCUMENTO);
alter table HPV.T52_CANDIDATOS
  add constraint FK_T52_T87 foreign key (A52CONDICIONESPECIAL)
  references HPV.T87_CONDICIONESPECIAL (A87CODIGO);
alter table HPV.T52_CANDIDATOS
  add constraint CK_A52ESTADO
  check (A52ESTADO IN ('A','I','P', 'S'));

prompt
prompt Creating table T52_CANDIDATOSP1
prompt ===============================
prompt
create table HPV.T52_CANDIDATOSP1
(
  a52codigo              NUMBER not null,
  a52periodo             NUMBER,
  a52tipodocumento       VARCHAR2(2),
  a52documento           VARCHAR2(15),
  a52primernombre        VARCHAR2(200),
  a52segundonombre       VARCHAR2(200),
  a52primerapellido      VARCHAR2(200),
  a52segundoapellido     VARCHAR2(200),
  a52fechanacimiento     DATE,
  a52email               VARCHAR2(200),
  a52telefono            VARCHAR2(25),
  a52movil               VARCHAR2(30),
  a52movilalt            VARCHAR2(30),
  a52condicionespecial   NUMBER,
  a52codigobeneficiario  NUMBER,
  a52estado              CHAR(1),
  a52fechacreacion       DATE,
  a52fechamodificacion   DATE,
  a52usuariocreacion     NUMBER,
  a52usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T52_CANDIDATOSP1
  is 'Tabla Candidatos del Periodo 1';

prompt
prompt Creating table T53_GRUPOINSCRITO
prompt ================================
prompt
create table HPV.T53_GRUPOINSCRITO
(
  a53codigo              NUMBER not null,
  a53grupofacilitador    NUMBER,
  a53periodo             NUMBER,
  a53inscrito            NUMBER,
  a53estado              CHAR(1),
  a53fechacreacion       DATE,
  a53fechamodificacion   DATE,
  a53usuariocreacion     NUMBER,
  a53usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T53_GRUPOINSCRITO
  is 'Tabla que contiene la información de los grupos asociados al inscrito';
comment on column HPV.T53_GRUPOINSCRITO.a53codigo
  is 'Identificacion unica del registro';
comment on column HPV.T53_GRUPOINSCRITO.a53grupofacilitador
  is 'FK de la tabla T26_GRUPOSFACILITADOR ID del grupo facilitador';
comment on column HPV.T53_GRUPOINSCRITO.a53periodo
  is 'FK de la tabla T12_PERIODOS Periodo al cual pertenece la encuesta';
comment on column HPV.T53_GRUPOINSCRITO.a53inscrito
  is 'FK de la tabla T15_INSCRITOS ID ID Inscrito que asistio al taller';
comment on column HPV.T53_GRUPOINSCRITO.a53estado
  is 'Estado A:Activo I:Inactivo, R:Rezagado';
comment on column HPV.T53_GRUPOINSCRITO.a53fechacreacion
  is 'Fecha de creacion del registro';
comment on column HPV.T53_GRUPOINSCRITO.a53fechamodificacion
  is 'Fecha de modificacion del registro';
comment on column HPV.T53_GRUPOINSCRITO.a53usuariocreacion
  is 'Usuario que realizo la creacion del registro';
comment on column HPV.T53_GRUPOINSCRITO.a53usuariomodificacion
  is 'Usuario que realizo modificacion';
alter table HPV.T53_GRUPOINSCRITO
  add constraint PK_T53_GRUPOINSCRITO primary key (A53CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T53_GRUPOINSCRITO
  add constraint FK_T53_T12 foreign key (A53PERIODO)
  references HPV.T12_PERIODOS (A12CODIGO);
alter table HPV.T53_GRUPOINSCRITO
  add constraint FK_T53_T15 foreign key (A53INSCRITO)
  references HPV.T15_INSCRITOS (A15CODIGO);
alter table HPV.T53_GRUPOINSCRITO
  add constraint FK_T53_T26 foreign key (A53GRUPOFACILITADOR)
  references HPV.T26_GRUPOSFACILITADOR (A26CODIGO);

prompt
prompt Creating table T53_GRUPOINSCRITO160924
prompt ======================================
prompt
create table HPV.T53_GRUPOINSCRITO160924
(
  a53codigo              NUMBER not null,
  a53grupofacilitador    NUMBER,
  a53periodo             NUMBER,
  a53inscrito            NUMBER,
  a53estado              CHAR(1),
  a53fechacreacion       DATE,
  a53fechamodificacion   DATE,
  a53usuariocreacion     NUMBER,
  a53usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T53_GRUPOINSCRITO160924
  is 'tabla backup';

prompt
prompt Creating table T53_GRUPOINSCRITO_20160518
prompt =========================================
prompt
create table HPV.T53_GRUPOINSCRITO_20160518
(
  a53codigo              NUMBER not null,
  a53grupofacilitador    NUMBER,
  a53periodo             NUMBER,
  a53inscrito            NUMBER,
  a53estado              CHAR(1),
  a53fechacreacion       DATE,
  a53fechamodificacion   DATE,
  a53usuariocreacion     NUMBER,
  a53usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T53_GRUPOINSCRITO_20160518
  is 'tabla backup';

prompt
prompt Creating table T54_TOKENUSUARIO
prompt ===============================
prompt
create table HPV.T54_TOKENUSUARIO
(
  a54codigo          NUMBER not null,
  a54usuario         NUMBER,
  a54token           VARCHAR2(100),
  a54fechageneracion DATE,
  a54usotoken        VARCHAR2(50),
  a54estado          CHAR(1),
  a54fechauso        DATE,
  a54iddato          NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T54_TOKENUSUARIO
  is 'Tabla con token de envio de correos';
comment on column HPV.T54_TOKENUSUARIO.a54codigo
  is 'Identificacion usuario';
comment on column HPV.T54_TOKENUSUARIO.a54usuario
  is 'Usuario deltoken';
comment on column HPV.T54_TOKENUSUARIO.a54token
  is 'Token generado';
comment on column HPV.T54_TOKENUSUARIO.a54fechageneracion
  is 'Fecha de generacion';
comment on column HPV.T54_TOKENUSUARIO.a54usotoken
  is 'Uso del token';
comment on column HPV.T54_TOKENUSUARIO.a54estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T54_TOKENUSUARIO.a54fechauso
  is 'fecha de uso del token';
comment on column HPV.T54_TOKENUSUARIO.a54iddato
  is 'id regsitro con informacion adicional';
alter table HPV.T54_TOKENUSUARIO
  add constraint PK_T54 primary key (A54CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T55_LOGENVIOCORREO
prompt =================================
prompt
create table HPV.T55_LOGENVIOCORREO
(
  a55codigo           NUMBER not null,
  a55fechaenvio       DATE,
  a55to               VARCHAR2(200),
  a55codigorespuesta  NUMBER,
  a55mensajerespuesta VARCHAR2(4000),
  a55asunto           VARCHAR2(200),
  a55procesoenvia     VARCHAR2(200)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T55_LOGENVIOCORREO
  is 'Tabla con Log de envio de correo';
comment on column HPV.T55_LOGENVIOCORREO.a55codigo
  is 'Identificacion unica del registro';
comment on column HPV.T55_LOGENVIOCORREO.a55fechaenvio
  is 'fecha de envio del correo';
comment on column HPV.T55_LOGENVIOCORREO.a55to
  is 'Correo destinatario';
comment on column HPV.T55_LOGENVIOCORREO.a55codigorespuesta
  is 'Codigo de respuesta del envio de correo';
comment on column HPV.T55_LOGENVIOCORREO.a55mensajerespuesta
  is 'Mensaje de respuesta del envio de correo';
comment on column HPV.T55_LOGENVIOCORREO.a55asunto
  is 'Asunto del correo';
comment on column HPV.T55_LOGENVIOCORREO.a55procesoenvia
  is 'Proceso que envio el correo';
alter table HPV.T55_LOGENVIOCORREO
  add constraint PK_T55 primary key (A55CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T56_OBSERVACIONENCUESTA
prompt ======================================
prompt
create table HPV.T56_OBSERVACIONENCUESTA
(
  a56codigo              NUMBER not null,
  a56inscrito            NUMBER,
  a56encuesta            NUMBER,
  a56observacion         VARCHAR2(1000),
  a56fechacreacion       DATE,
  a56fechamodificacion   DATE,
  a56usuariocreacion     NUMBER,
  a56usuariomodificacion NUMBER,
  a56idinscritoencuesta  NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T56_OBSERVACIONENCUESTA
  is 'Tabla con Observaciones Encuesta de Satisfaccion';
comment on column HPV.T56_OBSERVACIONENCUESTA.a56codigo
  is 'Identificacion unica del registro';
comment on column HPV.T56_OBSERVACIONENCUESTA.a56inscrito
  is 'Codigo del inscrito';
comment on column HPV.T56_OBSERVACIONENCUESTA.a56encuesta
  is 'Codigo de la encuesta';
comment on column HPV.T56_OBSERVACIONENCUESTA.a56observacion
  is 'Observacion a la encuesta';
comment on column HPV.T56_OBSERVACIONENCUESTA.a56fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T56_OBSERVACIONENCUESTA.a56fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T56_OBSERVACIONENCUESTA.a56usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T56_OBSERVACIONENCUESTA.a56usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T56_OBSERVACIONENCUESTA.a56idinscritoencuesta
  is 'Id a primera pregunta de encuesta';
alter table HPV.T56_OBSERVACIONENCUESTA
  add constraint PK_T56 primary key (A56CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T56_OBSERVACIONENCUESTA
  add constraint FK_T56_T15 foreign key (A56INSCRITO)
  references HPV.T15_INSCRITOS (A15CODIGO);
alter table HPV.T56_OBSERVACIONENCUESTA
  add constraint FK_T56_T50 foreign key (A56ENCUESTA)
  references HPV.T50_ENCUESTA (A50CODIGO);

prompt
prompt Creating table T85_TIPOHISTORIAVIDA
prompt ===================================
prompt
create table HPV.T85_TIPOHISTORIAVIDA
(
  a85codigo              NUMBER not null,
  a85descripcion         VARCHAR2(200),
  a85estado              CHAR(1),
  a85fechacreacion       DATE,
  a85fechamodificacion   DATE,
  a85usuariocreacion     NUMBER,
  a85usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T85_TIPOHISTORIAVIDA
  is 'Tabla con tipos de historia de vida';
comment on column HPV.T85_TIPOHISTORIAVIDA.a85codigo
  is 'Identificacion de cada registro';
comment on column HPV.T85_TIPOHISTORIAVIDA.a85descripcion
  is 'Descripcion del tipo de historia de vida';
comment on column HPV.T85_TIPOHISTORIAVIDA.a85estado
  is 'A:Activo I:Inactivo';
comment on column HPV.T85_TIPOHISTORIAVIDA.a85fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T85_TIPOHISTORIAVIDA.a85fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T85_TIPOHISTORIAVIDA.a85usuariocreacion
  is 'Id de usuario de creacion';
comment on column HPV.T85_TIPOHISTORIAVIDA.a85usuariomodificacion
  is 'Id de usuario de modificacion';
alter table HPV.T85_TIPOHISTORIAVIDA
  add constraint PK_T85 primary key (A85CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T57_HISTORIAVIDA
prompt ===============================
prompt
create table HPV.T57_HISTORIAVIDA
(
  a57codigo                  NUMBER not null,
  a57periodo                 NUMBER,
  a57grupofacilitador        NUMBER,
  a57estado                  CHAR(1),
  a57tipo                    NUMBER,
  a57razondeconsideracion    VARCHAR2(4000),
  a57circunstanciassuperadas VARCHAR2(4000),
  a57habilidadespracticadas  VARCHAR2(4000),
  a57leccion                 VARCHAR2(4000),
  a57fechacreacion           DATE,
  a57fechamodificacion       DATE,
  a57usuariocreacion         NUMBER,
  a57usuariomodificacion     NUMBER,
  a57inscrito                NUMBER,
  a57facilitador             NUMBER,
  a57motivorechazo           VARCHAR2(4000)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T57_HISTORIAVIDA
  is 'Tabla con Historias de Vida';
comment on column HPV.T57_HISTORIAVIDA.a57codigo
  is 'Identificacion unica de registro';
comment on column HPV.T57_HISTORIAVIDA.a57periodo
  is 'Periodo';
comment on column HPV.T57_HISTORIAVIDA.a57grupofacilitador
  is 'Grupo facilitador';
comment on column HPV.T57_HISTORIAVIDA.a57estado
  is 'Estado de la historia de vida';
comment on column HPV.T57_HISTORIAVIDA.a57tipo
  is 'Tipo de historia de vida';
comment on column HPV.T57_HISTORIAVIDA.a57razondeconsideracion
  is 'Razon de consideracion ';
comment on column HPV.T57_HISTORIAVIDA.a57circunstanciassuperadas
  is 'Circunstancias superadas';
comment on column HPV.T57_HISTORIAVIDA.a57habilidadespracticadas
  is 'Habilidades practicadas';
comment on column HPV.T57_HISTORIAVIDA.a57leccion
  is 'Leccion';
comment on column HPV.T57_HISTORIAVIDA.a57fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T57_HISTORIAVIDA.a57fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T57_HISTORIAVIDA.a57usuariocreacion
  is 'Usuario de creacion';
comment on column HPV.T57_HISTORIAVIDA.a57usuariomodificacion
  is 'Usuario de modificacion';
comment on column HPV.T57_HISTORIAVIDA.a57inscrito
  is 'Numero del inscrito seleccionado';
comment on column HPV.T57_HISTORIAVIDA.a57facilitador
  is 'Facilitador';
comment on column HPV.T57_HISTORIAVIDA.a57motivorechazo
  is 'Motivo de rechazo';
alter table HPV.T57_HISTORIAVIDA
  add constraint PK_T57 primary key (A57CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T57_HISTORIAVIDA
  add constraint FK_T56_T85 foreign key (A57TIPO)
  references HPV.T85_TIPOHISTORIAVIDA (A85CODIGO);
alter table HPV.T57_HISTORIAVIDA
  add constraint FK_T57_T06 foreign key (A57FACILITADOR)
  references HPV.T06_USUARIOS (A06CODIGO);
alter table HPV.T57_HISTORIAVIDA
  add constraint FK_T57_T12 foreign key (A57PERIODO)
  references HPV.T12_PERIODOS (A12CODIGO);
alter table HPV.T57_HISTORIAVIDA
  add constraint FK_T57_T15 foreign key (A57INSCRITO)
  references HPV.T15_INSCRITOS (A15CODIGO);
alter table HPV.T57_HISTORIAVIDA
  add constraint FK_T57_T26 foreign key (A57GRUPOFACILITADOR)
  references HPV.T26_GRUPOSFACILITADOR (A26CODIGO);

prompt
prompt Creating table T57_HISTORIAVIDA161101
prompt =====================================
prompt
create table HPV.T57_HISTORIAVIDA161101
(
  a57codigo                  NUMBER not null,
  a57periodo                 NUMBER,
  a57grupofacilitador        NUMBER,
  a57estado                  CHAR(1),
  a57tipo                    NUMBER,
  a57razondeconsideracion    VARCHAR2(4000),
  a57circunstanciassuperadas VARCHAR2(4000),
  a57habilidadespracticadas  VARCHAR2(4000),
  a57leccion                 VARCHAR2(4000),
  a57fechacreacion           DATE,
  a57fechamodificacion       DATE,
  a57usuariocreacion         NUMBER,
  a57usuariomodificacion     NUMBER,
  a57inscrito                NUMBER,
  a57facilitador             NUMBER,
  a57motivorechazo           VARCHAR2(4000)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T57_HISTORIAVIDA161101
  is 'tabla backup';

prompt
prompt Creating table T82_LOGROCASOEXITO
prompt =================================
prompt
create table HPV.T82_LOGROCASOEXITO
(
  a82codigo              NUMBER not null,
  a82nombre              VARCHAR2(50),
  a82verbo               VARCHAR2(50),
  a82adjetivo            VARCHAR2(50),
  a82medio               VARCHAR2(200),
  a82estado              CHAR(1),
  a82fechacreacion       DATE,
  a82fechamodificacion   DATE,
  a82usuariocreacion     NUMBER,
  a82usuariomodificacion NUMBER,
  a82taller              NUMBER,
  a82porc                NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T82_LOGROCASOEXITO
  is 'Tabla con logros de caso de exito';
comment on column HPV.T82_LOGROCASOEXITO.a82codigo
  is 'Identificacion unica del registro';
comment on column HPV.T82_LOGROCASOEXITO.a82nombre
  is 'Nombre del logro';
comment on column HPV.T82_LOGROCASOEXITO.a82verbo
  is 'Verbo del logro';
comment on column HPV.T82_LOGROCASOEXITO.a82adjetivo
  is 'Adjetivo del logro';
comment on column HPV.T82_LOGROCASOEXITO.a82medio
  is 'Medio del logro';
comment on column HPV.T82_LOGROCASOEXITO.a82estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T82_LOGROCASOEXITO.a82fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T82_LOGROCASOEXITO.a82fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T82_LOGROCASOEXITO.a82usuariocreacion
  is 'Usuario de creacion';
comment on column HPV.T82_LOGROCASOEXITO.a82usuariomodificacion
  is 'Usuario de modificacion';
comment on column HPV.T82_LOGROCASOEXITO.a82taller
  is 'Taller enseña el logro';
comment on column HPV.T82_LOGROCASOEXITO.a82porc
  is 'Porcentaje de habilidad';
alter table HPV.T82_LOGROCASOEXITO
  add constraint PK_T82 primary key (A82CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T83_ESTADOCASOEXITO
prompt ==================================
prompt
create table HPV.T83_ESTADOCASOEXITO
(
  a83codigo              CHAR(1) not null,
  a83nombre              VARCHAR2(50),
  a83fechacreacion       DATE,
  a83fechamodificacion   DATE,
  a83usuariocreacion     NUMBER,
  a83usuariomodificacion NUMBER,
  a83estado              CHAR(1)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T83_ESTADOCASOEXITO
  is 'Tabla con estados de casos de exito';
comment on column HPV.T83_ESTADOCASOEXITO.a83codigo
  is 'Identificacion del estado';
comment on column HPV.T83_ESTADOCASOEXITO.a83nombre
  is 'Descripcion del estado';
comment on column HPV.T83_ESTADOCASOEXITO.a83fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T83_ESTADOCASOEXITO.a83fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T83_ESTADOCASOEXITO.a83usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T83_ESTADOCASOEXITO.a83usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T83_ESTADOCASOEXITO.a83estado
  is 'Estado A:Activo I:Inactivo';
alter table HPV.T83_ESTADOCASOEXITO
  add constraint PK_T83 primary key (A83CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T58_CASOEXITO
prompt ============================
prompt
create table HPV.T58_CASOEXITO
(
  a58codigo              NUMBER not null,
  a58periodo             NUMBER,
  a58grupofacilitador    NUMBER,
  a58estado              CHAR(1),
  a58idlogro             NUMBER,
  a58fechacreacion       DATE,
  a58fechamodificacion   DATE,
  a58usuariocreacion     NUMBER,
  a58usuariomodificacion NUMBER,
  a58inscrito            NUMBER,
  a58facilitador         NUMBER,
  a58observacion         VARCHAR2(4000),
  a58motivorechazo       VARCHAR2(4000),
  a58numsi               NUMBER,
  a58numno               NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T58_CASOEXITO
  is 'Tabla con Casos de Exito';
comment on column HPV.T58_CASOEXITO.a58codigo
  is 'Identificacion del registro';
comment on column HPV.T58_CASOEXITO.a58periodo
  is 'Periodo';
comment on column HPV.T58_CASOEXITO.a58grupofacilitador
  is 'Grupo facilitador';
comment on column HPV.T58_CASOEXITO.a58estado
  is 'Estado del caso de exito';
comment on column HPV.T58_CASOEXITO.a58idlogro
  is 'Id del logro';
comment on column HPV.T58_CASOEXITO.a58fechacreacion
  is 'fecha de creacion';
comment on column HPV.T58_CASOEXITO.a58fechamodificacion
  is 'fecha de modiciacion';
comment on column HPV.T58_CASOEXITO.a58usuariocreacion
  is 'usuario creacion';
comment on column HPV.T58_CASOEXITO.a58usuariomodificacion
  is 'usuario modificacion';
comment on column HPV.T58_CASOEXITO.a58inscrito
  is 'inscrito seleccionado';
comment on column HPV.T58_CASOEXITO.a58facilitador
  is 'facilitador';
comment on column HPV.T58_CASOEXITO.a58observacion
  is 'observaciones';
comment on column HPV.T58_CASOEXITO.a58motivorechazo
  is 'motivo de rechazo';
comment on column HPV.T58_CASOEXITO.a58numsi
  is 'Numero de cualidades en si';
comment on column HPV.T58_CASOEXITO.a58numno
  is 'Numero de cualidades en no';
alter table HPV.T58_CASOEXITO
  add constraint PK_T58 primary key (A58CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T58_CASOEXITO
  add constraint FK_T58_T06 foreign key (A58FACILITADOR)
  references HPV.T06_USUARIOS (A06CODIGO);
alter table HPV.T58_CASOEXITO
  add constraint FK_T58_T12 foreign key (A58PERIODO)
  references HPV.T12_PERIODOS (A12CODIGO);
alter table HPV.T58_CASOEXITO
  add constraint FK_T58_T15 foreign key (A58INSCRITO)
  references HPV.T15_INSCRITOS (A15CODIGO);
alter table HPV.T58_CASOEXITO
  add constraint FK_T58_T26 foreign key (A58GRUPOFACILITADOR)
  references HPV.T26_GRUPOSFACILITADOR (A26CODIGO);
alter table HPV.T58_CASOEXITO
  add constraint FK_T58_T82 foreign key (A58IDLOGRO)
  references HPV.T82_LOGROCASOEXITO (A82CODIGO)
  disable;
alter table HPV.T58_CASOEXITO
  add constraint FK_T58_T83 foreign key (A58ESTADO)
  references HPV.T83_ESTADOCASOEXITO (A83CODIGO);

prompt
prompt Creating table T58_CASOEXITO161101
prompt ==================================
prompt
create table HPV.T58_CASOEXITO161101
(
  a58codigo              NUMBER not null,
  a58periodo             NUMBER,
  a58grupofacilitador    NUMBER,
  a58estado              CHAR(1),
  a58idlogro             NUMBER,
  a58fechacreacion       DATE,
  a58fechamodificacion   DATE,
  a58usuariocreacion     NUMBER,
  a58usuariomodificacion NUMBER,
  a58inscrito            NUMBER,
  a58facilitador         NUMBER,
  a58observacion         VARCHAR2(4000),
  a58motivorechazo       VARCHAR2(4000),
  a58numsi               NUMBER,
  a58numno               NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T58_CASOEXITO161101
  is 'tabla backup';

prompt
prompt Creating table T81_CUALIDADESCASOEXITO
prompt ======================================
prompt
create table HPV.T81_CUALIDADESCASOEXITO
(
  a81codigo              NUMBER not null,
  a81nombre              VARCHAR2(200),
  a81estado              CHAR(1),
  a81fechacreacion       DATE,
  a81fechamodificacion   DATE,
  a81usuariocreacion     NUMBER,
  a81usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T81_CUALIDADESCASOEXITO
  is 'Tabla con cualidades de casos de exito';
comment on column HPV.T81_CUALIDADESCASOEXITO.a81codigo
  is 'Identificacion del registro';
comment on column HPV.T81_CUALIDADESCASOEXITO.a81nombre
  is 'Descripcion de la cualidad';
comment on column HPV.T81_CUALIDADESCASOEXITO.a81estado
  is 'estado A:Activo I:Inactivo';
comment on column HPV.T81_CUALIDADESCASOEXITO.a81fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T81_CUALIDADESCASOEXITO.a81fechamodificacion
  is 'Fecha de modiciacion';
comment on column HPV.T81_CUALIDADESCASOEXITO.a81usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T81_CUALIDADESCASOEXITO.a81usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T81_CUALIDADESCASOEXITO
  add constraint PK_T81 primary key (A81CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T59_CASOEXITOLOGRO
prompt =================================
prompt
create table HPV.T59_CASOEXITOLOGRO
(
  a59codigo              NUMBER not null,
  a59casoexito           NUMBER,
  a59cualidad            NUMBER,
  a59respuesta           CHAR(1),
  a59estado              CHAR(1),
  a59fechacreacion       DATE,
  a59fechamodificacion   DATE,
  a59usuariocreacion     NUMBER,
  a59usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T59_CASOEXITOLOGRO
  is 'Tabla con Casos de Exito';
comment on column HPV.T59_CASOEXITOLOGRO.a59codigo
  is 'Identificacion registro';
comment on column HPV.T59_CASOEXITOLOGRO.a59casoexito
  is 'Caso de exito';
comment on column HPV.T59_CASOEXITOLOGRO.a59cualidad
  is 'Cualidad delcaso de exito';
comment on column HPV.T59_CASOEXITOLOGRO.a59respuesta
  is 'Si o No';
comment on column HPV.T59_CASOEXITOLOGRO.a59estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T59_CASOEXITOLOGRO.a59fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T59_CASOEXITOLOGRO.a59fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T59_CASOEXITOLOGRO.a59usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T59_CASOEXITOLOGRO.a59usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T59_CASOEXITOLOGRO
  add constraint PK_T59 primary key (A59CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T59_CASOEXITOLOGRO
  add constraint FK_T59_T58 foreign key (A59CASOEXITO)
  references HPV.T58_CASOEXITO (A58CODIGO);
alter table HPV.T59_CASOEXITOLOGRO
  add constraint FK_T59_T81 foreign key (A59CUALIDAD)
  references HPV.T81_CUALIDADESCASOEXITO (A81CODIGO);

prompt
prompt Creating table T59_CASOEXITOLOGRO161101
prompt =======================================
prompt
create table HPV.T59_CASOEXITOLOGRO161101
(
  a59codigo              NUMBER not null,
  a59casoexito           NUMBER,
  a59cualidad            NUMBER,
  a59respuesta           CHAR(1),
  a59estado              CHAR(1),
  a59fechacreacion       DATE,
  a59fechamodificacion   DATE,
  a59usuariocreacion     NUMBER,
  a59usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T59_CASOEXITOLOGRO161101
  is 'tabla de backup';

prompt
prompt Creating table T79_ESTADOLIDERAZGO
prompt ==================================
prompt
create table HPV.T79_ESTADOLIDERAZGO
(
  a79codigo              CHAR(1) not null,
  a79nombre              VARCHAR2(50),
  a79fechacreacion       DATE,
  a79fechamodificacion   DATE,
  a79usuariocreacion     NUMBER,
  a79usuariomodificacion NUMBER,
  a79estado              CHAR(1)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T79_ESTADOLIDERAZGO
  is 'Tabla con los estados de Liderazgo';
alter table HPV.T79_ESTADOLIDERAZGO
  add constraint PK_T79 primary key (A79CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T60_LIDERAZGO
prompt ============================
prompt
create table HPV.T60_LIDERAZGO
(
  a60codigo              NUMBER not null,
  a60periodo             NUMBER,
  a60grupofacilitador    NUMBER,
  a60estado              CHAR(1),
  a60fechacreacion       DATE,
  a60fechamodificacion   DATE,
  a60usuariocreacion     NUMBER,
  a60usuariomodificacion NUMBER,
  a60inscrito            NUMBER,
  a60facilitador         NUMBER,
  a60observacion         VARCHAR2(4000),
  a60motivorechazo       VARCHAR2(4000),
  a60numsi               NUMBER,
  a60numno               NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T60_LIDERAZGO
  is 'Tabla con ejemplos de Liderazgo';
comment on column HPV.T60_LIDERAZGO.a60codigo
  is 'Identificacion de registro';
comment on column HPV.T60_LIDERAZGO.a60periodo
  is 'Periodo';
comment on column HPV.T60_LIDERAZGO.a60grupofacilitador
  is 'Grupo facilitador';
comment on column HPV.T60_LIDERAZGO.a60estado
  is 'Estado';
comment on column HPV.T60_LIDERAZGO.a60fechacreacion
  is 'fecha creacion';
comment on column HPV.T60_LIDERAZGO.a60fechamodificacion
  is 'Fecha modicicacion';
comment on column HPV.T60_LIDERAZGO.a60usuariocreacion
  is 'usuario creacion';
comment on column HPV.T60_LIDERAZGO.a60usuariomodificacion
  is 'usuario modificacion';
comment on column HPV.T60_LIDERAZGO.a60inscrito
  is 'id delinscrito seleccionado';
comment on column HPV.T60_LIDERAZGO.a60facilitador
  is 'id facilitador';
comment on column HPV.T60_LIDERAZGO.a60observacion
  is 'observaciones';
comment on column HPV.T60_LIDERAZGO.a60motivorechazo
  is 'Motivo rechazo';
comment on column HPV.T60_LIDERAZGO.a60numsi
  is 'numero de cualidades positivas';
comment on column HPV.T60_LIDERAZGO.a60numno
  is 'numero de cualidades negativas';
alter table HPV.T60_LIDERAZGO
  add constraint PK_T60 primary key (A60CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T60_LIDERAZGO
  add constraint FK_T60_T06 foreign key (A60FACILITADOR)
  references HPV.T06_USUARIOS (A06CODIGO);
alter table HPV.T60_LIDERAZGO
  add constraint FK_T60_T12 foreign key (A60PERIODO)
  references HPV.T12_PERIODOS (A12CODIGO);
alter table HPV.T60_LIDERAZGO
  add constraint FK_T60_T15 foreign key (A60INSCRITO)
  references HPV.T15_INSCRITOS (A15CODIGO);
alter table HPV.T60_LIDERAZGO
  add constraint FK_T60_T26 foreign key (A60GRUPOFACILITADOR)
  references HPV.T26_GRUPOSFACILITADOR (A26CODIGO);
alter table HPV.T60_LIDERAZGO
  add constraint FK_T60_T79 foreign key (A60ESTADO)
  references HPV.T79_ESTADOLIDERAZGO (A79CODIGO);

prompt
prompt Creating table T60_LIDERAZGO161101
prompt ==================================
prompt
create table HPV.T60_LIDERAZGO161101
(
  a60codigo              NUMBER not null,
  a60periodo             NUMBER,
  a60grupofacilitador    NUMBER,
  a60estado              CHAR(1),
  a60fechacreacion       DATE,
  a60fechamodificacion   DATE,
  a60usuariocreacion     NUMBER,
  a60usuariomodificacion NUMBER,
  a60inscrito            NUMBER,
  a60facilitador         NUMBER,
  a60observacion         VARCHAR2(4000),
  a60motivorechazo       VARCHAR2(4000),
  a60numsi               NUMBER,
  a60numno               NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T60_LIDERAZGO161101
  is 'tabla backup';

prompt
prompt Creating table T80_CUALIDADESLIDERAZGO
prompt ======================================
prompt
create table HPV.T80_CUALIDADESLIDERAZGO
(
  a80codigo              NUMBER not null,
  a80nombre              VARCHAR2(200),
  a80estado              CHAR(1),
  a80fechacreacion       DATE,
  a80fechamodificacion   DATE,
  a80usuariocreacion     NUMBER,
  a80usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T80_CUALIDADESLIDERAZGO
  is 'Tabla con Cualidades de Liderazgo';
comment on column HPV.T80_CUALIDADESLIDERAZGO.a80codigo
  is 'Identificacion de registro';
comment on column HPV.T80_CUALIDADESLIDERAZGO.a80nombre
  is 'Nombre de la cualidad';
comment on column HPV.T80_CUALIDADESLIDERAZGO.a80estado
  is 'A:Activo I:Inactivo';
comment on column HPV.T80_CUALIDADESLIDERAZGO.a80fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T80_CUALIDADESLIDERAZGO.a80fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T80_CUALIDADESLIDERAZGO.a80usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T80_CUALIDADESLIDERAZGO.a80usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T80_CUALIDADESLIDERAZGO
  add constraint PK_T80 primary key (A80CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T61_LIDERAZGOCUALIDAD
prompt ====================================
prompt
create table HPV.T61_LIDERAZGOCUALIDAD
(
  a61codigo              NUMBER not null,
  a61liderazgo           NUMBER,
  a61cualidad            NUMBER,
  a61respuesta           CHAR(1),
  a61estado              CHAR(1),
  a61fechacreacion       DATE,
  a61fechamodificacion   DATE,
  a61usuariocreacion     NUMBER,
  a61usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T61_LIDERAZGOCUALIDAD
  is 'Tabla con cualidades de liderazgo';
comment on column HPV.T61_LIDERAZGOCUALIDAD.a61codigo
  is 'Identificacion del registro';
comment on column HPV.T61_LIDERAZGOCUALIDAD.a61liderazgo
  is 'id del registro de liderazgo asociado';
comment on column HPV.T61_LIDERAZGOCUALIDAD.a61cualidad
  is 'Id de la cualidad';
comment on column HPV.T61_LIDERAZGOCUALIDAD.a61respuesta
  is 'S:Si N:No';
comment on column HPV.T61_LIDERAZGOCUALIDAD.a61estado
  is 'A:Activo I:Inactivo';
comment on column HPV.T61_LIDERAZGOCUALIDAD.a61fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T61_LIDERAZGOCUALIDAD.a61fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T61_LIDERAZGOCUALIDAD.a61usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T61_LIDERAZGOCUALIDAD.a61usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T61_LIDERAZGOCUALIDAD
  add constraint PK_61 primary key (A61CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T61_LIDERAZGOCUALIDAD
  add constraint FK_T61_T60 foreign key (A61LIDERAZGO)
  references HPV.T60_LIDERAZGO (A60CODIGO);
alter table HPV.T61_LIDERAZGOCUALIDAD
  add constraint FK_T61_T80 foreign key (A61CUALIDAD)
  references HPV.T80_CUALIDADESLIDERAZGO (A80CODIGO);

prompt
prompt Creating table T61_LIDERAZGOCUALIDAD161101
prompt ==========================================
prompt
create table HPV.T61_LIDERAZGOCUALIDAD161101
(
  a61codigo              NUMBER not null,
  a61liderazgo           NUMBER,
  a61cualidad            NUMBER,
  a61respuesta           CHAR(1),
  a61estado              CHAR(1),
  a61fechacreacion       DATE,
  a61fechamodificacion   DATE,
  a61usuariocreacion     NUMBER,
  a61usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T61_LIDERAZGOCUALIDAD161101
  is 'tabla temporal';

prompt
prompt Creating table T62_REPORTE
prompt ==========================
prompt
create table HPV.T62_REPORTE
(
  a62codigo              NUMBER not null,
  a62categoria           VARCHAR2(100),
  a62nombre              VARCHAR2(100),
  a62descripcion         VARCHAR2(200),
  a62url                 VARCHAR2(200),
  a62estado              CHAR(1),
  a62fechacreacion       DATE,
  a62fechamodificacion   DATE,
  a62usuariocreacion     NUMBER,
  a62usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T62_REPORTE
  is 'Tabla con listado de Reportes';
comment on column HPV.T62_REPORTE.a62codigo
  is 'Identificacion unica del registro';
comment on column HPV.T62_REPORTE.a62categoria
  is 'Categoria del reporte';
comment on column HPV.T62_REPORTE.a62nombre
  is 'Nombre del reporte';
comment on column HPV.T62_REPORTE.a62descripcion
  is 'Descripcion del reporte';
comment on column HPV.T62_REPORTE.a62url
  is 'Url del reporte';
comment on column HPV.T62_REPORTE.a62estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T62_REPORTE.a62fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T62_REPORTE.a62fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T62_REPORTE.a62usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T62_REPORTE.a62usuariomodificacion
  is 'usuario modificacion';
alter table HPV.T62_REPORTE
  add constraint PK_T62 primary key (A62CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T63_CASOSEXITO_LOGROS
prompt ====================================
prompt
create table HPV.T63_CASOSEXITO_LOGROS
(
  a63_idcasoexito         NUMBER not null,
  a63_idlogro             NUMBER not null,
  a63_fechamodificacion   DATE,
  a63_usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T63_CASOSEXITO_LOGROS
  is 'Tabla con Casos de Exito';
comment on column HPV.T63_CASOSEXITO_LOGROS.a63_idcasoexito
  is 'Id del Caso de exito
';
comment on column HPV.T63_CASOSEXITO_LOGROS.a63_idlogro
  is 'Id del Logro referenciado.';
comment on column HPV.T63_CASOSEXITO_LOGROS.a63_fechamodificacion
  is 'Campo en el que se guarda la fecha en la que se modifica un registro.';
comment on column HPV.T63_CASOSEXITO_LOGROS.a63_usuariomodificacion
  is 'Campo en el que se guarda el usuario que realiza la modoficación de un registro.';
alter table HPV.T63_CASOSEXITO_LOGROS
  add constraint T63_CASOSEXITO_LOGROS_PK primary key (A63_IDCASOEXITO, A63_IDLOGRO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T63_CASOSEXITO_LOGROS
  add constraint T63_T58 foreign key (A63_IDCASOEXITO)
  references HPV.T58_CASOEXITO (A58CODIGO);
alter table HPV.T63_CASOSEXITO_LOGROS
  add constraint T63_T82 foreign key (A63_IDLOGRO)
  references HPV.T82_LOGROCASOEXITO (A82CODIGO);

prompt
prompt Creating table T63_CASOSEXITO_LOGROS161101
prompt ==========================================
prompt
create table HPV.T63_CASOSEXITO_LOGROS161101
(
  a63_idcasoexito         NUMBER not null,
  a63_idlogro             NUMBER not null,
  a63_fechamodificacion   DATE,
  a63_usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T63_CASOSEXITO_LOGROS161101
  is 'tabla temporal';

prompt
prompt Creating table T78_ESTADOPERIODO
prompt ================================
prompt
create table HPV.T78_ESTADOPERIODO
(
  a78codigo               CHAR(1),
  a78nombre               VARCHAR2(50),
  a78fechacreacion        DATE,
  a78fechamodificacion    DATE,
  a78usuariocreacion      NUMBER,
  a783usuariomodificacion NUMBER,
  a78estado               CHAR(1)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T78_ESTADOPERIODO
  is 'Tabla con estados de Periodo';

prompt
prompt Creating table T84_ESTADOHISTORIAVIDA
prompt =====================================
prompt
create table HPV.T84_ESTADOHISTORIAVIDA
(
  a84codigo              CHAR(1) not null,
  a84nombre              VARCHAR2(50),
  a84estado              CHAR(1),
  a84fechacreacion       DATE,
  a84fechamodificacion   DATE,
  a84usuariocreacion     NUMBER,
  a84usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T84_ESTADOHISTORIAVIDA
  is 'Tabla con estados de historias de vida';
comment on column HPV.T84_ESTADOHISTORIAVIDA.a84codigo
  is 'Identificacion del registro';
comment on column HPV.T84_ESTADOHISTORIAVIDA.a84nombre
  is 'Nombre del estado';
comment on column HPV.T84_ESTADOHISTORIAVIDA.a84estado
  is 'A:Activo I:Inactivo';
comment on column HPV.T84_ESTADOHISTORIAVIDA.a84fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T84_ESTADOHISTORIAVIDA.a84fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T84_ESTADOHISTORIAVIDA.a84usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T84_ESTADOHISTORIAVIDA.a84usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T84_ESTADOHISTORIAVIDA
  add constraint PK_T84 primary key (A84CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T86_NOTICIA
prompt ==========================
prompt
create table HPV.T86_NOTICIA
(
  a86codigo              NUMBER not null,
  a86noticia             VARCHAR2(300),
  a86estado              CHAR(1),
  a86fechacreacion       DATE,
  a86fechamodificacion   DATE,
  a86usuariocreacion     NUMBER,
  a86usuariomodificacion NUMBER,
  a86orden               NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 8K
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T86_NOTICIA
  is 'Tabla con las noticias en el banner';
comment on column HPV.T86_NOTICIA.a86codigo
  is 'Identifiacion unica de registro';
comment on column HPV.T86_NOTICIA.a86noticia
  is 'descripcion de la condicion especial';
comment on column HPV.T86_NOTICIA.a86estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T86_NOTICIA.a86fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T86_NOTICIA.a86fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T86_NOTICIA.a86usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T86_NOTICIA.a86usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T86_NOTICIA.a86orden
  is 'Orden de despliegue de la noticia';
alter table HPV.T86_NOTICIA
  add constraint PK_T86 primary key (A86CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T88_MOTIVOSRECHAZO
prompt =================================
prompt
create table HPV.T88_MOTIVOSRECHAZO
(
  a88codigo              VARCHAR2(10) not null,
  a88motivo              VARCHAR2(200),
  a88estado              CHAR(1),
  a88fechacreacion       DATE,
  a88fechamodificacion   DATE,
  a88usuariocreacion     NUMBER,
  a88usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T88_MOTIVOSRECHAZO
  is 'Tabla que contiene la información de las motivos de rechazo configurados en el sistema';
comment on column HPV.T88_MOTIVOSRECHAZO.a88codigo
  is 'Identificacion unica del registro';
comment on column HPV.T88_MOTIVOSRECHAZO.a88motivo
  is 'Motivo del rechazo';
comment on column HPV.T88_MOTIVOSRECHAZO.a88estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T88_MOTIVOSRECHAZO.a88fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T88_MOTIVOSRECHAZO.a88fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T88_MOTIVOSRECHAZO.a88usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T88_MOTIVOSRECHAZO.a88usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T88_MOTIVOSRECHAZO
  add constraint PK_T88 primary key (A88CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T89_ESTADOSENTREGABLES
prompt =====================================
prompt
create table HPV.T89_ESTADOSENTREGABLES
(
  a89codigo              VARCHAR2(10) not null,
  a89nombre              VARCHAR2(200),
  a89estado              CHAR(1),
  a89fechacreacion       DATE,
  a89fechamodificacion   DATE,
  a89usuariocreacion     NUMBER,
  a89usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T89_ESTADOSENTREGABLES
  is 'Tabla que contiene la información de los estados de los entregables configurados en el sistema';
comment on column HPV.T89_ESTADOSENTREGABLES.a89codigo
  is 'Identificacion unica del registro';
comment on column HPV.T89_ESTADOSENTREGABLES.a89nombre
  is 'Nombre del estado';
comment on column HPV.T89_ESTADOSENTREGABLES.a89estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T89_ESTADOSENTREGABLES.a89fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T89_ESTADOSENTREGABLES.a89fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T89_ESTADOSENTREGABLES.a89usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T89_ESTADOSENTREGABLES.a89usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T89_ESTADOSENTREGABLES
  add constraint PK_T89_ESTADOSENTREGABLES primary key (A89CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T91_ESTADOSITEM
prompt ==============================
prompt
create table HPV.T91_ESTADOSITEM
(
  a91codigo              VARCHAR2(10) not null,
  a91nombre              VARCHAR2(200),
  a91estado              CHAR(1),
  a91fechacreacion       DATE,
  a91fechamodificacion   DATE,
  a91usuariocreacion     NUMBER,
  a91usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T91_ESTADOSITEM
  is 'Tabla que contiene la información de los estados configurados en el sistema';
comment on column HPV.T91_ESTADOSITEM.a91codigo
  is 'Identificacion unica del registro';
comment on column HPV.T91_ESTADOSITEM.a91nombre
  is 'Nombre del estado';
comment on column HPV.T91_ESTADOSITEM.a91estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T91_ESTADOSITEM.a91fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T91_ESTADOSITEM.a91fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T91_ESTADOSITEM.a91usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T91_ESTADOSITEM.a91usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T91_ESTADOSITEM
  add constraint PK_T91_ESTADOSITEM primary key (A91CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T93_ESTADOSUSUARIO
prompt =================================
prompt
create table HPV.T93_ESTADOSUSUARIO
(
  a93codigo              VARCHAR2(10) not null,
  a93nombre              VARCHAR2(200),
  a93estado              CHAR(1),
  a93fechacreacion       DATE,
  a93fechamodificacion   DATE,
  a93usuariocreacion     NUMBER,
  a93usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T93_ESTADOSUSUARIO
  is 'Tabla que contiene la información de los estados del usuario configurados en el sistema';
comment on column HPV.T93_ESTADOSUSUARIO.a93codigo
  is 'Identificacion unica del registro';
comment on column HPV.T93_ESTADOSUSUARIO.a93nombre
  is 'Nombre del estado';
comment on column HPV.T93_ESTADOSUSUARIO.a93estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T93_ESTADOSUSUARIO.a93fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T93_ESTADOSUSUARIO.a93fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T93_ESTADOSUSUARIO.a93usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T93_ESTADOSUSUARIO.a93usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T93_ESTADOSUSUARIO
  add constraint PK_T93_ESTADOSUSUARIO primary key (A93CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T94_ESTADOSENCUESTA
prompt ==================================
prompt
create table HPV.T94_ESTADOSENCUESTA
(
  a94codigo              VARCHAR2(10) not null,
  a94nombre              VARCHAR2(200),
  a94estado              CHAR(1),
  a94fechacreacion       DATE,
  a94fechamodificacion   DATE,
  a94usuariocreacion     NUMBER,
  a94usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.T94_ESTADOSENCUESTA
  is 'Tabla que contiene la información de los estados de la encuesta configurados en el sistema';
comment on column HPV.T94_ESTADOSENCUESTA.a94codigo
  is 'Identificacion unica del registro';
comment on column HPV.T94_ESTADOSENCUESTA.a94nombre
  is 'Nombre del estado';
comment on column HPV.T94_ESTADOSENCUESTA.a94estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T94_ESTADOSENCUESTA.a94fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T94_ESTADOSENCUESTA.a94fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T94_ESTADOSENCUESTA.a94usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T94_ESTADOSENCUESTA.a94usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T94_ESTADOSENCUESTA
  add constraint PK_T94_ESTADOSENCUESTA primary key (A94CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255;

prompt
prompt Creating table T95_MENSAJERESPUESTA
prompt ===================================
prompt
create table HPV.T95_MENSAJERESPUESTA
(
  a95codigo              VARCHAR2(10) not null,
  a95mensaje             VARCHAR2(200),
  a95estado              CHAR(1),
  a95fechacreacion       DATE,
  a95fechamodificacion   DATE,
  a95usuariocreacion     NUMBER,
  a95usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T95_MENSAJERESPUESTA
  is 'Tabla que contiene la información de los mensajes configurados para el sistema';
comment on column HPV.T95_MENSAJERESPUESTA.a95codigo
  is 'Identificacion unica del registro';
comment on column HPV.T95_MENSAJERESPUESTA.a95mensaje
  is 'Descripcion del mensaje';
comment on column HPV.T95_MENSAJERESPUESTA.a95estado
  is 'Estado A:Activo I:Inactivo';
comment on column HPV.T95_MENSAJERESPUESTA.a95fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T95_MENSAJERESPUESTA.a95fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T95_MENSAJERESPUESTA.a95usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T95_MENSAJERESPUESTA.a95usuariomodificacion
  is 'Usuario modificacion';
alter table HPV.T95_MENSAJERESPUESTA
  add constraint PK_T95_MENSAJERESPUESTA primary key (A95CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T96_OPCIONROL
prompt ============================
prompt
create table HPV.T96_OPCIONROL
(
  a96opcion              NUMBER not null,
  a96rol                 NUMBER not null,
  a96fechacreacion       DATE,
  a96usuariocreacion     NUMBER,
  a96fechamodificacion   DATE,
  a96usuariomodificacion NUMBER,
  a96estado              CHAR(1)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T96_OPCIONROL
  is 'Tabla que contiene la información de los opciones del menu asociadas a un rol';
comment on column HPV.T96_OPCIONROL.a96opcion
  is 'FK de la tabla T10_OPCIONES de la opción';
comment on column HPV.T96_OPCIONROL.a96rol
  is 'FK de la tabla T05_ROLES ID del rol';
comment on column HPV.T96_OPCIONROL.a96fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T96_OPCIONROL.a96usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T96_OPCIONROL.a96fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T96_OPCIONROL.a96usuariomodificacion
  is 'Usuario ultima modificacion';
comment on column HPV.T96_OPCIONROL.a96estado
  is 'Estado A:Activo I:Inactivo';
alter table HPV.T96_OPCIONROL
  add constraint PK_T96_OPCIONESROL primary key (A96OPCION, A96ROL)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table HPV.T96_OPCIONROL
  add constraint FK_T96_T05 foreign key (A96ROL)
  references HPV.T05_ROLES (A05CODIGO);
alter table HPV.T96_OPCIONROL
  add constraint FK_T96_T10 foreign key (A96OPCION)
  references HPV.T10_OPCIONES (A10CODIGO);

prompt
prompt Creating table T96_OPCIONROL_T
prompt ==============================
prompt
create table HPV.T96_OPCIONROL_T
(
  a96opcion              NUMBER not null,
  a96rol                 NUMBER not null,
  a96fechacreacion       DATE,
  a96usuariocreacion     NUMBER,
  a96fechamodificacion   DATE,
  a96usuariomodificacion NUMBER,
  a96estado              CHAR(1)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255;
comment on table HPV.T96_OPCIONROL_T
  is 'Tabla que contiene la información de los opciones del menu asociadas a un rol';
comment on column HPV.T96_OPCIONROL_T.a96opcion
  is 'FK de la tabla T10_OPCIONES de la opción';
comment on column HPV.T96_OPCIONROL_T.a96rol
  is 'FK de la tabla T05_ROLES ID del rol';
comment on column HPV.T96_OPCIONROL_T.a96fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T96_OPCIONROL_T.a96usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T96_OPCIONROL_T.a96fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T96_OPCIONROL_T.a96usuariomodificacion
  is 'Usuario ultima modificacion';
comment on column HPV.T96_OPCIONROL_T.a96estado
  is 'Estado A:Activo I:Inactivo';

prompt
prompt Creating table T97_PARAMETROSLOG
prompt ================================
prompt
create table HPV.T97_PARAMETROSLOG
(
  a97codigo              NUMBER,
  a97paquete             VARCHAR2(30),
  a97procedimiento       VARCHAR2(30),
  a97estado              CHAR(1),
  a97fechacreacion       DATE,
  a97fechamodificacion   DATE,
  a97usuariocreacion     NUMBER,
  a97usuariomodificacion NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T97_PARAMETROSLOG
  is 'Tabla que contiene la información de la paramerización del log de la ejecución de paquetes';
comment on column HPV.T97_PARAMETROSLOG.a97codigo
  is 'Identificacion unica del registro';
comment on column HPV.T97_PARAMETROSLOG.a97paquete
  is 'Nombre del paquete de base de datos';
comment on column HPV.T97_PARAMETROSLOG.a97procedimiento
  is 'Nombre del procedimiento de base de datos';
comment on column HPV.T97_PARAMETROSLOG.a97estado
  is 'Estado A:Activo I:Inactivo''';
comment on column HPV.T97_PARAMETROSLOG.a97fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T97_PARAMETROSLOG.a97fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T97_PARAMETROSLOG.a97usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T97_PARAMETROSLOG.a97usuariomodificacion
  is 'Usuario modificacion';

prompt
prompt Creating table T98_EXCEPCION
prompt ============================
prompt
create table HPV.T98_EXCEPCION
(
  a98codigo              NUMBER not null,
  a98fechaexcepcion      DATE,
  a98usuario             NUMBER,
  a98paquete             VARCHAR2(30),
  a98procedimiento       VARCHAR2(30),
  a98coderror            NUMBER,
  a98fechacreacion       DATE,
  a98fechamodificacion   DATE,
  a98usuariocreacion     NUMBER,
  a98usuariomodificacion NUMBER,
  a98msgerror            VARCHAR2(4000)
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T98_EXCEPCION
  is 'Tabla que contiene la información de las excepciones presentadas en el sistema';
comment on column HPV.T98_EXCEPCION.a98codigo
  is 'Identificacion unica del registro';
comment on column HPV.T98_EXCEPCION.a98fechaexcepcion
  is 'Fecha en que se presenta la excepcion ';
comment on column HPV.T98_EXCEPCION.a98usuario
  is 'Usuario que ejecutó la excepcion';
comment on column HPV.T98_EXCEPCION.a98paquete
  is 'Nombre del paquete de base de datos donde se presenta la excepcion';
comment on column HPV.T98_EXCEPCION.a98procedimiento
  is 'Nombre del procedimeinto de base de datos donde se presenta la excepcion';
comment on column HPV.T98_EXCEPCION.a98coderror
  is 'Codigo de error Oracle';
comment on column HPV.T98_EXCEPCION.a98fechacreacion
  is 'Fecha de creacion';
comment on column HPV.T98_EXCEPCION.a98fechamodificacion
  is 'Fecha de modificacion';
comment on column HPV.T98_EXCEPCION.a98usuariocreacion
  is 'Usuario creacion';
comment on column HPV.T98_EXCEPCION.a98usuariomodificacion
  is 'Usuario modificacion';
comment on column HPV.T98_EXCEPCION.a98msgerror
  is 'Mensaje de error Oracle';
alter table HPV.T98_EXCEPCION
  add constraint PK_ primary key (A98CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating table T99_LOGOPERACION
prompt ===============================
prompt
create table HPV.T99_LOGOPERACION
(
  a99codigo         NUMBER not null,
  a99fechaoperacion DATE,
  a99usuario        NUMBER,
  a99paquete        VARCHAR2(30),
  a99procedimiento  VARCHAR2(30),
  a99descripcion    VARCHAR2(500),
  a99nivel          NUMBER
)
tablespace HPV
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
comment on table HPV.T99_LOGOPERACION
  is 'Tabla que contiene la información de los logs del sistema';
comment on column HPV.T99_LOGOPERACION.a99codigo
  is 'Identificacion unica del registro';
comment on column HPV.T99_LOGOPERACION.a99fechaoperacion
  is 'Fecha de registro del log';
comment on column HPV.T99_LOGOPERACION.a99usuario
  is 'Usuario que registró el log';
comment on column HPV.T99_LOGOPERACION.a99paquete
  is 'Nombre del paquete de base de datos';
comment on column HPV.T99_LOGOPERACION.a99procedimiento
  is 'Nombre del procedimiento de base de datos';
comment on column HPV.T99_LOGOPERACION.a99descripcion
  is 'Descripción del log ejecutado';
comment on column HPV.T99_LOGOPERACION.a99nivel
  is 'Nivel del log';
alter table HPV.T99_LOGOPERACION
  add constraint PK_T99_LOGOPERACION primary key (A99CODIGO)
  using index 
  tablespace HPV
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );

prompt
prompt Creating sequence T01_PARTICIPANTES_SEQ
prompt =======================================
prompt
create sequence HPV.T01_PARTICIPANTES_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 216041
increment by 1
cache 20;

prompt
prompt Creating sequence T02_DEPARTAMENTOS_SEQ
prompt =======================================
prompt
create sequence HPV.T02_DEPARTAMENTOS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T03_MUNICIPIOS_SEQ
prompt ====================================
prompt
create sequence HPV.T03_MUNICIPIOS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T04_TIPOSDOCUMENTO_SEQ
prompt ========================================
prompt
create sequence HPV.T04_TIPOSDOCUMENTO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T05_ROLES_SEQ
prompt ===============================
prompt
create sequence HPV.T05_ROLES_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 21
increment by 1
cache 20;

prompt
prompt Creating sequence T06_USUARIOS_SEQ
prompt ==================================
prompt
create sequence HPV.T06_USUARIOS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 2420
increment by 1
cache 20;

prompt
prompt Creating sequence T07_PERSONAS_SEQ
prompt ==================================
prompt
create sequence HPV.T07_PERSONAS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 2420
increment by 1
cache 20;

prompt
prompt Creating sequence T08_PARAMETROS_SEQ
prompt ====================================
prompt
create sequence HPV.T08_PARAMETROS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 100
increment by 1
cache 20;

prompt
prompt Creating sequence T09_MENU_SEQ
prompt ==============================
prompt
create sequence HPV.T09_MENU_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T10_OPCIONES_SEQ
prompt ==================================
prompt
create sequence HPV.T10_OPCIONES_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T12_PERIODOS_SEQ
prompt ==================================
prompt
create sequence HPV.T12_PERIODOS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 10
increment by 1
cache 20;

prompt
prompt Creating sequence T13_ENCUESTAPREGUNTAS_SEQ
prompt ===========================================
prompt
create sequence HPV.T13_ENCUESTAPREGUNTAS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 432
increment by 1
cache 20;

prompt
prompt Creating sequence T14_ENCUESTARESPUESTAS_SEQ
prompt ============================================
prompt
create sequence HPV.T14_ENCUESTARESPUESTAS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 500
increment by 1
cache 20;

prompt
prompt Creating sequence T15_INSCRITOS_SEQ
prompt ===================================
prompt
create sequence HPV.T15_INSCRITOS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 168500
increment by 1
cache 20;

prompt
prompt Creating sequence T16_INSCRITOENCUESTA_SEQ
prompt ==========================================
prompt
create sequence HPV.T16_INSCRITOENCUESTA_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 2695822
increment by 1
cache 20;

prompt
prompt Creating sequence T17_TALLERES_SEQ
prompt ==================================
prompt
create sequence HPV.T17_TALLERES_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T18_ENTREGABLES_SEQ
prompt =====================================
prompt
create sequence HPV.T18_ENTREGABLES_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T20_ENTREGABLESCARGADOS_SEQ
prompt =============================================
prompt
create sequence HPV.T20_ENTREGABLESCARGADOS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1035740
increment by 1
cache 20;

prompt
prompt Creating sequence T21_REALIZACIONTALLER_SEQ
prompt ===========================================
prompt
create sequence HPV.T21_REALIZACIONTALLER_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1036320
increment by 1
cache 20;

prompt
prompt Creating sequence T22_CORREOS_SEQ
prompt =================================
prompt
create sequence HPV.T22_CORREOS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T23_DIAS_SEQ
prompt ==============================
prompt
create sequence HPV.T23_DIAS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 21
increment by 1
cache 20;

prompt
prompt Creating sequence T24_HORARIOS_SEQ
prompt ==================================
prompt
create sequence HPV.T24_HORARIOS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 21
increment by 1
cache 20;

prompt
prompt Creating sequence T25_GRUPOS_SEQ
prompt ================================
prompt
create sequence HPV.T25_GRUPOS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 21
increment by 1
cache 20;

prompt
prompt Creating sequence T26_GRUPOSFACILITADOR_SEQ
prompt ===========================================
prompt
create sequence HPV.T26_GRUPOSFACILITADOR_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 5380
increment by 1
cache 20;

prompt
prompt Creating sequence T27_MENSAJES_SEQ
prompt ==================================
prompt
create sequence HPV.T27_MENSAJES_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T29_CONSULTAPARTICIPANTES_SEQ
prompt ===============================================
prompt
create sequence HPV.T29_CONSULTAPARTICIPANTES_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 110982
increment by 1
cache 20;

prompt
prompt Creating sequence T30_CIUDADESUSUARIO_SEQ
prompt =========================================
prompt
create sequence HPV.T30_CIUDADESUSUARIO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 2922
increment by 1
cache 20;

prompt
prompt Creating sequence T50_ENCUESTA_SEQ
prompt ==================================
prompt
create sequence HPV.T50_ENCUESTA_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 3
increment by 1
cache 20;

prompt
prompt Creating sequence T51_ASISTENCIA_SEQ
prompt ====================================
prompt
create sequence HPV.T51_ASISTENCIA_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1671360
increment by 1
cache 20;

prompt
prompt Creating sequence T52_CANDIDATOS_SEQ
prompt ====================================
prompt
create sequence HPV.T52_CANDIDATOS_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 6020
increment by 1
cache 20;

prompt
prompt Creating sequence T53_GRUPOINSCRITO_SEQ
prompt =======================================
prompt
create sequence HPV.T53_GRUPOINSCRITO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 109773
increment by 1
cache 20;

prompt
prompt Creating sequence T54_TOKENUSUARIO_SEQ
prompt ======================================
prompt
create sequence HPV.T54_TOKENUSUARIO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 117801
increment by 1
cache 20;

prompt
prompt Creating sequence T55_LOGENVIOCORREO_SEQ
prompt ========================================
prompt
create sequence HPV.T55_LOGENVIOCORREO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 170981
increment by 1
cache 20;

prompt
prompt Creating sequence T56_OBSERVACIONENCUESTA_SEQ
prompt =============================================
prompt
create sequence HPV.T56_OBSERVACIONENCUESTA_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 86501
increment by 1
cache 20;

prompt
prompt Creating sequence T57_HISTORIAVIDA_SEQ
prompt ======================================
prompt
create sequence HPV.T57_HISTORIAVIDA_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 601
increment by 1
cache 20;

prompt
prompt Creating sequence T58_CASOEXITO_SEQ
prompt ===================================
prompt
create sequence HPV.T58_CASOEXITO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 781
increment by 1
cache 20;

prompt
prompt Creating sequence T59_CASOEXITOLOGRO_SEQ
prompt ========================================
prompt
create sequence HPV.T59_CASOEXITOLOGRO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 5901
increment by 1
cache 20;

prompt
prompt Creating sequence T60_LIDERAZGO_SEQ
prompt ===================================
prompt
create sequence HPV.T60_LIDERAZGO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 641
increment by 1
cache 20;

prompt
prompt Creating sequence T61_LIDERAZGOCUALIDAD_SEQ
prompt ===========================================
prompt
create sequence HPV.T61_LIDERAZGOCUALIDAD_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 4721
increment by 1
cache 20;

prompt
prompt Creating sequence T90_ESTADOSESPACIOFISICO_SEQ
prompt ==============================================
prompt
create sequence HPV.T90_ESTADOSESPACIOFISICO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T91_ESTADOSITEM_SEQ
prompt =====================================
prompt
create sequence HPV.T91_ESTADOSITEM_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T92_PERFILESUSUARIO_SEQ
prompt =========================================
prompt
create sequence HPV.T92_PERFILESUSUARIO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T93_ESTADOSUSUARIO_SEQ
prompt ========================================
prompt
create sequence HPV.T93_ESTADOSUSUARIO_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T94_ESTADOSENCUESTA_SEQ
prompt =========================================
prompt
create sequence HPV.T94_ESTADOSENCUESTA_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T96_OPCIONROL_SEQ
prompt ===================================
prompt
create sequence HPV.T96_OPCIONROL_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 100
increment by 1
cache 20;

prompt
prompt Creating sequence T97_MENSAJE_SEQ
prompt =================================
prompt
create sequence HPV.T97_MENSAJE_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 20;

prompt
prompt Creating sequence T98_EXCEPCION_SEQ
prompt ===================================
prompt
create sequence HPV.T98_EXCEPCION_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 24642
increment by 1
cache 20;

prompt
prompt Creating sequence T99_LOGOPERACION_SEQ
prompt ======================================
prompt
create sequence HPV.T99_LOGOPERACION_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 4861922
increment by 1
cache 20;

prompt
prompt Creating view VW_CUPOSDISPONIBLES
prompt =================================
prompt
CREATE OR REPLACE FORCE VIEW HPV.VW_CUPOSDISPONIBLES AS
SELECT 38 - COUNT(*) Disponibilidad,
       D.A02NOMBRE Dpto,
       M.A03NOMBRE Municipio,
       s.A23NOMBRE Dia,
       H.A24HORARIO Horario,
       G.A26SIGLA Grupo,
       G.A26LUGAR Lugar,
       G.A26DIRECCION Direccion,
       p.a07primernombre || ' ' || p.a07segundonombre || ' ' ||
       p.a07primerapellido || ' ' || p.a07segundoapellido Facilitador,
       c.a07email Coordinador

  FROM T26_GRUPOSFACILITADOR G,
       T02_DEPARTAMENTOS     D,
       T03_MUNICIPIOS        M,
       T23_DIAS              s,
       T24_HORARIOS          H,
       T25_GRUPOS            R,
       T06_USUARIOS          u,
       T07_PERSONAS          P,
       t15_inscritos         I,
       T07_PERSONAS          c

 WHERE I.A15GRUPOFACILITADOR(+) = G.A26CODIGO
   and u.a06coordinador = c.a07usuario
   AND a26ciudad = a03codigo
   AND a03departamento = a02codigo
   AND a26dia = a23codigo
   AND a26horario = a24codigo
   AND a26grupo = a25codigo
   AND a26facilitador = a06codigo
   AND a06codigo = p.a07usuario
   and a26periodo = 2
   and A26ESTADO = 'A'
   and u.a06estado = 'A'
   and g.a26estado = 'A'
   and G.A26SIGLA not like '%G11'
 GROUP BY D.A02NOMBRE,
          M.A03NOMBRE,
          s.A23NOMBRE,
          H.A24HORARIO,
          G.A26SIGLA,
          G.A26LUGAR,
          G.A26DIRECCION,
          p.a07primernombre,
          p.a07segundonombre,
          p.a07primerapellido,
          p.a07segundoapellido,
          c.a07email
order by 2,3,4,5;

prompt
prompt Creating view VW_ESTACIOS_FISICOS
prompt =================================
prompt
CREATE OR REPLACE FORCE VIEW HPV.VW_ESTACIOS_FISICOS AS
SELECT a26periodo periodo,
             a26codigo idespaciofisico,
             a26estado codestado,
             a90nombre nomEstado,
             a02codigo iddepartamento,
             a02nombre nomdepartamento,
             a26ciudad idmunicipio,
             a03nombre nommunicipio,
             a26dia iddia,
             a23nombre dia,
             a26horario idhorario,
             a24horario horario,
             a26grupo idgrupo,
             a25nombre grupo,
             a26sigla siglagrupo,
             a26lugar lugar,
             a26direccion direccion,
             a26motivorechazo motivorechazo,
             a26facilitador idfacilitador,
             a07primernombre || ' ' || a07segundonombre || ' ' ||
             a07primerapellido || ' ' || a07segundoapellido nombrefacilitador,
             a06coordinador idCoordinador,
             (select b.a07primernombre || ' ' || b.a07segundonombre || ' ' ||
             b.a07primerapellido || ' ' || b.a07segundoapellido from T06_USUARIOS a, T07_PERSONAS b  where a.a06codigo = u.a06coordinador and a.a06codigo = b.a07usuario ) nomCoordinador
        FROM T26_GRUPOSFACILITADOR,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS u,
             T07_PERSONAS
       WHERE a26estado = a90codigo
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = a07usuario;

prompt
prompt Creating view VW_ESTADOREALIZACIONTALLER
prompt ========================================
prompt
create or replace force view hpv.vw_estadorealizaciontaller as
select
a21periodo IdPeriodo,
a19entregable IdEntregable,
a21taller IdTaller,
a17nombre NomTaller,
a17descripcion DescripcionTaller,
a26codigo IdGrupoFacilitador,
a25nombre NombreGrupo,
to_char(a21fechataller,'yyyy-mm-dd') FechaRealizacion,
a21facilitador IdFacilitador,
( a07primerapellido || ' ' || a07segundoapellido || ' ' || a07primernombre || ' '  || a07segundonombre ) NombreFacilitador,
a06coordinador IdCoordinador,
a21estado IdEstadoAsistencia,
e1.a89nombre EstadoAsistencia,
a21motivorechazo MotivoRechazoAsistencia,
a26grupo idGrupo,
a20codigo IdDocumento,
a20estado IdEstadoDocumento ,
e2.a89nombre EstadoDocumento,
a20motivorechazo MotivoRechazoDocumento,
--(a21Asistentes +  a21NoAsistentes) NumeroAsistentes,
(NVL(a21Asistentes,0) +  NVL(a21NoAsistentes,0)) NumeroAsistentes
from
t21_realizaciontaller ,
t06_usuarios ,
t07_personas ,
t26_gruposfacilitador ,
t20_entregablesCargados,
t25_grupos ,
t17_talleres ,
t19_tallerentregables ,
t89_estadosentregables e1,
t89_estadosentregables e2
where
a21facilitador = a06codigo
and a07usuario = a06codigo
and a26codigo = a21grupo
and a26grupo = a25codigo
and a21taller = a17codigo
and a21taller = a19taller
and a21estado = e1.a89codigo
and a26codigo = a20grupo
and a19entregable = a20entregable
and a21taller = a20taller
and a20estado = e2.a89codigo
and a19estado = 'A'
-- and a25Estado = 'A'
and a26Estado = 'A'
and a17estado = 'A';

prompt
prompt Creating view VW_INSCRITOS
prompt ==========================
prompt
CREATE OR REPLACE FORCE VIEW HPV.VW_INSCRITOS AS
SELECT a26periodo periodo,
             a15tipodocumento tipodocumento,
             a15documento documento,
             a15primernombre || ' ' || a15segundonombre || ' ' ||              a15primerapellido || ' ' || a15segundoapellido nombreinscrito,
             a15email email,
             a15telefono telefono,
             a15movil movil,
             a15movilalt movilalt,
             T87_CONDICIONESPECIAL.A87CONDICION condicionespecial,
             a02nombre nomdepartamento,
             a03nombre nommunicipio,
             a23nombre dia,
             a24horario horario,
             a25nombre grupo,
             a26sigla siglagrupo,
             a26lugar lugar,
             a26direccion direccion,
             p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' || p1.a07primerapellido || ' ' || p1.a07segundoapellido nombrefacilitador,
             p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||  p2.a07primerapellido || ' ' || p2.a07segundoapellido nombreCoordinador
        FROM T26_GRUPOSFACILITADOR,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS,
             T07_PERSONAS p1,
             T07_PERSONAS p2,
             T15_INSCRITOS,
             T04_TIPOSDOCUMENTO,
             T87_CONDICIONESPECIAL
       WHERE a26estado = a90codigo
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
        AND a06codigo = p1.a07usuario
         AND a06coordinador = p2.a07usuario
         AND a15grupofacilitador = a26codigo
         AND a15tipodocumento = a04tipodocumento
         AND a15condicionespecial = a87codigo
         and T26_GRUPOSFACILITADOR.A26ESTADO = 'A'
         AND T26_GRUPOSFACILITADOR.A26PERIODO = 2;

prompt
prompt Creating view VW_R_ENCUESTAENTRADA
prompt ==================================
prompt
create or replace force view hpv.vw_r_encuestaentrada as
select a26periodo, e.a16inscrito, f.a26sigla, p.a13numero, r.a14letra
  from T16_INSCRITOENCUESTA  e,
       t53_grupoinscrito     g,
       T26_GRUPOSFACILITADOR f,
       T13_ENCUESTAPREGUNTAS p,
       t14_encuestarespuestas r

 where e.a16encuesta = 4
   and g.a53periodo = 2
   and g.a53inscrito = e.a16inscrito
   and f.a26periodo = 2
   and f.a26codigo = g.a53grupofacilitador
   and p.a13codigo = e.a16pregunta
   and p.a13encuesta = 4
   and r.a14codigo = e.a16respuesta;

prompt
prompt Creating view VW_ROLUSUPER
prompt ==========================
prompt
create or replace force view hpv.vw_rolusuper as
select r.a05nombre,
       r.a05estado,
       u.a06perfil,
       u.a06coordinador,
       u.a06usuario,
       u.a06estado,
       p.a07tipodocumento,
       p.a07identificacion,
       p.a07primernombre,
       p.a07segundonombre,
       p.a07primerapellido,
       p.a07segundoapellido,
       p.a07email,
       p.a07movil
  from t05_roles r, t06_usuarios u, t07_personas p
 where r.a05codigo = u.a06rol
   and u.a06codigo = p.a07usuario
 order by u.a06estado, r.a05estado, r.a05nombre, p.a07primernombre;

prompt
prompt Creating view VW_RPT_CRONOGRAMATALLER
prompt =====================================
prompt
CREATE OR REPLACE FORCE VIEW HPV.VW_RPT_CRONOGRAMATALLER AS
SELECT
a26periodo periodo,
a26codigo idGrupoFacilitador,
a03dane Divipola,
a02nombre nomdepartamento,
a03nombre nommunicipio,
(select b.a07primernombre || ' ' || b.a07segundonombre || ' ' || b.a07primerapellido || ' ' || b.a07segundoapellido from T06_USUARIOS a, T07_PERSONAS b  where a.a06codigo = u.a06coordinador and a.a06codigo = b.a07usuario ) nomCoordinador,
(a07primernombre || ' ' || a07segundonombre || ' ' || a07primerapellido || ' ' || a07segundoapellido ) nombrefacilitador,
a26grupo idgrupo,
a23nombre dia,
a24horario horario,
(select count(*) from t53_grupoinscrito where a53periodo = a26periodo and a53grupofacilitador = a26codigo and a53estado = 'A') Inscritos,
(a12fechainitaller + a23Codigo - 2 + 0 ) Taller1,
(a12fechainitaller + a23Codigo - 2 + 7 ) Taller2,
(a12fechainitaller + a23Codigo - 2 + 14 ) Taller3,
(a12fechainitaller + a23Codigo - 2 + 21 ) Taller4,
(a12fechainitaller + a23Codigo - 2 + 28 ) Taller5,
(a12fechainitaller + a23Codigo - 2 + 35 ) Taller6,
(a12fechainitaller + a23Codigo - 2 + 42 ) Taller7,
(a12fechainitaller + a23Codigo - 2 + 49 ) Taller8,
a02codigo IdDepartamento,
a03codigo IdMunicipio,
a07Usuario IdFacilitador,
a06Coordinador IdCoordinador
FROM T26_GRUPOSFACILITADOR,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS u,
             T07_PERSONAS,
             T12_PERIODOS
       WHERE a26estado = a90codigo
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = a07usuario
         AND a26periodo = a12codigo
         and a06estado = 'A';

prompt
prompt Creating view VW_RPT_TRAZABILIDAD
prompt =================================
prompt
CREATE OR REPLACE FORCE VIEW HPV.VW_RPT_TRAZABILIDAD AS
SELECT
a26periodo periodo,
a15Codigo,
a02nombre nomdepartamento,
a03nombre nommunicipio,
( p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||  p2.a07primerapellido || ' ' || p2.a07segundoapellido ) nombreCoordinador,
p1.a07identificacion cc_facilitador,
( p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' || p1.a07primerapellido || ' ' || p1.a07segundoapellido ) nombrefacilitador,
a15documento documento_inscrito,
a15codigobeneficiario codigo_beneficiario,
a15primernombre PrimerNombre,
a15segundonombre SegundoNombre,
a15primerapellido PrimerApellido,
a15segundoapellido SegundoApellido,
a15email Email,
a15telefono Telefono,
a15movil Movil,
a15movilalt MovilAlt,
a01municipioestudio MunicipioEstudio,
a01tipoformcion TipoFormacion,
a01nivelformacion NivelFormacion,
a01fichasnies FichaSNIES,
a01ultimomes FechaUltMes,
a01finsemestre FechaFinSemestresCursados,
a01finetapapractica FinFechaEtapaPractica,
a01noconvenio CodigoConvenio,
a01sniesies SNIES_IES,
'INSCRITO' ProgramaEstado,
'' Institucion,
( select min(a16fechacreacion) from t16_inscritoencuesta where a16inscrito = a15Codigo and a16encuesta = ( select a50codigo from t50_encuesta where a50periodo = a26periodo and a50tipoencuesta = 'I' ) ) Encuesta_Inicial,
( select max(a16fechacreacion) from t16_inscritoencuesta where a16inscrito = a15Codigo and a16encuesta = ( select a50codigo from t50_encuesta where a50periodo = a26periodo and a50tipoencuesta = 'S' ) ) Encuesta_Satisfaccion,
( select max(a16fechacreacion) from t16_inscritoencuesta where a16inscrito = a15Codigo and a16encuesta = ( select a50codigo from t50_encuesta where a50periodo = a26periodo and a50tipoencuesta = 'F' ) ) Encuesta_Final,
(  select max(a51asistencia) from t51_asistenciataller where a51periodo = a26periodo and a51inscrito = a15Codigo and a51tallerrealizado = 1 ) Taller1,
(  select max(a51asistencia) from t51_asistenciataller where a51periodo = a26periodo and a51inscrito = a15Codigo and a51tallerrealizado = 2 ) Taller2,
(  select max(a51asistencia) from t51_asistenciataller where a51periodo = a26periodo and a51inscrito = a15Codigo and a51tallerrealizado = 3 ) Taller3,
(  select max(a51asistencia) from t51_asistenciataller where a51periodo = a26periodo and a51inscrito = a15Codigo and a51tallerrealizado = 4 ) Taller4,
(  select max(a51asistencia) from t51_asistenciataller where a51periodo = a26periodo and a51inscrito = a15Codigo and a51tallerrealizado = 5 ) Taller5,
(  select max(a51asistencia) from t51_asistenciataller where a51periodo = a26periodo and a51inscrito = a15Codigo and a51tallerrealizado = 6 ) Taller6,
(  select max(a51asistencia) from t51_asistenciataller where a51periodo = a26periodo and a51inscrito = a15Codigo and a51tallerrealizado = 7 ) Taller7,
(  select max(a51asistencia) from t51_asistenciataller where a51periodo = a26periodo and a51inscrito = a15Codigo and a51tallerrealizado = 8 ) Taller8,
( select round(count(*) * 100 / 8,0) from t51_asistenciataller where a51periodo = a26periodo and a51inscrito = a15Codigo and a51asistencia = 'A' ) porcAsistencia,
'NO' certifica,
null Fecha_Expedicion,
a15Estado Estado,
( select decode(count(*),0,'N','S') from t57_historiavida where a57periodo= a26periodo and a57inscrito = a15Codigo ) Vida,
'N' Liderazgo,
( select decode(count(*),0,'N','S') from t58_casoexito where a58periodo= a26periodo and a58inscrito = a15Codigo ) Exito
        FROM T26_GRUPOSFACILITADOR,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS,
             T07_PERSONAS p1,
             T07_PERSONAS p2,
             T15_INSCRITOS,
             T04_TIPOSDOCUMENTO,
             T87_CONDICIONESPECIAL,
             t01_participantes
       WHERE a26estado = a90codigo
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = p1.a07usuario
         AND a06coordinador = p2.a07usuario
         AND a15grupofacilitador = a26codigo
         AND a15tipodocumento = a04tipodocumento
         AND a15condicionespecial = a87codigo
         AND a15documento = a01documento
         and a26periodo = 2;

prompt
prompt Creating view VW_T16_INSCRITOENCUESTA
prompt =====================================
prompt
create or replace force view hpv.vw_t16_inscritoencuesta as
select "A16CODIGO","A16INSCRITO","A16ENCUESTA","A16PREGUNTA","A16RESPUESTA","A16FECHACREACION","A16FECHAMODIFICACION","A16USUARIOCREACION","A16USUARIOMODIFICACION"
  from t16_inscritoencuesta z
 where z.a16fechacreacion =
       (select min(e.a16fechacreacion)
          from t16_inscritoencuesta e
         where e.a16encuesta = 6
           and e.a16inscrito = z.a16inscrito
           and e.a16pregunta = z.a16pregunta
           and e.a16encuesta = z.a16encuesta
         group by e.a16inscrito, e.a16pregunta, e.a16encuesta

        );

prompt
prompt Creating view VW_ULTENCSALIDA
prompt =============================
prompt
create or replace force view hpv.vw_ultencsalida as
select e.a16inscrito, max(e.a16fechacreacion) a16fechacreacion
  from t16_inscritoencuesta e
 where e.a16encuesta IN
       (select T.A50CODIGO from T50_ENCUESTA t WHERE T.A50TIPOENCUESTA = 'F')
 group by e.a16inscrito;

prompt
prompt Creating view VW_USUARIOS_MSJ_ACTIVOS
prompt =====================================
prompt
create or replace force view hpv.vw_usuarios_msj_activos as
select R.A05NOMBRE, P.A07EMAIL || ';' CORREO
  from t06_usuarios u, t07_personas p, T05_ROLES R
 where R.A05CODIGO = U.A06ROL
   AND p.a07usuario = u.a06codigo
   and u.a06estado = 'A'
ORDER BY 1, 2;

prompt
prompt Creating package PK_UTILS
prompt =========================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_UTILS AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos y funciones
                   de utilidades como declaraci?n de variables, tipos, listas genericas,
                   registro de log de operaciones, registro de excepciones, mensajes de respuesta

  REALIZADO POR    :  
                      

  FECHA CREACION    : 15/02/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  TYPE TY_CURSOR IS REF CURSOR;

  -- CONSTANTES GENERALES

  NIVEL_SEVERE T100_NIVELLOG.A100CODIGO%TYPE := 1;
  NIVEL_ERROR  T100_NIVELLOG.A100CODIGO%TYPE := 2;
  NIVEL_INFO   T100_NIVELLOG.A100CODIGO%TYPE := 3;
  NIVEL_TRACE  T100_NIVELLOG.A100CODIGO%TYPE := 4;

  ERROR_GENERAL CONSTANT NUMBER := 9999;

  COD_OPERACION_CORRECTA CONSTANT NUMBER := 0;
  MSJ_OPERACION_CORRECTA CONSTANT VARCHAR2(50) := 'Operacion Correcta';
  MSJ_EXCEPCION_GENERAL  CONSTANT VARCHAR2(100) := 'SE PRESENTO UN ERROR GENERAL EN EL SISTEMA. FAVOR CONTACTAR AL ADMINISTRADOR CON ESTE CODIGO:';

  COD_ACTIVO      CONSTANT CHAR(1) := 'A';
  COD_INACTIVO    CONSTANT CHAR(1) := 'I';
  COD_INSCRIPCION CONSTANT CHAR(1) := 'P';

  INS_ACTIVO    CONSTANT CHAR(1) := 'A';
  INS_INACTIVO  CONSTANT CHAR(1) := 'I';
  INS_PENDIENTE CONSTANT CHAR(1) := 'P';

  APR_ACTIVO    CONSTANT CHAR(1) := 'A';
  APR_RECHAZO   CONSTANT CHAR(1) := 'R';
  APR_PENDIENTE CONSTANT CHAR(1) := 'P';

  ENT_ACTIVO    CONSTANT CHAR(1) := 'A';
  ENT_RECHAZO   CONSTANT CHAR(1) := 'R';
  ENT_PENDIENTE CONSTANT CHAR(1) := 'P';

  --CAT_MENSAJE_RESPUESTA CONSTANT VARCHAR2(50) := 'MENSAJERESPUESTA';

  COD_USUARIO_DEFECTO CONSTANT NUMBER := 0;

  -- DEFINICION DE FUNCIONES / PROCEDIMIENTOS
  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_UTILS';

  TYPE TOKEN_LIST is varray(2000) of varchar2(200);

  FUNCTION fn_ObtenerId(p_nombreSeq IN VARCHAR2) RETURN NUMBER;

  PROCEDURE Pr_ConsultarLista(p_categoria IN VARCHAR2,
                              p_resultado OUT TY_CURSOR,
                              p_codError  OUT NUMBER,
                              p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_RegistraLog(p_nivelLog      IN NUMBER,
                           p_paquete       IN VARCHAR2,
                           p_procedimiento IN VARCHAR2,
                           p_usuario       IN NUMBER,
                           p_descripcion   IN VARCHAR2);

  FUNCTION fn_ObtenerMensaje(p_codError IN VARCHAR2) RETURN VARCHAR2;

  FUNCTION fn_RegistraExcepcion(p_usuario       IN NUMBER,
                                p_paquete       IN VARCHAR2,
                                p_procedimiento IN VARCHAR2,
                                p_codError      IN NUMBER,
                                p_msjError      IN VARCHAR2) RETURN NUMBER;

  FUNCTION Fn_ObtenerPeriodoVigente RETURN NUMBER;

  FUNCTION Fn_ObtenerPeriodoInscripcion RETURN NUMBER;

  FUNCTION Fn_DarEncuestaXPregunta(p_pregunta IN NUMBER) RETURN NUMBER;

  FUNCTION fn_ObtenerValorParametro(p_parametro IN VARCHAR2) RETURN VARCHAR2;

  PROCEDURE Pr_EnviarCorreoWS(p_to       IN varchar2,
                              p_tarea    in varchar2,
                              p_idReg    IN number,
                              p_codError OUT NUMBER,
                              p_msjError OUT VARCHAR2);

  FUNCTION fn_darValorXml(p_cadena IN VARCHAR2, p_parametro IN VARCHAR2)
    RETURN VARCHAR2;

  PROCEDURE Pr_DarParametroInicial(p_resultado OUT PK_UTILS.TY_CURSOR,
                                   p_codError  OUT NUMBER,
                                   p_msjError  OUT VARCHAR2);

  function fn_splitStr(str varchar2, delim char) return token_list;

  function splitter_count(str in varchar2, delim in char) return int;

  PROCEDURE Pr_ValidarToken(p_categoria IN VARCHAR2,
                            p_token     IN VARCHAR2,
                            p_codError  OUT NUMBER,
                            p_msjError  OUT VARCHAR2);

END PK_UTILS;
/

prompt
prompt Creating package PK_ALI_INSCRIPCION
prompt ===================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_ALI_INSCRIPCION AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos y funciones
                   utilizados en el alistamiento de inscripciones
  
  REALIZADO POR    : 
                      
  
  FECHA CREACION    : 16/02/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  
  *******************************************************************************/

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_ALI_INSCRIPCION';

  --codPeriodo NUMBER := PK_UTILS.Fn_ObtenerPeriodoVigente;

  PROCEDURE Pr_FlujoInscripcion(p_tipoDocumento      IN varchar2,
                                p_documento          IN varchar2,
                                p_codigoBeneficiario IN number,
                                p_fechaNacimiento    IN varchar2,
                                p_consultaEnLinea    IN number,
                                p_resultado          OUT PK_UTILS.ty_cursor,
                                p_codError           OUT NUMBER,
                                p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_FinalizarInscripcion(p_esBeneficiario     IN NUMBER, -- 1 es participante valido , 0: No es participante valido
                                    p_grupofacilitador   IN NUMBER,
                                    p_tipodocumento      IN VARCHAR2,
                                    p_documento          IN VARCHAR2,
                                    p_codigobeneficiario IN NUMBER,
                                    p_primernombre       IN VARCHAR2,
                                    p_segundonombre      IN VARCHAR2,
                                    p_primerapellido     IN VARCHAR2,
                                    p_segundoapellido    IN VARCHAR2,
                                    p_fechanacimiento    IN VARCHAR2, -- YYYY-MM-DD
                                    p_email              IN VARCHAR2,
                                    p_telefono           IN VARCHAR2,
                                    p_movil              IN VARCHAR2,
                                    p_movilalt           IN VARCHAR2,
                                    p_condicionEspecial  IN NUMBER,
                                    p_encuesta           IN VARCHAR2,
                                    p_codigoInscripcion  OUT NUMBER,
                                    p_codError           OUT NUMBER,
                                    p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_ObtenerPeriodoVigente(p_resultado OUT PK_UTILS.TY_CURSOR,
                                     p_codError  OUT NUMBER,
                                     p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ValidarParticipante(p_tipoDocumento      IN varchar2,
                                   p_documento          IN varchar2,
                                   p_codigoBeneficiario IN number,
                                   p_fechaNacimiento    IN varchar2,
                                   p_consultaEnLinea    IN number,
                                   p_resultado          OUT PK_UTILS.ty_cursor,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_ObtenerPeriodoInscripcion(p_resultado OUT PK_UTILS.TY_CURSOR,
                                         p_codError  OUT NUMBER,
                                         p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ValidarBeneficiario(p_tipoDocumento      IN varchar2,
                                   p_documento          IN varchar2,
                                   p_codigoBeneficiario IN number,
                                   p_fechaNacimiento    IN varchar2,
                                   p_consultaEnLinea    IN number,
                                   p_resultado          OUT PK_UTILS.ty_cursor,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_ValidarInscrito(p_tipoDocumento      IN varchar2,
                               p_documento          IN varchar2,
                               p_codigoBeneficiario IN number,
                               p_fechaNacimiento    IN varchar2,
                               p_resultado          OUT PK_UTILS.ty_cursor,
                               p_codError           OUT NUMBER,
                               p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_ValidarCorreo(p_correo             IN VARCHAR2,
                             p_tipoDocumento      IN varchar2,
                             p_documento          IN varchar2,
                             p_codigoBeneficiario IN number,
                             p_codError           OUT NUMBER,
                             p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_DarDepartamentos(p_resultado OUT PK_UTILS.ty_cursor,
                                p_codError  OUT NUMBER,
                                p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarMunicipiosXDepto(p_idDepartamento IN NUMBER,
                                   p_resultado      OUT PK_UTILS.ty_cursor,
                                   p_codError       OUT NUMBER,
                                   p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarDiasDisponibles(p_idMunicipio IN NUMBER,
                                  p_resultado   OUT PK_UTILS.ty_cursor,
                                  p_codError    OUT NUMBER,
                                  p_msjError    OUT VARCHAR2);

  PROCEDURE Pr_DarHorariosDisponibles(p_idMunicipio IN NUMBER,
                                      p_dia         IN NUMBER,
                                      p_resultado   OUT PK_UTILS.ty_cursor,
                                      p_codError    OUT NUMBER,
                                      p_msjError    OUT VARCHAR2);

  PROCEDURE Pr_DarLugaresDisponibles(p_idMunicipio IN NUMBER,
                                     p_dia         IN NUMBER,
                                     p_horario     IN NUMBER,
                                     p_resultado   OUT PK_UTILS.ty_cursor,
                                     p_codError    OUT NUMBER,
                                     p_msjError    OUT VARCHAR2);

  PROCEDURE Pr_GuardarInscripcion(p_esBeneficiario     IN NUMBER, -- 1 es participante valido , 0: No es participante valido
                                  p_grupofacilitador   IN NUMBER,
                                  p_tipodocumento      IN VARCHAR2,
                                  p_documento          IN VARCHAR2,
                                  p_codigobeneficiario IN NUMBER,
                                  p_primernombre       IN VARCHAR2,
                                  p_segundonombre      IN VARCHAR2,
                                  p_primerapellido     IN VARCHAR2,
                                  p_segundoapellido    IN VARCHAR2,
                                  p_fechanacimiento    IN VARCHAR2, -- YYYY-MM-DD
                                  p_email              IN VARCHAR2,
                                  p_telefono           IN VARCHAR2,
                                  p_movil              IN VARCHAR2,
                                  p_movilalt           IN VARCHAR2,
                                  p_condicionEspecial  IN NUMBER,
                                  p_encuesta           IN VARCHAR2,
                                  p_codigoInscripcion  OUT NUMBER,
                                  p_codError           OUT NUMBER,
                                  p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_GuardarInscripcion2(p_esBeneficiario     IN NUMBER, -- 1 es participante valido , 0: No es participante valido
                                   p_grupofacilitador   IN NUMBER,
                                   p_tipodocumento      IN VARCHAR2,
                                   p_documento          IN VARCHAR2,
                                   p_codigobeneficiario IN NUMBER,
                                   p_primernombre       IN VARCHAR2,
                                   p_segundonombre      IN VARCHAR2,
                                   p_primerapellido     IN VARCHAR2,
                                   p_segundoapellido    IN VARCHAR2,
                                   p_fechanacimiento    IN VARCHAR2, -- YYYY-MM-DD
                                   p_email              IN VARCHAR2,
                                   p_telefono           IN VARCHAR2,
                                   p_movil              IN VARCHAR2,
                                   p_movilalt           IN VARCHAR2,
                                   p_condicionEspecial  IN NUMBER,
                                   p_encuesta           IN VARCHAR2,
                                   p_codigoInscripcion  OUT NUMBER,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_GuardarInscripcion3(p_esBeneficiario     IN NUMBER, -- 1 es participante valido , 0: No es participante valido
                                   p_grupofacilitador   IN NUMBER,
                                   p_tipodocumento      IN VARCHAR2,
                                   p_documento          IN VARCHAR2,
                                   p_codigobeneficiario IN NUMBER,
                                   p_primernombre       IN VARCHAR2,
                                   p_segundonombre      IN VARCHAR2,
                                   p_primerapellido     IN VARCHAR2,
                                   p_segundoapellido    IN VARCHAR2,
                                   p_fechanacimiento    IN VARCHAR2, -- YYYY-MM-DD
                                   p_email              IN VARCHAR2,
                                   p_telefono           IN VARCHAR2,
                                   p_movil              IN VARCHAR2,
                                   p_movilalt           IN VARCHAR2,
                                   p_condicionEspecial  IN NUMBER,
                                   p_encuesta           IN VARCHAR2,
                                   p_codigoInscripcion  OUT NUMBER,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_EnviarCorreoInscripcion(p_idInscrito NUMBER,
                                       p_codError   OUT NUMBER,
                                       p_msjError   OUT VARCHAR2);

  PROCEDURE Pr_DarEncuesta(idTipoEncuesta IN VARCHAR2,
                           p_resultado    OUT PK_UTILS.ty_cursor,
                           p_codError     OUT NUMBER,
                           p_msjError     OUT VARCHAR2);

  PROCEDURE pr_GuardarEncuesta(p_inscrito IN NUMBER,
                               p_encuesta IN VARCHAR2,
                               p_codigo   OUT NUMBER,
                               p_codError OUT NUMBER,
                               p_msjError OUT VARCHAR2);

  PROCEDURE Pr_ConsultarInscritoWS(p_codigoBeneficiario IN number, -- 0 Si no hay codigo
                                   p_documento          varchar2,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2);

  FUNCTION fn_darValorXml(p_cadena IN VARCHAR2, p_parametro IN VARCHAR2)
    RETURN VARCHAR2;

  PROCEDURE pr_GuardarEncuestaPeriodoAct(p_inscrito      IN NUMBER,
                                         p_encuesta      IN VARCHAR2,
                                         p_observaciones IN VARCHAR2,
                                         p_codigo        OUT NUMBER,
                                         p_codError      OUT NUMBER,
                                         p_msjError      OUT VARCHAR2);

  PROCEDURE pr_GuardarEncuestaToken(p_token         IN VARCHAR2,
                                    p_encuesta      IN VARCHAR2,
                                    p_observaciones IN VARCHAR2,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_GenerarCertificado(p_tipoDocumento      IN varchar2,
                                  p_documento          IN varchar2,
                                  p_codigoBeneficiario IN number,
                                  p_fechaNacimiento    IN varchar2,
                                  p_idInscrito         OUT NUMBER,
                                  p_codError           OUT NUMBER,
                                  p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_RegistrarEncuestaFinal(p_inscrito      IN NUMBER,
                                      p_encuesta      IN VARCHAR2,
                                      p_observaciones IN VARCHAR2,
                                      p_codError      OUT NUMBER,
                                      p_msjError      OUT VARCHAR2);
END PK_ALI_INSCRIPCION;
/

prompt
prompt Creating package PK_MIGRACION
prompt =============================
prompt
create or replace package hpv.PK_MIGRACION is

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_MIGRACION';

  PROCEDURE Pr_limpiar(p_codError OUT NUMBER, p_msjError OUT VARCHAR2);

  PROCEDURE Pr_mig_t01dbo_participantes(p_codError OUT NUMBER,
                                        p_msjError OUT VARCHAR2);
  PROCEDURE Pr_mig_t02dbc_departamentos(p_codError OUT NUMBER,
                                        p_msjError OUT VARCHAR2);

  PROCEDURE Pr_mig_t03dbc_municipios(p_codError OUT NUMBER,
                                     p_msjError OUT VARCHAR2);

  PROCEDURE Pr_mig_t06web_usuarios(p_codError OUT NUMBER,
                                   p_msjError OUT VARCHAR2);

  PROCEDURE Pr_mig_t13dbo_preguntas(p_codError OUT NUMBER,
                                    p_msjError OUT VARCHAR2);

  PROCEDURE Pr_mig_t14dbo_respuestas(p_codError OUT NUMBER,
                                     p_msjError OUT VARCHAR2);

  PROCEDURE Pr_mig_t21web_realizaciont(p_codError OUT NUMBER,
                                       p_msjError OUT VARCHAR2);

  PROCEDURE Pr_mig_t26web_gruposfac(p_codError OUT NUMBER,
                                    p_msjError OUT VARCHAR2);

  PROCEDURE Pr_mig_t15web_inscritos(p_codError OUT NUMBER,
                                    p_msjError OUT VARCHAR2);

  PROCEDURE Pr_mig_t32web_tallerasistencia(p_codError OUT NUMBER,
                                           p_msjError OUT VARCHAR2);

end PK_MIGRACION;
/

prompt
prompt Creating package PK_OPE_ADMESPACIOFISICO
prompt ========================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_OPE_ADMESPACIOFISICO AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos y funciones
                   utilizados en la administración de espacios fisicos

  REALIZADO POR    : 
                      

  FECHA CREACION    : 13/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_OPE_ADMESPACIOFISICO';

  PROCEDURE Pr_DarEspacioFisico(p_idFacilitador IN NUMBER,
                                p_consulta      IN VARCHAR2,
                                p_resultado     OUT PK_UTILS.TY_CURSOR,
                                p_codError      OUT NUMBER,
                                p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_DarDias(p_resultado OUT PK_UTILS.ty_cursor,
                       p_codError  OUT NUMBER,
                       p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarHorarios(p_resultado OUT PK_UTILS.ty_cursor,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarGrupos(p_resultado OUT PK_UTILS.ty_cursor,
                         p_codError  OUT NUMBER,
                         p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarLugaresMunicipio(p_idMunicipio IN NUMBER,
                                   p_resultado   OUT PK_UTILS.ty_cursor,
                                   p_codError    OUT NUMBER,
                                   p_msjError    OUT VARCHAR2);

  PROCEDURE Pr_DarDireccionesLugar(p_idMunicipio IN NUMBER,
                                   p_nombreLugar IN VARCHAR2,
                                   p_resultado   OUT PK_UTILS.ty_cursor,
                                   p_codError    OUT NUMBER,
                                   p_msjError    OUT VARCHAR2);

  PROCEDURE Pr_ActualizarEspacio(p_idEspacioFisico IN NUMBER,
                                 p_idFacilitador   IN NUMBER,
                                 p_idMunicipio     IN NUMBER,
                                 p_idDia           IN NUMBER,
                                 p_idHorario       IN NUMBER,
                                 p_idGrupo         IN NUMBER,
                                 p_nombreLugar     IN VARCHAR2,
                                 p_direccion       IN VARCHAR2,
                                 p_codError        OUT NUMBER,
                                 p_msjError        OUT VARCHAR2);

  PROCEDURE Pr_ConsultarEspacio(p_idEspacioFisico IN NUMBER,
                                p_resultado       OUT PK_UTILS.TY_CURSOR,
                                p_codError        OUT NUMBER,
                                p_msjError        OUT VARCHAR2);

  PROCEDURE Pr_DarEspacioFisicoXAprobar(p_idCoordinador IN NUMBER,
                                        p_consulta      IN VARCHAR2,
                                        p_estado        IN VARCHAR2,
                                        p_idPeriodo     IN NUMBER,
                                        p_resultado     OUT PK_UTILS.ty_cursor,
                                        p_codError      OUT NUMBER,
                                        p_msjError      OUT VARCHAR2);

  PROCEDURE pr_AprobarEspacioFisico(p_idCoordinador   IN NUMBER,
                                    p_idEspacioFisico IN NUMBER,
                                    p_codError        OUT NUMBER,
                                    p_msjError        OUT VARCHAR2);

  PROCEDURE pr_RechazarEspacioFisico(p_idCoordinador   IN NUMBER,
                                     p_idEspacioFisico IN NUMBER,
                                     p_motivoRechazo   IN VARCHAR2,
                                     p_codError        OUT NUMBER,
                                     p_msjError        OUT VARCHAR2);
  FUNCTION fn_ValidarHorario(p_idFacilitador IN NUMBER,
                             p_idDia         IN NUMBER,
                             p_hinicio       IN NUMBER,
                             p_hfin          IN NUMBER) RETURN NUMBER;

  PROCEDURE Pr_DarDeptosFacilitador(p_idFacilitador IN NUMBER,
                                    p_resultado     OUT PK_UTILS.ty_cursor,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_DarMunicipiosFacilitador(p_idFacilitador  IN NUMBER,
                                        p_idDepartamento IN NUMBER,
                                        p_resultado      OUT PK_UTILS.ty_cursor,
                                        p_codError       OUT NUMBER,
                                        p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_ReasignarEspacio(p_idInscrito         IN NUMBER,
                                p_idGrupoFacilitador IN NUMBER,
                                p_idUsuario          IN NUMBER,
                                p_idPeriodo          IN NUMBER,
                                p_codError           OUT NUMBER,
                                p_msjError           OUT VARCHAR2);
END PK_OPE_ADMESPACIOFISICO;
/

prompt
prompt Creating package PK_OPE_ADMUSUARIO
prompt ==================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_OPE_ADMUSUARIO AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos y funciones
                   utilizados en el operativo administracion de usuarios

  REALIZADO POR    : 
                      

  FECHA CREACION    : 04/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_OPE_ADMUSUARIO';

  PROCEDURE Pr_AutenticarUsuario(p_usuario   IN VARCHAR2,
                                 p_clave     IN VARCHAR2,
                                 p_codError  OUT NUMBER,
                                 p_msjError  OUT VARCHAR2,
                                 p_idUsuario OUT NUMBER);

  PROCEDURE Pr_DarUsuarios(p_consulta  IN VARCHAR2,
                           p_resultado OUT PK_UTILS.ty_cursor,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarRoles(p_consulta  IN VARCHAR2,
                        p_resultado OUT PK_UTILS.ty_cursor,
                        p_codError  OUT NUMBER,
                        p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarCoordinadores(p_resultado OUT PK_UTILS.ty_cursor,
                                p_codError  OUT NUMBER,
                                p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarMunicipios(p_resultado OUT PK_UTILS.ty_cursor,
                             p_codError  OUT NUMBER,
                             p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ConsultarUsuario(p_idusuario IN NUMBER,
                                p_resultado OUT PK_UTILS.ty_cursor,
                                p_codError  OUT NUMBER,
                                p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_Darciudades(p_idusuario IN NUMBER,
                           p_resultado OUT PK_UTILS.ty_cursor,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2);

  FUNCTION Fn_DarCiudades(p_idusuario IN NUMBER) RETURN VARCHAR2;

  FUNCTION Fn_DarCiudadesNom(p_idusuario IN NUMBER) RETURN VARCHAR2;

  PROCEDURE Pr_DarMenus(p_resultado OUT PK_UTILS.ty_cursor,
                        p_codError  OUT NUMBER,
                        p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarOpcionesMenu(p_idmenu    IN NUMBER,
                               p_resultado OUT PK_UTILS.ty_cursor,
                               p_codError  OUT NUMBER,
                               p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ConsultarRol(p_idrol     IN NUMBER,
                            p_resultado OUT PK_UTILS.ty_cursor,
                            p_codError  OUT NUMBER,
                            p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarOpcionesMenuRol(p_idrol     IN NUMBER,
                                  p_idMenu    IN NUMBER,
                                  p_resultado OUT PK_UTILS.ty_cursor,
                                  p_codError  OUT NUMBER,
                                  p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ActualizarUsuario(p_idUsuario       IN NUMBER, -- Si es cero es nuevo, de lo contrario es edicion
                                 p_rol             IN NUMBER,
                                 p_coordinador     IN NUMBER,
                                 p_login           IN VARCHAR2,
                                 p_clave           IN VARCHAR2, -- si es nuevo viene la clave, si es edicion viene vacia y no se debe actualizar
                                 p_tipodocumento   IN VARCHAR2,
                                 p_identificacion  IN VARCHAR2,
                                 p_primernombre    IN VARCHAR2,
                                 p_segundonombre   IN VARCHAR2,
                                 p_primerapellido  IN VARCHAR2,
                                 p_segundoapellido IN VARCHAR2,
                                 p_fechanacimiento IN VARCHAR2, --- yyyy-mm-dd
                                 p_email           IN VARCHAR2,
                                 p_telefono        IN VARCHAR2,
                                 p_movil           IN VARCHAR2,
                                 p_movilalt        IN VARCHAR2,
                                 p_estado          IN VARCHAR2,
                                 p_perfil          IN NUMBER,
                                 p_ciudades        IN VARCHAR2,
                                 p_usuario         IN NUMBER,
                                 p_codError        OUT NUMBER,
                                 p_msjError        OUT VARCHAR2);

  PROCEDURE Pr_ActualizarRol(p_idRol    in number, -- Si es cero es nuevo , de lo contrario es edicion
                             p_nombre   IN VARCHAR2,
                             p_estado   IN VARCHAR2,
                             p_opciones IN VARCHAR2, -- conjunto idMenu, idOpcion
                             p_usuario  IN NUMBER,
                             p_codError OUT NUMBER,
                             p_msjError OUT VARCHAR2);

  PROCEDURE Pr_RestaurarContrasena(p_email    IN VARCHAR2,
                                   p_codError OUT NUMBER,
                                   p_msjError OUT VARCHAR2);

  PROCEDURE Pr_AsignarContrasenaXToken(p_token      IN VARCHAR2,
                                       p_contrasena IN VARCHAR2,
                                       p_codError   OUT NUMBER,
                                       p_msjError   OUT VARCHAR2);

END PK_OPE_ADMUSUARIO;
/

prompt
prompt Creating package PK_OPE_ASISTENCIA
prompt ==================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_OPE_ASISTENCIA AUTHID CURRENT_USER AS

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_OPE_ASISTENCIA';

  PROCEDURE Pr_DarAsistenciaEncabezado(p_idFacilitador IN NUMBER,
                                       p_idGrupo       IN NUMBER,
                                       p_idTaller      IN NUMBER,
                                       p_idPeriodo     IN NUMBER,
                                       p_resultado     OUT PK_UTILS.TY_CURSOR,
                                       p_codError      OUT NUMBER,
                                       p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_DarAsistenciaDetalle(p_idFacilitador IN NUMBER,
                                    p_idGrupo       IN NUMBER,
                                    p_idPeriodo     IN NUMBER,
                                    p_resultado     OUT PK_UTILS.TY_CURSOR,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_DarFacilitadorXCoordinador(p_idCoordinador IN NUMBER,
                                          p_idPeriodo     IN NUMBER,
                                          p_resultado     OUT PK_UTILS.TY_CURSOR,
                                          p_codError      OUT NUMBER,
                                          p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_DarGruposXFacilitador(p_idFacilitador IN NUMBER,
                                     p_idPeriodo     IN NUMBER,
                                     p_resultado     OUT PK_UTILS.TY_CURSOR,
                                     p_codError      OUT NUMBER,
                                     p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_DarTalleres(p_resultado OUT PK_UTILS.TY_CURSOR,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_CargarEntregable(p_idFacilitador    IN NUMBER,
                                p_idGrupo          IN NUMBER,
                                p_idTaller         IN NUMBER,
                                p_idEntregable     IN NUMBER, -- va un 1 para indicar que es lista de asistencia
                                p_fechaRealizacion IN VARCHAR2, --yyyy-mm-dd
                                p_rutaArchivo      IN VARCHAR2,
                                p_codError         OUT NUMBER,
                                p_msjError         OUT VARCHAR2);

  PROCEDURE Pr_DarInfoAsistencia(p_idFacilitador IN NUMBER,
                                 p_idGrupo       IN NUMBER,
                                 p_resultado     OUT PK_UTILS.TY_CURSOR,
                                 p_codError      OUT NUMBER,
                                 p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_DarAsistenciasXAprobar(p_idCoodinador IN NUMBER,
                                      p_resultado    OUT PK_UTILS.TY_CURSOR,
                                      p_codError     OUT NUMBER,
                                      p_msjError     OUT VARCHAR2);

  PROCEDURE Pr_AprobarAsistencia(p_idCoordinador IN NUMBER,
                                 p_idRegistro    IN NUMBER,
                                 p_codError      OUT NUMBER,
                                 p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_RechazarAsistencia(p_idCoordinador IN NUMBER,
                                  p_idRegistro    IN NUMBER,
                                  p_motivoRechazo IN VARCHAR2,
                                  p_codError      OUT NUMBER,
                                  p_msjError      OUT VARCHAR2);

  FUNCTION Fn_AsistenciasReg(p_idFacilitador IN NUMBER,
                             p_idGrupo       IN NUMBER) RETURN NUMBER;

  FUNCTION Fn_TalleresInscrito(p_idParticiante IN VARCHAR2) RETURN NUMBER;

  FUNCTION Fn_AsistenciasInscrito(p_idParticiante IN VARCHAR2) RETURN NUMBER;

  FUNCTION Fn_MaxAsistInscritoPer(p_idParticiante IN VARCHAR2) RETURN NUMBER;

  PROCEDURE Pr_DarEntregableEstado(p_idUsuario          IN NUMBER,
                                   p_idTaller           IN NUMBER,
                                   p_idEntregable       IN NUMBER,
                                   p_idPeriodo          IN NUMBER,
                                   p_idEstadoDocumento  IN VARCHAR2,
                                   p_idEstadoAsistencia IN VARCHAR2,
                                   p_filtroBusqueda     IN VARCHAR2,
                                   p_resultado          OUT PK_UTILS.TY_CURSOR,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_DarEntregableEstadoDetalle(p_idEntregable       IN NUMBER,
                                          p_idPeriodo          IN NUMBER,
                                          p_idTaller           IN NUMBER,
                                          p_idGrupoFacilitador IN NUMBER,
                                          p_resultado          OUT PK_UTILS.TY_CURSOR,
                                          p_codError           OUT NUMBER,
                                          p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_DarInscritos(p_idGrupoFacilitador IN NUMBER,
                            p_resultado          OUT PK_UTILS.TY_CURSOR,
                            p_codError           OUT NUMBER,
                            p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_DarAsistenciaEstado(p_idPeriodo          IN NUMBER,
                                   p_idEntregable       IN NUMBER,
                                   p_idTaller           IN NUMBER,
                                   p_idGrupoFacilitador IN NUMBER,
                                   p_resultado          OUT PK_UTILS.TY_CURSOR,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_DarAsistenteXFacilitador(p_idPeriodo     IN NUMBER,
                                        p_idFacilitador IN NUMBER,
                                        p_resultado     OUT PK_UTILS.TY_CURSOR,
                                        p_codError      OUT NUMBER,
                                        p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_RegistrarAsistencia(p_idFacilitador      IN NUMBER,
                                   p_idPeriodo          IN NUMBER,
                                   p_idEntregable       IN NUMBER,
                                   p_idTaller           IN NUMBER,
                                   p_idGrupoFacilitador IN NUMBER,
                                   p_fechaRealizacion   IN VARCHAR2, -- yyyy-mm-dd
                                   p_arrAsistencia      IN VARCHAR2,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_RegistrarAprobacion(p_idFacilitador      IN NUMBER,
                                   p_idPeriodo          IN NUMBER,
                                   p_idEntregable       IN NUMBER,
                                   p_idTaller           IN NUMBER,
                                   p_idGrupoFacilitador IN NUMBER,
                                   p_categoria          IN VARCHAR2, -- D:Documento A:Asistencia
                                   p_estado             IN VARCHAR2, --  A:Aprobar R:Rechazar P:Pendiente aprobacion
                                   p_motivoRechazo      IN VARCHAR2,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2);
  PROCEDURE Pr_IniciarAsistencia(p_idPeriodo in number,
                                 p_codError  OUT NUMBER,
                                 p_msjError  OUT VARCHAR2);

  FUNCTION Fn_InscritosGrupo(p_idGrupoFacilitador IN NUMBER) RETURN NUMBER;

END PK_OPE_ASISTENCIA;
/

prompt
prompt Creating package PK_OPE_AUDIT
prompt =============================
prompt
create or replace package hpv.pk_ope_audit is

  -- Author  :  
  -- Created : 10/08/2016 7:55:43 a. m.
  -- Purpose : Paquete para listar la auditoria del sistema

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'pk_ope_audit';

  PROCEDURE Pr_DarTransac(p_idFuncion IN NUMBER,
                          p_idUsuario IN NUMBER,
                          p_fec_ini   IN varchar2,
                          p_fec_fin   IN varchar2,
                          p_resultado OUT PK_UTILS.TY_CURSOR,
                          p_codError  OUT NUMBER,
                          p_msjError  OUT VARCHAR2);
end pk_ope_audit;
/

prompt
prompt Creating package PK_OPE_CASOEXITO
prompt =================================
prompt
create or replace package hpv.PK_OPE_CASOEXITO is

  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos y funciones
                   utilizados casos de exito

  REALIZADO POR    : 
                      

  FECHA CREACION    : 20/05/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_OPE_CASOEXITO';

  PROCEDURE Pr_DarLogros(p_resultado OUT PK_UTILS.ty_cursor,
                         p_codError  OUT NUMBER,
                         p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarCasosDeExito(p_idUsuario        IN number,
                               p_filtroBusqueda   in varchar2,
                               p_estadoXConsultar in varchar2,
                               p_idPeriodo        IN NUMBER,
                               p_resultado        OUT PK_UTILS.ty_cursor,
                               p_codError         OUT NUMBER,
                               p_msjError         OUT VARCHAR2);

  PROCEDURE Pr_ValidarCantidadCasoDeExito(p_idUsuario IN number,
                                          p_codError  OUT NUMBER,
                                          p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ActualizarCasoDeExito(p_idCasoExito        IN number, -- 0 Si es nuevo
                                     p_idGrupoFacilitador number,
                                     p_idFacilitador      number,
                                     p_idLogro            number,
                                     p_logros             varchar2,
                                     p_criterios          varchar2, -- idCualidad,S(N);
                                     p_idInscrito         number,
                                     p_observaciones      varchar2,
                                     p_codError           OUT NUMBER,
                                     p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_consultarCasoDeExito(p_idCasoDeExito IN number,
                                    p_resultado     OUT PK_UTILS.ty_cursor,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_RegistrarEstadoCasoDeExito(p_idUsuario     IN NUMBER,
                                          p_idCasoDeExito IN NUMBER,
                                          p_motivoRechazo IN VARCHAR2,
                                          p_estado        IN VARCHAR2, --  A:Aprobar R:Rechazar P:Pendiente aprobacion E:Elejido
                                          p_codError      OUT NUMBER,
                                          p_msjError      OUT VARCHAR2);
end PK_OPE_CASOEXITO;
/

prompt
prompt Creating package PK_OPE_CONSULTAS
prompt =================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_OPE_CONSULTAS AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos y funciones
                   utilizados para la consulta de informacion

  REALIZADO POR    : 
                      

  FECHA CREACION    : 15/04/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_OPE_CONSULTAS';

  PROCEDURE Pr_Consultarinscritos(p_consulta  IN VARCHAR2,
                                  p_idPeriodo IN NUMBER,
                                  p_resultado OUT PK_UTILS.TY_CURSOR,
                                  p_codError  OUT NUMBER,
                                  p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_Consultarinscrito(p_idPeriodo  IN NUMBER,
                                 p_idInscrito IN NUMBER,
                                 p_resultado  OUT PK_UTILS.TY_CURSOR,
                                 p_codError   OUT NUMBER,
                                 p_msjError   OUT VARCHAR2);

  PROCEDURE Pr_ConsultarHorarios(p_consulta      IN VARCHAR2,
                                 p_idPeriodo     IN NUMBER,
                                 p_idCoordinador IN NUMBER,
                                 p_resultado     OUT PK_UTILS.TY_CURSOR,
                                 p_codError      OUT NUMBER,
                                 p_msjError      OUT VARCHAR2);

END PK_OPE_CONSULTAS;
/

prompt
prompt Creating package PK_OPE_HISTORIAVIDA
prompt ====================================
prompt
create or replace package hpv.PK_OPE_HISTORIAVIDA is

  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos y funciones
                   utilizados historia de vida
  
  REALIZADO POR    : 
                      
  
  FECHA CREACION    : 20/05/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  
  *******************************************************************************/

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_OPE_HISTORIAVIDA';

  PROCEDURE Pr_DarHistoriasDeVida(p_idUsuario        IN number,
                                  p_filtroBusqueda   IN varchar2,
                                  p_estadoXConsultar IN varchar2,
                                  p_idPeriodo        IN NUMBER,
                                  p_resultado        OUT PK_UTILS.ty_cursor,
                                  p_codError         OUT NUMBER,
                                  p_msjError         OUT VARCHAR2);

  PROCEDURE Pr_ValidarCantidadHistorias(p_idUsuario IN number,
                                        p_codError  OUT NUMBER,
                                        p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ActualizarHistoriaVida(p_idHistoriaDeVida        IN number, -- 0 Si es nuevo
                                      p_idGrupoFacilitador      number,
                                      p_idFacilitador           number,
                                      p_idTipoHistoriaDeVida    number,
                                      p_razonDeConsideracion    varchar2,
                                      p_circunstanciasSuperadas varchar2,
                                      p_habilidadesPracticadas  varchar2,
                                      p_leccion                 varchar2,
                                      p_idInscrito              number,
                                      p_codError                OUT NUMBER,
                                      p_msjError                OUT VARCHAR2);

  PROCEDURE Pr_consultarHistoriaVida(p_idHistoriaDeVida IN number,
                                     p_resultado        OUT PK_UTILS.ty_cursor,
                                     p_codError         OUT NUMBER,
                                     p_msjError         OUT VARCHAR2);

  PROCEDURE Pr_RegistrarEstadoHistoriaVida(p_idUsuario      IN NUMBER,
                                           p_idHistoriaVida IN NUMBER,
                                           p_estado         IN VARCHAR2, --  A:Aprobar R:Rechazar P:Pendiente aprobacion E:Elejido
                                           p_motivoRechazo  IN VARCHAR2,
                                           p_codError       OUT NUMBER,
                                           p_msjError       OUT VARCHAR2);
end PK_OPE_HISTORIAVIDA;
/

prompt
prompt Creating package PK_OPE_LIDERAZGO
prompt =================================
prompt
create or replace package hpv.PK_OPE_LIDERAZGO is

  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos y funciones
                   utilizados liderazgo
  
  REALIZADO POR    : 
                      
  
  FECHA CREACION    : 04/06/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  
  *******************************************************************************/

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_OPE_LIDERAZGO';

  PROCEDURE Pr_DarLiderazgos(p_idUsuario        IN number,
                             p_filtroBusqueda   IN varchar2,
                             p_estadoXConsultar IN varchar2,
                             p_idPeriodo        IN NUMBER,
                             p_resultado        OUT PK_UTILS.ty_cursor,
                             p_codError         OUT NUMBER,
                             p_msjError         OUT VARCHAR2);

  PROCEDURE Pr_ValidarCantidadLiderazgo(p_idUsuario IN number,
                                        p_codError  OUT NUMBER,
                                        p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ActualizarLiderazgo(p_idLiderazgo        IN number, -- 0 Si es nuevo
                                   p_idGrupoFacilitador number,
                                   p_idFacilitador      number,
                                   p_criterios          varchar2, -- idCualidad,S(N);
                                   p_idInscrito         number,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2);

  PROCEDURE Pr_consultarLiderazgo(p_idLiderazgo IN number,
                                  p_resultado   OUT PK_UTILS.ty_cursor,
                                  p_codError    OUT NUMBER,
                                  p_msjError    OUT VARCHAR2);

  PROCEDURE Pr_RegistrarEstadoLiderazgo(p_idUsuario     IN NUMBER,
                                        p_idLiderazgo   IN NUMBER,
                                        p_motivoRechazo IN VARCHAR2,
                                        p_estado        IN VARCHAR2, --  A:Aprobar R:Rechazar P:Pendiente aprobacion E:Elejido
                                        p_codError      OUT NUMBER,
                                        p_msjError      OUT VARCHAR2);

end PK_OPE_LIDERAZGO;
/

prompt
prompt Creating package PK_PAR_ADMPARAMETRO
prompt ====================================
prompt
create or replace package hpv.PK_PAR_ADMPARAMETRO is

  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos y funciones
                   utilizados en la administracion de parametros
  
  REALIZADO POR    :  
                      
  
  FECHA CREACION    : 10/06/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  
  *******************************************************************************/

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_PAR_ADMPARAMETRO';

  PROCEDURE Pr_DarParametros(p_resultado OUT PK_UTILS.ty_cursor,
                             p_codError  OUT NUMBER,
                             p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ConsultarParametro(p_codigo    IN NUMBER,
                                  p_resultado OUT PK_UTILS.ty_cursor,
                                  p_codError  OUT NUMBER,
                                  p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ActualizarParametro(p_codigo          IN NUMBER,
                                   p_nombre          IN VARCHAR2,
                                   p_valor           IN VARCHAR2,
                                   p_descripcion     IN VARCHAR2,
                                   p_estado          IN VARCHAR2,
                                   p_usuarioregistra IN NUMBER,
                                   p_codError        OUT NUMBER,
                                   p_msjError        OUT VARCHAR2);

  PROCEDURE Pr_DarPeriodos(p_resultado OUT PK_UTILS.ty_cursor,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ConsultarPeriodo(p_codigo    IN NUMBER,
                                p_resultado OUT PK_UTILS.ty_cursor,
                                p_codError  OUT NUMBER,
                                p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ActualizarPeriodo(p_codigo          IN NUMBER,
                                 p_nombre          IN VARCHAR2,
                                 p_fechainicio     IN VARCHAR2,
                                 p_fechafin        IN VARCHAR2,
                                 p_noperiodo       IN NUMBER,
                                 p_estado          IN VARCHAR2,
                                 p_fechaIniTaller  IN VARCHAr2,
                                 p_usuarioregistra IN NUMBER,
                                 p_codError        OUT NUMBER,
                                 p_msjError        OUT VARCHAR2);

  PROCEDURE Pr_DarFechasCorte(p_idperiodo number,
                              p_resultado OUT PK_UTILS.ty_cursor,
                              p_codError  OUT NUMBER,
                              p_msjError  OUT VARCHAR2);

end PK_PAR_ADMPARAMETRO;
/

prompt
prompt Creating package PK_PAR_ADMROL
prompt ==============================
prompt
create or replace package hpv.PK_PAR_ADMROL is

  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos y funciones
                   utilizados en la administracion de roles

  REALIZADO POR    :  
                      

  FECHA CREACION    : 10/06/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_PAR_ADMROL';

  PROCEDURE Pr_DarRoles(p_resultado OUT PK_UTILS.ty_cursor,
                        p_codError  OUT NUMBER,
                        p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ConsultarRol(p_codigo    IN NUMBER,
                            p_resultado OUT PK_UTILS.ty_cursor,
                            p_codError  OUT NUMBER,
                            p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_ActualizarRol(p_codigo          IN NUMBER,
                             p_nombre          IN VARCHAR2,
                             p_estado          IN VARCHAR2,
                             p_opciones        IN VARCHAR2,
                             p_usuarioRegistra IN NUMBER,
                             p_codError        OUT NUMBER,
                             p_msjError        OUT VARCHAR2);

  PROCEDURE Pr_DarOpcionesXUsuario(p_idUsuario IN NUMBER,
                                   p_idRol     OUT number,
                                   p_nomRol    OUT varchar2,
                                   p_opciones  OUT varchar2,
                                   p_codError  OUT NUMBER,
                                   p_msjError  OUT VARCHAR2);
end PK_PAR_ADMROL;
/

prompt
prompt Creating package PK_PRC_BATCH
prompt =============================
prompt
create or replace package hpv.PK_PRC_BATCH is

  -- Author  : TOSHIBA
  -- Created : 21/05/2016 8:02:39 a. m.
  -- Purpose : Procesos enviados en batch

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_PRC_BATCH';

  PROCEDURE Pr_ReprocesaEncEntSal(p_codError OUT NUMBER,
                                  p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarEncuestaSatisfaccion(p_codError OUT NUMBER,
                                           p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarCorreoInscripcion(p_codError OUT NUMBER,
                                        p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarRptEncuestaSat(p_codError OUT NUMBER,
                                     p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarRptEncuestaIO(p_codError OUT NUMBER,
                                    p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarRptCronogTalleres(p_codError OUT NUMBER,
                                        p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarRptCandidatos(p_codError OUT NUMBER,
                                    p_msjError OUT VARCHAR2);

  PROCEDURE Pr_TipoFechaCorte(p_fec_corte  OUT VARCHAR2,
                              p_tipo_corte OUT VARCHAR2,
                              p_codError   OUT NUMBER,
                              p_msjError   OUT VARCHAR2);

  PROCEDURE Pr_GenerarRptCasoExito(p_periodo  IN NUMBER,
                                   p_codError OUT NUMBER,
                                   p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarRptEjemLiderazgo(p_periodo  IN NUMBER,
                                       p_codError OUT NUMBER,
                                       p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarRptHistVida(p_periodo  IN NUMBER,
                                  p_codError OUT NUMBER,
                                  p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarRptTrazabilidadP1(p_codError OUT NUMBER,
                                        p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarRptGestionEspacios(p_codError OUT NUMBER,
                                         p_msjError OUT VARCHAR2);

  PROCEDURE Pr_ActPeriodosAnt(p_codError OUT NUMBER,
                              p_msjError OUT VARCHAR2);

  PROCEDURE Pr_GenerarRptTrazabilidad(p_codError OUT NUMBER,
                                      p_msjError OUT VARCHAR2);

  PROCEDURE Pr_ActEnc_SatisP1(p_codError OUT NUMBER,
                              p_msjError OUT VARCHAR2);

end PK_PRC_BATCH;
/

prompt
prompt Creating package PK_RPT_ADMREPORTE
prompt ==================================
prompt
create or replace package hpv.PK_RPT_ADMREPORTE is

  NOMBRE_PAQUETE CONSTANT VARCHAR2(50) := 'PK_RPT_ADMREPORTE';

  PROCEDURE Pr_DarReportes(p_idUsuario IN NUMBER,
                           p_resultado OUT PK_UTILS.TY_CURSOR,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2);

  PROCEDURE Pr_DarRptTrazabilidad(p_idPeriodo      IN NUMBER,
                                  p_idFacilitador  IN NUMBER,
                                  p_idCoordinador  IN NUMBER,
                                  p_idGrupo        IN NUMBER,
                                  p_idDepartamento IN NUMBER,
                                  p_idMunicipio    IN NUMBER,
                                  p_fec_corte      IN varchar2,
                                  p_resultado      OUT PK_UTILS.TY_CURSOR,
                                  p_codError       OUT NUMBER,
                                  p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptSatisfaccion(p_idPeriodo      IN NUMBER,
                                  p_idFacilitador  IN NUMBER,
                                  p_idCoordinador  IN NUMBER,
                                  p_idGrupo        IN NUMBER,
                                  p_idDepartamento IN NUMBER,
                                  p_idMunicipio    IN NUMBER,
                                  p_fec_corte      IN varchar2,
                                  p_resultado      OUT PK_UTILS.TY_CURSOR,
                                  p_codError       OUT NUMBER,
                                  p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptCronograma(p_idPeriodo      IN NUMBER,
                                p_idFacilitador  IN NUMBER,
                                p_idCoordinador  IN NUMBER,
                                p_idGrupo        IN NUMBER,
                                p_idDepartamento IN NUMBER,
                                p_idMunicipio    IN NUMBER,
                                p_fec_corte      IN varchar2,
                                p_resultado      OUT PK_UTILS.TY_CURSOR,
                                p_codError       OUT NUMBER,
                                p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptEntradaSalida(p_idPeriodo      IN NUMBER,
                                   p_idFacilitador  IN NUMBER,
                                   p_idCoordinador  IN NUMBER,
                                   p_idGrupo        IN NUMBER,
                                   p_idDepartamento IN NUMBER,
                                   p_idMunicipio    IN NUMBER,
                                   p_fec_corte      IN varchar2,
                                   p_resultado      OUT PK_UTILS.TY_CURSOR,
                                   p_codError       OUT NUMBER,
                                   p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptCandidatos(p_idPeriodo      IN NUMBER,
                                p_idFacilitador  IN NUMBER,
                                p_idCoordinador  IN NUMBER,
                                p_idGrupo        IN NUMBER,
                                p_idDepartamento IN NUMBER,
                                p_idMunicipio    IN NUMBER,
                                p_fec_corte      IN varchar2,
                                p_resultado      OUT PK_UTILS.TY_CURSOR,
                                p_codError       OUT NUMBER,
                                p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptCasosExito(p_idPeriodo      IN NUMBER,
                                p_idFacilitador  IN NUMBER,
                                p_idCoordinador  IN NUMBER,
                                p_idGrupo        IN NUMBER,
                                p_idDepartamento IN NUMBER,
                                p_idMunicipio    IN NUMBER,
                                p_fec_corte      IN varchar2,
                                p_resultado      OUT PK_UTILS.TY_CURSOR,
                                p_codError       OUT NUMBER,
                                p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptEjemLider(p_idPeriodo      IN NUMBER,
                               p_idFacilitador  IN NUMBER,
                               p_idCoordinador  IN NUMBER,
                               p_idGrupo        IN NUMBER,
                               p_idDepartamento IN NUMBER,
                               p_idMunicipio    IN NUMBER,
                               p_fec_corte      IN varchar2,
                               p_resultado      OUT PK_UTILS.TY_CURSOR,
                               p_codError       OUT NUMBER,
                               p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptHistVida(p_idPeriodo      IN NUMBER,
                              p_idFacilitador  IN NUMBER,
                              p_idCoordinador  IN NUMBER,
                              p_idGrupo        IN NUMBER,
                              p_idDepartamento IN NUMBER,
                              p_idMunicipio    IN NUMBER,
                              p_fec_corte      IN varchar2,
                              p_resultado      OUT PK_UTILS.TY_CURSOR,
                              p_codError       OUT NUMBER,
                              p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptUsuarSistema(p_idPeriodo      IN NUMBER,
                                  p_idFacilitador  IN NUMBER,
                                  p_idCoordinador  IN NUMBER,
                                  p_idGrupo        IN NUMBER,
                                  p_idDepartamento IN NUMBER,
                                  p_idMunicipio    IN NUMBER,
                                  p_fec_corte      IN varchar2,
                                  p_resultado      OUT PK_UTILS.TY_CURSOR,
                                  p_codError       OUT NUMBER,
                                  p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptObsEncSatisf(p_idPeriodo      IN NUMBER,
                                  p_idFacilitador  IN NUMBER,
                                  p_idCoordinador  IN NUMBER,
                                  p_idGrupo        IN NUMBER,
                                  p_idDepartamento IN NUMBER,
                                  p_idMunicipio    IN NUMBER,
                                  p_fec_corte      IN varchar2,
                                  p_resultado      OUT PK_UTILS.TY_CURSOR,
                                  p_codError       OUT NUMBER,
                                  p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptEspaciosFisicos(p_idPeriodo      IN NUMBER,
                                     p_idFacilitador  IN NUMBER,
                                     p_idCoordinador  IN NUMBER,
                                     p_idGrupo        IN NUMBER,
                                     p_idDepartamento IN NUMBER,
                                     p_idMunicipio    IN NUMBER,
                                     p_fec_corte      IN varchar2,
                                     p_resultado      OUT PK_UTILS.TY_CURSOR,
                                     p_codError       OUT NUMBER,
                                     p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarDptosXProfesional(p_idProfesional IN NUMBER,
                                    p_resultado     OUT PK_UTILS.ty_cursor,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_DarMunicipiosXProfesional(p_idProfesional  IN NUMBER,
                                         p_idDepartamento IN NUMBER,
                                         p_resultado      OUT PK_UTILS.ty_cursor,
                                         p_codError       OUT NUMBER,
                                         p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarCoordinadoresXPrf(p_idProfesional IN NUMBER,
                                    p_resultado     OUT PK_UTILS.ty_cursor,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2);

  PROCEDURE Pr_DarRptRechazoGrupos(p_idPeriodo      IN NUMBER,
                                   p_idFacilitador  IN NUMBER,
                                   p_idCoordinador  IN NUMBER,
                                   p_idGrupo        IN NUMBER,
                                   p_idDepartamento IN NUMBER,
                                   p_idMunicipio    IN NUMBER,
                                   p_fec_corte      IN varchar2,
                                   p_resultado      OUT PK_UTILS.TY_CURSOR,
                                   p_codError       OUT NUMBER,
                                   p_msjError       OUT VARCHAR2);

  PROCEDURE Pr_DarRptTrazabilidad(p_idPeriodo      IN NUMBER,
                                  p_idFacilitador  IN NUMBER,
                                  p_idCoordinador  IN NUMBER,
                                  p_idGrupo        IN NUMBER,
                                  p_idDepartamento IN NUMBER,
                                  p_idMunicipio    IN NUMBER,
                                  p_IdUsuario      IN NUMBER,
                                  p_fec_corte      IN varchar2,
                                  p_resultado      OUT PK_UTILS.TY_CURSOR,
                                  p_codError       OUT NUMBER,
                                  p_msjError       OUT VARCHAR2);
end PK_RPT_ADMREPORTE;
/

prompt
prompt Creating package PK_T01_PARTICIPANTES
prompt =====================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T01_PARTICIPANTES AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T01_PARTICIPANTES

REALIZADO POR    : 
                    

FECHA CREACION    : 18/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a01municipioestudio    IN T01_PARTICIPANTES.a01municipioestudio%TYPE,
p_a01tipodocumento       IN T01_PARTICIPANTES.a01tipodocumento%TYPE,
p_a01documento           IN T01_PARTICIPANTES.a01documento%TYPE,
p_a01codigobeneficiario  IN T01_PARTICIPANTES.a01codigobeneficiario%TYPE,
p_a01primernombre        IN T01_PARTICIPANTES.a01primernombre%TYPE,
p_a01segundonombre       IN T01_PARTICIPANTES.a01segundonombre%TYPE,
p_a01primerapellido      IN T01_PARTICIPANTES.a01primerapellido%TYPE,
p_a01segundoapellido     IN T01_PARTICIPANTES.a01segundoapellido%TYPE,
p_a01fechanacimiento     IN T01_PARTICIPANTES.a01fechanacimiento%TYPE,
p_a01email               IN T01_PARTICIPANTES.a01email%TYPE,
p_a01telefono            IN T01_PARTICIPANTES.a01telefono%TYPE,
p_a01movil               IN T01_PARTICIPANTES.a01movil%TYPE,
p_a01movilalt            IN T01_PARTICIPANTES.a01movilalt%TYPE,
p_a01noconvenio          IN T01_PARTICIPANTES.a01noconvenio%TYPE,
p_a01estado              IN T01_PARTICIPANTES.a01estado%TYPE,
p_a01finetapapractica    IN T01_PARTICIPANTES.a01finetapapractica%TYPE,
p_a01finsemestre         IN T01_PARTICIPANTES.a01finsemestre%TYPE,
p_a01ultimomes           IN T01_PARTICIPANTES.a01ultimomes%TYPE,
p_a01fichasnies          IN T01_PARTICIPANTES.a01fichasnies%TYPE,
p_a01nivelformacion      IN T01_PARTICIPANTES.a01nivelformacion%TYPE,
p_a01sniesies            IN T01_PARTICIPANTES.a01sniesies%TYPE,
p_a01tipoformcion        IN T01_PARTICIPANTES.a01tipoformcion%TYPE,
p_usuario                IN T01_PARTICIPANTES.a01usuariocreacion%TYPE,
p_a01codigo              OUT T01_PARTICIPANTES.a01codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a01codigo     IN T01_PARTICIPANTES.a01codigo%TYPE,
p_usuario       IN T01_PARTICIPANTES.a01usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a01codigo              IN T01_PARTICIPANTES.a01codigo%TYPE,
p_a01municipioestudio    IN T01_PARTICIPANTES.a01municipioestudio%TYPE,
p_a01tipodocumento       IN T01_PARTICIPANTES.a01tipodocumento%TYPE,
p_a01documento           IN T01_PARTICIPANTES.a01documento%TYPE,
p_a01codigobeneficiario  IN T01_PARTICIPANTES.a01codigobeneficiario%TYPE,
p_a01primernombre        IN T01_PARTICIPANTES.a01primernombre%TYPE,
p_a01segundonombre       IN T01_PARTICIPANTES.a01segundonombre%TYPE,
p_a01primerapellido      IN T01_PARTICIPANTES.a01primerapellido%TYPE,
p_a01segundoapellido     IN T01_PARTICIPANTES.a01segundoapellido%TYPE,
p_a01fechanacimiento     IN T01_PARTICIPANTES.a01fechanacimiento%TYPE,
p_a01email               IN T01_PARTICIPANTES.a01email%TYPE,
p_a01telefono            IN T01_PARTICIPANTES.a01telefono%TYPE,
p_a01movil               IN T01_PARTICIPANTES.a01movil%TYPE,
p_a01movilalt            IN T01_PARTICIPANTES.a01movilalt%TYPE,
p_a01noconvenio          IN T01_PARTICIPANTES.a01noconvenio%TYPE,
p_a01estado              IN T01_PARTICIPANTES.a01estado%TYPE,
p_a01finetapapractica    IN T01_PARTICIPANTES.a01finetapapractica%TYPE,
p_a01finsemestre         IN T01_PARTICIPANTES.a01finsemestre%TYPE,
p_a01ultimomes           IN T01_PARTICIPANTES.a01ultimomes%TYPE,
p_a01fichasnies          IN T01_PARTICIPANTES.a01fichasnies%TYPE,
p_a01nivelformacion      IN T01_PARTICIPANTES.a01nivelformacion%TYPE,
p_a01sniesies            IN T01_PARTICIPANTES.a01sniesies%TYPE,
p_a01tipoformcion        IN T01_PARTICIPANTES.a01tipoformcion%TYPE,
p_usuario                IN T01_PARTICIPANTES.a01usuariocreacion%TYPE);

PROCEDURE Pr_Consultar(
p_a01codigo     IN T01_PARTICIPANTES.a01codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T01_PARTICIPANTES;
/

prompt
prompt Creating package PK_T02_DEPARTAMENTOS
prompt =====================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T02_DEPARTAMENTOS AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T02_DEPARTAMENTOS

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a02nombre     IN T02_DEPARTAMENTOS.a02nombre%TYPE,
p_a02dane       IN T02_DEPARTAMENTOS.a02dane%TYPE,
p_a02indicativo IN T02_DEPARTAMENTOS.a02indicativo%TYPE,
p_a02estado     IN T02_DEPARTAMENTOS.a02estado%TYPE,
p_usuario       IN T02_DEPARTAMENTOS.a02usuariocreacion%TYPE,
p_a02codigo     OUT T02_DEPARTAMENTOS.a02codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a02codigo     IN T02_DEPARTAMENTOS.a02codigo%TYPE,
p_usuario       IN T02_DEPARTAMENTOS.a02usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a02codigo     IN T02_DEPARTAMENTOS.a02codigo%TYPE,
p_a02nombre     IN T02_DEPARTAMENTOS.a02nombre%TYPE,
p_a02dane       IN T02_DEPARTAMENTOS.a02dane%TYPE,
p_a02indicativo IN T02_DEPARTAMENTOS.a02indicativo%TYPE,
p_a02estado     IN T02_DEPARTAMENTOS.a02estado%TYPE,
p_usuario       IN T02_DEPARTAMENTOS.a02usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a02codigo     IN T02_DEPARTAMENTOS.a02codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T02_DEPARTAMENTOS;
/

prompt
prompt Creating package PK_T03_MUNICIPIOS
prompt ==================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T03_MUNICIPIOS AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T03_MUNICIPIOS

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a03departamento IN T03_MUNICIPIOS.a03departamento%TYPE,
p_a03nombre       IN T03_MUNICIPIOS.a03nombre%TYPE,
p_a03dane         IN T03_MUNICIPIOS.a03dane%TYPE,
p_a03estado       IN T03_MUNICIPIOS.a03estado%TYPE,
p_usuario         IN T03_MUNICIPIOS.a03usuariocreacion%TYPE,
p_a03codigo       OUT T03_MUNICIPIOS.a03codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a03codigo     IN T03_MUNICIPIOS.a03codigo%TYPE,
p_usuario       IN T03_MUNICIPIOS.a03usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a03codigo       IN T03_MUNICIPIOS.a03codigo%TYPE,
p_a03departamento IN T03_MUNICIPIOS.a03departamento%TYPE,
p_a03nombre       IN T03_MUNICIPIOS.a03nombre%TYPE,
p_a03dane         IN T03_MUNICIPIOS.a03dane%TYPE,
p_a03estado       IN T03_MUNICIPIOS.a03estado%TYPE,
p_usuario         IN T03_MUNICIPIOS.a03usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a03codigo     IN T03_MUNICIPIOS.a03codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

FUNCTION fn_ObtenerNombre(p_a03codigo  IN T03_MUNICIPIOS.a03codigo%TYPE) RETURN VARCHAR2;

END PK_T03_MUNICIPIOS;
/

prompt
prompt Creating package PK_T05_ROLES
prompt =============================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T05_ROLES AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T05_ROLES

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a05nombre     IN T05_ROLES.a05nombre%TYPE,
p_a05estado     IN T05_ROLES.a05estado%TYPE,
p_usuario       IN T05_ROLES.a05usuariocreacion%TYPE,
p_a05codigo     OUT T05_ROLES.a05codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a05codigo     IN T05_ROLES.a05codigo%TYPE,
p_usuario       IN T05_ROLES.a05usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a05codigo     IN T05_ROLES.a05codigo%TYPE,
p_a05nombre     IN T05_ROLES.a05nombre%TYPE,
p_a05estado     IN T05_ROLES.a05estado%TYPE,
p_usuario       IN T05_ROLES.a05usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a05codigo     IN T05_ROLES.a05codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T05_ROLES;
/

prompt
prompt Creating package PK_T06_USUARIOS
prompt ================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T06_USUARIOS AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                   con la operaciones CRUD sobre la tabla T06_USUARIOS

  REALIZADO POR    : 
                      

  FECHA CREACION    : 04/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a06rol         IN T06_USUARIOS.a06rol%TYPE,
                        p_a06coordinador IN T06_USUARIOS.a06coordinador%TYPE,
                        p_a06perfil      IN T06_USUARIOS.a06perfil%TYPE,
                        p_a06usuario     IN T06_USUARIOS.a06usuario%TYPE,
                        p_a06clave       IN T06_USUARIOS.a06clave%TYPE,
                        p_a06estado      IN T06_USUARIOS.a06estado%TYPE,
                        p_usuario        IN T06_USUARIOS.a06usuariocreacion%TYPE,
                        p_a06codigo      OUT T06_USUARIOS.a06codigo%TYPE);

  PROCEDURE Pr_Eliminar(p_a06codigo IN T06_USUARIOS.a06codigo%TYPE,
                        p_usuario   IN T06_USUARIOS.a06usuariomodificacion%TYPE);

  PROCEDURE Pr_Actualizar(p_a06codigo      IN T06_USUARIOS.a06codigo%TYPE,
                          p_a06rol         IN T06_USUARIOS.a06rol%TYPE,
                          p_a06perfil      IN T06_USUARIOS.a06perfil%TYPE,
                          p_a06coordinador IN T06_USUARIOS.a06coordinador%TYPE,
                          p_a06usuario     IN T06_USUARIOS.a06usuario%TYPE,
                          p_a06clave       IN T06_USUARIOS.a06clave%TYPE,
                          p_a06estado      IN T06_USUARIOS.a06estado%TYPE,
                          p_usuario        IN T06_USUARIOS.a06usuariomodificacion%TYPE);

  PROCEDURE Pr_Consultar(p_a06codigo IN T06_USUARIOS.a06codigo%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor);

END PK_T06_USUARIOS;
/

prompt
prompt Creating package PK_T07_PERSONAS
prompt ================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T07_PERSONAS AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T07_PERSONAS

REALIZADO POR    : 
                    

FECHA CREACION    : 04/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a07usuario             IN T07_PERSONAS.a07usuario%TYPE,
p_a07tipodocumento       IN T07_PERSONAS.a07tipodocumento%TYPE,
p_a07identificacion      IN T07_PERSONAS.a07identificacion%TYPE,
p_a07primernombre        IN T07_PERSONAS.a07primernombre%TYPE,
p_a07segundonombre       IN T07_PERSONAS.a07segundonombre%TYPE,
p_a07primerapellido      IN T07_PERSONAS.a07primerapellido%TYPE,
p_a07segundoapellido     IN T07_PERSONAS.a07segundoapellido%TYPE,
p_a07fechanacimiento     IN T07_PERSONAS.a07fechanacimiento%TYPE,
p_a07email               IN T07_PERSONAS.a07email%TYPE,
p_a07telefono            IN T07_PERSONAS.a07telefono%TYPE,
p_a07movil               IN T07_PERSONAS.a07movil%TYPE,
p_a07movilalt            IN T07_PERSONAS.a07movilalt%TYPE,
p_usuario                IN T07_PERSONAS.a07usuariocreacion%TYPE,
p_a07codigo              OUT T07_PERSONAS.a07codigo%TYPE);

PROCEDURE Pr_Actualizar(
p_a07codigo              IN T07_PERSONAS.a07codigo%TYPE,
p_a07usuario             IN T07_PERSONAS.a07usuario%TYPE,
p_a07tipodocumento       IN T07_PERSONAS.a07tipodocumento%TYPE,
p_a07identificacion      IN T07_PERSONAS.a07identificacion%TYPE,
p_a07primernombre        IN T07_PERSONAS.a07primernombre%TYPE,
p_a07segundonombre       IN T07_PERSONAS.a07segundonombre%TYPE,
p_a07primerapellido      IN T07_PERSONAS.a07primerapellido%TYPE,
p_a07segundoapellido     IN T07_PERSONAS.a07segundoapellido%TYPE,
p_a07fechanacimiento     IN T07_PERSONAS.a07fechanacimiento%TYPE,
p_a07email               IN T07_PERSONAS.a07email%TYPE,
p_a07telefono            IN T07_PERSONAS.a07telefono%TYPE,
p_a07movil               IN T07_PERSONAS.a07movil%TYPE,
p_a07movilalt            IN T07_PERSONAS.a07movilalt%TYPE,
p_usuario                IN T07_PERSONAS.a07usuariocreacion%TYPE);

PROCEDURE Pr_Consultar(
p_a07codigo     IN T07_PERSONAS.a07codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T07_PERSONAS;
/

prompt
prompt Creating package PK_T12_PERIODOS
prompt ================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T12_PERIODOS AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T12_PERIODOS

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a12nombre      IN T12_PERIODOS.a12nombre%TYPE,
p_a12fechainicio IN T12_PERIODOS.a12fechainicio%TYPE,
p_a12fechafin    IN T12_PERIODOS.a12fechafin%TYPE,
p_a12estado      IN T12_PERIODOS.a12estado%TYPE,
p_a12noperiodo   IN T12_PERIODOS.a12noperiodo%TYPE,
p_usuario        IN T12_PERIODOS.a12usuariocreacion%TYPE,
p_a12codigo      OUT T12_PERIODOS.a12codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a12codigo     IN T12_PERIODOS.a12codigo%TYPE,
p_usuario       IN T12_PERIODOS.a12usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a12codigo      IN T12_PERIODOS.a12codigo%TYPE,
p_a12nombre      IN T12_PERIODOS.a12nombre%TYPE,
p_a12fechainicio IN T12_PERIODOS.a12fechainicio%TYPE,
p_a12fechafin    IN T12_PERIODOS.a12fechafin%TYPE,
p_a12estado      IN T12_PERIODOS.a12estado%TYPE,
p_a12noperiodo   IN T12_PERIODOS.a12noperiodo%TYPE,
p_usuario        IN T12_PERIODOS.a12usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a12codigo     IN T12_PERIODOS.a12codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T12_PERIODOS;
/

prompt
prompt Creating package PK_T13_ENCUESTAPREGUNTAS
prompt =========================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T13_ENCUESTAPREGUNTAS AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T13_ENCUESTAPREGUNTAS

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a13numero    IN T13_ENCUESTAPREGUNTAS.a13numero%TYPE,
p_a13pregunta  IN T13_ENCUESTAPREGUNTAS.a13pregunta%TYPE,
p_a13encuesta  IN T13_ENCUESTAPREGUNTAS.a13encuesta%TYPE,
p_a13estado    IN T13_ENCUESTAPREGUNTAS.a13estado%TYPE,
p_usuario      IN T13_ENCUESTAPREGUNTAS.a13usuariocreacion%TYPE,
p_a13codigo    OUT T13_ENCUESTAPREGUNTAS.a13codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a13codigo     IN T13_ENCUESTAPREGUNTAS.a13codigo%TYPE,
p_usuario       IN T13_ENCUESTAPREGUNTAS.a13usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a13codigo    IN T13_ENCUESTAPREGUNTAS.a13codigo%TYPE,
p_a13numero    IN T13_ENCUESTAPREGUNTAS.a13numero%TYPE,
p_a13pregunta  IN T13_ENCUESTAPREGUNTAS.a13pregunta%TYPE,
p_a13encuesta  IN T13_ENCUESTAPREGUNTAS.a13encuesta%TYPE,
p_a13estado    IN T13_ENCUESTAPREGUNTAS.a13estado%TYPE,
p_usuario      IN T13_ENCUESTAPREGUNTAS.a13usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a13codigo     IN T13_ENCUESTAPREGUNTAS.a13codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T13_ENCUESTAPREGUNTAS;
/

prompt
prompt Creating package PK_T14_ENCUESTARESPUESTAS
prompt ==========================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T14_ENCUESTARESPUESTAS AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T14_ENCUESTARESPUESTAS

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a14pregunta    IN T14_ENCUESTARESPUESTAS.a14pregunta%TYPE,
p_a14letra       IN T14_ENCUESTARESPUESTAS.a14letra%TYPE,
p_a14respuesta   IN T14_ENCUESTARESPUESTAS.a14respuesta%TYPE,
p_a14correcta    IN T14_ENCUESTARESPUESTAS.a14correcta%TYPE,
p_a14estado      IN T14_ENCUESTARESPUESTAS.a14estado%TYPE,
p_usuario        IN T14_ENCUESTARESPUESTAS.a14usuariocreacion%TYPE,
p_a14codigo      OUT T14_ENCUESTARESPUESTAS.a14codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a14codigo     IN T14_ENCUESTARESPUESTAS.a14codigo%TYPE,
p_usuario       IN T14_ENCUESTARESPUESTAS.a14usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a14codigo      IN T14_ENCUESTARESPUESTAS.a14codigo%TYPE,
p_a14pregunta    IN T14_ENCUESTARESPUESTAS.a14pregunta%TYPE,
p_a14letra       IN T14_ENCUESTARESPUESTAS.a14letra%TYPE,
p_a14respuesta   IN T14_ENCUESTARESPUESTAS.a14respuesta%TYPE,
p_a14correcta    IN T14_ENCUESTARESPUESTAS.a14correcta%TYPE,
p_a14estado      IN T14_ENCUESTARESPUESTAS.a14estado%TYPE,
p_usuario        IN T14_ENCUESTARESPUESTAS.a14usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a14codigo     IN T14_ENCUESTARESPUESTAS.a14codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T14_ENCUESTARESPUESTAS;
/

prompt
prompt Creating package PK_T15_INSCRITOS
prompt =================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T15_INSCRITOS AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                   con la operaciones CRUD sobre la tabla T15_INSCRITOS

  REALIZADO POR    : 
                      

  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a15grupofacilitador   IN T15_INSCRITOS.a15grupofacilitador%TYPE,
                        p_a15tipodocumento      IN T15_INSCRITOS.a15tipodocumento%TYPE,
                        p_a15documento          IN T15_INSCRITOS.a15documento%TYPE,
                        p_a15codigobeneficiario IN T15_INSCRITOS.a15codigobeneficiario%TYPE,
                        p_a15primernombre       IN T15_INSCRITOS.a15primernombre%TYPE,
                        p_a15segundonombre      IN T15_INSCRITOS.a15segundonombre%TYPE,
                        p_a15primerapellido     IN T15_INSCRITOS.a15primerapellido%TYPE,
                        p_a15segundoapellido    IN T15_INSCRITOS.a15segundoapellido%TYPE,
                        p_a15fechanacimiento    IN T15_INSCRITOS.a15fechanacimiento%TYPE,
                        p_a15email              IN T15_INSCRITOS.a15email%TYPE,
                        p_a15telefono           IN T15_INSCRITOS.a15telefono%TYPE,
                        p_a15movil              IN T15_INSCRITOS.a15movil%TYPE,
                        p_a15movilalt           IN T15_INSCRITOS.a15movilalt%TYPE,
                        p_a15condicionespecial  IN T15_INSCRITOS.a15condicionespecial%TYPE,
                        p_a15estado             IN T15_INSCRITOS.a15estado%TYPE,
                        p_usuario               IN T15_INSCRITOS.a15usuariocreacion%TYPE,
                        p_a15codigo             OUT T15_INSCRITOS.a15codigo%TYPE);


  PROCEDURE Pr_Eliminar(p_a15codigo IN T15_INSCRITOS.a15codigo%TYPE,
                        p_usuario   IN T15_INSCRITOS.a15usuariomodificacion%TYPE);

  PROCEDURE Pr_Actualizar(p_a15codigo             IN T15_INSCRITOS.a15codigo%TYPE,
                          p_a15grupofacilitador   IN T15_INSCRITOS.a15grupofacilitador%TYPE,
                          p_a15tipodocumento      IN T15_INSCRITOS.a15tipodocumento%TYPE,
                          p_a15documento          IN T15_INSCRITOS.a15documento%TYPE,
                          p_a15codigobeneficiario IN T15_INSCRITOS.a15codigobeneficiario%TYPE,
                          p_a15primernombre       IN T15_INSCRITOS.a15primernombre%TYPE,
                          p_a15segundonombre      IN T15_INSCRITOS.a15segundonombre%TYPE,
                          p_a15primerapellido     IN T15_INSCRITOS.a15primerapellido%TYPE,
                          p_a15segundoapellido    IN T15_INSCRITOS.a15segundoapellido%TYPE,
                          p_a15fechanacimiento    IN T15_INSCRITOS.a15fechanacimiento%TYPE,
                          p_a15email              IN T15_INSCRITOS.a15email%TYPE,
                          p_a15telefono           IN T15_INSCRITOS.a15telefono%TYPE,
                          p_a15movil              IN T15_INSCRITOS.a15movil%TYPE,
                          p_a15movilalt           IN T15_INSCRITOS.a15movilalt%TYPE,
                          p_a15condicionespecial  IN T15_INSCRITOS.a15condicionespecial%TYPE,
                          p_a15estado             IN T15_INSCRITOS.a15estado%TYPE,
                          p_usuario               IN T15_INSCRITOS.a15usuariocreacion%TYPE);

  PROCEDURE Pr_Consultar(p_a15codigo IN T15_INSCRITOS.a15codigo%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor);

END PK_T15_INSCRITOS;
/

prompt
prompt Creating package PK_T16_INSCRITOENCUESTA
prompt ========================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T16_INSCRITOENCUESTA AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T16_INSCRITOENCUESTA

REALIZADO POR    : 
                    

FECHA CREACION    : 02/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a16inscrito    IN T16_INSCRITOENCUESTA.a16inscrito%TYPE,
p_a16encuesta    IN T16_INSCRITOENCUESTA.a16encuesta%TYPE,
p_a16pregunta    IN T16_INSCRITOENCUESTA.a16pregunta%TYPE,
p_a16respuesta   IN T16_INSCRITOENCUESTA.a16respuesta%TYPE,
p_usuario        IN T16_INSCRITOENCUESTA.a16usuariocreacion%TYPE,
p_a16codigo      OUT T16_INSCRITOENCUESTA.a16codigo%TYPE);

PROCEDURE Pr_Actualizar(
p_a16codigo      IN T16_INSCRITOENCUESTA.a16codigo%TYPE,
p_a16inscrito    IN T16_INSCRITOENCUESTA.a16inscrito%TYPE,
p_a16encuesta    IN T16_INSCRITOENCUESTA.a16encuesta%TYPE,
p_a16pregunta    IN T16_INSCRITOENCUESTA.a16pregunta%TYPE,
p_a16respuesta   IN T16_INSCRITOENCUESTA.a16respuesta%TYPE,
p_usuario        IN T16_INSCRITOENCUESTA.a16usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a16codigo     IN T16_INSCRITOENCUESTA.a16codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T16_INSCRITOENCUESTA;
/

prompt
prompt Creating package PK_T17_TALLERES
prompt ================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T17_TALLERES AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T17_TALLERES

REALIZADO POR    : 
                    

FECHA CREACION    : 30/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a17nombre       IN T17_TALLERES.a17nombre%TYPE,
p_a17descripcion  IN T17_TALLERES.a17descripcion%TYPE,
p_a17orden        IN T17_TALLERES.a17orden%TYPE,
p_a17estado       IN T17_TALLERES.a17estado%TYPE,
p_usuario         IN T17_TALLERES.a17usuariocreacion%TYPE,
p_a17codigo       OUT T17_TALLERES.a17codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a17codigo     IN T17_TALLERES.a17codigo%TYPE,
p_usuario       IN T17_TALLERES.a17usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a17codigo       IN T17_TALLERES.a17codigo%TYPE,
p_a17nombre       IN T17_TALLERES.a17nombre%TYPE,
p_a17descripcion  IN T17_TALLERES.a17descripcion%TYPE,
p_a17orden        IN T17_TALLERES.a17orden%TYPE,
p_a17estado       IN T17_TALLERES.a17estado%TYPE,
p_usuario         IN T17_TALLERES.a17usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a17codigo     IN T17_TALLERES.a17codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T17_TALLERES;
/

prompt
prompt Creating package PK_T20_ENTREGABLESCARGADOS
prompt ===========================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T20_ENTREGABLESCARGADOS AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                   con la operaciones CRUD sobre la tabla T20_ENTREGABLESCARGADOS

  REALIZADO POR    : 
                      

  FECHA CREACION    : 29/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a20facilitador   IN T20_ENTREGABLESCARGADOS.a20facilitador%TYPE,
                        p_a20grupo         IN T20_ENTREGABLESCARGADOS.a20grupo%TYPE,
                        p_a20taller        IN T20_ENTREGABLESCARGADOS.a20taller%TYPE,
                        p_a20entregable    IN T20_ENTREGABLESCARGADOS.a20entregable%TYPE,
                        p_a20ruta          IN T20_ENTREGABLESCARGADOS.a20ruta%TYPE,
                        p_a20periodo       IN T20_ENTREGABLESCARGADOS.a20periodo%TYPE,
                        p_a20estado        IN T20_ENTREGABLESCARGADOS.a20estado%TYPE,
                        p_usuario          IN T20_ENTREGABLESCARGADOS.a20usuariocreacion%TYPE,
                        p_a20codigo        OUT T20_ENTREGABLESCARGADOS.a20codigo%TYPE);

  PROCEDURE Pr_Eliminar(p_a20codigo IN T20_ENTREGABLESCARGADOS.a20codigo%TYPE,
                        p_usuario   IN T20_ENTREGABLESCARGADOS.a20usuariomodificacion%TYPE);

  PROCEDURE Pr_Actualizar(p_a20codigo        IN T20_ENTREGABLESCARGADOS.a20codigo%TYPE,
                          p_a20facilitador   IN T20_ENTREGABLESCARGADOS.a20facilitador%TYPE,
                          p_a20grupo         IN T20_ENTREGABLESCARGADOS.a20grupo%TYPE,
                          p_a20taller        IN T20_ENTREGABLESCARGADOS.a20taller%TYPE,
                          p_a20entregable    IN T20_ENTREGABLESCARGADOS.a20entregable%TYPE,
                          p_a20ruta          IN T20_ENTREGABLESCARGADOS.a20ruta%TYPE,
                          p_a20periodo       IN T20_ENTREGABLESCARGADOS.a20periodo%TYPE,
                          p_usuario          IN T20_ENTREGABLESCARGADOS.a20usuariomodificacion%TYPE);

  PROCEDURE Pr_Consultar(p_a20codigo IN T20_ENTREGABLESCARGADOS.a20codigo%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor);

  PROCEDURE Pr_ActualizarEstado(p_a20codigo IN T20_ENTREGABLESCARGADOS.a20codigo%TYPE,
                                p_a20estado IN T20_ENTREGABLESCARGADOS.a20estado%TYPE,
                                p_usuario   IN T20_ENTREGABLESCARGADOS.a20usuariomodificacion%TYPE);
END PK_T20_ENTREGABLESCARGADOS;
/

prompt
prompt Creating package PK_T23_DIAS
prompt ============================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T23_DIAS AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T23_DIAS

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a23nombre     IN T23_DIAS.a23nombre%TYPE,
p_a23estado     IN T23_DIAS.a23estado%TYPE,
p_usuario       IN T23_DIAS.a23usuariocreacion%TYPE,
p_a23codigo     OUT T23_DIAS.a23codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a23codigo     IN T23_DIAS.a23codigo%TYPE,
p_usuario       IN T23_DIAS.a23usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a23codigo     IN T23_DIAS.a23codigo%TYPE,
p_a23nombre     IN T23_DIAS.a23nombre%TYPE,
p_a23estado     IN T23_DIAS.a23estado%TYPE,
p_usuario       IN T23_DIAS.a23usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a23codigo     IN T23_DIAS.a23codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T23_DIAS;
/

prompt
prompt Creating package PK_T24_HORARIOS
prompt ================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T24_HORARIOS AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T24_HORARIOS

REALIZADO POR    : 
                    

FECHA CREACION    : 15/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a24horario    IN T24_HORARIOS.a24horario%TYPE,
p_a24estado     IN T24_HORARIOS.a24estado%TYPE,
p_usuario       IN T24_HORARIOS.a24usuariocreacion%TYPE,
p_a24codigo     OUT T24_HORARIOS.a24codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a24codigo     IN T24_HORARIOS.a24codigo%TYPE,
p_usuario       IN T24_HORARIOS.a24usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a24codigo     IN T24_HORARIOS.a24codigo%TYPE,
p_a24horario    IN T24_HORARIOS.a24horario%TYPE,
p_a24estado     IN T24_HORARIOS.a24estado%TYPE,
p_usuario       IN T24_HORARIOS.a24usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a24codigo     IN T24_HORARIOS.a24codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

PROCEDURE Pr_ObtenerRango(
p_a24codigo  IN T24_HORARIOS.a24codigo%TYPE,
p_hinicio    OUT NUMBER,
p_hfin       OUT NUMBER);


END PK_T24_HORARIOS;
/

prompt
prompt Creating package PK_T25_GRUPOS
prompt ==============================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T25_GRUPOS AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T25_GRUPOS

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a25nombre     IN T25_GRUPOS.a25nombre%TYPE,
p_a25estado     IN T25_GRUPOS.a25estado%TYPE,
p_a25numero     IN T25_GRUPOS.a25numero%TYPE,
p_usuario       IN T25_GRUPOS.a25usuariocreacion%TYPE,
p_a25codigo     OUT T25_GRUPOS.a25codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a25codigo     IN T25_GRUPOS.a25codigo%TYPE,
p_usuario       IN T25_GRUPOS.a25usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a25codigo     IN T25_GRUPOS.a25codigo%TYPE,
p_a25nombre     IN T25_GRUPOS.a25nombre%TYPE,
p_a25estado     IN T25_GRUPOS.a25estado%TYPE,
p_a25numero     IN T25_GRUPOS.a25numero%TYPE,
p_usuario       IN T25_GRUPOS.a25usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a25codigo     IN T25_GRUPOS.a25codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T25_GRUPOS;
/

prompt
prompt Creating package PK_T26_GRUPOSFACILITADOR
prompt =========================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T26_GRUPOSFACILITADOR AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                   con la operaciones CRUD sobre la tabla T26_GRUPOSFACILITADOR

  REALIZADO POR    : 
                      

  FECHA CREACION    : 01/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a26facilitador   IN T26_GRUPOSFACILITADOR.a26facilitador%TYPE,
                        p_a26ciudad        IN T26_GRUPOSFACILITADOR.a26ciudad%TYPE,
                        p_a26grupo         IN T26_GRUPOSFACILITADOR.a26grupo%TYPE,
                        p_a26dia           IN T26_GRUPOSFACILITADOR.a26dia%TYPE,
                        p_a26horario       IN T26_GRUPOSFACILITADOR.a26horario%TYPE,
                        p_a26lugar         IN T26_GRUPOSFACILITADOR.a26lugar%TYPE,
                        p_a26direccion     IN T26_GRUPOSFACILITADOR.a26direccion%TYPE,
                        p_a26sigla         IN T26_GRUPOSFACILITADOR.a26sigla%TYPE,
                        p_a26periodo       IN T26_GRUPOSFACILITADOR.a26periodo%TYPE,
                        p_a26condicion     IN T26_GRUPOSFACILITADOR.a26condicion%TYPE,
                        p_a26observaciones IN T26_GRUPOSFACILITADOR.a26observaciones%TYPE,
                        p_a26estado        IN T26_GRUPOSFACILITADOR.a26estado%TYPE,
                        p_usuario          IN T26_GRUPOSFACILITADOR.a26usuariocreacion%TYPE,
                        p_a26codigo        OUT T26_GRUPOSFACILITADOR.a26codigo%TYPE);

  PROCEDURE Pr_Eliminar(p_a26codigo IN T26_GRUPOSFACILITADOR.a26codigo%TYPE,
                        p_usuario   IN T26_GRUPOSFACILITADOR.a26usuariomodificacion%TYPE);

  PROCEDURE Pr_Actualizar(p_a26codigo        IN T26_GRUPOSFACILITADOR.a26codigo%TYPE,
                          p_a26facilitador   IN T26_GRUPOSFACILITADOR.a26facilitador%TYPE,
                          p_a26ciudad        IN T26_GRUPOSFACILITADOR.a26ciudad%TYPE,
                          p_a26grupo         IN T26_GRUPOSFACILITADOR.a26grupo%TYPE,
                          p_a26dia           IN T26_GRUPOSFACILITADOR.a26dia%TYPE,
                          p_a26horario       IN T26_GRUPOSFACILITADOR.a26horario%TYPE,
                          p_a26lugar         IN T26_GRUPOSFACILITADOR.a26lugar%TYPE,
                          p_a26direccion     IN T26_GRUPOSFACILITADOR.a26direccion%TYPE,
                          p_a26sigla         IN T26_GRUPOSFACILITADOR.a26sigla%TYPE,
                          p_a26periodo       IN T26_GRUPOSFACILITADOR.a26periodo%TYPE,
                          p_a26condicion     IN T26_GRUPOSFACILITADOR.a26condicion%TYPE,
                          p_a26observaciones IN T26_GRUPOSFACILITADOR.a26observaciones%TYPE,
                          p_usuario          IN T26_GRUPOSFACILITADOR.a26usuariomodificacion%TYPE);

  PROCEDURE Pr_Consultar(p_a26codigo IN T26_GRUPOSFACILITADOR.a26codigo%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor);

  PROCEDURE Pr_ActualizarEstado(p_a26codigo IN T26_GRUPOSFACILITADOR.a26codigo%TYPE,
                                p_a26estado IN T26_GRUPOSFACILITADOR.a26estado%TYPE,
                                p_usuario   IN T26_GRUPOSFACILITADOR.a26usuariomodificacion%TYPE);
END PK_T26_GRUPOSFACILITADOR;
/

prompt
prompt Creating package PK_T29_CONSULTAPARTICIPANTES
prompt =============================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T29_CONSULTAPARTICIPANTES AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T29_CONSULTAPARTICIPANTES

REALIZADO POR    : 
                    

FECHA CREACION    : 20/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a29participante        IN T29_CONSULTAPARTICIPANTES.a29participante%TYPE,
p_a29municipioestudio    IN T29_CONSULTAPARTICIPANTES.a29municipioestudio%TYPE,
p_a29tipodocumento       IN T29_CONSULTAPARTICIPANTES.a29tipodocumento%TYPE,
p_a29documento           IN T29_CONSULTAPARTICIPANTES.a29documento%TYPE,
p_a29codigobeneficiario  IN T29_CONSULTAPARTICIPANTES.a29codigobeneficiario%TYPE,
p_a29primernombre        IN T29_CONSULTAPARTICIPANTES.a29primernombre%TYPE,
p_a29segundonombre       IN T29_CONSULTAPARTICIPANTES.a29segundonombre%TYPE,
p_a29primerapellido      IN T29_CONSULTAPARTICIPANTES.a29primerapellido%TYPE,
p_a29segundoapellido     IN T29_CONSULTAPARTICIPANTES.a29segundoapellido%TYPE,
p_a29fechanacimiento     IN T29_CONSULTAPARTICIPANTES.a29fechanacimiento%TYPE,
p_a29email               IN T29_CONSULTAPARTICIPANTES.a29email%TYPE,
p_a29telefono            IN T29_CONSULTAPARTICIPANTES.a29telefono%TYPE,
p_a29movil               IN T29_CONSULTAPARTICIPANTES.a29movil%TYPE,
p_a29movilalt            IN T29_CONSULTAPARTICIPANTES.a29movilalt%TYPE,
p_a29noconvenio          IN T29_CONSULTAPARTICIPANTES.a29noconvenio%TYPE,
p_a29estado              IN T29_CONSULTAPARTICIPANTES.a29estado%TYPE,
p_a29finetapapractica    IN T29_CONSULTAPARTICIPANTES.a29finetapapractica%TYPE,
p_a29finsemestre         IN T29_CONSULTAPARTICIPANTES.a29finsemestre%TYPE,
p_a29ultimomes           IN T29_CONSULTAPARTICIPANTES.a29ultimomes%TYPE,
p_a29fichasnies          IN T29_CONSULTAPARTICIPANTES.a29fichasnies%TYPE,
p_a29nivelformacion      IN T29_CONSULTAPARTICIPANTES.a29nivelformacion%TYPE,
p_a29sniesies            IN T29_CONSULTAPARTICIPANTES.a29sniesies%TYPE,
p_a29tipoformcion        IN T29_CONSULTAPARTICIPANTES.a29tipoformcion%TYPE,
p_usuario                IN T29_CONSULTAPARTICIPANTES.a29usuariocreacion%TYPE,
p_a29codigo              OUT T29_CONSULTAPARTICIPANTES.a29codigo%TYPE);

PROCEDURE Pr_Consultar(
p_a29codigo     IN T29_CONSULTAPARTICIPANTES.a29codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T29_CONSULTAPARTICIPANTES;
/

prompt
prompt Creating package PK_T30_CIUDADESUSUARIO
prompt =======================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T30_CIUDADESUSUARIO AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T30_CIUDADESUSUARIO

REALIZADO POR    : 
                    

FECHA CREACION    : 07/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a30ciudad     IN T30_CIUDADESUSUARIO.a30ciudad%TYPE,
p_a30estado     IN T30_CIUDADESUSUARIO.a30estado%TYPE,
p_a30usuario    IN T30_CIUDADESUSUARIO.a30usuario%TYPE,
p_usuario       IN T30_CIUDADESUSUARIO.a30usuariocreacion%TYPE,
p_a30codigo     OUT T30_CIUDADESUSUARIO.a30codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a30codigo     IN T30_CIUDADESUSUARIO.a30codigo%TYPE,
p_usuario       IN T30_CIUDADESUSUARIO.a30usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a30codigo     IN T30_CIUDADESUSUARIO.a30codigo%TYPE,
p_a30ciudad     IN T30_CIUDADESUSUARIO.a30ciudad%TYPE,
p_a30estado     IN T30_CIUDADESUSUARIO.a30estado%TYPE,
p_a30usuario    IN T30_CIUDADESUSUARIO.a30usuario%TYPE,
p_usuario       IN T30_CIUDADESUSUARIO.a30usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a30codigo     IN T30_CIUDADESUSUARIO.a30codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T30_CIUDADESUSUARIO;
/

prompt
prompt Creating package PK_T50_ENCUESTA
prompt ================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T50_ENCUESTA AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T50_ENCUESTA

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a50descripcion   IN T50_ENCUESTA.a50descripcion%TYPE,
p_a50periodo       IN T50_ENCUESTA.a50periodo%TYPE,
p_a50tipoencuesta  IN T50_ENCUESTA.a50tipoencuesta%TYPE,
p_a50estado        IN T50_ENCUESTA.a50estado%TYPE,
p_usuario          IN T50_ENCUESTA.a50usuariocreacion%TYPE,
p_a50codigo        OUT T50_ENCUESTA.a50codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a50codigo     IN T50_ENCUESTA.a50codigo%TYPE,
p_usuario       IN T50_ENCUESTA.a50usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a50codigo        IN T50_ENCUESTA.a50codigo%TYPE,
p_a50descripcion   IN T50_ENCUESTA.a50descripcion%TYPE,
p_a50periodo       IN T50_ENCUESTA.a50periodo%TYPE,
p_a50tipoencuesta  IN T50_ENCUESTA.a50tipoencuesta%TYPE,
p_a50estado        IN T50_ENCUESTA.a50estado%TYPE,
p_usuario          IN T50_ENCUESTA.a50usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a50codigo     IN T50_ENCUESTA.a50codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T50_ENCUESTA;
/

prompt
prompt Creating package PK_T52_CANDIDATOS
prompt ==================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T52_CANDIDATOS AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                   con la operaciones CRUD sobre la tabla T52_CANDIDATOS

  REALIZADO POR    : 
                      

  FECHA CREACION    : 15/04/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a52tipodocumento      IN T52_CANDIDATOS.a52tipodocumento%TYPE,
                        p_a52documento          IN T52_CANDIDATOS.a52documento%TYPE,
                        p_a52codigobeneficiario IN T52_CANDIDATOS.a52codigobeneficiario%TYPE,
                        p_a52primernombre       IN T52_CANDIDATOS.a52primernombre%TYPE,
                        p_a52segundonombre      IN T52_CANDIDATOS.a52segundonombre%TYPE,
                        p_a52primerapellido     IN T52_CANDIDATOS.a52primerapellido%TYPE,
                        p_a52segundoapellido    IN T52_CANDIDATOS.a52segundoapellido%TYPE,
                        p_a52fechanacimiento    IN T52_CANDIDATOS.a52fechanacimiento%TYPE,
                        p_a52email              IN T52_CANDIDATOS.a52email%TYPE,
                        p_a52telefono           IN T52_CANDIDATOS.a52telefono%TYPE,
                        p_a52movil              IN T52_CANDIDATOS.a52movil%TYPE,
                        p_a52movilalt           IN T52_CANDIDATOS.a52movilalt%TYPE,
                        p_a52condicionespecial  IN T52_CANDIDATOS.a52condicionespecial%TYPE,
                        p_a52estado             IN T52_CANDIDATOS.a52estado%TYPE,
                        p_a52periodo            IN T52_CANDIDATOS.a52periodo%TYPE,
                        p_usuario               IN T52_CANDIDATOS.a52usuariocreacion%TYPE,
                        p_a52codigo             OUT T52_CANDIDATOS.a52codigo%TYPE);

  PROCEDURE Pr_Eliminar(p_a52codigo IN T52_CANDIDATOS.a52codigo%TYPE,
                        p_usuario   IN T52_CANDIDATOS.a52usuariomodificacion%TYPE);

  PROCEDURE Pr_Actualizar(p_a52codigo             IN T52_CANDIDATOS.a52codigo%TYPE,
                          p_a52tipodocumento      IN T52_CANDIDATOS.a52tipodocumento%TYPE,
                          p_a52documento          IN T52_CANDIDATOS.a52documento%TYPE,
                          p_a52codigobeneficiario IN T52_CANDIDATOS.a52codigobeneficiario%TYPE,
                          p_a52primernombre       IN T52_CANDIDATOS.a52primernombre%TYPE,
                          p_a52segundonombre      IN T52_CANDIDATOS.a52segundonombre%TYPE,
                          p_a52primerapellido     IN T52_CANDIDATOS.a52primerapellido%TYPE,
                          p_a52segundoapellido    IN T52_CANDIDATOS.a52segundoapellido%TYPE,
                          p_a52fechanacimiento    IN T52_CANDIDATOS.a52fechanacimiento%TYPE,
                          p_a52email              IN T52_CANDIDATOS.a52email%TYPE,
                          p_a52telefono           IN T52_CANDIDATOS.a52telefono%TYPE,
                          p_a52movil              IN T52_CANDIDATOS.a52movil%TYPE,
                          p_a52movilalt           IN T52_CANDIDATOS.a52movilalt%TYPE,
                          p_a52condicionespecial  IN T52_CANDIDATOS.a52condicionespecial%TYPE,
                          p_a52estado             IN T52_CANDIDATOS.a52estado%TYPE,
                          p_usuario               IN T52_CANDIDATOS.a52usuariocreacion%TYPE);

  PROCEDURE Pr_Consultar(p_a52codigo IN T52_CANDIDATOS.a52codigo%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor);

END PK_T52_CANDIDATOS;
/

prompt
prompt Creating package PK_T53_GRUPOINSCRITO
prompt =====================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T53_GRUPOINSCRITO AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T53_GRUPOINSCRITO

REALIZADO POR    : 
                    

FECHA CREACION    : 15/04/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a53grupofacilitador   IN T53_GRUPOINSCRITO.a53grupofacilitador%TYPE,
p_a53periodo            IN T53_GRUPOINSCRITO.a53periodo%TYPE,
p_a53inscrito           IN T53_GRUPOINSCRITO.a53inscrito%TYPE,
p_a53estado             IN T53_GRUPOINSCRITO.a53estado%TYPE,
p_usuario               IN T53_GRUPOINSCRITO.a53usuariocreacion%TYPE,
p_a53codigo             OUT T53_GRUPOINSCRITO.a53codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a53codigo     IN T53_GRUPOINSCRITO.a53codigo%TYPE,
p_usuario       IN T53_GRUPOINSCRITO.a53usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a53codigo             IN T53_GRUPOINSCRITO.a53codigo%TYPE,
p_a53grupofacilitador   IN T53_GRUPOINSCRITO.a53grupofacilitador%TYPE,
p_a53periodo            IN T53_GRUPOINSCRITO.a53periodo%TYPE,
p_a53inscrito           IN T53_GRUPOINSCRITO.a53inscrito%TYPE,
p_a53estado             IN T53_GRUPOINSCRITO.a53estado%TYPE,
p_usuario               IN T53_GRUPOINSCRITO.a53usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a53codigo     IN T53_GRUPOINSCRITO.a53codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T53_GRUPOINSCRITO;
/

prompt
prompt Creating package PK_T92_PERFILESUSUARIO
prompt =======================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T92_PERFILESUSUARIO AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T92_PERFILESUSUARIO

REALIZADO POR    : 
                    

FECHA CREACION    : 09/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a92nombre     IN T92_PERFILESUSUARIO.a92nombre%TYPE,
p_a92estado     IN T92_PERFILESUSUARIO.a92estado%TYPE,
p_usuario       IN T92_PERFILESUSUARIO.a92usuariocreacion%TYPE,
p_a92codigo     OUT T92_PERFILESUSUARIO.a92codigo%TYPE);

PROCEDURE Pr_Eliminar(
p_a92codigo     IN T92_PERFILESUSUARIO.a92codigo%TYPE,
p_usuario       IN T92_PERFILESUSUARIO.a92usuariomodificacion%TYPE);

PROCEDURE Pr_Actualizar(
p_a92codigo     IN T92_PERFILESUSUARIO.a92codigo%TYPE,
p_a92nombre     IN T92_PERFILESUSUARIO.a92nombre%TYPE,
p_a92estado     IN T92_PERFILESUSUARIO.a92estado%TYPE,
p_usuario       IN T92_PERFILESUSUARIO.a92usuariomodificacion%TYPE);

PROCEDURE Pr_Consultar(
p_a92codigo     IN T92_PERFILESUSUARIO.a92codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor);

END PK_T92_PERFILESUSUARIO;
/

prompt
prompt Creating package PK_T96_OPCIONROL
prompt =================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T96_OPCIONROL AUTHID CURRENT_USER AS
  /********************************************************************************
  DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                   con la operaciones CRUD sobre la tabla T96_OPCIONROL

  REALIZADO POR    : 
                      

  FECHA CREACION    : 09/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a96opcion IN T96_OPCIONROL.a96opcion%TYPE,
                        p_a96rol    IN T96_OPCIONROL.a96rol%TYPE,
                        p_usuario   IN T96_OPCIONROL.a96usuariocreacion%TYPE);

  PROCEDURE Pr_Actualizar(p_a96opcion IN T96_OPCIONROL.a96opcion%TYPE,
                          p_a96rol    IN T96_OPCIONROL.a96rol%TYPE,
                          p_usuario   IN T96_OPCIONROL.a96usuariomodificacion%TYPE);

  PROCEDURE Pr_Consultar(p_a96rol    IN T96_OPCIONROL.a96rol%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor);

END PK_T96_OPCIONROL;
/

prompt
prompt Creating package PK_T98_EXCEPCION
prompt =================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T98_EXCEPCION AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T98DBO_EXCEPCION

REALIZADO POR    : 
                    

FECHA CREACION    : 18/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a98fechaexcepcion   IN T98_EXCEPCION.a98fechaexcepcion%TYPE,
p_a98usuario          IN T98_EXCEPCION.a98usuario%TYPE,
p_a98paquete          IN T98_EXCEPCION.a98paquete%TYPE,
p_a98procedimiento    IN T98_EXCEPCION.a98procedimiento%TYPE,
p_a98coderror         IN T98_EXCEPCION.a98coderror%TYPE,
p_a98msgerror         IN T98_EXCEPCION.a98msgerror%TYPE,
p_a98codigo           OUT T98_EXCEPCION.a98codigo%TYPE);

END PK_T98_EXCEPCION;
/

prompt
prompt Creating package PK_T99_LOGOPERACION
prompt ====================================
prompt
CREATE OR REPLACE PACKAGE HPV.PK_T99_LOGOPERACION AUTHID CURRENT_USER AS
/********************************************************************************
DESCRIPCION    : Paquete utilizado para agrupar todos los procedimientos
                 con la operaciones CRUD sobre la tabla T99DBO_LOGOPERACION

REALIZADO POR    : 
                    

FECHA CREACION    : 18/02/2016

FECHA MODIFICA    :
MODIFICADO POR    :
DESCRIPCION CAMBIO:

*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a99fechaoperacion   IN T99_LOGOPERACION.a99fechaoperacion%TYPE,
p_a99usuario          IN T99_LOGOPERACION.a99usuario%TYPE,
p_a99paquete          IN T99_LOGOPERACION.a99paquete%TYPE,
p_a99procedimiento    IN T99_LOGOPERACION.a99procedimiento%TYPE,
p_a99descripcion      IN T99_LOGOPERACION.a99descripcion%TYPE,
p_a99nivel            IN T99_LOGOPERACION.a99nivel%TYPE,
p_a99codigo           OUT T99_LOGOPERACION.a99codigo%TYPE);

END PK_T99_LOGOPERACION;
/

prompt
prompt Creating function FN_SYN_USUARIO
prompt ================================
prompt
create or replace function hpv.fn_syn_usuario(p_cedula in number)
  return varchar2 is
  Result  varchar2(100);
  v_count number;

  v_fecini    date;
  v_fecfin    date;
  v_idUsuario number;

begin

  select count(*)
    into v_count
    from t06_usuarios u
   where u.a06usuario = p_cedula
     and u.a06rol = 1; -- Facilitador

  if v_count <> 1 then
    Result := 'No existe o hay mas de un registro coincidente para Facilitador';
  else
  
    select u.a06codigo, u.a06fechacreacion, u.a06fechafin
      into v_idUsuario, v_fecini, v_fecfin
      from t06_usuarios u
     where u.a06usuario = p_cedula
       and u.a06rol = 1;
  
    Result := 'Actualizacioin exitosa';
  end if;

  return(Result);
end fn_syn_usuario;
/

prompt
prompt Creating package body PK_ALI_INSCRIPCION
prompt ========================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_ALI_INSCRIPCION IS
  /********************************************************************************
   DESCRIPCION   : Procedimiento que define el flujo de inscripcion
  
   PARAMETROS    :
   IN            :p_tipoDocumento      Tipo documento del participantes
                  p_documento          Numero documento del participantes
                  p_codigoBeneficiario Codigo de Benficiario del participantes
                  p_fechaNacimiento    Fecha de Nacimiento del participantes
                  p_consultaEnLinea    Determina si se consulta en linea WS sija
  
   OUT           : p_resultado       Retorna registro del periodo activo
                   p_codError        Codigo de error generado
                   p_msjError        Mensaje del error generado
  
  REALIZADO POR    :  
  
  FECHA CREACION    : 15/07/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_FlujoInscripcion(p_tipoDocumento      IN varchar2,
                                p_documento          IN varchar2,
                                p_codigoBeneficiario IN number,
                                p_fechaNacimiento    IN varchar2,
                                p_consultaEnLinea    IN number,
                                p_resultado          OUT PK_UTILS.ty_cursor,
                                p_codError           OUT NUMBER,
                                p_msjError           OUT VARCHAR2) IS
    v_codPeriodo         number;
    numReg               number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_FlujoInscripcion';
    codExcepcion         number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a ' || NOMBRE_PROCEDIMIENTO);
  
    select count(*)
      into numReg
      from t12_periodos
     WHERE a12estado = PK_UTILS.COD_ACTIVO;
  
    -- No hay periodo vigente
    if (numReg = 0) then
      p_codError := 7;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    IF p_consultaEnLinea = 1 then
      -- No se rezaliza nada dado que se esta consultado el estado del participante
      numReg := 1;

    ELSE
     -- Proceso de inscripcion.
      select count(*)
        into numReg
        from t12_periodos p
       WHERE p.a12codigo = PK_UTILS.Fn_ObtenerPeriodoInscripcion
         and p.a12fechainicio <= sysdate
         and p.a12fechafin >= sysdate;
    
      -- No hay inscripciones abiertas
      if (numReg = 0) then
        p_codError := 108;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    end if;

    -- Hay mas de un periodo vigente
    if (numReg > 1) then
      p_codError := 8;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    v_codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    if (v_codPeriodo = 2) then
      -- Flujo de Inscricpion para el periodo 2
      pk_ali_inscripcion.pr_validarbeneficiario(p_tipodocumento,
                                                p_documento,
                                                p_codigobeneficiario,
                                                p_fechanacimiento,
                                                p_consultaenlinea,
                                                p_resultado,
                                                p_coderror,
                                                p_msjerror);
    
    else
      -- Flujo de Inscricpion para el periodo 3
      pk_ali_inscripcion.pr_validarparticipante(p_tipodocumento,
                                                p_documento,
                                                p_codigobeneficiario,
                                                p_fechanacimiento,
                                                p_consultaenlinea,
                                                p_resultado,
                                                p_coderror,
                                                p_msjerror);
    
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Fin a ' || NOMBRE_PROCEDIMIENTO);
  EXCEPTION
    WHEN OTHERS THEN
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_FlujoInscripcion;

  /********************************************************************************
   DESCRIPCION   : Procedimiento que Finaliza la inscripcion con los datos capturados en el proceso
  
   PARAMETROS    :
   IN            :p_esBeneficiario     1 es participante valido o 0: No es participante valido
                  p_grupofacilitador   Grupo seleccionado por el Participante
                  p_tipodocumento      Tipo de documento del Participante
                  p_documento          Numero Documento del Participante
                  p_codigobeneficiario Codigo de Beneficiario del Participante
                  p_primernombre       Primer nombre  del Participante
                  p_segundonombre      Segunfo nombre  del Participante
                  p_primerapellido     Primer Apellido  del Participante
                  p_segundoapellido    Segundo Apellido  del Participante
                  p_fechanacimiento    Fecha de nacimiento del Participante YYYY-MM-DD
                  p_email              Email del Participante
                  p_telefono           Telefono del Participante
                  p_movil              Celular  del Participante
                  p_movilalt           Celular alterno del Participante
                  p_condicionEspecial  Condicion especial del Participante
                  p_encuesta           Id de la encuesta de entrada del Participante
  
   OUT           : p_resultado       Retorna registro del periodo activo
                   p_codError        Codigo de error generado
                   p_msjError        Mensaje del error generado
  
  REALIZADO POR    :  
  
  FECHA CREACION    : 15/07/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/


  PROCEDURE Pr_FinalizarInscripcion(p_esBeneficiario     IN NUMBER, -- 1 es participante valido , 0: No es participante valido
                                    p_grupofacilitador   IN NUMBER,
                                    p_tipodocumento      IN VARCHAR2,
                                    p_documento          IN VARCHAR2,
                                    p_codigobeneficiario IN NUMBER,
                                    p_primernombre       IN VARCHAR2,
                                    p_segundonombre      IN VARCHAR2,
                                    p_primerapellido     IN VARCHAR2,
                                    p_segundoapellido    IN VARCHAR2,
                                    p_fechanacimiento    IN VARCHAR2, -- YYYY-MM-DD
                                    p_email              IN VARCHAR2,
                                    p_telefono           IN VARCHAR2,
                                    p_movil              IN VARCHAR2,
                                    p_movilalt           IN VARCHAR2,
                                    p_condicionEspecial  IN NUMBER,
                                    p_encuesta           IN VARCHAR2,
                                    p_codigoInscripcion  OUT NUMBER,
                                    p_codError           OUT NUMBER,
                                    p_msjError           OUT VARCHAR2) IS
  
    v_codPeriodo         number;
    numReg               number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_FinalizarInscripcion';
    codExcepcion         number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a ' || NOMBRE_PROCEDIMIENTO);
  
    select count(*)
      into numReg
      from t12_periodos
     WHERE a12estado = PK_UTILS.COD_ACTIVO;
  
    -- No hay periodo vigente
    if (numReg = 0) then
      p_codError := 7;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    -- Hay mas de un periodo vigente
    if (numReg > 1) then
      p_codError := 8;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    v_codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    if (v_codPeriodo = 2) then
      -- Finaliza Inscricpion para el periodo 2
      pk_ali_inscripcion.pr_guardarinscripcion(p_esbeneficiario,
                                               p_grupofacilitador,
                                               p_tipodocumento,
                                               p_documento,
                                               p_codigobeneficiario,
                                               p_primernombre,
                                               p_segundonombre,
                                               p_primerapellido,
                                               p_segundoapellido,
                                               p_fechanacimiento,
                                               p_email,
                                               p_telefono,
                                               p_movil,
                                               p_movilalt,
                                               p_condicionespecial,
                                               p_encuesta,
                                               p_codigoinscripcion,
                                               p_coderror,
                                               p_msjerror);
    
    else
      -- Finaliza Inscricpion para el periodo 3
      pk_ali_inscripcion.pr_guardarinscripcion3(p_esbeneficiario,
                                                p_grupofacilitador,
                                                p_tipodocumento,
                                                p_documento,
                                                p_codigobeneficiario,
                                                p_primernombre,
                                                p_segundonombre,
                                                p_primerapellido,
                                                p_segundoapellido,
                                                p_fechanacimiento,
                                                p_email,
                                                p_telefono,
                                                p_movil,
                                                p_movilalt,
                                                p_condicionespecial,
                                                p_encuesta,
                                                p_codigoinscripcion,
                                                p_coderror,
                                                p_msjerror);
    
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Fin a ' || NOMBRE_PROCEDIMIENTO);
  EXCEPTION
    WHEN OTHERS THEN
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_FinalizarInscripcion;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para validar y consultar la informacion de los inscritos
  PARAMETROS    :
  IN    :p_tipoDocumento      tipo documento del participante
         p_documento          documento del participante
         p_codigoBeneficiario codigo de beneficiario del participante
         p_fechaNacimiento    Fecha de nacimiento del participante
         p_consultaEnLinea    1 si se requiere consultar el participante en WebService
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_ValidarParticipante(p_tipoDocumento      IN varchar2,
                                   p_documento          IN varchar2,
                                   p_codigoBeneficiario IN number,
                                   p_fechaNacimiento    IN varchar2,
                                   p_consultaEnLinea    IN number,
                                   p_resultado          OUT PK_UTILS.ty_cursor,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2) IS
    v_fechaNacimiento date;
    numAsistencias    number;
    esContingencia    number;
    CURSOR c_participanteXDocumento IS
      SELECT *
        FROM T01_PARTICIPANTES
       WHERE a01tipodocumento = p_tipoDocumento
         AND a01documento = p_documento
         AND TRUNC(a01fechanacimiento) = TRUNC(v_fechaNacimiento);
  
    CURSOR c_participanteXCodigo IS
      SELECT *
        FROM T01_PARTICIPANTES t
       WHERE t.a01codigobeneficiario = p_codigoBeneficiario
         AND TRUNC(a01fechanacimiento) = TRUNC(v_fechaNacimiento);
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ValidarParticipante';
    numReg               NUMBER;
  
    idReg number; -- numero de id creado para la tabla t29 con resultado de la consulta a la vista de participantes
  
    codBeneficiario NUMBER := 0;
    tipoDocumento   VARCHAR2(2) := NULL;
    documento       VARCHAR2(15) := NULL;
  
    idInscrito NUMBER;
  
    utilizarWs varchar2(100);
    codErrorWs NUMBER;
    msjErrorWs varchar2(2000);
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar participante ' ||
                            p_documento || '-' ||
                            to_char(p_codigoBeneficiario));
  
    codBeneficiario := p_codigobeneficiario;
    tipoDocumento   := p_tipodocumento;
    documento       := p_documento;
  
    -- valida que la fecha de nacimiento no sea nula y sea valida
    IF p_fechaNacimiento IS NULL THEN
      p_codError := 2;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;
  
    Begin
      v_fechaNacimiento := to_date(p_fechaNacimiento, 'yyyy-mm-dd');
    EXCEPTION
      WHEN OTHERS THEN
        p_codError := 37;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
    end;
  
    IF trunc(v_fechaNacimiento) =
       trunc(to_date('0001/01/01', 'yyyy/mm/dd')) THEN
      p_codError := 2;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;
  
    -- Valida que este presente algun dato para busqueda
    IF tipoDocumento IS NULL AND documento IS NULL AND
       p_codigoBeneficiario IS NULL THEN
      p_codError := 3;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    
    END IF;
  
    -- Valida que este presente algun dato para busqueda
    IF tipoDocumento IS NULL AND documento IS NULL AND
       p_codigoBeneficiario = 0 THEN
      p_codError := 3;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    
    END IF;
  
    -- Si esta preente el tipo de documento el numero de documento es requerido
    IF tipoDocumento IS NOT NULL AND documento IS NULL THEN
    
      p_codError := 4;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    
    END IF;
  
    -- si numero documento presente el tipo documento es requerido
    IF tipoDocumento IS NULL AND documento IS NOT NULL THEN
    
      p_codError := 5;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    
    END IF;
  
    -- Es una validacion de la consulta en linea de un inscrito
    if (p_consultaEnLinea = 1) then
    
      Pr_ValidarInscrito(p_tipoDocumento,
                         p_documento,
                         p_codigoBeneficiario,
                         p_fechaNacimiento,
                         p_resultado,
                         p_codError,
                         p_msjError);
    
      return;
    
    end if;
  
    utilizarWs := Pk_Utils.Fn_Obtenervalorparametro('UTILIZARWS');
  
    if (utilizarWs = 'S') then
    
      Pr_ConsultarInscritoWS(codBeneficiario,
                             documento,
                             codErrorWs,
                             msjErrorWs);
    
      if (codErrorWs <> 0) then
        p_codError := 65;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError) || ':' ||
                      msjErrorWs;
        return;
      
      end if;
    
    end if;
  
    -- Si tipo documento y documento estan presentes validar por esos campos
    if tipoDocumento IS NOT NULL AND documento IS NOT NULL then
    
      -- validar que si existe el documento pero esta con otro tipo documento se le informe al usuario el error
    
      select count(1)
        into numReg
        from T01_PARTICIPANTES
       where a01tipodocumento <> p_tipoDocumento
         and a01documento = p_documento;
    
      if (numReg > 0) then
        p_codError := 57;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Validar si existe participante
      select count(1)
        into numReg
        from T01_PARTICIPANTES
       where a01tipodocumento = tipoDocumento
         and a01documento = documento;
    
      -- NO ES BENEFICIARIO
      if (numReg = 0) then
      
        select count(1)
          into numReg
          from t52_candidatos
         where a52tipodocumento = tipoDocumento
           and a52documento = documento;
      
        -- NO ESTA COMO CANDIDATO -> ES UN NUEVO CANDIDATO
        if numReg = 0 THEN
          p_codError := 1;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        else
          -- YA ESTA COMO CANDIDATO
          p_codError := 59;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        
        end if;
      end if;
    
      -- Validar que la fecha de nacimiento corresponda
      select count(1)
        into numReg
        from T01_PARTICIPANTES
       where a01tipodocumento = tipoDocumento
         and a01documento = documento
         and trunc(a01fechanacimiento) = trunc(v_fechaNacimiento);
    
      if (numReg = 0) then
        p_codError := 36;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Validar si el codigo corresponde
      if (p_codigoBeneficiario > 0) then
      
        select t.a01codigobeneficiario
          into codBeneficiario
          from T01_PARTICIPANTES t
         where a01tipodocumento = tipoDocumento
           and a01documento = documento
           and trunc(t.a01fechanacimiento) = trunc(v_fechaNacimiento);
      
        -- Si el codigo de beneficiario esta presente validar que sea el asignado
        if (codBeneficiario <> p_codigoBeneficiario) then
          p_codError := 11;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          Return;
        end if;
      
      end if;
    
      -- OBTENER CODIGO BENEFICIARIO POR DOCUMENTO
      select t.a01codigobeneficiario
        into codBeneficiario
        from T01_PARTICIPANTES t
       where a01tipodocumento = tipoDocumento
         and a01documento = documento
         and trunc(t.a01fechanacimiento) = trunc(v_fechaNacimiento);
    
    end if;
  
    -- Si solo esta presente el codigo de beneficiario validar que sea un participante
    if (p_codigoBeneficiario > 0) then
      --    if (codBeneficiario > 0) then
    
      -- Valida si codigo de beneficiario existe
      select count(1)
        into numReg
        from T01_PARTICIPANTES t
       where t.a01codigobeneficiario = p_codigoBeneficiario;
    
      if (numReg = 0) then
      
        select count(1)
          into numReg
          from t52_candidatos
         where a52codigobeneficiario = p_codigobeneficiario;
      
        -- NO ESTA COMO CANDIDATO -> ES UN NUEVO CANDIDATO
        if numReg = 0 THEN
          p_codError := 1;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        else
          -- YA ESTA COMO CANDIDATO
          p_codError := 59;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        end if;
      
      end if;
    
      -- Valida si la fecha de nacimiento corresponde
      select count(1)
        into numReg
        from T01_PARTICIPANTES t
       where t.a01codigobeneficiario = p_codigoBeneficiario
         and trunc(t.a01fechanacimiento) = trunc(v_fechaNacimiento);
    
      if (numReg = 0) then
        p_codError := 36;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- obtener documento por codigo beneficiario
      select T.A01TIPODOCUMENTO, T.A01DOCUMENTO
        into tipoDocumento, documento
        from T01_PARTICIPANTES t
       where t.a01codigobeneficiario = p_codigoBeneficiario
         and trunc(t.a01fechanacimiento) = trunc(v_fechaNacimiento);
    
    end if;
  
    if tipoDocumento IS NULL AND documento IS NULL then
    
      select T.A01TIPODOCUMENTO, T.A01DOCUMENTO
        into tipoDocumento, documento
        from T01_PARTICIPANTES t
       where t.a01codigobeneficiario = p_codigoBeneficiario
         and trunc(t.a01fechanacimiento) = trunc(v_fechaNacimiento);
    end if;
  
    -- Se debe validar que el particpante no este inscrito activo
    --    if p_tipoDocumento IS NOT NULL AND p_documento IS NOT NULL then
    if tipoDocumento IS NOT NULL AND documento IS NOT NULL then
    
      select count(1)
        into numReg
        from t15_inscritos t
       where t.a15tipodocumento = tipoDocumento
         and t.a15documento = documento
         and t.a15estado <> 'I';
    
      if (numReg > 0) then
      
        --numTalleresDictados := Pk_Ope_Asistencia.Fn_Talleresinscrito(p_documento);
      
        --Validar si ya esta inscrito para el periodo de inscripcio
      
        select T.A15CODIGO
          into idInscrito
          from t15_inscritos t
         where t.a15tipodocumento = tipoDocumento
           and t.a15documento = documento
           and t.a15estado <> 'I';
      
        select count(*)
          into numReg
          from t53_grupoinscrito t
         where (t.A53PERIODO = PK_UTILS.FN_OBTENERPERIODOINSCRIPCION or
               t.A53PERIODO = PK_UTILS.Fn_ObtenerPeriodoVigente)
           and t.a53inscrito = idInscrito;
      
        if numReg > 0 then
          p_codError := 66;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        end if;
      
        -- Se obtiene el numero de aistencias del participante
        numAsistencias := nvl(Pk_Ope_Asistencia.Fn_MaxAsistInscritoPer(documento),
                              0);
        /*
        
                select count(*)
                  into esContingencia
                  from T110_PARTCONTINGENCIAS C
                 where c.a110documento = documento;
                -- Es contingencia y el Faciltiador debe contactarlo
                if esContingencia > 0 then
                  p_codError := 106;
        
                else
        */
        -- Participante certificado y se debe redireccionar a la pagina de Generar Certificado
        if numAsistencias >= 6 then
          p_codError := 105;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
          /*
                      -- Sin asistencias
                    elsif numAsistencias > 0 then
                      -- No es contingencia y debe esperar el proximo periodo
                      p_codError := 107;
                      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          */
        
        else
          p_codError := 60;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        end if;
        --        end if;
      
        OPEN p_resultado FOR
          select a15codigo a01codigo,
                 a15tipodocumento a01tipodocumento,
                 a15documento a01documento,
                 a15codigobeneficiario a01codigobeneficiario,
                 a15primernombre a01primernombre,
                 a15segundonombre a01segundonombre,
                 a15primerapellido a01primerapellido,
                 a15segundoapellido a01segundoapellido,
                 TO_CHAR(a15fechanacimiento, 'YYYY-MM-DD') a01fechanacimiento,
                 NULL a01municipioestudio,
                 NULL a01noconvenio,
                 a15movil a01movil,
                 a15movilalt a01movilalt,
                 a15email a01email,
                 NULL a01finetapapractica,
                 NULL a01finsemestre,
                 NULL a01ultimomes,
                 NULL a01fichasnies,
                 NULL a01nivelformacion,
                 NULL a01sniesies,
                 a15telefono a01telefono,
                 NULL a01tipoformcion,
                 a15estado a01estado,
                 a15fechacreacion a01fechacreacion,
                 a15fechamodificacion a01fechamodificacion,
                 a15usuariocreacion a01usuariocreacion,
                 a15usuariomodificacion a01usuariomodificacion
            FROM T15_INSCRITOS
          --           WHERE a15codigobeneficiario = p_codigoBeneficiario;
           where a15tipodocumento = tipoDocumento
             and a15documento = documento;
      
        return;
      end if;
    
    end if;
  
    -- Guardar datos consultados de vista
    if tipoDocumento IS NOT NULL AND documento IS NOT NULL then
      FOR reg IN c_participanteXDocumento LOOP
        Pk_T29_Consultaparticipantes.Pr_Insertar(reg.a01codigo,
                                                 reg.a01municipioestudio,
                                                 reg.a01tipodocumento,
                                                 reg.a01documento,
                                                 reg.a01codigobeneficiario,
                                                 reg.a01primernombre,
                                                 reg.a01segundonombre,
                                                 reg.a01primerapellido,
                                                 reg.a01segundoapellido,
                                                 reg.a01fechanacimiento,
                                                 reg.a01email,
                                                 reg.a01telefono,
                                                 reg.a01movil,
                                                 reg.a01movilalt,
                                                 reg.a01noconvenio,
                                                 reg.a01estado,
                                                 reg.a01finetapapractica,
                                                 reg.a01finsemestre,
                                                 reg.a01ultimomes,
                                                 reg.a01fichasnies,
                                                 reg.a01nivelformacion,
                                                 reg.a01sniesies,
                                                 reg.a01tipoformcion,
                                                 reg.a01codigo,
                                                 idReg);
      END LOOP;
    else
      FOR reg IN c_participanteXCodigo LOOP
        Pk_T29_Consultaparticipantes.Pr_Insertar(reg.a01codigo,
                                                 reg.a01municipioestudio,
                                                 reg.a01tipodocumento,
                                                 reg.a01documento,
                                                 reg.a01codigobeneficiario,
                                                 reg.a01primernombre,
                                                 reg.a01segundonombre,
                                                 reg.a01primerapellido,
                                                 reg.a01segundoapellido,
                                                 reg.a01fechanacimiento,
                                                 reg.a01email,
                                                 reg.a01telefono,
                                                 reg.a01movil,
                                                 reg.a01movilalt,
                                                 reg.a01noconvenio,
                                                 reg.a01estado,
                                                 reg.a01finetapapractica,
                                                 reg.a01finsemestre,
                                                 reg.a01ultimomes,
                                                 reg.a01fichasnies,
                                                 reg.a01nivelformacion,
                                                 reg.a01sniesies,
                                                 reg.a01tipoformcion,
                                                 reg.a01codigo,
                                                 idReg);
      END LOOP;
    end if;
  
    -- Registrar valor consultado
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    -- retorna informacion del participante  ya sea por documento o codigo
    if tipoDocumento IS NOT NULL AND documento IS NOT NULL then
      OPEN p_resultado FOR
        select a01codigo,
               a01tipodocumento,
               a01documento,
               a01codigobeneficiario,
               a01primernombre,
               a01segundonombre,
               a01primerapellido,
               a01segundoapellido,
               to_char(a01fechanacimiento, 'yyyy-mm-dd') a01fechanacimiento,
               a01municipioestudio,
               a01noconvenio,
               a01movil,
               a01movilalt,
               a01email,
               a01finetapapractica,
               a01finsemestre,
               a01ultimomes,
               a01fichasnies,
               a01nivelformacion,
               a01sniesies,
               a01telefono,
               a01tipoformcion,
               a01estado,
               a01fechacreacion,
               a01fechamodificacion,
               a01usuariocreacion,
               a01usuariomodificacion
          FROM T01_PARTICIPANTES
         WHERE a01tipodocumento = tipoDocumento
           AND a01documento = documento
           AND trunc(a01fechanacimiento) = trunc(v_fechaNacimiento);
    
    else
      OPEN p_resultado FOR
        select a01codigo,
               a01tipodocumento,
               a01documento,
               a01codigobeneficiario,
               a01primernombre,
               a01segundonombre,
               a01primerapellido,
               a01segundoapellido,
               to_char(a01fechanacimiento, 'yyyy-mm-dd') a01fechanacimiento,
               a01municipioestudio,
               a01noconvenio,
               a01movil,
               a01movilalt,
               a01email,
               a01finetapapractica,
               a01finsemestre,
               a01ultimomes,
               a01fichasnies,
               a01nivelformacion,
               a01sniesies,
               a01telefono,
               a01tipoformcion,
               a01estado,
               a01fechacreacion,
               a01fechamodificacion,
               a01usuariocreacion,
               a01usuariomodificacion
          FROM T01_PARTICIPANTES
         WHERE a01codigobeneficiario = p_codigoBeneficiario
           AND trunc(a01fechanacimiento) = trunc(v_fechaNacimiento);
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Fin ' || NOMBRE_PROCEDIMIENTO || ':' ||
                            p_documento);
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ValidarParticipante;

  /********************************************************************************
   DESCRIPCION   : Procedimiento encargado de devolver el periodo activo para la inscripcion
  
   PARAMETROS    :
   IN            :
  
   OUT           : p_resultado       Retorna registro del periodo activo
                   p_codError        Codigo de error generado
                   p_msjError        Mensaje del error generado
  
  REALIZADO POR    : 
                      
  
  FECHA CREACION    : 16/02/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_ObtenerPeriodoVigente(p_resultado OUT PK_UTILS.TY_CURSOR,
                                     p_codError  OUT NUMBER,
                                     p_msjError  OUT VARCHAR2) IS
  
    codExcepcion number;
    numReg       number;
    v_dias       number;
  
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ObtenerPeriodoVigente';
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar periodo vigente ');
  
    select count(*)
      into numReg
      from t12_periodos
     WHERE a12estado = PK_UTILS.COD_ACTIVO;
  
    -- No hay periodo vigente
    if (numReg = 0) then
      p_codError := 7;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    -- Hay mas de un periodo vigente
    if (numReg > 1) then
      p_codError := 8;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    v_dias := Pk_Utils.Fn_Obtenervalorparametro('DIASPREAVISO');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select a12codigo,
             a12nombre,
             to_char(a12fechainicio, 'yyyy-mm-dd') a12fechainicio,
             to_char(a12fechafin, 'yyyy-mm-dd') a12fechafin,
             to_char(a12fechainicio - v_dias, 'yyyy-mm-dd') a12fechapreaviso,
             a12noperiodo,
             a12estado,
             a12fechacreacion,
             a12fechamodificacion,
             a12usuariocreacion,
             a12usuariomodificacion
        FROM T12_PERIODOS
       WHERE a12estado = PK_UTILS.COD_ACTIVO;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta periodo vigente OK ');
  EXCEPTION
    WHEN OTHERS THEN
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ObtenerPeriodoVigente;

  /********************************************************************************
   DESCRIPCION   : Procedimiento encargado de devolver el periodo activo de inscripcion
  
   PARAMETROS    :
   IN            :
  
   OUT           : p_resultado       Retorna registro del periodo activo
                   p_codError        Codigo de error generado
                   p_msjError        Mensaje del error generado
  
  REALIZADO POR    : 
                      
  
  FECHA CREACION    : 15/04/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_ObtenerPeriodoInscripcion(p_resultado OUT PK_UTILS.TY_CURSOR,
                                         p_codError  OUT NUMBER,
                                         p_msjError  OUT VARCHAR2) IS
  
    codExcepcion      number;
    numReg            number;
    v_dias            number;
    v_COD_INSCRIPCION varchar2(5) := PK_UTILS.COD_INSCRIPCION;
  
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ObtenerPeriodoiInscripcion';
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar periodo vigente de inscripcion ');
  
    SELECT COUNT(*)
      INTO numReg
      FROM T12_PERIODOS
     WHERE a12estado = v_COD_INSCRIPCION;
  
    -- No hay periodo vigente
    if (numReg = 0) then
      v_COD_INSCRIPCION := PK_UTILS.COD_ACTIVO;
    
      SELECT COUNT(*)
        INTO numReg
        FROM T12_PERIODOS
       WHERE a12estado = v_COD_INSCRIPCION;
    end if;
    -- No hay periodo vigente
    if (numReg = 0) then
      p_codError := 7;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    -- Hay mas de un periodo vigente
    if (numReg > 1) then
      p_codError := 8;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    v_dias := Pk_Utils.Fn_Obtenervalorparametro('DIASPREAVISO');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select a12codigo,
             a12nombre,
             to_char(a12fechainicio, 'yyyy-mm-dd') a12fechainicio,
             to_char(a12fechafin, 'yyyy-mm-dd') a12fechafin,
             to_char(a12fechainicio - v_dias, 'yyyy-mm-dd') a12fechapreaviso,
             a12noperiodo,
             a12estado,
             a12fechacreacion,
             a12fechamodificacion,
             a12usuariocreacion,
             a12usuariomodificacion
        FROM T12_PERIODOS
       WHERE a12estado = v_COD_INSCRIPCION;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta periodo vigente de inscripcion OK ');
  EXCEPTION
    WHEN OTHERS THEN
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ObtenerPeriodoInscripcion;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para validar y consultar la informacion de los inscritos
  PARAMETROS    :
  IN    :
                   p_tipoDocumento      tipo documento del participante
                   p_documento          docuemnto del participante
                   p_codigoBeneficiario codigo beneficiario del participante
                   p_fechaNacimiento    fecha nnacimiento del participante
                   p_consultaEnLinea    Consulta en linea del participante contra el webservices
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_ValidarBeneficiario(p_tipoDocumento      IN varchar2,
                                   p_documento          IN varchar2,
                                   p_codigoBeneficiario IN number,
                                   p_fechaNacimiento    IN varchar2,
                                   p_consultaEnLinea    IN number,
                                   p_resultado          OUT PK_UTILS.ty_cursor,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2) IS
    v_fechaNacimiento date;
  
    CURSOR c_participanteXDocumento IS
      SELECT *
        FROM T01_PARTICIPANTES
       WHERE a01tipodocumento = p_tipoDocumento
         AND a01documento = p_documento
         AND TRUNC(a01fechanacimiento) = TRUNC(v_fechaNacimiento);
  
    CURSOR c_participanteXCodigo IS
      SELECT *
        FROM T01_PARTICIPANTES t
       WHERE t.a01codigobeneficiario = p_codigoBeneficiario
         AND TRUNC(a01fechanacimiento) = TRUNC(v_fechaNacimiento);
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ValidarBeneficiario';
    numReg               NUMBER;
  
    idReg number; -- numero de id creado para la tabla t29 con resultado de la consulta a la vista de participantes
  
    codBeneficiario NUMBER := 0;
    tipoDocumento   VARCHAR2(2) := NULL;
    documento       VARCHAR2(15) := NULL;
  
    numTalleres     NUMBER := 0;
    numAsistenacias NUMBER := 0;
  
    idInscrito NUMBER;
  
    porcAsistencia number;
  
    utilizarWs varchar2(100);
    codErrorWs NUMBER;
    msjErrorWs varchar2(2000);
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar participante ' ||
                            p_documento || '-' ||
                            to_char(p_codigoBeneficiario));
  
    codBeneficiario := p_codigobeneficiario;
    tipoDocumento   := p_tipodocumento;
    documento       := p_documento;
  
    -- valida que la fecha de nacimiento no sea nula y sea valida
    IF p_fechaNacimiento IS NULL THEN
      p_codError := 2;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;
  
    Begin
      v_fechaNacimiento := to_date(p_fechaNacimiento, 'yyyy-mm-dd');
    EXCEPTION
      WHEN OTHERS THEN
        p_codError := 37;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
    end;
  
    IF trunc(v_fechaNacimiento) =
       trunc(to_date('0001/01/01', 'yyyy/mm/dd')) THEN
      p_codError := 2;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;
  
    -- Valida que este presente algun dato para busqueda
    IF p_tipoDocumento IS NULL AND p_documento IS NULL AND
       p_codigoBeneficiario IS NULL THEN
      p_codError := 3;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    
    END IF;
  
    -- Valida que este presente algun dato para busqueda
    IF p_tipoDocumento IS NULL AND p_documento IS NULL AND
       p_codigoBeneficiario = 0 THEN
      p_codError := 3;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    
    END IF;
  
    -- Si esta preente el tipo de documento el numero de documento es requerido
    IF p_tipoDocumento IS NOT NULL AND p_documento IS NULL THEN
    
      p_codError := 4;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    
    END IF;
  
    -- si numero documento presente el tipo documento es requerido
    IF p_tipoDocumento IS NULL AND p_documento IS NOT NULL THEN
    
      p_codError := 5;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    
    END IF;
  
    -- Es una validacion de la consulta en linea de un inscrito
    if (p_consultaEnLinea = 1) then
    
      Pr_ValidarInscrito(p_tipoDocumento,
                         p_documento,
                         p_codigoBeneficiario,
                         p_fechaNacimiento,
                         p_resultado,
                         p_codError,
                         p_msjError);
    
      return;
    
    end if;
  
    utilizarWs := Pk_Utils.Fn_Obtenervalorparametro('UTILIZARWS');
  
    if (utilizarWs = 'S') then
    
      Pr_ConsultarInscritoWS(codBeneficiario,
                             documento,
                             codErrorWs,
                             msjErrorWs);
    
      if (codErrorWs <> 0) then
        p_codError := 65;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError) || ':' ||
                      msjErrorWs;
        return;
      
      end if;
    
    end if;
  
    -- Si tipo documento y documento estan presentes validar por esos campos
    if p_tipoDocumento IS NOT NULL AND p_documento IS NOT NULL then
    
      -- validar que si existe el documento pero esta con otro tipo documento se le informe al usuario el error
    
      select count(1)
        into numReg
        from T01_PARTICIPANTES
       where a01tipodocumento <> p_tipoDocumento
         and a01documento = p_documento;
    
      if (numReg > 0) then
        p_codError := 57;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Validar si existe participante
      select count(1)
        into numReg
        from T01_PARTICIPANTES
       where a01tipodocumento = p_tipoDocumento
         and a01documento = p_documento;
    
      -- NO ES BENEFICIARIO
      if (numReg = 0) then
      
        select count(1)
          into numReg
          from t52_candidatos
         where a52tipodocumento = p_tipoDocumento
           and a52documento = p_documento;
      
        -- NO ESTA COMO CANDIDATO -> ES UN NUEVO CANDIDATO
        if numReg = 0 THEN
          p_codError := 1;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        else
          -- YA ESTA COMO CANDIDATO
          p_codError := 59;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        
        end if;
      end if;
    
      -- Validar que la fecha de nacimiento corresponda
      select count(1)
        into numReg
        from T01_PARTICIPANTES
       where a01tipodocumento = p_tipoDocumento
         and a01documento = p_documento
         and trunc(a01fechanacimiento) = trunc(v_fechaNacimiento);
    
      if (numReg = 0) then
        p_codError := 36;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Validar si el codigo corresponde
      if (p_codigoBeneficiario > 0) then
      
        select t.a01codigobeneficiario
          into codBeneficiario
          from T01_PARTICIPANTES t
         where a01tipodocumento = p_tipoDocumento
           and a01documento = p_documento
           and trunc(t.a01fechanacimiento) = trunc(v_fechaNacimiento);
      
        -- Si el codigo de beneficiario esta presente validar que sea el asignado
        if (codBeneficiario <> p_codigoBeneficiario) then
          p_codError := 11;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          Return;
        end if;
      
      end if;
    
      -- OBTENER CODIGO BENEFICIARIO POR DOCUMENTO
      select t.a01codigobeneficiario
        into codBeneficiario
        from T01_PARTICIPANTES t
       where a01tipodocumento = p_tipoDocumento
         and a01documento = p_documento
         and trunc(t.a01fechanacimiento) = trunc(v_fechaNacimiento);
    
    end if;
  
    -- Si solo esta presente el codigo de beneficiario validar que sea un participante
    if (p_codigoBeneficiario > 0) then
    
      -- Valida si codigo de beneficiario existe
      select count(1)
        into numReg
        from T01_PARTICIPANTES t
       where t.a01codigobeneficiario = p_codigoBeneficiario;
    
      if (numReg = 0) then
      
        select count(1)
          into numReg
          from t52_candidatos
         where a52codigobeneficiario = p_codigobeneficiario;
      
        -- NO ESTA COMO CANDIDATO -> ES UN NUEVO CANDIDATO
        if numReg = 0 THEN
          p_codError := 1;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        else
          -- YA ESTA COMO CANDIDATO
          p_codError := 59;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        end if;
      
      end if;
    
      -- Valida si la fecha de nacimiento corresponde
      select count(1)
        into numReg
        from T01_PARTICIPANTES t
       where t.a01codigobeneficiario = p_codigoBeneficiario
         and trunc(t.a01fechanacimiento) = trunc(v_fechaNacimiento);
    
      if (numReg = 0) then
        p_codError := 36;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- obtener documento por codigo beneficiario
      select T.A01TIPODOCUMENTO, T.A01DOCUMENTO
        into tipoDocumento, documento
        from T01_PARTICIPANTES t
       where t.a01codigobeneficiario = p_codigoBeneficiario
         and trunc(t.a01fechanacimiento) = trunc(v_fechaNacimiento);
    
    end if;
  
    -- Se debe validar que el particpante no este inscrito activo
    if p_tipoDocumento IS NOT NULL AND p_documento IS NOT NULL then
    
      select count(1)
        into numReg
        from t15_inscritos t
       where t.a15tipodocumento = p_tipoDocumento
         and t.a15documento = p_documento
         and t.a15estado <> 'P';
    
      if (numReg > 0) then
      
        --numTalleresDictados := Pk_Ope_Asistencia.Fn_Talleresinscrito(p_documento);
      
        --Validar si ya esta inscrito para el periodo de inscripcio
      
        select T.A15CODIGO
          into idInscrito
          from t15_inscritos t
         where t.a15tipodocumento = p_tipoDocumento
           and t.a15documento = p_documento
           and t.a15estado <> 'P';
      
        select count(*)
          into numReg
          from t53_grupoinscrito t
         where t.a53periodo = PK_UTILS.Fn_ObtenerPeriodoInscripcion
           and t.a53inscrito = idInscrito;
      
        if numReg > 0 then
          p_codError := 66;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        end if;
      
        -- Numero de talleres a dictar
        select count(*)
          into numTalleres
          from t17_talleres t
         where t.a17estado = 'A';
      
        numAsistenacias := Pk_Ope_Asistencia.Fn_Asistenciasinscrito(documento);
      
        --numFallas := numTalleres - numAsistenacias;
      
        if numTalleres > 0 then
          porcAsistencia := numAsistenacias * 100 / numTalleres;
        else
          porcAsistencia := 100;
        end if;
      
        -- Sin asistencias
        if porcAsistencia = 0 then
          p_codError := 60;
        end if;
      
        -- Asistio a uno, dos o tres talleres
        if porcAsistencia > 0 and porcAsistencia < 40 then
          p_codError := 61;
        end if;
      
        -- Asistio a cuatro o cinco talleres
      
        if porcAsistencia > 40 and porcAsistencia < 70 then
          p_codError := 62;
        end if;
      
        -- Asistio a seis, siete u ocho talleres
        if porcAsistencia > 70 then
          p_codError := 63;
        end if;
      
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      
        OPEN p_resultado FOR
          select a15codigo a01codigo,
                 a15tipodocumento a01tipodocumento,
                 a15documento a01documento,
                 a15codigobeneficiario a01codigobeneficiario,
                 a15primernombre a01primernombre,
                 a15segundonombre a01segundonombre,
                 a15primerapellido a01primerapellido,
                 a15segundoapellido a01segundoapellido,
                 TO_CHAR(a15fechanacimiento, 'YYYY-MM-DD') a01fechanacimiento,
                 NULL a01municipioestudio,
                 NULL a01noconvenio,
                 a15movil a01movil,
                 a15movilalt a01movilalt,
                 a15email a01email,
                 NULL a01finetapapractica,
                 NULL a01finsemestre,
                 NULL a01ultimomes,
                 NULL a01fichasnies,
                 NULL a01nivelformacion,
                 NULL a01sniesies,
                 a15telefono a01telefono,
                 NULL a01tipoformcion,
                 a15estado a01estado,
                 a15fechacreacion a01fechacreacion,
                 a15fechamodificacion a01fechamodificacion,
                 a15usuariocreacion a01usuariocreacion,
                 a15usuariomodificacion a01usuariomodificacion
            FROM T15_INSCRITOS
           WHERE a15tipodocumento = p_tipoDocumento
             AND a15documento = p_documento;
      
        return;
      end if;
    else
      select count(1)
        into numReg
        from t15_inscritos t
       where t.a15codigobeneficiario = p_codigoBeneficiario
         and t.a15estado <> 'P';
    
      if (numReg > 0) then
      
        -- numTalleresDictados := Pk_Ope_Asistencia.Fn_Talleresinscrito(p_documento);
        --Validar si ya esta inscrito para el periodo de inscripcio
      
        select T.A15CODIGO
          into idInscrito
          from t15_inscritos t
         where t.a15codigobeneficiario = p_codigoBeneficiario
           and t.a15estado <> 'P';
      
        select count(*)
          into numReg
          from t53_grupoinscrito t
         where t.a53periodo = PK_UTILS.Fn_ObtenerPeriodoInscripcion
           and t.a53inscrito = idInscrito;
      
        if numReg > 0 then
          p_codError := 66;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        end if;
      
        -- Numero de talleres a dictar
        select count(*)
          into numTalleres
          from t17_talleres t
         where t.a17estado = 'A';
      
        numAsistenacias := Pk_Ope_Asistencia.Fn_Asistenciasinscrito(documento);
      
        --numFallas := numTalleres - numAsistenacias;
      
        if numTalleres > 0 then
          porcAsistencia := numAsistenacias * 100 / numTalleres;
        else
          porcAsistencia := 100;
        end if;
      
        -- Sin asistencias
        if porcAsistencia = 0 then
          p_codError := 60;
        end if;
      
        -- Asistio a uno, dos o tres talleres
        if porcAsistencia > 0 and porcAsistencia < 40 then
          p_codError := 61;
        end if;
      
        -- Asistio a cuatro o cinco talleres
      
        if porcAsistencia > 40 and porcAsistencia < 70 then
          p_codError := 62;
        end if;
      
        -- Asistio a seis, siete u ocho talleres
        if porcAsistencia > 70 then
          p_codError := 63;
        end if;
      
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      
        OPEN p_resultado FOR
          select a15codigo a01codigo,
                 a15tipodocumento a01tipodocumento,
                 a15documento a01documento,
                 a15codigobeneficiario a01codigobeneficiario,
                 a15primernombre a01primernombre,
                 a15segundonombre a01segundonombre,
                 a15primerapellido a01primerapellido,
                 a15segundoapellido a01segundoapellido,
                 TO_CHAR(a15fechanacimiento, 'YYYY-MM-DD') a01fechanacimiento,
                 NULL a01municipioestudio,
                 NULL a01noconvenio,
                 a15movil a01movil,
                 a15movilalt a01movilalt,
                 a15email a01email,
                 NULL a01finetapapractica,
                 NULL a01finsemestre,
                 NULL a01ultimomes,
                 NULL a01fichasnies,
                 NULL a01nivelformacion,
                 NULL a01sniesies,
                 a15telefono a01telefono,
                 NULL a01tipoformcion,
                 a15estado a01estado,
                 a15fechacreacion a01fechacreacion,
                 a15fechamodificacion a01fechamodificacion,
                 a15usuariocreacion a01usuariocreacion,
                 a15usuariomodificacion a01usuariomodificacion
            FROM T15_INSCRITOS
           WHERE a15codigobeneficiario = p_codigoBeneficiario;
      
        return;
      end if;
    
    end if;
  
    -- Guardar datos consultados de vista
    if p_tipoDocumento IS NOT NULL AND p_documento IS NOT NULL then
      FOR reg IN c_participanteXDocumento LOOP
        Pk_T29_Consultaparticipantes.Pr_Insertar(reg.a01codigo,
                                                 reg.a01municipioestudio,
                                                 reg.a01tipodocumento,
                                                 reg.a01documento,
                                                 reg.a01codigobeneficiario,
                                                 reg.a01primernombre,
                                                 reg.a01segundonombre,
                                                 reg.a01primerapellido,
                                                 reg.a01segundoapellido,
                                                 reg.a01fechanacimiento,
                                                 reg.a01email,
                                                 reg.a01telefono,
                                                 reg.a01movil,
                                                 reg.a01movilalt,
                                                 reg.a01noconvenio,
                                                 reg.a01estado,
                                                 reg.a01finetapapractica,
                                                 reg.a01finsemestre,
                                                 reg.a01ultimomes,
                                                 reg.a01fichasnies,
                                                 reg.a01nivelformacion,
                                                 reg.a01sniesies,
                                                 reg.a01tipoformcion,
                                                 reg.a01codigo,
                                                 idReg);
      END LOOP;
    else
      FOR reg IN c_participanteXCodigo LOOP
        Pk_T29_Consultaparticipantes.Pr_Insertar(reg.a01codigo,
                                                 reg.a01municipioestudio,
                                                 reg.a01tipodocumento,
                                                 reg.a01documento,
                                                 reg.a01codigobeneficiario,
                                                 reg.a01primernombre,
                                                 reg.a01segundonombre,
                                                 reg.a01primerapellido,
                                                 reg.a01segundoapellido,
                                                 reg.a01fechanacimiento,
                                                 reg.a01email,
                                                 reg.a01telefono,
                                                 reg.a01movil,
                                                 reg.a01movilalt,
                                                 reg.a01noconvenio,
                                                 reg.a01estado,
                                                 reg.a01finetapapractica,
                                                 reg.a01finsemestre,
                                                 reg.a01ultimomes,
                                                 reg.a01fichasnies,
                                                 reg.a01nivelformacion,
                                                 reg.a01sniesies,
                                                 reg.a01tipoformcion,
                                                 reg.a01codigo,
                                                 idReg);
      END LOOP;
    end if;
  
    -- Registrar valor consultado
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    -- retorna informacion del participante  ya sea por documento o codigo
    if p_tipoDocumento IS NOT NULL AND p_documento IS NOT NULL then
      OPEN p_resultado FOR
        select a01codigo,
               a01tipodocumento,
               a01documento,
               a01codigobeneficiario,
               a01primernombre,
               a01segundonombre,
               a01primerapellido,
               a01segundoapellido,
               to_char(a01fechanacimiento, 'yyyy-mm-dd') a01fechanacimiento,
               a01municipioestudio,
               a01noconvenio,
               a01movil,
               a01movilalt,
               a01email,
               a01finetapapractica,
               a01finsemestre,
               a01ultimomes,
               a01fichasnies,
               a01nivelformacion,
               a01sniesies,
               a01telefono,
               a01tipoformcion,
               a01estado,
               a01fechacreacion,
               a01fechamodificacion,
               a01usuariocreacion,
               a01usuariomodificacion
          FROM T01_PARTICIPANTES
         WHERE a01tipodocumento = p_tipoDocumento
           AND a01documento = p_documento
           AND trunc(a01fechanacimiento) = trunc(v_fechaNacimiento);
    
    else
      OPEN p_resultado FOR
        select a01codigo,
               a01tipodocumento,
               a01documento,
               a01codigobeneficiario,
               a01primernombre,
               a01segundonombre,
               a01primerapellido,
               a01segundoapellido,
               to_char(a01fechanacimiento, 'yyyy-mm-dd') a01fechanacimiento,
               a01municipioestudio,
               a01noconvenio,
               a01movil,
               a01movilalt,
               a01email,
               a01finetapapractica,
               a01finsemestre,
               a01ultimomes,
               a01fichasnies,
               a01nivelformacion,
               a01sniesies,
               a01telefono,
               a01tipoformcion,
               a01estado,
               a01fechacreacion,
               a01fechamodificacion,
               a01usuariocreacion,
               a01usuariomodificacion
          FROM T01_PARTICIPANTES
         WHERE a01codigobeneficiario = p_codigoBeneficiario
           AND trunc(a01fechanacimiento) = trunc(v_fechaNacimiento);
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  participante ok ' || p_documento);
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ValidarBeneficiario;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para validar y consultar la informacion de los inscritos
                   para periodo 3 y 4
  PARAMETROS    :
  IN    :
                   p_tipoDocumento      tipo documento del participante
                   p_documento          docuemnto del participante
                   p_codigoBeneficiario codigo beneficiario del participante
                   p_fechaNacimiento    fecha nnacimiento del participante
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_ValidarInscrito(p_tipoDocumento      IN varchar2,
                               p_documento          IN varchar2,
                               p_codigoBeneficiario IN number,
                               p_fechaNacimiento    IN varchar2,
                               p_resultado          OUT PK_UTILS.ty_cursor,
                               p_codError           OUT NUMBER,
                               p_msjError           OUT VARCHAR2) IS
  
    v_fechaNacimiento date;
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ValidarInscrito';
    numReg               NUMBER;
  
    codBeneficiario NUMBER := 0;
    tipoDocumento   VARCHAR2(2) := NULL;
    documento       VARCHAR2(15) := NULL;
  
  BEGIN
  
    v_fechaNacimiento := to_date(p_fechaNacimiento, 'yyyy-mm-dd');
  
    codBeneficiario := p_codigobeneficiario;
    tipoDocumento   := p_tipodocumento;
    documento       := p_documento;
  
    if p_tipoDocumento IS NOT NULL AND p_documento IS NOT NULL then
    
      -- validar que si existe el documento pero esta con otro tipo documento se le informe al usuario el error
    
      select count(1)
        into numReg
        from t15_inscritos
       where a15tipodocumento <> p_tipoDocumento
         and a15documento = p_documento;
    
      if (numReg > 0) then
        p_codError := 57;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Validar si existe participante
      select count(1)
        into numReg
        from t15_inscritos
       where a15tipodocumento = p_tipoDocumento
         and a15documento = p_documento
         and a15estado = 'A';
    
      -- No esta inscrito
      if (numReg = 0) then
        p_codError := 1;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Validar que la fecha de nacimiento corresponda
      select count(1)
        into numReg
        from t15_inscritos
       where a15tipodocumento = p_tipoDocumento
         and a15documento = p_documento
         and trunc(a15fechanacimiento) = trunc(v_fechaNacimiento);
    
      if (numReg = 0) then
        p_codError := 36;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Validar si el codigo corresponde
      if (p_codigoBeneficiario > 0) then
      
        select a15codigobeneficiario
          into codBeneficiario
          from t15_inscritos
         where a15tipodocumento = p_tipoDocumento
           and a15documento = p_documento
           and trunc(a15fechanacimiento) = trunc(v_fechaNacimiento);
      
        -- Si el codigo de beneficiario esta presente validar que sea el asignado
        if (codBeneficiario <> p_codigoBeneficiario) then
          p_codError := 11;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          Return;
        end if;
      
      end if;
    
      -- OBTENER CODIGO BENEFICIARIO POR DOCUMENTO
      select a15codigobeneficiario
        into codBeneficiario
        from t15_inscritos t
       where a15tipodocumento = p_tipoDocumento
         and a15documento = p_documento
         and trunc(a15fechanacimiento) = trunc(v_fechaNacimiento);
    
    end if;
  
    -- Si solo esta presente el codigo de beneficiario validar que sea un participante
    if (p_codigoBeneficiario > 0) then
    
      -- Valida si codigo de beneficiario existe
      select count(1)
        into numReg
        from t15_inscritos
       where a15codigobeneficiario = p_codigoBeneficiario;
    
      -- No esta inscrito
      if numReg = 0 THEN
        p_codError := 1;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Valida si la fecha de nacimiento corresponde
      select count(1)
        into numReg
        from t15_inscritos
       where a15codigobeneficiario = p_codigoBeneficiario
         and trunc(a15fechanacimiento) = trunc(v_fechaNacimiento);
    
      if (numReg = 0) then
        p_codError := 36;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- obtener documento por codigo beneficiario
      select A15TIPODOCUMENTO, A15DOCUMENTO
        into tipoDocumento, documento
        from t15_inscritos t
       where a15codigobeneficiario = p_codigoBeneficiario
         and trunc(a15fechanacimiento) = trunc(v_fechaNacimiento);
    
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    -- Registrar valor consultado
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    -- retorna informacion del participante  ya sea por documento o codigo
    if p_tipoDocumento IS NOT NULL AND p_documento IS NOT NULL then
      OPEN p_resultado FOR
        select a15codigo a01codigo,
               a15tipodocumento a01tipodocumento,
               a15documento a01documento,
               a15codigobeneficiario a01codigobeneficiario,
               a15primernombre a01primernombre,
               a15segundonombre a01segundonombre,
               a15primerapellido a01primerapellido,
               a15segundoapellido a01segundoapellido,
               to_char(a15fechanacimiento, 'yyyy-mm-dd') a01fechanacimiento,
               '' a01municipioestudio,
               '' a01noconvenio,
               a15movil a01movil,
               a15movilalt a01movilalt,
               a15email a01email,
               '' a01finetapapractica,
               '' a01finsemestre,
               '' a01ultimomes,
               '' a01fichasnies,
               '' a01nivelformacion,
               '' a01sniesies,
               a15telefono a01telefono,
               '' a01tipoformcion,
               a15estado a01estado,
               a15fechacreacion a01fechacreacion,
               a15fechamodificacion a01fechamodificacion,
               a15usuariocreacion a01usuariocreacion,
               a15usuariomodificacion a01usuariomodificacion
          FROM t15_inscritos
         WHERE a15tipodocumento = p_tipoDocumento
           AND a15documento = p_documento
           AND trunc(a15fechanacimiento) = trunc(v_fechaNacimiento);
    
    else
      OPEN p_resultado FOR
        select a15codigo a01codigo,
               a15tipodocumento a01tipodocumento,
               a15documento a01documento,
               a15codigobeneficiario a01codigobeneficiario,
               a15primernombre a01primernombre,
               a15segundonombre a01segundonombre,
               a15primerapellido a01primerapellido,
               a15segundoapellido a01segundoapellido,
               to_char(a15fechanacimiento, 'yyyy-mm-dd') a01fechanacimiento,
               '' a01municipioestudio,
               '' a01noconvenio,
               a15movil a01movil,
               a15movilalt a01movilalt,
               a15email a01email,
               '' a01finetapapractica,
               '' a01finsemestre,
               '' a01ultimomes,
               '' a01fichasnies,
               '' a01nivelformacion,
               '' a01sniesies,
               a15telefono a01telefono,
               '' a01tipoformcion,
               a15estado a01estado,
               a15fechacreacion a01fechacreacion,
               a15fechamodificacion a01fechamodificacion,
               a15usuariocreacion a01usuariocreacion,
               a15usuariomodificacion a01usuariomodificacion
          FROM t15_inscritos
         WHERE a15codigobeneficiario = p_codigoBeneficiario
           AND trunc(a15fechanacimiento) = trunc(v_fechaNacimiento);
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  participante ok ' || p_documento);
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ValidarInscrito;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para validar el correo electronico del Participante
  PARAMETROS    :
  IN    :
             p_correo             Correo del participante
             p_tipoDocumento      tipo de docuemnto del participante
             p_documento          documento del participante
  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ValidarCorreo(p_correo             IN VARCHAR2,
                             p_tipoDocumento      IN varchar2,
                             p_documento          IN varchar2,
                             p_codigoBeneficiario IN number,
                             p_codError           OUT NUMBER,
                             p_msjError           OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ValidarCorreo';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar correo existente ');
  
    -- Verifica si el correo no esta utilizado por algun inscrito anterior
    if (p_codigoBeneficiario > 0) then
      select count(1)
        into numReg
        from t15_inscritos t
       where t.a15email = p_correo
         and t.a15codigobeneficiario <> p_codigoBeneficiario;
    else
      select count(1)
        into numReg
        from t15_inscritos t
       where t.a15email = p_correo
         and t.a15tipodocumento <> p_tipoDocumento
         and t.a15documento <> p_documento;
    end if;
  
    IF numReg > 0 THEN
      p_codError := 6;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta correo existente OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ValidarCorreo;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los departamentos disponibles para
                   dictar el taller
  PARAMETROS    :
  IN    :
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarDepartamentos(p_resultado OUT PK_UTILS.ty_cursor,
                                p_codError  OUT NUMBER,
                                p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarDepartamentos';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar departamentos ');
    select count(*)
      into numReg
      from T02_DEPARTAMENTOS
     WHERE a02estado = PK_UTILS.COD_ACTIVO;
  
    if (numReg = 0) then
      p_codError := 13;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select a02codigo,
             upper(a02nombre) a02nombre,
             a02dane,
             a02indicativo,
             a02estado,
             a02fechacreacion,
             a02fechamodificacion,
             a02usuariocreacion,
             a02usuariomodificacion
        from T02_DEPARTAMENTOS
       WHERE a02estado = PK_UTILS.COD_ACTIVO
       order by a02nombre;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta departamentos OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarDepartamentos;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar las ciudades disponibles por departamento
                   para dictar el taller
  PARAMETROS    :
  IN    :
           p_idDepartamento id del departamento a consultar
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarMunicipiosXDepto(p_idDepartamento IN number,
                                   p_resultado      OUT PK_UTILS.ty_cursor,
                                   p_codError       OUT NUMBER,
                                   p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarMunicipiosXDepto';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar municipio por departamentos ');
  
    select count(*)
      into numReg
      FROM T03_MUNICIPIOS t
     WHERE a03departamento = p_idDepartamento
       AND t.a03estado = PK_UTILS.COD_ACTIVO;
  
    if (numReg = 0) then
      p_codError := 14;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select a03codigo,
             a03departamento,
             upper(a03nombre) a03nombre,
             a03dane,
             a03estado,
             a03fechacreacion,
             a03fechamodificacion,
             a03usuariocreacion,
             a03usuariomodificacion
        FROM T03_MUNICIPIOS t
       WHERE a03departamento = p_idDepartamento
         AND t.a03estado = PK_UTILS.COD_ACTIVO
       order by a03nombre;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta municipios por departamentos OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarMunicipiosXDepto;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los dias disponibles por ciudad
                   para dictar el taller
  PARAMETROS    :
  IN    :
           p_idMunicipio id del municipios a consultar
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 18/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarDiasDisponibles(p_idMunicipio IN number,
                                  p_resultado   OUT PK_UTILS.ty_cursor,
                                  p_codError    OUT NUMBER,
                                  p_msjError    OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarDiasDisponibles';
    numReg               NUMBER;
    codPeriodo           number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar dias disponibles por municipio ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    -- VALIDAR QUE EL SELECT TENGA REGISTROS
    select count(*)
      into numReg
      FROM T23_DIAS, T26_GRUPOSFACILITADOR
     WHERE a26ciudad = p_idMunicipio
       AND a26dia = a23codigo
       AND a26periodo = codPeriodo
       AND a26estado = PK_UTILS.COD_ACTIVO;
  
    if (numReg = 0) then
      p_codError := 15;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      SELECT DISTINCT a23codigo, a23nombre
        FROM T23_DIAS, T26_GRUPOSFACILITADOR
       WHERE a26ciudad = p_idMunicipio
         AND a26dia = a23codigo
         AND a26periodo = codPeriodo
         AND a26estado = PK_UTILS.COD_ACTIVO;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta dias disponibles por municipio OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarDiasDisponibles;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los horarios disponibles por dia
                   para dictar el taller
  PARAMETROS    :
  IN    :
           p_idMunicipio  id del municipios a consultar
           p_dia  id del dia a consultar
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 18/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarHorariosDisponibles(p_idMunicipio IN NUMBER,
                                      p_dia         IN NUMBER,
                                      p_resultado   OUT PK_UTILS.ty_cursor,
                                      p_codError    OUT NUMBER,
                                      p_msjError    OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarHorariosDisponibles';
    numReg               NUMBER;
  
    codPeriodo number;
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar horarios disponibles por municipio y dia ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    -- VALIDAR QUE EL SELECT TENGA REGISTROS
    select count(*)
      into numReg
      FROM T24_HORARIOS, T26_GRUPOSFACILITADOR
     WHERE a26ciudad = p_idMunicipio
       AND a26dia = p_dia
       AND a26periodo = codPeriodo
       AND a26horario = a24codigo
       AND a26estado = PK_UTILS.COD_ACTIVO;
  
    if (numReg = 0) then
      p_codError := 16;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      SELECT DISTINCT a24codigo, a24horario
        FROM T24_HORARIOS, T26_GRUPOSFACILITADOR
       WHERE a26ciudad = p_idMunicipio
         AND a26dia = p_dia
         AND a26periodo = codPeriodo
         AND a26horario = a24codigo
         AND a26estado = PK_UTILS.COD_ACTIVO
       ORDER BY a24horario;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta horarios disponibles por municipio y dia OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarHorariosDisponibles;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los lugares disponibles por horario
                   para dictar el taller
  PARAMETROS    :
  IN    :
           p_idMunicipio  id del municipios a consultar
           p_dia  id del dia a consultar
           p_horario  id del horario a consultar
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 18/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarLugaresDisponibles(p_idMunicipio IN NUMBER,
                                     p_dia         IN NUMBER,
                                     p_horario     IN NUMBER,
                                     p_resultado   OUT PK_UTILS.ty_cursor,
                                     p_codError    OUT NUMBER,
                                     p_msjError    OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarLugaresDisponibles';
    numReg               NUMBER;
    numCupos             NUMBER;
  
    codPeriodo number;
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar lugares disponibles por municipio, dia y horario ');
  
    numCupos := TO_NUMBER(Pk_Utils.Fn_Obtenervalorparametro('CUPOS'));
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    -- VALIDAR QUE EL SELECT TENGA REGISTROS
    select count(*)
      into numReg
      FROM T26_GRUPOSFACILITADOR
     WHERE a26ciudad = p_idMunicipio
       AND a26dia = p_dia
       AND a26horario = p_horario
       AND a26periodo = codPeriodo
       AND a26estado = PK_UTILS.COD_ACTIVO;
  
    if (numReg = 0) then
      p_codError := 17;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    -- validar que el lugar tenga cupos disponibles
    /*    select count(*)
     into numReg
     FROM T26_GRUPOSFACILITADOR, T15_INSCRITOS
    WHERE a26ciudad = p_idMunicipio
      AND a26dia = p_dia
      AND a26horario = p_horario
      AND a26periodo = codPeriodo
      AND a26estado = PK_UTILS.COD_ACTIVO
      AND a26codigo = a15grupofacilitador;*/
  
    select count(*)
      into numReg
      from (select a26codigo,
                   (select count(*)
                      from T15_INSCRITOS i
                     where i.a15grupofacilitador = t.a26codigo
                       and i.a15estado = 'A') inscritos
              from T26_GRUPOSFACILITADOR t
             where t.a26estado = 'A'
               and t.a26periodo = codPeriodo
               and t.a26ciudad = p_idMunicipio
               AND t.a26dia = p_dia
               AND t.a26horario = p_horario) a
     where a.inscritos < numCupos;
  
    if (numReg = 0) then
      p_codError := 18;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select *
        from (select a26codigo,
                     (a26lugar || '-' || a26direccion) a26lugar,
                     a26direccion,
                     (select count(*)
                        from T15_INSCRITOS i
                       where i.a15grupofacilitador = t.a26codigo
                         and i.a15estado = 'A') inscritos
                from T26_GRUPOSFACILITADOR t
               where t.a26estado = 'A'
                 and t.a26periodo = codPeriodo
                 and t.a26ciudad = p_idMunicipio
                 AND t.a26dia = p_dia
                 AND t.a26horario = p_horario) a
       where a.inscritos < numCupos
       order by a26lugar;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta lugares disponibles por municipio, dia y horario OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarLugaresDisponibles;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para realizar el proceso de inscripcion del participante al taller
                   para guardar la inscripcion del participante
  
  PARAMETROS    :
  IN    :
          p_esBeneficiario  -- 1 es participante valido , 0: No es participante valido
          p_grupofacilitador id del grupo facilitador del participante
          p_tipodocumento  tipo de docuemnto del participante
          p_documento documento del participante
          p_codigobeneficiario codigo beneficiario del participante
          p_primernombre del participante
          p_segundonombre del participante
          p_primerapellido del participante
          p_segundoapellido del participante
          p_fechanacimiento del participante
          p_email del participante
          p_telefono del participante
          p_movil del participante
          p_movilalt del participante
          p_confirmacion del participante
          p_estado del participante
          p_usuario del participante
  
  OUT    :
          p_codigo
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 18/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_GuardarInscripcion(p_esBeneficiario     IN NUMBER, -- 1 es participante valido , 0: No es participante valido
                                  p_grupofacilitador   IN NUMBER,
                                  p_tipodocumento      IN VARCHAR2,
                                  p_documento          IN VARCHAR2,
                                  p_codigobeneficiario IN NUMBER,
                                  p_primernombre       IN VARCHAR2,
                                  p_segundonombre      IN VARCHAR2,
                                  p_primerapellido     IN VARCHAR2,
                                  p_segundoapellido    IN VARCHAR2,
                                  p_fechanacimiento    IN VARCHAR2, -- YYYY-MM-DD
                                  p_email              IN VARCHAR2,
                                  p_telefono           IN VARCHAR2,
                                  p_movil              IN VARCHAR2,
                                  p_movilalt           IN VARCHAR2,
                                  p_condicionEspecial  IN NUMBER,
                                  p_encuesta           IN VARCHAR2,
                                  p_codigoInscripcion  OUT NUMBER,
                                  p_codError           OUT NUMBER,
                                  p_msjError           OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_GuardarInscripcion';
    numReg               NUMBER;
  
    codPeriodoIns NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a guardar inscripcion ' || p_documento);
  
    codPeriodoIns := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    if (codPeriodoIns <= 2) then
    
      pk_ali_inscripcion.pr_guardarinscripcion2(p_esbeneficiario,
                                                p_grupofacilitador,
                                                p_tipodocumento,
                                                p_documento,
                                                p_codigobeneficiario,
                                                p_primernombre,
                                                p_segundonombre,
                                                p_primerapellido,
                                                p_segundoapellido,
                                                p_fechanacimiento,
                                                p_email,
                                                p_telefono,
                                                p_movil,
                                                p_movilalt,
                                                p_condicionespecial,
                                                p_encuesta,
                                                p_codigoinscripcion,
                                                p_coderror,
                                                p_msjerror);
    else
      pk_ali_inscripcion.pr_guardarinscripcion3(p_esbeneficiario,
                                                p_grupofacilitador,
                                                p_tipodocumento,
                                                p_documento,
                                                p_codigobeneficiario,
                                                p_primernombre,
                                                p_segundonombre,
                                                p_primerapellido,
                                                p_segundoapellido,
                                                p_fechanacimiento,
                                                p_email,
                                                p_telefono,
                                                p_movil,
                                                p_movilalt,
                                                p_condicionespecial,
                                                p_encuesta,
                                                p_codigoinscripcion,
                                                p_coderror,
                                                p_msjerror);
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Guardar inscripcion OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_GuardarInscripcion;

  /********************************************************************************
    DESCRIPCION    : Procedimiento para realizar el proceso de inscripcion del participante al taller metodo utilizado para periodo 2 de 2016
  
    PARAMETROS    :
    IN    :
            p_esBeneficiario  -- 1 es participante valido , 0: No es participante valido
            p_grupofacilitador
            p_tipodocumento
            p_documento
            p_codigobeneficiario
            p_primernombre
            p_segundonombre
            p_primerapellido
            p_segundoapellido
            p_fechanacimiento
            p_email
            p_telefono
            p_movil
            p_movilalt
            p_confirmacion
            p_estado
            p_usuario
  
    OUT    :
            p_codigo
            p_codError        Codigo de error generado
            p_msjError        Mensaje del error generado
  
  
    REALIZADO POR    : 
    FECHA CREACION    : 18/02/2016
    MODIFICADO POR    :
    FECHA MODIFICA    :
    CAMBIOS    :
  --------------------------------------------------------------------------------*/

  PROCEDURE Pr_GuardarInscripcion2(p_esBeneficiario     IN NUMBER, -- 1 es participante valido , 0: No es participante valido
                                   p_grupofacilitador   IN NUMBER,
                                   p_tipodocumento      IN VARCHAR2,
                                   p_documento          IN VARCHAR2,
                                   p_codigobeneficiario IN NUMBER,
                                   p_primernombre       IN VARCHAR2,
                                   p_segundonombre      IN VARCHAR2,
                                   p_primerapellido     IN VARCHAR2,
                                   p_segundoapellido    IN VARCHAR2,
                                   p_fechanacimiento    IN VARCHAR2, -- YYYY-MM-DD
                                   p_email              IN VARCHAR2,
                                   p_telefono           IN VARCHAR2,
                                   p_movil              IN VARCHAR2,
                                   p_movilalt           IN VARCHAR2,
                                   p_condicionEspecial  IN NUMBER,
                                   p_encuesta           IN VARCHAR2,
                                   p_codigoInscripcion  OUT NUMBER,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_GuardarInscripcion2';
    numReg               NUMBER;
  
    CURSOR c_participanteXDocumento IS
      SELECT a01codigobeneficiario
        FROM T01_PARTICIPANTES
       WHERE a01tipodocumento = p_tipoDocumento
         AND a01documento = p_documento;
  
    CURSOR c_participanteXCodigo IS
      SELECT a01tipodocumento, a01documento
        FROM T01_PARTICIPANTES t
       WHERE t.a01codigobeneficiario = p_codigoBeneficiario;
  
    codBeneficiario NUMBER := 0;
    tipoDocumento   VARCHAR2(2) := NULL;
    documento       VARCHAR2(15) := NULL;
    codPeriodoIns   NUMBER;
    estado          CHAR(1);
    codigoEncuesta  NUMBER;
    numCupos        NUMBER;
    p_a52codigo     NUMBER;
  
    numTalleres     number;
    numAsistenacias number;
    porcAsistencia  number;
    inscrito        number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a guardar inscripcion ' ||
                            to_char(p_esBeneficiario));
  
    p_codigoInscripcion := 0;
  
    codPeriodoIns := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    numCupos := TO_NUMBER(Pk_Utils.Fn_Obtenervalorparametro('CUPOS'));
  
    codBeneficiario := p_codigobeneficiario;
    tipoDocumento   := p_tipodocumento;
    documento       := p_documento;
  
    IF p_esBeneficiario = 1 THEN
    
      -- Valida que este presente algun dato para busqueda
      IF p_tipoDocumento IS NULL AND p_documento IS NULL AND
         (p_codigobeneficiario IS NULL OR p_codigobeneficiario = 0) THEN
      
        p_codError := 3;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
      END IF;
    
      -- Si esta presente el tipo de documento el numero de documento es requerido
      IF p_tipoDocumento IS NOT NULL AND p_documento IS NULL THEN
      
        p_codError := 4;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
      END IF;
    
      -- si numero documento presente el tipo documento es requerido
      IF p_tipoDocumento IS NULL AND p_documento IS NOT NULL THEN
      
        p_codError := 5;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
      END IF;
    
      IF p_codigobeneficiario IS NULL OR p_codigobeneficiario = 0 THEN
      
        OPEN c_participanteXDocumento;
        FETCH c_participanteXDocumento
          INTO codBeneficiario;
        CLOSE c_participanteXDocumento;
      
      END IF;
    
      IF p_tipodocumento IS NULL AND p_documento IS NULL THEN
      
        OPEN c_participanteXCodigo;
        FETCH c_participanteXCodigo
          INTO tipoDocumento, documento;
        CLOSE c_participanteXCodigo;
      
      END IF;
    
      select count(*)
        into inscrito
        from t15_inscritos t
       where t.a15codigobeneficiario = codBeneficiario;
    
      if inscrito > 0 then
      
        -- Numero de talleres a dictar
        select count(*)
          into numTalleres
          from t17_talleres t
         where t.a17estado = 'A';
      
        numAsistenacias := Pk_Ope_Asistencia.Fn_Asistenciasinscrito(p_documento);
      
        --numFallas := numTalleres - numAsistenacias;
      
        if numTalleres > 0 then
          porcAsistencia := numAsistenacias * 100 / numTalleres;
        else
          porcAsistencia := 100;
        end if;
      
        -- Esta inscrito pero no ha asitido a ningun taller validar cupos disponibles
      
        if porcAsistencia = 0 and inscrito = 1 then
        
          SELECT COUNT(*)
            INTO numReg
            FROM T26_GRUPOSFACILITADOR, T15_INSCRITOS
           WHERE a26codigo = p_grupofacilitador
             AND a26codigo = a15grupofacilitador
             AND a26periodo = codPeriodoIns
             AND a26estado = PK_UTILS.COD_ACTIVO;
        
          IF (numReg >= numCupos) THEN
            p_codError := 18;
            p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
            RETURN;
          END IF;
        
        end if;
      end if;
    
      -- si es beneficiario y no esta inscrito validar cupos disponibles
      if inscrito = 0 then
        SELECT COUNT(*)
          INTO numReg
          FROM T26_GRUPOSFACILITADOR, T15_INSCRITOS
         WHERE a26codigo = p_grupofacilitador
           AND a26codigo = a15grupofacilitador
           AND a26periodo = codPeriodoIns
           AND a26estado = PK_UTILS.COD_ACTIVO;
      
        IF (numReg >= numCupos) THEN
          p_codError := 18;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          RETURN;
        END IF;
      end if;
      estado := PK_UTILS.INS_ACTIVO;
    ELSE
    
      -- Valida que este presente algun dato para busqueda
      IF p_tipoDocumento IS NULL AND p_documento IS NULL AND
         (p_codigobeneficiario IS NULL OR p_codigobeneficiario = 0) THEN
      
        p_codError := 3;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
      END IF;
    
      -- Si esta presente el tipo de documento el numero de documento es requerido
      IF p_tipoDocumento IS NOT NULL AND p_documento IS NULL THEN
      
        p_codError := 4;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
      END IF;
    
      -- si numero documento presente el tipo documento es requerido
      IF p_tipoDocumento IS NULL AND p_documento IS NOT NULL THEN
      
        p_codError := 5;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
      END IF;
    
      estado := PK_UTILS.INS_PENDIENTE;
    
    END IF;
  
    select count(*)
      into inscrito
      from t15_inscritos t
     where t.a15codigobeneficiario = codBeneficiario;
  
    -- si no esta inscrito y no es beneficiario inscribirlo en la t52 de interesados
    if inscrito = 0 and p_esBeneficiario = 0 then
    
      if p_codigobeneficiario = 0 then
        select count(*)
          into numReg
          from t52_candidatos t
         where t.a52tipodocumento = p_tipoDocumento
           and t.a52documento = documento;
      else
        select count(*)
          into numReg
          from t52_candidatos t
         where t.a52codigobeneficiario = p_codigobeneficiario;
      end if;
    
      if numReg = 0 then
      
        Pk_T52_Candidatos.Pr_Insertar(p_tipoDocumento,
                                      p_documento,
                                      codBeneficiario,
                                      p_primernombre,
                                      p_segundonombre,
                                      p_primerapellido,
                                      p_segundoapellido,
                                      to_date(p_fechanacimiento,
                                              'yyyy-mm-dd'),
                                      p_email,
                                      p_telefono,
                                      p_movil,
                                      p_movilalt,
                                      p_condicionEspecial,
                                      'P',
                                      codPeriodoIns,
                                      0,
                                      p_a52codigo);
      
      else
      
        if p_codigobeneficiario = 0 then
        
          update t52_candidatos
             set a52primernombre        = p_primernombre,
                 a52segundonombre       = p_segundonombre,
                 a52primerapellido      = p_primerapellido,
                 a52segundoapellido     = p_segundoapellido,
                 a52fechanacimiento     = to_date(p_fechanacimiento,
                                                  'yyyy-mm-dd'),
                 a52email               = p_email,
                 a52telefono            = p_telefono,
                 a52movil               = p_movil,
                 a52movilalt            = p_movilalt,
                 a52fechamodificacion   = sysdate,
                 a52usuariomodificacion = 0,
                 a52condicionespecial   = p_condicionespecial,
                 a52codigobeneficiario  = p_codigobeneficiario
           where a52tipodocumento = p_tipoDocumento
             and a52documento = p_documento;
        else
          update t52_candidatos
             set a52primernombre        = p_primernombre,
                 a52segundonombre       = p_segundonombre,
                 a52primerapellido      = p_primerapellido,
                 a52segundoapellido     = p_segundoapellido,
                 a52fechanacimiento     = to_date(p_fechanacimiento,
                                                  'yyyy-mm-dd'),
                 a52email               = p_email,
                 a52telefono            = p_telefono,
                 a52movil               = p_movil,
                 a52movilalt            = p_movilalt,
                 a52fechamodificacion   = sysdate,
                 a52usuariomodificacion = 0,
                 a52condicionespecial   = p_condicionespecial,
                 a52tipodocumento       = p_tipoDocumento,
                 a52documento           = p_documento
           where a52codigobeneficiario = p_codigobeneficiario;
        end if;
      
      end if;
    
      p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
      p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
      RETURN;
    end if;
  
    --  si esta inscrito se debe actualizar info en t15 pero no la info del grupo donde esta inscrito
    --  crear info en t53
    --  no hay encuesta
    --  ya esta inscrito, se va a tener un periodo de inscripcion y un periodo en curso,
    --- se debe registrar en t53 con el periodo de inscripcion,
  
    if inscrito > 0 then
    
      p_codigoInscripcion := 0;
    
      SELECT a15codigo
        INTO p_codigoInscripcion
        FROM t15_inscritos
       WHERE a15codigobeneficiario = codBeneficiario;
    
      update t15_inscritos
         set a15primernombre      = p_primernombre,
             a15segundonombre     = p_segundonombre,
             a15primerapellido    = p_primerapellido,
             a15segundoapellido   = p_segundoapellido,
             a15fechanacimiento   = to_date(p_fechanacimiento, 'yyyy-mm-dd'),
             a15email             = p_email,
             a15telefono          = p_telefono,
             a15movil             = p_movil,
             a15movilalt          = P_movilalt,
             a15fechamodificacion = sysdate,
             a15condicionespecial = p_condicionEspecial
       where a15codigobeneficiario = codBeneficiario;
    
      select count(*)
        into numReg
        from t53_grupoinscrito t
       where t.a53grupofacilitador = p_grupofacilitador
         and t.a53periodo = codPeriodoIns
         and t.a53inscrito = p_codigoInscripcion;
    
      if numReg = 0 then
      
        if porcAsistencia > 0 then
        
          insert into t53_grupoinscrito
            (a53codigo,
             a53grupofacilitador,
             a53periodo,
             a53inscrito,
             a53estado,
             a53fechacreacion,
             a53fechamodificacion,
             a53usuariocreacion,
             a53usuariomodificacion)
            select t53_grupoinscrito_seq.nextval,
                   p_grupofacilitador,
                   codPeriodoIns,
                   p_codigoInscripcion,
                   'R',
                   sysdate,
                   sysdate,
                   0,
                   0
              from dual;
        
          /*Pk_T53_Grupoinscrito.Pr_Insertar(p_grupofacilitador,
          codPeriodoIns,
          p_codigoInscripcion,
          'R', --Rezagado
          0,
          p_codigoInscrito);*/
        
        else
          insert into t53_grupoinscrito
            (a53codigo,
             a53grupofacilitador,
             a53periodo,
             a53inscrito,
             a53estado,
             a53fechacreacion,
             a53fechamodificacion,
             a53usuariocreacion,
             a53usuariomodificacion)
            select t53_grupoinscrito_seq.nextval,
                   p_grupofacilitador,
                   codPeriodoIns,
                   p_codigoInscripcion,
                   'A',
                   sysdate,
                   sysdate,
                   0,
                   0
              from dual;
          /*Pk_T53_Grupoinscrito.Pr_Insertar(p_grupofacilitador,
          codPeriodoIns,
          p_codigoInscripcion,
          PK_UTILS.COD_ACTIVO,
          0,
          p_codigoInscrito);*/
        
          update t26_gruposfacilitador
             set a26inscritos = a26inscritos + 1
           where a26codigo = p_grupofacilitador;
        
        end if;
      
      end if;
    
      p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
      p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
    
    end if;
  
    -- si no esta inscrito y es beneficiario  inscribirlo en la t15 y tiene encuesta
    if inscrito = 0 and p_esBeneficiario = 1 then
    
      Pk_T15_Inscritos.Pr_Insertar(p_grupofacilitador,
                                   tipoDocumento,
                                   documento,
                                   codBeneficiario,
                                   p_primernombre,
                                   p_segundonombre,
                                   p_primerapellido,
                                   p_segundoapellido,
                                   to_date(p_fechanacimiento, 'yyyy-mm-dd'),
                                   p_email,
                                   p_telefono,
                                   p_movil,
                                   p_movilalt,
                                   p_condicionEspecial,
                                   estado,
                                   0,
                                   p_codigoInscripcion);
    
      if LENGTH(p_encuesta) > 0 then
        Pk_Ali_Inscripcion.Pr_Guardarencuesta(p_codigoInscripcion,
                                              p_encuesta,
                                              codigoEncuesta,
                                              p_codError,
                                              p_msjError);
      end if;
    
      -- crear info de los grupos donde se ha inscrito un estudiante t53
      select count(*)
        into numReg
        from t53_grupoinscrito t
       where t.a53grupofacilitador = p_grupofacilitador
         and t.a53periodo = codPeriodoIns
         and t.a53inscrito = p_codigoInscripcion;
    
      if numReg = 0 then
        insert into t53_grupoinscrito
          (a53codigo,
           a53grupofacilitador,
           a53periodo,
           a53inscrito,
           a53estado,
           a53fechacreacion,
           a53fechamodificacion,
           a53usuariocreacion,
           a53usuariomodificacion)
          select t53_grupoinscrito_seq.nextval,
                 p_grupofacilitador,
                 codPeriodoIns,
                 p_codigoInscripcion,
                 'A',
                 sysdate,
                 sysdate,
                 0,
                 0
            from dual;
      
        /*Pk_T53_Grupoinscrito.Pr_Insertar(p_grupofacilitador,
        codPeriodoIns,
        p_codigoInscripcion,
        PK_UTILS.COD_ACTIVO,
        0,
        p_codigoInscrito);*/
      
        update t26_gruposfacilitador
           set a26inscritos = a26inscritos + 1
         where a26codigo = p_grupofacilitador;
      
      end if;
    
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Guardar inscripcion OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_GuardarInscripcion2;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para realizar el proceso de inscripcion del participante al taller en periodo 3 de 2016
  
  PARAMETROS    :
  IN    :
          p_esBeneficiario  -- 1 es participante valido , 0: No es participante valido
          p_grupofacilitador
          p_tipodocumento
          p_documento
          p_codigobeneficiario
          p_primernombre
          p_segundonombre
          p_primerapellido
          p_segundoapellido
          p_fechanacimiento
          p_email
          p_telefono
          p_movil
          p_movilalt
          p_confirmacion
          p_estado
          p_usuario
  
  OUT    :
          p_codigo
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 18/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  ----------------------------------------------------------*/

  PROCEDURE Pr_GuardarInscripcion3(p_esBeneficiario     IN NUMBER, -- 1 es participante valido , 0: No es participante valido
                                   p_grupofacilitador   IN NUMBER,
                                   p_tipodocumento      IN VARCHAR2,
                                   p_documento          IN VARCHAR2,
                                   p_codigobeneficiario IN NUMBER,
                                   p_primernombre       IN VARCHAR2,
                                   p_segundonombre      IN VARCHAR2,
                                   p_primerapellido     IN VARCHAR2,
                                   p_segundoapellido    IN VARCHAR2,
                                   p_fechanacimiento    IN VARCHAR2, -- YYYY-MM-DD
                                   p_email              IN VARCHAR2,
                                   p_telefono           IN VARCHAR2,
                                   p_movil              IN VARCHAR2,
                                   p_movilalt           IN VARCHAR2,
                                   p_condicionEspecial  IN NUMBER,
                                   p_encuesta           IN VARCHAR2,
                                   p_codigoInscripcion  OUT NUMBER,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_GuardarInscripcion3';
    numReg               NUMBER;
  
    CURSOR c_participanteXDocumento IS
      SELECT a01codigobeneficiario
        FROM T01_PARTICIPANTES
       WHERE a01tipodocumento = p_tipoDocumento
         AND a01documento = p_documento;
  
    CURSOR c_participanteXCodigo IS
      SELECT a01tipodocumento, a01documento
        FROM T01_PARTICIPANTES t
       WHERE t.a01codigobeneficiario = p_codigoBeneficiario;
  
    codBeneficiario NUMBER := 0;
    tipoDocumento   VARCHAR2(2) := NULL;
    documento       VARCHAR2(15) := NULL;
    codPeriodoIns   NUMBER;
    codigoEncuesta  NUMBER;
    numCupos        NUMBER;
    p_a52codigo     NUMBER;
  
    inscrito number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_GuardarInscripcion3' ||
                            to_char(p_esBeneficiario));
  
    p_codigoInscripcion := 0;
  
    codPeriodoIns := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    numCupos := TO_NUMBER(Pk_Utils.Fn_Obtenervalorparametro('CUPOS'));
  
    codBeneficiario := p_codigobeneficiario;
    tipoDocumento   := p_tipodocumento;
    documento       := p_documento;
  
    -- validado por  SIJA correctamente
    IF p_esBeneficiario = 1 THEN
    
      -- Valida que este presente algun dato para busqueda
      IF p_tipoDocumento IS NULL AND p_documento IS NULL AND
         (p_codigobeneficiario IS NULL OR p_codigobeneficiario = 0) THEN
      
        p_codError := 3;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
      END IF;
    
      -- Si esta presente el tipo de documento el numero de documento es requerido
      IF p_tipoDocumento IS NOT NULL AND p_documento IS NULL THEN
      
        p_codError := 4;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
      END IF;
    
      -- si numero documento presente el tipo documento es requerido
      IF p_tipoDocumento IS NULL AND p_documento IS NOT NULL THEN
      
        p_codError := 5;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      
      END IF;
    
      -- Si no esta presente el codigo de beneficiario obtenerlo de la t01 grabada en la validacion por SIJA
      IF p_codigobeneficiario IS NULL OR p_codigobeneficiario = 0 THEN
      
        OPEN c_participanteXDocumento;
        FETCH c_participanteXDocumento
          INTO codBeneficiario;
        CLOSE c_participanteXDocumento;
      
      END IF;
    
      -- Si no esta presente el tipo de documento y documento obtenerlo de la t01  grabada en la validacion por SIJA
      IF p_tipodocumento IS NULL AND p_documento IS NULL THEN
      
        OPEN c_participanteXCodigo;
        FETCH c_participanteXCodigo
          INTO tipoDocumento, documento;
        CLOSE c_participanteXCodigo;
      
      END IF;
    
      -- validar cantidad de inscritos en el grupo seleccionado
      SELECT COUNT(*)
        INTO numReg
        FROM T26_GRUPOSFACILITADOR, T15_INSCRITOS
       WHERE a26codigo = p_grupofacilitador
         AND a26codigo = a15grupofacilitador
         AND a26periodo = codPeriodoIns
         AND a26estado = PK_UTILS.COD_ACTIVO;
    
      IF (numReg >= numCupos) THEN
        p_codError := 18;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        RETURN;
      END IF;
    
    ELSE
      -- Rechazado por SIJA
    
      -- Valida que este presente algun dato para busqueda
      IF p_tipoDocumento IS NULL AND p_documento IS NULL AND
         (p_codigobeneficiario IS NULL OR p_codigobeneficiario = 0) THEN
        p_codError := 3;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      END IF;
    
      -- Si esta presente el tipo de documento el numero de documento es requerido
      IF p_tipoDocumento IS NOT NULL AND p_documento IS NULL THEN
        p_codError := 4;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      END IF;
    
      -- si numero documento presente el tipo documento es requerido
      IF p_tipoDocumento IS NULL AND p_documento IS NOT NULL THEN
        p_codError := 5;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      END IF;
    
    END IF;
  
    -- si no esta validado por sija ponerlo como candidato
    if p_esBeneficiario = 0 then
    
      -- verificar si ya esta registrado como candidato
      if p_codigobeneficiario = 0 then
        select count(*)
          into numReg
          from t52_candidatos t
         where t.a52tipodocumento = p_tipoDocumento
           and t.a52documento = documento;
      else
        select count(*)
          into numReg
          from t52_candidatos t
         where t.a52codigobeneficiario = p_codigobeneficiario;
      end if;
    
      -- Si no esta registrado , registrarlo como candidato o si no actualizar la informacion
      if numReg = 0 then
      
        Pk_T52_Candidatos.Pr_Insertar(p_tipoDocumento,
                                      p_documento,
                                      codBeneficiario,
                                      p_primernombre,
                                      p_segundonombre,
                                      p_primerapellido,
                                      p_segundoapellido,
                                      to_date(p_fechanacimiento,
                                              'yyyy-mm-dd'),
                                      p_email,
                                      p_telefono,
                                      p_movil,
                                      p_movilalt,
                                      p_condicionEspecial,
                                      'P',
                                      codPeriodoIns,
                                      0,
                                      p_a52codigo);
      
      else
      
        if p_codigobeneficiario = 0 then
        
          update t52_candidatos
             set a52primernombre        = p_primernombre,
                 a52segundonombre       = p_segundonombre,
                 a52primerapellido      = p_primerapellido,
                 a52segundoapellido     = p_segundoapellido,
                 a52fechanacimiento     = to_date(p_fechanacimiento,
                                                  'yyyy-mm-dd'),
                 a52email               = p_email,
                 a52telefono            = p_telefono,
                 a52movil               = p_movil,
                 a52movilalt            = p_movilalt,
                 a52fechamodificacion   = sysdate,
                 a52usuariomodificacion = 0,
                 a52condicionespecial   = p_condicionespecial,
                 a52codigobeneficiario  = p_codigobeneficiario,
                 a52periodo             = codPeriodoIns
           where a52tipodocumento = p_tipoDocumento
             and a52documento = p_documento;
        else
          update t52_candidatos
             set a52primernombre        = p_primernombre,
                 a52segundonombre       = p_segundonombre,
                 a52primerapellido      = p_primerapellido,
                 a52segundoapellido     = p_segundoapellido,
                 a52fechanacimiento     = to_date(p_fechanacimiento,
                                                  'yyyy-mm-dd'),
                 a52email               = p_email,
                 a52telefono            = p_telefono,
                 a52movil               = p_movil,
                 a52movilalt            = p_movilalt,
                 a52fechamodificacion   = sysdate,
                 a52usuariomodificacion = 0,
                 a52condicionespecial   = p_condicionespecial,
                 a52tipodocumento       = p_tipoDocumento,
                 a52documento           = p_documento,
                 a52periodo             = codPeriodoIns
           where a52codigobeneficiario = p_codigobeneficiario;
        end if;
      
      end if;
    
      p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
      p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
      RETURN;
    
    end if;
  
    --  verificar si ya estaba inscrito en periodos anteriores
    select count(*)
      into inscrito
      from t15_inscritos t
     where t.a15codigobeneficiario = codBeneficiario;
  
    if inscrito > 0 then
    
      -- validar cantidad de inscritos en el grupo seleccionado
      SELECT COUNT(*)
        INTO numReg
        FROM T26_GRUPOSFACILITADOR, T15_INSCRITOS
       WHERE a26codigo = p_grupofacilitador
         AND a26codigo = a15grupofacilitador
         AND a26periodo = codPeriodoIns
         AND a26estado = PK_UTILS.COD_ACTIVO;
    
      IF (numReg >= numCupos) THEN
        p_codError := 18;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        RETURN;
      END IF;
    
      p_codigoInscripcion := 0;
    
      SELECT a15codigo
        INTO p_codigoInscripcion
        FROM t15_inscritos
       WHERE a15codigobeneficiario = codBeneficiario;
    
      update t15_inscritos
         set a15primernombre      = p_primernombre,
             a15segundonombre     = p_segundonombre,
             a15primerapellido    = p_primerapellido,
             a15segundoapellido   = p_segundoapellido,
             a15fechanacimiento   = to_date(p_fechanacimiento, 'yyyy-mm-dd'),
             a15email             = p_email,
             a15telefono          = p_telefono,
             a15movil             = p_movil,
             a15movilalt          = P_movilalt,
             a15fechamodificacion = sysdate,
             a15condicionespecial = p_condicionEspecial,
             a15grupofacilitador  = p_grupofacilitador
       where a15codigobeneficiario = codBeneficiario;
    
      -- inactivar grupos anteriores donde pudo estar el inscrito anteriormente
      update t53_grupoinscrito
         set a53estado = 'I', a53fechamodificacion = sysdate
       where a53inscrito = p_codigoInscripcion
         and a53estado <> 'I';
    
      -- agrega nuevo grupo al que va a pertenecer
    
      insert into t53_grupoinscrito
        (a53codigo,
         a53grupofacilitador,
         a53periodo,
         a53inscrito,
         a53estado,
         a53fechacreacion,
         a53fechamodificacion,
         a53usuariocreacion,
         a53usuariomodificacion)
        select t53_grupoinscrito_seq.nextval,
               p_grupofacilitador,
               codPeriodoIns,
               p_codigoInscripcion,
               'A',
               sysdate,
               sysdate,
               0,
               0
          from dual;
    
      -- actualizar numero de inscritos
      update t26_gruposfacilitador
         set a26inscritos = a26inscritos + 1
       where a26codigo = p_grupofacilitador;
    
      commit;
    
      pk_ali_inscripcion.pr_enviarcorreoinscripcion(p_codigoInscripcion,
                                                    p_coderror,
                                                    p_msjerror);
    
      p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
      p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
    
    end if;
  
    -- si no esta inscrito y es beneficiario  inscribirlo en la t15 y tiene encuesta
    if inscrito = 0 and p_esBeneficiario = 1 then
    
      -- validar cantidad de inscritos en el grupo seleccionado
      SELECT COUNT(*)
        INTO numReg
        FROM T26_GRUPOSFACILITADOR, T15_INSCRITOS
       WHERE a26codigo = p_grupofacilitador
         AND a26codigo = a15grupofacilitador
         AND a26periodo = codPeriodoIns
         AND a26estado = PK_UTILS.COD_ACTIVO;
    
      IF (numReg >= numCupos) THEN
        p_codError := 18;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        RETURN;
      END IF;
    
      Pk_T15_Inscritos.Pr_Insertar(p_grupofacilitador,
                                   tipoDocumento,
                                   documento,
                                   codBeneficiario,
                                   p_primernombre,
                                   p_segundonombre,
                                   p_primerapellido,
                                   p_segundoapellido,
                                   to_date(p_fechanacimiento, 'yyyy-mm-dd'),
                                   p_email,
                                   p_telefono,
                                   p_movil,
                                   p_movilalt,
                                   p_condicionEspecial,
                                   'A',
                                   0,
                                   p_codigoInscripcion);
    
      if LENGTH(p_encuesta) > 0 then
        Pk_Ali_Inscripcion.Pr_Guardarencuesta(p_codigoInscripcion,
                                              p_encuesta,
                                              codigoEncuesta,
                                              p_codError,
                                              p_msjError);
      end if;
    
      -- inactivar grupos anteriores donde pudo estar el inscrito anteriormente
      update t53_grupoinscrito
         set a53estado = 'I', a53fechamodificacion = sysdate
       where a53inscrito = p_codigoInscripcion
         and a53estado <> 'I';
    
      insert into t53_grupoinscrito
        (a53codigo,
         a53grupofacilitador,
         a53periodo,
         a53inscrito,
         a53estado,
         a53fechacreacion,
         a53fechamodificacion,
         a53usuariocreacion,
         a53usuariomodificacion)
        select t53_grupoinscrito_seq.nextval,
               p_grupofacilitador,
               codPeriodoIns,
               p_codigoInscripcion,
               'A',
               sysdate,
               sysdate,
               0,
               0
          from dual;
    
      update t26_gruposfacilitador
         set a26inscritos = a26inscritos + 1
       where a26codigo = p_grupofacilitador;
    
      commit;
    
      pk_ali_inscripcion.pr_enviarcorreoinscripcion(p_codigoInscripcion,
                                                    p_coderror,
                                                    p_msjerror);
    
      p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
      p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
    
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Pr_GuardarInscripcion3 OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_GuardarInscripcion3;

  PROCEDURE Pr_EnviarCorreoInscripcion(p_idInscrito NUMBER,
                                       p_codError   OUT NUMBER,
                                       p_msjError   OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_EnviarCorreoInscripcion';
  
    maxCorreosDia number;
    totalEnvios   number;
    emailEnviar   varchar2(100);
    coderrorEnv   number;
    msjerrorEnv   varchar2(1000);
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_EnviarCorreoInscripcion ');
  
    -- idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    maxCorreosDia := Pk_Utils.Fn_Obtenervalorparametro('MAXCORREOSDIAS');
  
    select count(*)
      into totalEnvios
      from t55_logenviocorreo
     where to_char(a55fechaenvio, 'yyyymmdd') =
           to_char(sysdate, 'yyyymmdd')
       and a55codigorespuesta = 0;
  
    if (totalEnvios > to_number(maxCorreosDia)) then
      p_codError := 72;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    select i.a15email
      into emailEnviar
      from t15_inscritos i
     where a15codigo = p_idInscrito;
    -- emailEnviar := ' @ .com';
    pk_utils.pr_enviarcorreows(p_to       => emailEnviar,
                               p_tarea    => 'INSCRIPCION',
                               p_idreg    => p_idInscrito,
                               p_coderror => coderrorEnv,
                               p_msjerror => msjerrorEnv);
  
    update t15_inscritos
       set a15codigocorreo = coderrorEnv,
           a15msjcorreo    = msjerrorEnv,
           a15fechaenvio   = sysdate
     where a15codigo = p_idInscrito;
  
    commit;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Pr_EnviarCorreoInscripcion OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_EnviarCorreoInscripcion;

  -- crear catalogo de tipo encuesta
  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la encuesta habilitada para el periodo
  PARAMETROS    :
  IN    :
           idTipoEncuesta
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 01/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarEncuesta(idTipoEncuesta IN VARCHAR2, --I: Inicial S:Satisfaccion F:Final
                           p_resultado    OUT PK_UTILS.ty_cursor,
                           p_codError     OUT NUMBER,
                           p_msjError     OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_darEncuesta';
    numReg               NUMBER;
    codPeriodo           NUMBER;
  
  BEGIN
  
    if (idTipoEncuesta = 'I') then
      codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
    else
       codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar encuesta tipo ' ||
                            idTipoEncuesta);
  
    -- VALIDAR QUE EL SELECT TENGA REGISTROS
    select count(*)
      into numReg
      FROM T50_ENCUESTA, T13_ENCUESTAPREGUNTAS, T14_ENCUESTARESPUESTAS
     WHERE a50tipoencuesta = idTipoEncuesta
       AND a50periodo = codPeriodo
       AND a50estado = PK_UTILS.COD_ACTIVO
       AND a50codigo = a13encuesta
       AND a13estado = PK_UTILS.COD_ACTIVO
       AND a13codigo = a14pregunta
       AND a14estado = PK_UTILS.COD_ACTIVO;
  
    if (numReg = 0) then
      p_codError := 19;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      SELECT a50codigo,
             a50descripcion,
             a13codigo,
             a13numero,
             a13pregunta,
             a14codigo,
             a14letra,
             a14respuesta,
             a14correcta
        FROM T50_ENCUESTA, T13_ENCUESTAPREGUNTAS, T14_ENCUESTARESPUESTAS
       WHERE a50tipoencuesta = idTipoEncuesta
         AND a50periodo = codPeriodo
         AND a50estado = PK_UTILS.COD_ACTIVO
         AND a50codigo = a13encuesta
         AND a13estado = PK_UTILS.COD_ACTIVO
         AND a13codigo = a14pregunta
         AND a14estado = PK_UTILS.COD_ACTIVO
       order by a13numero, a14letra;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta de encuesta OK tipo ' ||
                            idTipoEncuesta);
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarEncuesta;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para guardar la encuesta diligenciada por el inscrito
  PARAMETROS    :
  IN    :
           p_inscrito
           p_encuesta
  
  OUT    :
          p_codigo
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 01/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE pr_GuardarEncuesta(p_inscrito IN NUMBER,
                               p_encuesta IN VARCHAR2,
                               p_codigo   OUT NUMBER,
                               p_codError OUT NUMBER,
                               p_msjError OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'pr_GuardarEncuesta';
  
    codPeriodo  NUMBER;
    numCiclo    NUMBER;
    valorCadena VARCHAR2(4000);
    encuesta    VARCHAR2(4000);
    pregunta    NUMBER;
    respuesta   NUMBER;
    longitud    NUMBER;
    idEncuesta  NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a guardar encuesta inscrito ' ||
                            p_inscrito);
  
    SELECT (LENGTH(p_encuesta) - LENGTH(REPLACE(p_encuesta, ',')))
      INTO numCiclo
      FROM dual;
  
    IF MOD(numCiclo + 1, 2) != 0 THEN
      p_codError := 20;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;
  
    encuesta := p_encuesta;
  
    pregunta := SUBSTR(encuesta, 1, INSTR(encuesta, ',', 1, 1) - 1);
  
    idEncuesta := Pk_Utils.Fn_Darencuestaxpregunta(pregunta);
  
    numCiclo := (numCiclo + 1) / 2;
  
    FOR j IN 1 .. numCiclo LOOP
    
      IF j = numCiclo THEN
        valorCadena := encuesta;
      ELSE
        valorCadena := SUBSTR(encuesta, 1, INSTR(encuesta, ',', 1, 2));
      END IF;
    
      longitud := LENGTH(SUBSTR(valorCadena,
                                1,
                                INSTR(valorCadena, ',', 1, 1))) + 1;
    
      pregunta := SUBSTR(valorCadena, 1, INSTR(valorCadena, ',', 1, 1) - 1);
    
      respuesta := REPLACE(SUBSTR(valorCadena, longitud), ',');
    
      encuesta := SUBSTR(encuesta, LENGTH(valorCadena) + 1);
    
      Pk_T16_Inscritoencuesta.Pr_Insertar(p_inscrito,
                                          idEncuesta,
                                          pregunta,
                                          respuesta,
                                          p_inscrito,
                                          p_codigo);
    
    END LOOP;
  
    p_codigo := idEncuesta;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Guarda encuesta OK inscrito ' || p_inscrito);
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END pr_GuardarEncuesta;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los datos de un inscrito mediante ws
  PARAMETROS    :
  IN    :
           codigoBeneficiario
           documento
  
  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    :   P
  FECHA CREACION    : 01/04/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/

  PROCEDURE Pr_ConsultarInscritoWS(p_codigoBeneficiario IN number, -- 0 Si no hay codigo
                                   p_documento          varchar2,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ConsultarInscritoWS';
  
    url varchar2(200);
  
    req     UTL_HTTP.req := NULL;
    resp    UTL_HTTP.resp := NULL;
    respVal VARCHAR2(32000);
    reqXML  VARCHAR2(32760);
  
    idTipoDocumento    number;
    codigoBeneficiario number;
    fechaNacimiento    date;
    finEtapaPractica   date;
    finSemestre        date;
    ultimoMes          date;
    fichaNies          number;
    sniesIes           number;
  
  BEGIN
  
    -- SE REQUIERE ESTE PERMISO
    -- GRANT EXECUTE ON SYS.UTL_HTTP TO PUBLIC;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar inscrito ' ||
                            to_number(p_codigoBeneficiario) || '-' ||
                            p_documento);
  
    url := Pk_Utils.Fn_Obtenervalorparametro('URLWS');
  
    -- Si no esta parametrizado
    if (substr(url, 1, 5) = 'VALOR') then
      p_codError := 64;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    /*Generamos un Request a la URL destino, el método debe ser POST */
    req := UTL_HTTP.begin_request(url, 'POST');
  
    /*Creamos un mensaje SOAP tal cual se define en el WSDL*/
  
    reqXML := '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:tem="http://tempuri.org/">
   <soapenv:Header/>
   <soapenv:Body>
      <tem:TraerJoven>
         <tem:IdPersona>codigoBeneficiario</tem:IdPersona>
         <tem:documento>numDocumento</tem:documento>
      </tem:TraerJoven>
   </soapenv:Body>
</soapenv:Envelope>';
  
    reqXML := replace(reqXML,
                      'codigoBeneficiario',
                      trim(to_char(p_codigoBeneficiario)));
  
    if p_documento is null then
      reqXML := replace(reqXML, 'numDocumento', '');
    else
      reqXML := replace(reqXML, 'numDocumento', p_documento);
    end if;
  
    /*El contenido que enviamos es XML: */
    UTL_HTTP.set_header(req, 'Content-Type', 'text/xml');
  
    /*Establecemos el SOAPAction a invocar: */
    UTL_HTTP.set_header(req,
                        'SOAPAction',
                        'http://tempuri.org/IServiceHabilidades/TraerJoven');
  
    /*Indicamos en el header el tamano del mensaje enviado: */
    UTL_HTTP.set_header(req, 'Content-Length', LENGTH(reqXML));
  
    /*Escribimos el body del request */
    UTL_HTTP.write_text(req, reqXML);
  
    /*Obtenemos la respuesta */
    resp := UTL_HTTP.get_response(req);
  
    /*Cargamos en la variable respVal la devolución del servidor */
    UTL_HTTP.read_text(resp, respVal);
  
    /*Finalizamos la conexión HTTP */
    UTL_HTTP.end_response(resp);
  
    -- Hay informacion en respuesta del web services
  
    if instr(respVal, 'PrimerNombre') > 0 then
      -- Borrar informacion de t01_participantes para demas procesos del sistema
      if p_documento is null then
        delete t01_participantes t
         where t.a01codigobeneficiario = p_codigoBeneficiario;
      else
        delete t01_participantes t where t.a01documento = p_documento;
      end if;
    
      BEGIN
        idTipoDocumento := to_number(fn_darValorXml(respVal,
                                                    'IdTipoDocumento'));
      EXCEPTION
        WHEN OTHERS THEN
          idTipoDocumento := 0;
      END;
    
      BEGIN
        codigoBeneficiario := to_number(fn_darValorXml(respVal, 'IdPersona'));
      EXCEPTION
        WHEN OTHERS THEN
          codigoBeneficiario := 0;
      END;
    
      BEGIN
        fechaNacimiento := to_date(substr(fn_darValorXml(respVal,
                                                         'FechaNacimiento'),
                                          1,
                                          10),
                                   'dd/mm/yyyy');
      EXCEPTION
        WHEN OTHERS THEN
          fechaNacimiento := to_date('1900-01-01', 'yyyy-mm-dd');
      END;
    
      BEGIN
        finEtapaPractica := to_date(substr(fn_darValorXml(respVal,
                                                          'FechaFinEtapaPractica'),
                                           1,
                                           10),
                                    'dd/mm/yyyy');
      EXCEPTION
        WHEN OTHERS THEN
          finEtapaPractica := to_date('1900-01-01', 'yyyy-mm-dd');
      END;
    
      BEGIN
        finSemestre := to_date(substr(fn_darValorXml(respVal,
                                                     'FechaFin_Semestre'),
                                      1,
                                      10),
                               'dd/mm/yyyy');
      EXCEPTION
        WHEN OTHERS THEN
          finSemestre := to_date('1900-01-01', 'yyyy-mm-dd');
      END;
    
      BEGIN
        ultimoMes := to_date(substr(fn_darValorXml(respVal,
                                                   'FechaUltimoMes'),
                                    1,
                                    10),
                             'dd/mm/yyyy');
      EXCEPTION
        WHEN OTHERS THEN
          ultimoMes := to_date('1900-01-01', 'yyyy-mm-dd');
      END;
    
      BEGIN
        fichaNies := to_number(fn_darValorXml(respVal, 'FichaSnies'));
      EXCEPTION
        WHEN OTHERS THEN
          fichaNies := 0;
      END;
    
      BEGIN
        sniesIes := to_number(fn_darValorXml(respVal, 'Snies_Ies'));
      EXCEPTION
        WHEN OTHERS THEN
          sniesIes := 0;
      END;
    
      insert into t01_participantes
        (a01codigo,
         a01tipodocumento,
         a01documento,
         a01codigobeneficiario,
         a01primernombre,
         a01segundonombre,
         a01primerapellido,
         a01segundoapellido,
         a01fechanacimiento,
         a01municipioestudio,
         a01noconvenio,
         a01movil,
         a01movilalt,
         a01email,
         a01finetapapractica,
         a01finsemestre,
         a01ultimomes,
         a01fichasnies,
         a01nivelformacion,
         a01sniesies,
         a01telefono,
         a01tipoformcion,
         a01estado,
         a01fechacreacion,
         a01fechamodificacion,
         a01usuariocreacion,
         a01usuariomodificacion,
         a01Condicion,
         a01EstadoPersona,
         a01Genero,
         a01NombreInstitucion)
        select t01_participantes_seq.nextval, -- a01codigo
               decode(idTipoDocumento,
                      1,
                      'CC',
                      2,
                      'TI',
                      3,
                      'CE',
                      4,
                      'NU',
                      'OT'), --a01tipodocumento
               fn_darValorXml(respVal, 'Documento'), -- a01documento
               codigoBeneficiario, -- a01codigobeneficiario
               fn_darValorXml(respVal, 'PrimerNombre'), --a01primernombre
               fn_darValorXml(respVal, 'SegundoNombre'), -- a01segundonombre
               fn_darValorXml(respVal, 'PrimerApellido'), -- a01primerapellido
               fn_darValorXml(respVal, 'SegundoApellido'), -- a01segundoapellido
               fechaNacimiento, -- a01fechanacimiento
               fn_darValorXml(respVal, 'MunicipioEstudio'),
               fn_darValorXml(respVal, 'CodigoCovenio'),
               fn_darValorXml(respVal, 'Celular2'),
               fn_darValorXml(respVal, 'Celular1'),
               fn_darValorXml(respVal, 'Correo'),
               finEtapaPractica, -- a01finetapapractica,
               finSemestre, -- a01finsemestre,
               ultimoMes, -- a01ultimomes,
               fichaNies, -- a01fichasnies,
               fn_darValorXml(respVal, 'NivelFormacion'), -- a01nivelformacion,
               sniesIes, --a01sniesies,
               fn_darValorXml(respVal, 'Telefono'), --a01telefono,
               fn_darValorXml(respVal, 'TipoFormacion'), --a01tipoformcion,
               null, --        a01estado,
               sysdate, -- a01fechacreacion,
               sysdate, --a01fechamodificacion,
               0, --a01usuariocreacion,
               0, --a01usuariomodificacion),
               fn_darValorXml(respVal, 'Condicion'), -- a01Condicion
               fn_darValorXml(respVal, 'EstadoPersona'), -- a01EstadoPersona
               fn_darValorXml(respVal, 'Genero'), -- a01Genero
               fn_darValorXml(respVal, 'NombreInstitucion') -- a01NombreInstitucion
          from dual;
    
      commit;
    
    end if;
  
    commit;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta de ws ok ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      --p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      p_msjError := SQLERRM;
    
  END Pr_ConsultarInscritoWS;

  /********************************************************************************
   DESCRIPCION   : Funcion para devolver el valor de un parametro de un xml
  
   PARAMETROS    :
   IN            : p_cadena    Cadena con la informacion
                   p_parametro Nombre del parametro a obtener
  
   OUT           : v_valor    Retorna el valor del parametro
  
  REALIZADO POR    :   P
                      
  
  FECHA CREACION    : 01/04/2016
  
  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  
  *******************************************************************************/
  FUNCTION fn_darValorXml(p_cadena IN VARCHAR2, p_parametro IN VARCHAR2)
    RETURN VARCHAR2 IS
  
    v_valor varchar2(200);
    posIni  number;
    posFin  number;
    token   varchar2(200);
  
  BEGIN
  
    v_valor := '';
  
    token  := '<a:' || p_parametro || '>';
    posIni := instr(p_cadena, token);
    if posIni = 0 then
      RETURN v_valor;
    end if;
  
    posIni := posIni + LENGTH(token);
  
    token := '</a:' || p_parametro || '>';
  
    posFin := instr(p_cadena, token);
  
    if posFin = 0 then
      RETURN v_valor;
    end if;
  
    v_valor := substr(p_cadena, posIni, posFin - posIni);
  
    RETURN v_valor;
  
  END fn_darValorXml;

  PROCEDURE Pr_CrearACLWS(p_codError OUT NUMBER, p_msjError OUT VARCHAR2) is
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_CrearACLWS';
  
  BEGIN
  
    /*
        DBMS_NETWORK_ACL_ADMIN.drop_acl('rblMail.xml');
    
        DBMS_NETWORK_ACL_ADMIN.create_acl(
          'rblMail.xml',
          'ws deconsultar informacion de u joven',
          'HPV',
          TRUE,
          'connect');
    
        DBMS_NETWORK_ACL_ADMIN.assign_acl (
          acl => 'rblMail.xml',
          host => 'smtp.sparkpostmail.com',
          lower_port => 587,
          upper_port => NULL);
    
    COMMIT;
      */
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_CrearACLWS;

  PROCEDURE pr_GuardarEncuestaPeriodoAct(p_inscrito      IN NUMBER,
                                         p_encuesta      IN VARCHAR2,
                                         p_observaciones IN VARCHAR2,
                                         p_codigo        OUT NUMBER,
                                         p_codError      OUT NUMBER,
                                         p_msjError      OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'pr_GuardarEncuestaPeriodoAct';
  
    codPeriodo  NUMBER;
    numCiclo    NUMBER;
    valorCadena VARCHAR2(4000);
    encuesta    VARCHAR2(4000);
    pregunta    NUMBER;
    respuesta   NUMBER;
    longitud    NUMBER;
    idEncuesta  NUMBER;
  
    numEncuesta number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a guardar encuesta inscrito ' ||
                            p_inscrito);
  
    SELECT (LENGTH(p_encuesta) - LENGTH(REPLACE(p_encuesta, ',')))
      INTO numCiclo
      FROM dual;
  
    IF MOD(numCiclo + 1, 2) != 0 THEN
      p_codError := 20;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;
  
    encuesta := p_encuesta;
  
    pregunta := SUBSTR(encuesta, 1, INSTR(encuesta, ',', 1, 1) - 1);
  
    idEncuesta := Pk_Utils.Fn_Darencuestaxpregunta(pregunta);
  
    numCiclo := (numCiclo + 1) / 2;
  
    FOR j IN 1 .. numCiclo LOOP
    
      IF j = numCiclo THEN
        valorCadena := encuesta;
      ELSE
        valorCadena := SUBSTR(encuesta, 1, INSTR(encuesta, ',', 1, 2));
      END IF;
    
      longitud := LENGTH(SUBSTR(valorCadena,
                                1,
                                INSTR(valorCadena, ',', 1, 1))) + 1;
    
      pregunta := SUBSTR(valorCadena, 1, INSTR(valorCadena, ',', 1, 1) - 1);
    
      respuesta := REPLACE(SUBSTR(valorCadena, longitud), ',');
    
      encuesta := SUBSTR(encuesta, LENGTH(valorCadena) + 1);
    
      Pk_T16_Inscritoencuesta.Pr_Insertar(p_inscrito,
                                          idEncuesta,
                                          pregunta,
                                          respuesta,
                                          p_inscrito,
                                          p_codigo);
      if j = 1 then
        numEncuesta := p_codigo;
      end if;
    
    END LOOP;
  
    insert into t56_observacionencuesta
      (a56codigo,
       a56inscrito,
       a56encuesta,
       a56observacion,
       a56fechacreacion,
       a56fechamodificacion,
       a56usuariocreacion,
       a56usuariomodificacion,
       a56idinscritoencuesta)
      select T56_OBSERVACIONENCUESTA_SEQ.NEXTVAL,
             p_inscrito,
             idEncuesta,
             p_observaciones,
             sysdate,
             sysdate,
             0,
             0,
             numEncuesta
        from dual;
  
    p_codigo := idEncuesta;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Guarda encuesta OK inscrito ' || p_inscrito);
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END pr_GuardarEncuestaPeriodoAct;

  PROCEDURE pr_GuardarEncuestaToken(p_token         IN VARCHAR2,
                                    p_encuesta      IN VARCHAR2,
                                    p_observaciones IN VARCHAR2,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'pr_GuardarEncuestaToken';
    numReg               NUMBER;
  
    idUsuario      number;
    codigoRegistro number;
  
    idDato number;
  
  BEGIN
  
    select count(*)
      into numReg
      from t54_tokenusuario
     where a54token = p_token
       and a54usotoken = 'ENCUESTASATISFACION';
  
    if (numReg = 0) then
      p_codError := 73;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    select count(*)
      into numReg
      from t54_tokenusuario
     where a54token = p_token
       and a54usotoken = 'ENCUESTASATISFACION'
       and a54estado = 'I';
  
    if (numReg > 0) then
      p_codError := 74;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    select a54usuario, a54iddato
      into idUsuario, idDato
      from t54_tokenusuario
     where a54token = p_token
       and a54usotoken = 'ENCUESTASATISFACION';
  
    pk_ali_inscripcion.pr_GuardarEncuestaPeriodoAct(p_inscrito      => idUsuario,
                                                    p_encuesta      => p_encuesta,
                                                    p_observaciones => p_observaciones,
                                                    p_codigo        => codigoRegistro,
                                                    p_coderror      => p_coderror,
                                                    p_msjerror      => p_msjerror);
  
    if (p_codError = 0) then
    
      update t54_tokenusuario
         set a54estado = 'I', a54fechauso = sysdate
       where a54token = p_token
         and a54usotoken = 'ENCUESTASATISFACION';
    
      update t51_asistenciataller
         set a51fechadiligenciaencuesta = sysdate
       where a51codigo = idDato;
    
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Guarda encuesta OK inscrito ' || idUsuario);
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END pr_GuardarEncuestaToken;

  PROCEDURE Pr_GenerarCertificado(p_tipoDocumento      IN varchar2,
                                  p_documento          IN varchar2,
                                  p_codigoBeneficiario IN number,
                                  p_fechaNacimiento    IN varchar2,
                                  p_idInscrito         OUT NUMBER,
                                  p_codError           OUT NUMBER,
                                  p_msjError           OUT VARCHAR2) IS
  
    v_fechaNacimiento date;
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarCertificado';
    numReg               NUMBER;
  
    codBeneficiario NUMBER := 0;
    tipoDocumento   VARCHAR2(2) := NULL;
    documento       VARCHAR2(15) := NULL;
  
    numAsistencia number;
  
    limiteMinAsistencia NUMBER;
    idInscrito          number;
    v_tipodocumento     NUMBER;
  
    fechaEncuesta date;
  
  BEGIN
  
    v_fechaNacimiento := to_date(p_fechaNacimiento, 'yyyy-mm-dd');
  
    codBeneficiario := p_codigobeneficiario;
    tipoDocumento   := p_tipodocumento;
    documento       := p_documento;
    p_idInscrito    := 0;
  
    if p_tipoDocumento IS NOT NULL AND p_documento IS NOT NULL then
    
      select count(*)
        into v_tipodocumento
        from t04_tiposdocumento t
       where t.a04tipodocumento = p_tipodocumento;
      if (v_tipodocumento = 0) then
        p_codError := 5;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- validar que si existe el documento pero esta con otro tipo documento se le informe al usuario el error
    
      select count(1)
        into numReg
        from t15_inscritos
       where a15tipodocumento <> p_tipoDocumento
         and a15documento = p_documento;
    
      if (numReg > 0) then
        p_codError := 57;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Validar si existe participante
      select count(1)
        into numReg
        from t15_inscritos
       where a15tipodocumento = p_tipoDocumento
         and a15documento = p_documento
         and a15estado = 'A';
    
      -- No esta inscrito
      if (numReg = 0) then
        p_codError := 1;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Validar que la fecha de nacimiento corresponda
      select count(1)
        into numReg
        from t15_inscritos
       where a15tipodocumento = p_tipoDocumento
         and a15documento = p_documento
         and trunc(a15fechanacimiento) = trunc(v_fechaNacimiento);
    
      if (numReg = 0) then
        p_codError := 36;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Validar si el codigo corresponde
      if (p_codigoBeneficiario > 0) then
      
        select a15codigobeneficiario
          into codBeneficiario
          from t15_inscritos
         where a15tipodocumento = p_tipoDocumento
           and a15documento = p_documento
           and trunc(a15fechanacimiento) = trunc(v_fechaNacimiento);
      
        -- Si el codigo de beneficiario esta presente validar que sea el asignado
        if (codBeneficiario <> p_codigoBeneficiario) then
          p_codError := 11;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          Return;
        end if;
      
      end if;
    
      -- OBTENER CODIGO BENEFICIARIO POR DOCUMENTO
      select a15codigobeneficiario, a15Codigo, A15FECHAENCUESTAFINAL
        into codBeneficiario, idInscrito, fechaEncuesta
        from t15_inscritos t
       where a15tipodocumento = p_tipoDocumento
         and a15documento = p_documento
         and trunc(a15fechanacimiento) = trunc(v_fechaNacimiento)
         AND T.A15ESTADO = 'A';
    
      p_idInscrito := idInscrito;
    end if;
  
    -- Si solo esta presente el codigo de beneficiario validar que sea un participante
    if (p_codigoBeneficiario > 0) then
    
      -- Valida si codigo de beneficiario existe
      select count(1)
        into numReg
        from t15_inscritos
       where a15codigobeneficiario = p_codigoBeneficiario;
    
      -- No esta inscrito
      if numReg = 0 THEN
        p_codError := 1;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- Valida si la fecha de nacimiento corresponde
      select count(1)
        into numReg
        from t15_inscritos
       where a15codigobeneficiario = p_codigoBeneficiario
         and trunc(a15fechanacimiento) = trunc(v_fechaNacimiento);
    
      if (numReg = 0) then
        p_codError := 36;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      -- obtener documento por codigo beneficiario
      select A15TIPODOCUMENTO,
             A15DOCUMENTO,
             a15Codigo,
             A15FECHAENCUESTAFINAL
        into tipoDocumento, documento, idInscrito, fechaEncuesta
        from t15_inscritos t
       where a15codigobeneficiario = p_codigoBeneficiario
         and trunc(a15fechanacimiento) = trunc(v_fechaNacimiento)
         AND T.A15ESTADO = 'A';
    
      p_idInscrito := idInscrito;
    
    end if;
  
    -- Validar que cumpla con mas de 6 asistencias
    select count(*)
      into numAsistencia
      from (select a51tallerrealizado
              from t51_asistenciataller
             where a51inscrito = idInscrito
               and a51asistencia = 'A'
             group by a51tallerrealizado);
  
    limiteMinAsistencia := TO_NUMBER(pk_utils.fn_ObtenerValorParametro('LIMNUMASISTENCIA'));
  
    if (numAsistencia < limiteMinAsistencia) then
      p_codError := 84;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    select MIN(T.A16FECHACREACION)
      INTO fechaEncuesta
      from T16_INSCRITOENCUESTA t
     WHERE t.a16inscrito = p_idInscrito
       and t.a16encuesta in
           (select e.a50codigo
              from T50_ENCUESTA E
             WHERE E.A50TIPOENCUESTA = 'F');
  
    if (fechaEncuesta is null) then
      p_codError := 85;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_GenerarCertificado ok ' ||
                            p_documento);
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_GenerarCertificado;

  PROCEDURE Pr_RegistrarEncuestaFinal(p_inscrito      IN NUMBER,
                                      p_encuesta      IN VARCHAR2,
                                      p_observaciones IN VARCHAR2,
                                      p_codError      OUT NUMBER,
                                      p_msjError      OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_RegistrarEncuestaFinal';
  
    codPeriodo  NUMBER;
    numCiclo    NUMBER;
    valorCadena VARCHAR2(4000);
    encuesta    VARCHAR2(4000);
    pregunta    NUMBER;
    respuesta   NUMBER;
    longitud    NUMBER;
    idEncuesta  NUMBER;
  
    numEncuesta number;
  
    idCodigo number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a guardar encuesta inscrito ' ||
                            p_inscrito);
  
    SELECT (LENGTH(p_encuesta) - LENGTH(REPLACE(p_encuesta, ',')))
      INTO numCiclo
      FROM dual;
  
    IF MOD(numCiclo + 1, 2) != 0 THEN
      p_codError := 20;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;
  
    encuesta := p_encuesta;
  
    pregunta := SUBSTR(encuesta, 1, INSTR(encuesta, ',', 1, 1) - 1);
  
    idEncuesta := Pk_Utils.Fn_Darencuestaxpregunta(pregunta);
  
    numCiclo := (numCiclo + 1) / 2;
  
    FOR j IN 1 .. numCiclo LOOP
    
      IF j = numCiclo THEN
        valorCadena := encuesta;
      ELSE
        valorCadena := SUBSTR(encuesta, 1, INSTR(encuesta, ',', 1, 2));
      END IF;
    
      longitud := LENGTH(SUBSTR(valorCadena,
                                1,
                                INSTR(valorCadena, ',', 1, 1))) + 1;
    
      pregunta := SUBSTR(valorCadena, 1, INSTR(valorCadena, ',', 1, 1) - 1);
    
      respuesta := REPLACE(SUBSTR(valorCadena, longitud), ',');
    
      encuesta := SUBSTR(encuesta, LENGTH(valorCadena) + 1);
    
      Pk_T16_Inscritoencuesta.Pr_Insertar(p_inscrito,
                                          idEncuesta,
                                          pregunta,
                                          respuesta,
                                          p_inscrito,
                                          idCodigo);
      if j = 1 then
        numEncuesta := idCodigo;
      end if;
    
    END LOOP;
  
    insert into t56_observacionencuesta
      (a56codigo,
       a56inscrito,
       a56encuesta,
       a56observacion,
       a56fechacreacion,
       a56fechamodificacion,
       a56usuariocreacion,
       a56usuariomodificacion,
       a56idinscritoencuesta)
      select T56_OBSERVACIONENCUESTA_SEQ.NEXTVAL,
             p_inscrito,
             idEncuesta,
             p_observaciones,
             sysdate,
             sysdate,
             0,
             0,
             numEncuesta
        from dual;
  
    update t15_inscritos
       set a15fechaencuestafinal = sysdate, a15fechacertificacion = sysdate
     where a15codigo = p_inscrito;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'GuardaPr_RegistrarEncuestaFinal ' ||
                            p_inscrito);
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_RegistrarEncuestaFinal;

END PK_ALI_INSCRIPCION;
/

prompt
prompt Creating package body PK_MIGRACION
prompt ==================================
prompt
create or replace package body hpv.PK_MIGRACION is

  PROCEDURE Pr_limpiar(p_codError OUT NUMBER, p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_limpiar';
  BEGIN
    /*    delete from t03_municipios;
    delete from t02_departamentos;*/
    /*    DELETE FROM t14_encuestarespuestas;
    DELETE FROM t14_encuestarespuestas;
    COMMIT;*/
    delete from t98_excepcion;
    delete from t99_logoperacion;
    delete from t30_ciudadesusuario;
    delete from t16_inscritoencuesta;
    delete from t15_inscritos;
    delete from T20_ENTREGABLESCARGADOS;
    delete from T21_REALIZACIONTALLER;
    delete from t26_gruposfacilitador;
    delete from t01_participantes;
    delete from T29_CONSULTAPARTICIPANTES;
    delete from t51_asistenciataller;

    delete from t07_personas t where t.a07codigo <> 0;

    delete from T06_USUARIOS t where t.a06codigo <> 0;

    commit;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_limpiar;

  PROCEDURE Pr_mig_t01dbo_participantes(p_codError OUT NUMBER,
                                        p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_mig_t01dbo_participantes';
  BEGIN
    delete from t01_participantes;
    insert into t01_participantes
      (a01codigo,
       a01codigobeneficiario,
       a01tipodocumento,
       a01documento,
       a01primernombre,
       a01segundonombre,
       a01primerapellido,
       a01segundoapellido,
       a01fechanacimiento,
       a01municipioestudio,
       a01noconvenio,
       a01movil,
       a01movilalt,
       a01email,
       a01finetapapractica,
       a01finsemestre,
       a01ultimomes,
       a01fichasnies,
       a01nivelformacion,
       a01sniesies,
       a01telefono)

      select a01codigo,
             a01codigobeneficiario,
             decode(a01tipodocumento,
                    1,
                    'NU',
                    2,
                    'CC',
                    3,
                    'TI',
                    4,
                    'PA',
                    5,
                    'CE',
                    'OT'),
             a01documento,
             a01primernombre,
             a01segundonombre,
             a01primerapellido,
             a01segundoapellido,
             to_date(a01fechanacimiento, 'yyyy-mm-dd'),
             a01municipioestudio,
             a01codigoconvenio,
             a01celular,
             a01celularalterno,
             a01email,
             null, --to_date(a01finfechaetapapractica,'yyyy-mm-dd'),
             null, --to_date(a01fechafinsemestrescursados,'yyyy-mm-dd'),
             null, --to_date(a01fechaultmes,'yyyy-mm-dd'),
             a01fichasnies,
             a01nivelformacion,
             a01snies_ies,
             a01telefono
        from mig_t01dbo_participantes;

    commit;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_mig_t01dbo_participantes;

  PROCEDURE Pr_mig_t02dbc_departamentos(p_codError OUT NUMBER,
                                        p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_mig_t02dbc_departamentos';
  BEGIN
    insert into t02_departamentos
      (a02codigo, a02nombre, a02dane, a02indicativo, a02estado)
      select a02codigo, a02nombre, a02dane, a02indicativo, a02estado
        from mig_t02dbc_departamentos;

    commit;
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_mig_t02dbc_departamentos;

  PROCEDURE Pr_mig_t03dbc_municipios(p_codError OUT NUMBER,
                                     p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_mig_t03dbc_municipios';
  BEGIN
    insert into t03_municipios
      (a03codigo, a03departamento, a03nombre, a03dane, a03estado)
      select a03codigo, a03departamento, a03nombre, a03dane, a03estado
        from mig_t03dbc_municipios;

    commit;
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_mig_t03dbc_municipios;

  PROCEDURE Pr_mig_t06web_usuarios(p_codError OUT NUMBER,
                                   p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_mig_t06web_usuarios';

  begin

    delete from t30_ciudadesusuario t;

    delete from t07_personas t where t.a07codigo <> 0;

    delete from T06_USUARIOS t where t.a06codigo <> 0;

    commit;

    insert into t06_usuarios
      (a06codigo,
       a06rol,
       a06perfil,
       a06coordinador,
       a06usuario,
       a06clave,
       a06intentos,
       a06fechaclave,
       a06estado,
       a06fechaultimoingreso,
       a06fechacreacion,
       a06fechamodificacion,
       a06usuariocreacion,
       a06usuariomodificacion)
      select a06codigo,
             a06rol,
             1, -- a06perfil
             0, -- a06coordinador
             a06usuario,
             a06clave,
             a06intentos,
             sysdate, --a06fechaclave,
             a06estado,
             --a06prueba,
             sysdate, -- a06fechaultimoingreso,
             sysdate, --to_date(substr(a06fechacreacion, 1, 10), 'yyyy-mm-dd'),
             sysdate, --to_date(substr(a06fechamodificacion, 1, 10), 'yyyy-mm-dd'),
             0, -- a06usuariocreacion
             0 -- a06usuariomodificacion
        from mig_t06web_usuarios
       where a06usuario <> '17639183'
         and a06estado <> 'B';

    insert into t07_personas
      (a07codigo,
       a07usuario,
       a07tipodocumento,
       a07identificacion,
       a07primernombre,
       a07segundonombre,
       a07primerapellido,
       a07segundoapellido,
       a07fechanacimiento,
       a07email,
       a07telefono,
       a07movil,
       a07movilalt,
       a07fechacreacion,
       a07fechamodificacion,
       a07usuariocreacion,
       a07usuariomodificacion)
      select a07codigo,
             a07usuario,
             --             a07ciudad,
             decode(a07tipoidentificacion,
                    1,
                    'NU',
                    2,
                    'CC',
                    3,
                    'TI',
                    4,
                    'PA',
                    5,
                    'CE',
                    'OT'),
             a07identificacion,
             a07primernombre,
             a07segundonombre,
             a07primerapellido,
             a07segundoapellido,
             NVL(TO_DATE(a07fechanacimiento, 'yyyy-mm-dd'), NULL),
             a07email,
             a07telefono,
             a07movil,
             a07movilalt,
             --a07estado,
             sysdate, -- a07fechacreacion,
             sysdate, --a07fechamodificacion
             0, --a07usuariocreacion
             0 -- a07usuariomodificacion
        from mig_t07web_personas t
       where t.a07usuario in (select a06codigo from t06_usuarios);

    commit;

    insert into t30_ciudadesusuario
      (a30codigo,
       a30ciudad,
       a30usuario,
       a30estado,
       a30fechacreacion,
       a30fechamodificacion,
       a30usuariocreacion,
       a30usuariomodificacion)
      select t30_ciudadesusuario_seq.nextval,
             a07ciudad,
             a07usuario,
             'A',
             sysdate,
             sysdate,
             0,
             0
        from mig_t07web_personas t
       where t.a07usuario in (select a06codigo from t06_usuarios);

    update t06_usuarios a
       set a.a06coordinador =
           (select b.a28coordinador
              from mig_t28dbo_facilitadorcoord b
             where a.a06codigo = b.a28facilitador
               and b.a28estado = 'A'
               and b.a28coordinador in (select a06codigo from t06_usuarios));

    commit;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_mig_t06web_usuarios;

  PROCEDURE Pr_mig_t13dbo_preguntas(p_codError OUT NUMBER,
                                    p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_mig_t13dbo_preguntas';
  BEGIN
    insert into t13_encuestapreguntas
      (a13codigo, a13numero, a13pregunta, a13encuesta, a13estado)
      select a13codigo, a13numero, a13pregunta, 2, a13estado
        from mig_t13dbo_preguntas
       WHERE a13tipo = 'R';
    commit;
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_mig_t13dbo_preguntas;

  PROCEDURE Pr_mig_t14dbo_respuestas(p_codError OUT NUMBER,
                                     p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_mig_t14dbo_respuestas';
  BEGIN
    insert into t14_encuestarespuestas
      (a14codigo,
       a14pregunta,
       a14letra,
       a14respuesta,
       a14correcta,
       a14estado)
      select r.a14codigo,
             p.a30pregunta,
             r.a14letra,
             r.a14respuesta,
             r.a14correcta,
             r.a14estado
        from mig_t14dbo_respuestas r, mig_t30bdo_preguntarespuestas p
       where r.a14codigo = p.a30respuesta;

    commit;
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_mig_t14dbo_respuestas;

  PROCEDURE Pr_mig_t15web_inscritos(p_codError OUT NUMBER,
                                    p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_mig_t15web_inscritos';
  BEGIN

    delete from t15_inscritos;
    commit;

    update MIG_T15WEB_INSCRITOS t
       set t.a15fechanacimiento = '1980-01-01'
     where substr(a15fechanacimiento, 6, 2) = '00';

    commit;

    insert into t15_inscritos
      (a15codigo,
       a15grupofacilitador,
       a15tipodocumento,
       a15documento,
       a15codigobeneficiario,
       a15primernombre,
       a15segundonombre,
       a15primerapellido,
       a15segundoapellido,
       a15fechanacimiento,
       a15email,
       a15telefono,
       a15movil,
       a15movilalt,
       a15estado,
       a15fechacreacion,
       a15fechamodificacion,
       a15usuariocreacion,
       a15usuariomodificacion,
       a15condicionespecial)
      select a15codigo,
             a15grupo,
             decode(a15tipodocumento,
                    1,
                    'NU',
                    2,
                    'CC',
                    3,
                    'TI',
                    4,
                    'PA',
                    5,
                    'CE',
                    'OT'),
             a15documento,
             a15codigobeneficiario,
             a15primernombre,
             a15segundonombre,
             a15primerapellido,
             a15segundoapellido,
             to_date(substr(a15fechanacimiento, 1, 10), 'yyyy-mm-dd'),
             a15email,
             a15telefono,
             a15movil,
             a15movilalt,
             a15estado,
             to_date(substr(a15fechacreacion, 1, 10), 'yyyy-mm-dd'),
             to_date(substr(a15fechamodificacion, 1, 10), 'yyyy-mm-dd'),
             0,
             0,
             0
        from mig_t15web_inscritos;

    commit;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_mig_t15web_inscritos;

  PROCEDURE Pr_mig_t21web_realizaciont(p_codError OUT NUMBER,
                                       p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_mig_t21web_realizaciontaller';
  BEGIN

    delete from t21_realizaciontaller;
    commit;

    insert into t21_realizaciontaller
      (a21codigo,
       a21grupo,
       a21taller,
       a21fechataller,
       a21facilitador,
       a21periodo,
       a21estado,
       a21fechacreacion,
       a21fechamodificacion,
       a21usuariocreacion,
       a21usuariomodificacion)
      select a21codigo,
             a21grupo,
             a21taller,
             to_date(substr(a21fechataller, 1, 10), 'yyyy-mm-dd'),
             0, -- facilitador
             1, -- periodo
             a21estado,
             to_date(substr(a21fechacreacion, 1, 10), 'yyyy-mm-dd'),
             to_date(substr(a21fechamodificacion, 1, 10), 'yyyy-mm-dd'),
             nvl(a21usuariocreacion, 0),
             nvl(a21usuariomodificacion, 0)
        from mig_t21web_realizaciontaller;

    update t21_realizaciontaller t
       set t.a21facilitador =
           (select g.a26facilitador
              from t26_gruposfacilitador g
             where t.a21grupo = g.a26codigo);

    commit;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_mig_t21web_realizaciont;

  PROCEDURE Pr_mig_t26web_gruposfac(p_codError OUT NUMBER,
                                    p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_mig_t26web_gruposfac';
  BEGIN

    delete from t26_gruposfacilitador;

    insert into t26_gruposfacilitador
      (a26codigo,
       a26periodo,
       a26facilitador,
       a26ciudad,
       a26grupo,
       a26dia,
       a26horario,
       a26lugar,
       a26direccion,
       a26sigla,
       a26condicion,
       a26observaciones,
       a26motivorechazo,
       a26estado,
       a26fechacreacion,
       a26fechamodificacion,
       a26usuariocreacion,
       a26usuariomodificacion)
      select a26codigo,
             a26periodo,
             a26facilitador,
             a26ciudad,
             a26grupo,
             a26dia,
             a26horario,
             upper(a26lugar),
             upper(a26direccion),
             upper(substr(Pk_T03_Municipios.Fn_Obtenernombre(a26ciudad),
                          1,
                          3)) || 'P' || a26periodo || 'F' ||
             to_char(a26facilitador) || 'G' || a26grupo, -- a26sigla
             a26condicion,
             a26observaciones,
             '', -- a26motivorechazo
             a26estado,
             sysdate, -- a26fechacreacion,
             sysdate, --a26fechamodificacion
             0, -- a26usuariocreacion,
             0 --a26usuariomodificacion,

        from mig_t26web_gruposfac;
        --where a26estado ='A';


    commit;
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_mig_t26web_gruposfac;

  PROCEDURE Pr_mig_t32web_tallerasistencia(p_codError OUT NUMBER,
                                           p_msjError OUT VARCHAR2) IS

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_mig_t32web_tallerasistencia';
  BEGIN

    delete from t51_asistenciataller;

    insert into t51_asistenciataller
      (a51codigo,
       a51tallerrealizado,
       a51inscrito,
       a51facilitadorreporta,
       a51grupofacilitador,
       a51periodo,
       a51fechareporte,
       a51fechacreacion,
       a51fechamodificacion,
       a51usuariocreacion,
       a51usuariomodificacion,
       a51asistencia,
       a51estado)
      select t51_asistencia_seq.nextval,
             a32taller,
             a32inscrito,
             a32usuariocreacion,
             a32grupo,
             1,
             to_date(substr(a32fechacreacion, 1, 10), 'yyyy-mm-dd'),
             to_date(substr(a32fechacreacion, 1, 10), 'yyyy-mm-dd'),
             to_date(substr(a32fechamodificacion, 1, 10), 'yyyy-mm-dd'),
             a32usuariocreacion,
             a32usuariomodificacion,
             a32asistencia,
             a32estado
        from mig_t32web_tallerasistencia;

    commit;
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

  EXCEPTION
    WHEN OTHERS THEN

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_mig_t32web_tallerasistencia;

end PK_MIGRACION;
/

prompt
prompt Creating package body PK_OPE_ADMESPACIOFISICO
prompt =============================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_OPE_ADMESPACIOFISICO IS
  /********************************************************************************
   DESCRIPCION   : Procedimiento encargado de devolver los espacios fisicos

   PARAMETROS    :
   IN            :
                  p_idFacilitador

   OUT           : p_resultado       Retorna los espacios fisicos
                   p_codError        Codigo de error generado
                   p_msjError        Mensaje del error generado

  REALIZADO POR    : 
                      

  FECHA CREACION    : 13/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_DarEspacioFisico(p_idFacilitador IN NUMBER,
                                p_consulta      IN VARCHAR2,
                                p_resultado     OUT PK_UTILS.TY_CURSOR,
                                p_codError      OUT NUMBER,
                                p_msjError      OUT VARCHAR2) IS

    codExcepcion NUMBER;
    numReg       NUMBER;
    codPeriodo   NUMBER;

    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarEspacioFisico';
  BEGIN

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar espacios fisicos ' ||
                            to_char(p_idFacilitador));

    SELECT COUNT(*)
      INTO numreg
      FROM T26_GRUPOSFACILITADOR
     WHERE a26periodo = codperiodo;

    if (numReg = 0) then
      p_codError := 53;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT a26codigo idespaciofisico,
             a26estado codestado,
             a90nombre estado,
             a02codigo iddepartamento,
             a02nombre nomdepartamento,
             a26ciudad idmunicipio,
             a03nombre nommunicipio,
             a26dia iddia,
             a23nombre dia,
             a26horario idhorario,
             a24horario horario,
             a26grupo idgrupo,
             a25nombre grupo,
             a26sigla siglagrupo,
             a26lugar lugar,
             a26direccion direccion,
             a26motivorechazo motivorechazo,
             a26facilitador idfacilitador,
             a07primernombre || ' ' || a07segundonombre || ' ' ||
             a07primerapellido || ' ' || a07segundoapellido nombrefacilitador
        FROM T26_GRUPOSFACILITADOR,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS,
             T07_PERSONAS
       WHERE a26estado = a90codigo
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = a07usuario
         AND a26periodo = codperiodo
         and a26facilitador = p_idFacilitador
         AND (UPPER(a02nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a03nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a23nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a24horario) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a26sigla) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a26lugar) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a26direccion) LIKE '%' || UPPER(p_consulta) || '%');

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta espacios fisicos OK ');
  EXCEPTION
    WHEN OTHERS THEN

      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarEspacioFisico;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los dias activos
  PARAMETROS    :
  IN    :


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 13/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_DarDias(p_resultado OUT PK_UTILS.ty_cursor,
                       p_codError  OUT NUMBER,
                       p_msjError  OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarDias';
    numReg               NUMBER;

    codError NUMBER;
    msjError VARCHAR2(4000);

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar dias ');

    SELECT COUNT(*)
      INTO numreg
      FROM T23_DIAS
     WHERE a23estado = PK_UTILS.COD_ACTIVO;

    if (numReg = 0) then
      p_codError := 39;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT *
        FROM T23_DIAS
       WHERE a23estado = PK_UTILS.COD_ACTIVO
       order by a23codigo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  dias OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarDias;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los horarios activos
  PARAMETROS    :
  IN    :


  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 13/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarHorarios(p_resultado OUT PK_UTILS.ty_cursor,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarHorarios';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar horarios ');

    -- Verifica si el correo no esta utilizado por algun inscrito anterior
    SELECT COUNT(1)
      INTO numreg
      FROM T24_HORARIOS
     WHERE a24estado IN (PK_UTILS.COD_ACTIVO);

    IF numReg = 0 THEN
      p_codError := 40;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT *
        FROM T24_HORARIOS
       WHERE a24estado IN (PK_UTILS.COD_ACTIVO)
       order by a24horario;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta horarios OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarHorarios;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los grupos activos
  PARAMETROS    :
  IN    :

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 13/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarGrupos(p_resultado OUT PK_UTILS.ty_cursor,
                         p_codError  OUT NUMBER,
                         p_msjError  OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarGrupos';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar grupos ');
    SELECT COUNT(*)
      INTO numreg
      FROM T25_GRUPOS
     WHERE a25estado = PK_UTILS.COD_ACTIVO;

    if (numReg = 0) then
      p_codError := 41;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      select *
        from T25_GRUPOS
       WHERE a25estado = PK_UTILS.COD_ACTIVO
       ORDER BY a25codigo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta grupos OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarGrupos;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar el nombre de todos los lugares
                   creados en ese municipio

  PARAMETROS    :
  IN    :
           p_idMunicipio

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 13/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarLugaresMunicipio(p_idMunicipio IN NUMBER,
                                   p_resultado   OUT PK_UTILS.ty_cursor,
                                   p_codError    OUT NUMBER,
                                   p_msjError    OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarLugaresMunicipio';
    numReg               NUMBER;

    codPeriodo NUMBER;

  BEGIN

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar lugares del municipio ');

    SELECT COUNT(*)
      INTO numReg
      FROM T26_GRUPOSFACILITADOR
     WHERE a26ciudad = p_idMunicipio
       AND a26periodo = codPeriodo;

    if (numReg = 0) then
      p_codError := 42;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT distinct a26lugar
        FROM T26_GRUPOSFACILITADOR
       WHERE a26ciudad = p_idMunicipio
         AND a26periodo = codPeriodo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta lugares del municipio OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarLugaresMunicipio;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar todas las direcciones de un lugar
                   en un municipio

  PARAMETROS    :
  IN    :
           p_idMunicipio
           p_nombreLugar

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 13/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarDireccionesLugar(p_idMunicipio IN NUMBER,
                                   p_nombreLugar IN VARCHAR2,
                                   p_resultado   OUT PK_UTILS.ty_cursor,
                                   p_codError    OUT NUMBER,
                                   p_msjError    OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarDireccionesLugar';
    numReg               NUMBER;
    codPeriodo           NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar las direcciones de un lugar del municipio ');

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;

    -- VALIDAR QUE EL SELECT TENGA REGISTROS
    SELECT COUNT(*)
      INTO numReg
      FROM T26_GRUPOSFACILITADOR
     WHERE a26ciudad = p_idMunicipio
       AND a26lugar = p_nombreLugar
       AND a26periodo = codPeriodo;

    if (numReg = 0) then
      p_codError := 43;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT distinct a26direccion
        FROM T26_GRUPOSFACILITADOR
       WHERE a26ciudad = p_idMunicipio
         AND a26lugar = p_nombreLugar
         AND a26periodo = codPeriodo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta las direcciones de un lugar del municipio OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarDireccionesLugar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar el espacio fisico

  PARAMETROS    :
  IN    :
           p_idEspacioFisico
           p_idFacilitador
           p_idMunicipio
           p_idDia
           p_idHorario
           p_idGrupo
           p_nombreLugar
           p_direccion

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 13/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ActualizarEspacio(p_idEspacioFisico IN NUMBER, -- si es cero es nuevo
                                 p_idFacilitador   IN NUMBER,
                                 p_idMunicipio     IN NUMBER,
                                 p_idDia           IN NUMBER,
                                 p_idHorario       IN NUMBER,
                                 p_idGrupo         IN NUMBER,
                                 p_nombreLugar     IN VARCHAR2,
                                 p_direccion       IN VARCHAR2,
                                 p_codError        OUT NUMBER,
                                 p_msjError        OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ActualizarEspacio';
    numReg               NUMBER;
    idEspacioFisico      NUMBER;
    sigMunicipio         VARCHAR2(10);
    sigla                VARCHAR2(20);

    codPeriodo       NUMBER;
    codPeriodoActual NUMBER;

    hInicio NUMBER;
    hFinal  NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a actualizar el espacio fisico ' ||
                            p_nombreLugar || ':' || p_direccion);

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;

    -- validar que el facilitador solo pueda crear lugares en las ciudades asignadas
    SELECT COUNT(*)
      INTO numreg
      FROM t30_ciudadesusuario
     WHERE a30usuario = p_idFacilitador
       and a30ciudad = p_idMunicipio;

    IF numReg = 0 THEN
      p_codError := 46;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;

    if (p_idEspacioFisico = 0) then

      -- Validar que el facilitador no pueda crear otro grupo en el mismo dia y horario
      SELECT COUNT(*)
        INTO numreg
        FROM T26_GRUPOSFACILITADOR
       where a26facilitador = p_idFacilitador
         and a26dia = p_idDia
         and a26horario = p_idHorario
         and a26periodo = codPeriodo;

      IF numReg > 0 THEN
        p_codError := 47;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      END IF;

      -- Validar que no se tenga el mismo grupo ya creado
      SELECT COUNT(*)
        INTO numreg
        FROM T26_GRUPOSFACILITADOR
       where a26facilitador = p_idFacilitador
         and a26grupo = p_idGrupo
         and a26periodo = codPeriodo;

      IF numReg > 0 THEN
        p_codError := 48;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      END IF;

      -- Validar que no exista uno ya creado con los mismos datos
      SELECT COUNT(*)
        INTO numReg
        FROM T26_GRUPOSFACILITADOR
       WHERE a26facilitador = p_idFacilitador
         AND a26ciudad = p_idMunicipio
         AND a26grupo = p_idGrupo
         AND a26dia = p_idDia
         AND a26horario = p_idHorario
         AND a26lugar = upper(p_nombreLugar)
         AND a26direccion = upper(p_direccion)
         AND a26periodo = codPeriodo;

      IF numReg != 0 THEN
        p_codError := 44;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      END IF;

    end if;

    Pk_T24_Horarios.Pr_Obtenerrango(p_idHorario, hInicio, hFinal);

    numReg := Pk_Ope_Admespaciofisico.Fn_Validarhorario(p_idFacilitador,
                                                        p_idDia,
                                                        hInicio,
                                                        hFinal);

    IF numReg > 0 THEN
      p_codError := 54;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;

    sigMunicipio := substr(Pk_T03_Municipios.Fn_Obtenernombre(p_idMunicipio),
                           1,
                           3);

    sigla := sigMunicipio || 'P' || codPeriodo || 'F' ||
             to_char(p_idFacilitador) || 'G' || p_idGrupo;

    IF p_idEspacioFisico = 0 THEN

      Pk_T26_Gruposfacilitador.Pr_Insertar(p_idFacilitador,
                                           p_idMunicipio,
                                           p_idGrupo,
                                           p_idDia,
                                           p_idHorario,
                                           upper(p_nombreLugar),
                                           upper(p_direccion),
                                           sigla,
                                           codPeriodo,
                                           NULL, -- condicion
                                           NULL, -- observaciones
                                           PK_UTILS.APR_PENDIENTE,
                                           p_idFacilitador,
                                           idEspacioFisico);

    ELSE

      Pk_T26_Gruposfacilitador.Pr_Actualizar(p_idEspacioFisico,
                                             p_idFacilitador,
                                             p_idMunicipio,
                                             p_idGrupo,
                                             p_idDia,
                                             p_idHorario,
                                             p_nombreLugar,
                                             p_direccion,
                                             sigla,
                                             codPeriodo,
                                             NULL,
                                             NULL,
                                             p_idFacilitador);

      Pk_T26_Gruposfacilitador.Pr_ActualizarEstado(p_idEspacioFisico,
                                                   PK_UTILS.APR_PENDIENTE,
                                                   p_idFacilitador);
    END IF;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Actualizar espacio fisico OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ActualizarEspacio;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los espacios fisicos por ID
  PARAMETROS    :
  IN    :
           p_idEspacioFisico

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 13/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ConsultarEspacio(p_idEspacioFisico IN NUMBER,
                                p_resultado       OUT PK_UTILS.TY_CURSOR,
                                p_codError        OUT NUMBER,
                                p_msjError        OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ConsultarEspacio';
    numReg               NUMBER;

    codPeriodo NUMBER;
  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro consultar espacio fisico ');

    --    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;

    SELECT COUNT(*)
      INTO numreg
      FROM T26_GRUPOSFACILITADOR
     WHERE a26codigo = p_idEspacioFisico;
    --       AND a26periodo = codperiodo;

    if (numReg = 0) then
      p_codError := 38;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT a26codigo idespaciofisico,
             a26estado codestado,
             a90nombre estado,
             a02codigo iddepartamento,
             a02nombre nomdepartamento,
             a26ciudad idmunicipio,
             a03nombre nommunicipio,
             a26dia iddia,
             a23nombre dia,
             a26horario idhorario,
             a24horario horario,
             a26grupo idgrupo,
             a25nombre grupo,
             a26sigla siglagrupo,
             a26lugar lugar,
             a26direccion direccion,
             a26motivorechazo motivorechazo,
             a26facilitador idfacilitador,
             a07primernombre || ' ' || a07segundonombre || ' ' ||
             a07primerapellido || ' ' || a07segundoapellido nombrefacilitador
        FROM T26_GRUPOSFACILITADOR,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS,
             T07_PERSONAS
       WHERE a26codigo = p_idEspacioFisico
         AND a26estado = a90codigo
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = a07usuario;
    --   AND a26periodo = codperiodo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta espacio fisico OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ConsultarEspacio;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los espacios fisicos por aprobar por coordinador

  PARAMETROS    :
  IN    :
          p_idCoordinador
          p_consulta

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 13/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarEspacioFisicoXAprobar(p_idCoordinador IN NUMBER,
                                        p_consulta      IN VARCHAR2,
                                        p_estado        IN VARCHAR2,
                                        p_idPeriodo     IN NUMBER,
                                        p_resultado     OUT PK_UTILS.ty_cursor,
                                        p_codError      OUT NUMBER,
                                        p_msjError      OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarEspacioFisicoXAprobar';
    numReg               NUMBER;

    codPeriodo NUMBER;

    idRol number;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro consultar espacio fisico por aprobar ');

    if (p_idPeriodo is null) then
      codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
    else
      codPeriodo := p_idPeriodo;
    end if;

    select a06rol
      into idRol
      from t06_usuarios
     where a06codigo = p_idCoordinador;

    -- Si es coordinador validar que exista info para el periodo
    if (idRol = 2) then
      SELECT COUNT(*)
        INTO numreg
        FROM T26_GRUPOSFACILITADOR, T06_USUARIOS, T07_PERSONAS
       WHERE a26periodo = codperiodo
         AND a26facilitador = a06codigo
         AND a06codigo = a07usuario
         AND a06coordinador = p_idCoordinador
         AND a26estado =
             decode(p_estado, 'T', a26estado, '', a26estado, p_estado);

      if (numReg = 0) then
        p_codError := 53;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;

    end if;

    -- si es supervisor o administrador
    if (idRol = 6 or idRol = 7) then
      SELECT COUNT(*)
        INTO numreg
        FROM T26_GRUPOSFACILITADOR, T06_USUARIOS, T07_PERSONAS
       WHERE a26periodo = codperiodo
         AND a26facilitador = a06codigo
         AND a06codigo = a07usuario
         AND a26estado =
             decode(p_estado, 'T', a26estado, '', a26estado, p_estado);

      if (numReg = 0) then
        p_codError := 53;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;

    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    if (idRol = 2) then
      OPEN p_resultado FOR
        SELECT a26codigo idespaciofisico,
               a26estado codestado,
               a90nombre estado,
               a02codigo iddepartamento,
               a02nombre nomdepartamento,
               a26ciudad idmunicipio,
               a03nombre nommunicipio,
               a26dia iddia,
               a23nombre dia,
               a26horario idhorario,
               a24horario horario,
               a26grupo idgrupo,
               a25nombre grupo,
               a26sigla siglagrupo,
               a26lugar lugar,
               a26direccion direccion,
               a26motivorechazo motivorechazo,
               a26facilitador idfacilitador,
               a07primernombre || ' ' || a07segundonombre || ' ' ||
               a07primerapellido || ' ' || a07segundoapellido nombrefacilitador
          FROM T26_GRUPOSFACILITADOR,
               T90_ESTADOSESPACIOFISICO,
               T02_DEPARTAMENTOS,
               T03_MUNICIPIOS,
               T23_DIAS,
               T24_HORARIOS,
               T25_GRUPOS,
               T06_USUARIOS,
               T07_PERSONAS
         WHERE a26estado = a90codigo
           AND a26ciudad = a03codigo
           AND a03departamento = a02codigo
           AND a26dia = a23codigo
           AND a26horario = a24codigo
           AND a26grupo = a25codigo
           AND a26facilitador = a06codigo
           AND a06codigo = a07usuario
           AND a06coordinador = p_idCoordinador
           AND a26periodo = codperiodo
           AND a26estado =
               decode(p_estado, 'T', a26estado, '', a26estado, p_estado)
           AND (UPPER(a02nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a03nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a23nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a24horario) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a26sigla) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a26lugar) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a26direccion) LIKE '%' || UPPER(p_consulta) || '%')
         order by T90_ESTADOSESPACIOFISICO.A90NOMBRE desc;

    end if;

    -- si es supervisor o administrador
    if (idRol = 6 or idRol = 7) then
      OPEN p_resultado FOR
        SELECT a26codigo idespaciofisico,
               a26estado codestado,
               a90nombre estado,
               a02codigo iddepartamento,
               a02nombre nomdepartamento,
               a26ciudad idmunicipio,
               a03nombre nommunicipio,
               a26dia iddia,
               a23nombre dia,
               a26horario idhorario,
               a24horario horario,
               a26grupo idgrupo,
               a25nombre grupo,
               a26sigla siglagrupo,
               a26lugar lugar,
               a26direccion direccion,
               a26motivorechazo motivorechazo,
               a26facilitador idfacilitador,
               a07primernombre || ' ' || a07segundonombre || ' ' ||
               a07primerapellido || ' ' || a07segundoapellido nombrefacilitador
          FROM T26_GRUPOSFACILITADOR,
               T90_ESTADOSESPACIOFISICO,
               T02_DEPARTAMENTOS,
               T03_MUNICIPIOS,
               T23_DIAS,
               T24_HORARIOS,
               T25_GRUPOS,
               T06_USUARIOS,
               T07_PERSONAS
         WHERE a26estado = a90codigo
           AND a26ciudad = a03codigo
           AND a03departamento = a02codigo
           AND a26dia = a23codigo
           AND a26horario = a24codigo
           AND a26grupo = a25codigo
           AND a26facilitador = a06codigo
           AND a06codigo = a07usuario
           AND a26periodo = codperiodo
           AND a26estado =
               decode(p_estado, 'T', a26estado, '', a26estado, p_estado)
           AND (UPPER(a02nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a03nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a23nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a24horario) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a26sigla) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a26lugar) LIKE '%' || UPPER(p_consulta) || '%' OR
               UPPER(a26direccion) LIKE '%' || UPPER(p_consulta) || '%')
         order by T90_ESTADOSESPACIOFISICO.A90NOMBRE desc;
    end if;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta espacio fisico por aprobar OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarEspacioFisicoXAprobar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para aprobar espacio fisico
  PARAMETROS    :
  IN    :
           p_idCoordinador
           p_idEspacioFisico

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 13/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE pr_AprobarEspacioFisico(p_idCoordinador   IN NUMBER,
                                    p_idEspacioFisico IN NUMBER,
                                    p_codError        OUT NUMBER,
                                    p_msjError        OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'pr_AprobarEspacioFisico';
    numReg               NUMBER;
    codPeriodo           NUMBER;
    idTaller             number;
    idFacilitador        number;

    CURSOR curTallere IS
      SELECT a17codigo FROM t17_talleres WHERE a17estado = 'A';

    CURSOR curEntregable IS
      SELECT a19entregable
        FROM t19_tallerentregables
       WHERE a19estado = 'A'
         and a19taller = idTaller;

  BEGIN

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a aprobar espacio fisio ');

    UPDATE T26_GRUPOSFACILITADOR
       SET a26estado              = PK_UTILS.APR_ACTIVO,
           a26fechamodificacion   = SYSDATE,
           a26usuariomodificacion = p_idCoordinador
     WHERE a26codigo = p_idEspacioFisico;

    select a26facilitador
      into idFacilitador
      from T26_GRUPOSFACILITADOR
     WHERE a26codigo = p_idEspacioFisico;

    FOR regTaller IN curTallere LOOP

      select count(*)
        into numReg
        from t21_realizaciontaller
       where a21grupo = p_idEspacioFisico
         and a21taller = regTaller.a17codigo;

      if (numReg = 0) then

        insert into t21_realizaciontaller
          (a21codigo,
           a21grupo,
           a21taller,
           a21fechataller,
           a21facilitador,
           a21periodo,
           a21estado,
           a21fechacreacion,
           a21fechamodificacion,
           a21usuariocreacion,
           a21usuariomodificacion,
           a21motivorechazo,
           a21asistentes,
           a21noasistentes)
          select t21_realizaciontaller_seq.nextval,
                 p_idEspacioFisico,
                 regTaller.a17codigo,
                 null,
                 idFacilitador,
                 codPeriodo,
                 'S',
                 sysdate,
                 sysdate,
                 p_idCoordinador,
                 p_idCoordinador,
                 '',
                 0,
                 0
            from dual;
      end if;

      idTaller := regTaller.a17codigo;

      FOR regEntregable IN curEntregable LOOP
        select count(*)
          into numReg
          from t20_entregablescargados
         where a20grupo = p_idEspacioFisico
           and a20taller = regTaller.a17codigo
           and a20entregable = regEntregable.a19Entregable;

        if numReg = 0 then
          insert into t20_entregablescargados
            (a20codigo,
             a20grupo,
             a20taller,
             a20entregable,
             a20ruta,
             a20facilitador,
             a20periodo,
             a20estado,
             a20motivorechazo,
             a20fechacreacion,
             a20fechamodificacion,
             a20usuariocreacion,
             a20usuariomodificacion)
            select t20_entregablescargados_seq.nextval,
                   p_idEspacioFisico,
                   regTaller.a17codigo,
                   regEntregable.a19Entregable,
                   '',
                   idFacilitador,
                   codPeriodo,
                   'S',
                   '',
                   sysdate,
                   sysdate,
                   0,
                   0
              from dual;

        end if;

      END LOOP;

    end loop;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Aprobar esapcio fisico OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END pr_AprobarEspacioFisico;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para rechazar esapcio fisico
  PARAMETROS    :
  IN    :
           p_idCoordinador
           p_idEspacioFisico
           p_motivoRechazo

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 13/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE pr_RechazarEspacioFisico(p_idCoordinador   IN NUMBER,
                                     p_idEspacioFisico IN NUMBER,
                                     p_motivoRechazo   IN VARCHAR2,
                                     p_codError        OUT NUMBER,
                                     p_msjError        OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'pr_RechazarEspacioFisico';
    numReg               NUMBER;
    codPeriodo           NUMBER;
    idGrupo              NUMBER;

  BEGIN

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a rechazar espacio fisico ');
    select a26grupo
      into idGrupo
      FROM T26_GRUPOSFACILITADOR
     where a26codigo = p_idEspacioFisico;

    -- si es nivelacion o contingencia no se pueden rechazar
    if (idGrupo = 11 or idGrupo = 12) then
      p_codError := 104;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    UPDATE T26_GRUPOSFACILITADOR
       SET a26estado              = PK_UTILS.APR_RECHAZO,
           a26motivorechazo       = p_motivoRechazo,
           a26fechamodificacion   = SYSDATE,
           a26usuariomodificacion = p_idCoordinador
     WHERE a26codigo = p_idEspacioFisico;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Rechazar espacio fisico OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END pr_RechazarEspacioFisico;

  FUNCTION fn_ValidarHorario(p_idFacilitador IN NUMBER,
                             p_idDia         IN NUMBER,
                             p_hinicio       IN NUMBER,
                             p_hfin          IN NUMBER) RETURN NUMBER IS

    codPeriodo NUMBER;

    CURSOR c_horario IS
      SELECT COUNT(1)
        FROM T26_GRUPOSFACILITADOR t
       WHERE a26facilitador = p_idFacilitador
         AND a26periodo = codPeriodo
         AND t.a26dia = p_idDia
         AND (a26horario =
             (SELECT a24codigo
                 FROM T24_HORARIOS
                WHERE p_hinicio > TO_NUMBER(SUBSTR(a24horario, 1, 2))
                  AND p_hinicio < TO_NUMBER(SUBSTR(a24horario, 9, 2))) OR
             a26horario =
             (SELECT a24codigo
                 FROM T24_HORARIOS
                WHERE p_hfin > TO_NUMBER(SUBSTR(a24horario, 1, 2))
                  AND p_hfin < TO_NUMBER(SUBSTR(a24horario, 9, 2))));

    v_valor NUMBER;

  BEGIN

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;

    OPEN c_horario;
    FETCH c_horario
      INTO v_valor;
    CLOSE c_horario;

    RETURN v_valor;

  END fn_ValidarHorario;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los departamentos asociados al facilitador
  PARAMETROS    :
  IN    :
         p_idFacilitador


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 07/04/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarDeptosFacilitador(p_idFacilitador IN NUMBER,
                                    p_resultado     OUT PK_UTILS.ty_cursor,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarDeptosFacilitador';
    numReg               NUMBER;
    idRol                number;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar departamentos del facilitador' ||
                            p_idFacilitador);
    select a06rol
      into idRol
      from t06_usuarios
     where a06codigo = p_idFacilitador;

    if (idrol = 1) then
      SELECT COUNT(*)
        INTO numReg
        FROM T06_USUARIOS,
             T30_CIUDADESUSUARIO,
             T03_MUNICIPIOS,
             T02_DEPARTAMENTOS
       WHERE a06codigo = p_idFacilitador
         AND a06estado = PK_UTILS.COD_ACTIVO
         AND a06codigo = a30usuario
         AND a30ciudad = a03codigo
         AND a03departamento = a02codigo;

      if (numReg = 0) then
        p_codError := 55;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    if (idRol = 1) then
      OPEN p_resultado FOR
        SELECT DISTINCT a02codigo,
                        upper(a02nombre) a02nombre,
                        a02dane,
                        a02indicativo,
                        a02estado,
                        a02fechacreacion,
                        a02fechamodificacion,
                        a02usuariocreacion,
                        a02usuariomodificacion
          FROM T06_USUARIOS,
               T30_CIUDADESUSUARIO,
               T03_MUNICIPIOS,
               T02_DEPARTAMENTOS
         WHERE a06codigo = p_idFacilitador
           AND a06estado = PK_UTILS.COD_ACTIVO
           AND a06codigo = a30usuario
           AND a30ciudad = a03codigo
           AND a03departamento = a02codigo;
    end if;

    if (idRol = 2) then
      OPEN p_resultado FOR
        SELECT DISTINCT a02codigo,
                        upper(a02nombre) a02nombre,
                        a02dane,
                        a02indicativo,
                        a02estado,
                        a02fechacreacion,
                        a02fechamodificacion,
                        a02usuariocreacion,
                        a02usuariomodificacion
          FROM T06_USUARIOS,
               T30_CIUDADESUSUARIO,
               T03_MUNICIPIOS,
               T02_DEPARTAMENTOS
         WHERE a06coordinador = p_idFacilitador
           AND a06estado = PK_UTILS.COD_ACTIVO
           AND a06codigo = a30usuario
           AND a30ciudad = a03codigo
           AND a03departamento = a02codigo;
    end if;
    if (idRol = 6) then
      OPEN p_resultado FOR
        SELECT DISTINCT a02codigo,
                        upper(a02nombre) a02nombre,
                        a02dane,
                        a02indicativo,
                        a02estado,
                        a02fechacreacion,
                        a02fechamodificacion,
                        a02usuariocreacion,
                        a02usuariomodificacion
          FROM T06_USUARIOS,
               T30_CIUDADESUSUARIO,
               T03_MUNICIPIOS,
               T02_DEPARTAMENTOS
         WHERE a06estado = PK_UTILS.COD_ACTIVO
           AND a06codigo = a30usuario
           AND a30ciudad = a03codigo
           AND a03departamento = a02codigo;
    end if;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta departamentos facilitador OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarDeptosFacilitador;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar las ciudades asociados al facilitador
                   y departamento
  PARAMETROS    :
  IN    :
         p_idFacilitador
         p_idDepartamento


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarMunicipiosFacilitador(p_idFacilitador  IN NUMBER,
                                        p_idDepartamento IN NUMBER,
                                        p_resultado      OUT PK_UTILS.ty_cursor,
                                        p_codError       OUT NUMBER,
                                        p_msjError       OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarMunicipiosFacilitador';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar ciudades del facilitador' ||
                            p_idFacilitador);

    SELECT COUNT(*)
      INTO numReg
      FROM T06_USUARIOS, T30_CIUDADESUSUARIO, T03_MUNICIPIOS
     WHERE a06codigo = p_idFacilitador
       AND a06estado = PK_UTILS.COD_ACTIVO
       AND a06codigo = a30usuario
       AND a30ciudad = a03codigo
       AND a03departamento = p_idDepartamento;

    if (numReg = 0) then
      p_codError := 28;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT a03codigo,
             a03departamento,
             upper(a03nombre) a03nombre,
             a03dane,
             a03estado,
             a03fechacreacion,
             a03fechamodificacion,
             a03usuariocreacion,
             a03usuariomodificacion
        FROM T06_USUARIOS, T30_CIUDADESUSUARIO, T03_MUNICIPIOS
       WHERE a06codigo = p_idFacilitador
         AND a06estado = PK_UTILS.COD_ACTIVO
         AND a06codigo = a30usuario
         AND a30ciudad = a03codigo
         AND a03departamento = p_idDepartamento;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta ciudades OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarMunicipiosFacilitador;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para reasignar el espacio fisico al inscrito
  PARAMETROS    :
  IN    :
           p_idInscrito
           p_idGrupoFacilitador
           p_idUsuario

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 15/04/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ReasignarEspacio(p_idInscrito         IN NUMBER,
                                p_idGrupoFacilitador IN NUMBER,
                                p_idUsuario          IN NUMBER,
                                p_idPeriodo          IN NUMBER,
                                p_codError           OUT NUMBER,
                                p_msjError           OUT VARCHAR2) IS

    codExcepcion          NUMBER;
    NOMBRE_PROCEDIMIENTO  VARCHAR2(50) := 'Pr_ReasignarEspacio';
    idGrupoFacilitadorAnt number;

    numCupos      number;
    codPeriodoIns number;
    numReg        number;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a reasignar espacio fisico ');

    codPeriodoIns := PK_UTILS.Fn_ObtenerPeriodoInscripcion;

    numCupos := TO_NUMBER(Pk_Utils.Fn_Obtenervalorparametro('CUPOS'));

    -- validar cantidad de inscritos en el grupo seleccionado
    SELECT COUNT(*)
      INTO numReg
      FROM T26_GRUPOSFACILITADOR, T15_INSCRITOS
     WHERE a26codigo = p_idGrupoFacilitador
       AND a26codigo = a15grupofacilitador
       AND a26estado = PK_UTILS.COD_ACTIVO;


    IF (numReg >= numCupos) THEN
      p_codError := 18;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      RETURN;
    END IF;

    select a15grupofacilitador
      into idGrupoFacilitadorAnt
      from T15_INSCRITOS
     where a15codigo = p_idInscrito;

    -- actualizar grupo donde esta facilitador
    UPDATE T15_INSCRITOS
       SET a15grupofacilitador    = p_idGrupoFacilitador,
           a15fechamodificacion   = SYSDATE,
           a15usuariomodificacion = p_idUsuario
     WHERE a15codigo = p_idInscrito;

    -- inactivar grupos anteriores donde pudo estar el inscrito anteriormente
    update t53_grupoinscrito
       set a53estado = 'I', a53fechamodificacion = sysdate
     where a53inscrito = p_idInscrito
       and a53estado <> 'I';

    -- agrega nuevo grupo al que va a pertenecer

    insert into t53_grupoinscrito
      (a53codigo,
       a53grupofacilitador,
       a53periodo,
       a53inscrito,
       a53estado,
       a53fechacreacion,
       a53fechamodificacion,
       a53usuariocreacion,
       a53usuariomodificacion)
      select t53_grupoinscrito_seq.nextval,
             p_idGrupoFacilitador,
             codPeriodoIns,
             p_idInscrito,
             'A',
             sysdate,
             sysdate,
             0,
             0
        from dual;

    update t26_gruposfacilitador
       set a26inscritos = a26inscritos - 1
     where a26codigo = idGrupoFacilitadorAnt;

    update t26_gruposfacilitador
       set a26inscritos = a26inscritos + 1
     where a26codigo = p_idGrupoFacilitador;

    pk_ali_inscripcion.pr_enviarcorreoinscripcion(p_idInscrito,
                                                  p_coderror,
                                                  p_msjerror);

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Reasignar espacio fisico OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ReasignarEspacio;

END PK_OPE_ADMESPACIOFISICO;
/

prompt
prompt Creating package body PK_OPE_ADMUSUARIO
prompt =======================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_OPE_ADMUSUARIO IS
  /********************************************************************************
   DESCRIPCION   : Procedimiento encargado validar la autenticacion de los usuarios

   PARAMETROS    :
   IN            : p_usuario
                   p_clave

   OUT           : p_codError        Codigo de error generado
                   p_msjError        Mensaje del error generado

  REALIZADO POR    : 
                      

  FECHA CREACION    : 04/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_AutenticarUsuario(p_usuario   IN VARCHAR2,
                                 p_clave     IN VARCHAR2,
                                 p_codError  OUT NUMBER,
                                 p_msjError  OUT VARCHAR2,
                                 p_idUsuario OUT NUMBER) IS
    CURSOR c_intentos IS
      SELECT NVL(a06intentos, 0)
        FROM T06_USUARIOS t
       WHERE t.a06usuario = p_usuario;

    codExcepcion         NUMBER;
    numReg               NUMBER;
    intentos             NUMBER;
    maxIntentos          NUMBER;
    maxDiasInac          NUMBER;
    maxDiasCambioClave   NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_AutenticarUsuario';

    /*    md5Clave varchar2(64);*/

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_INFO,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a autenticar usuario ');

    --GRANT EXECUTE ON SYS.DBMS_CRYPTO TO PUBLIC;

    /*    select rawtohex(DBMS_CRYPTO.Hash(UTL_I18N.STRING_TO_RAW(p_clave,
                                                          'AL32UTF8'),
                                   2))
    into md5Clave
    from dual;*/

    maxIntentos        := TO_NUMBER(Pk_Utils.Fn_Obtenervalorparametro('INTENTOS'));
    maxDiasInac        := TO_NUMBER(Pk_Utils.Fn_Obtenervalorparametro('DIASINACTIVIDAD'));
    maxDiasCambioClave := TO_NUMBER(Pk_Utils.Fn_Obtenervalorparametro('CAMBIOCLAVE'));

    IF p_usuario IS NULL AND p_clave IS NULL THEN
      p_codError := 21;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;

    SELECT COUNT(*)
      INTO numReg
      FROM T06_USUARIOS t
     WHERE t.a06usuario = p_usuario;

    IF (numReg = 0) THEN
      p_codError := 22;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      RETURN;
    END IF;

    SELECT COUNT(*)
      INTO numReg
      FROM T06_USUARIOS t
     WHERE t.a06usuario = p_usuario
       AND t.a06estado = PK_UTILS.COD_ACTIVO;

    IF (numReg = 0) THEN
      p_codError := 24;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      RETURN;
    END IF;

    OPEN c_intentos;
    FETCH c_intentos
      INTO intentos;
    CLOSE c_intentos;

    IF intentos >= maxIntentos THEN

      UPDATE T06_USUARIOS SET a06estado = 'B' WHERE a06usuario = p_usuario;

      p_codError := 31;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      RETURN;
    END IF;

    SELECT COUNT(*)
      INTO numReg
      FROM T06_USUARIOS t
     WHERE t.a06usuario = p_usuario
       AND upper(t.a06clave) = upper(p_clave);

    IF (numReg = 0) THEN

      UPDATE T06_USUARIOS
         SET a06intentos = intentos + 1
       WHERE a06usuario = p_usuario;

      p_codError := 23;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      RETURN;
    END IF;

    SELECT COUNT(*)
      INTO numReg
      FROM T06_USUARIOS t
     WHERE t.a06usuario = p_usuario
       AND maxDiasCambioClave <= TRUNC(SYSDATE) - TRUNC(t.a06fechaclave);

    IF (numReg != 0) THEN
      p_codError := 25;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      RETURN;
    END IF;

    SELECT COUNT(*)
      INTO numReg
      FROM T06_USUARIOS t
     WHERE t.a06usuario = p_usuario
       AND maxDiasInac <= TRUNC(SYSDATE) - TRUNC(t.a06fechaultimoingreso);

    IF (numReg != 0) THEN
      p_codError := 34;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      RETURN;
    END IF;

    SELECT t.a06codigo
      INTO p_idUsuario
      FROM T06_USUARIOS t
     WHERE t.a06usuario = p_usuario;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    UPDATE T06_USUARIOS
       SET a06intentos = 0, a06fechaultimoingreso = TRUNC(SYSDATE)
     WHERE a06usuario = p_usuario;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Autenticar usuario OK ');
  EXCEPTION
    WHEN OTHERS THEN

      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_AutenticarUsuario;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los usuarios registrados
  PARAMETROS    :
  IN    :
          p_consulta

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 04/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_DarUsuarios(p_consulta  IN VARCHAR2,
                           p_resultado OUT PK_UTILS.ty_cursor,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarUsuarios';

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar usuarios ');

    OPEN p_resultado FOR

      SELECT a06codigo,
             a06rol,
             a06usuario,
             a07codigo,
             a07tipodocumento,
             a07identificacion,
             a07primernombre,
             a07segundonombre,
             a07primerapellido,
             a07segundoapellido,
             TO_CHAR(a07fechanacimiento, 'YYYY-MM-DD') a07fechanacimiento,
             a07email,
             a07telefono,
             a07movil,
             a07movilalt,
             a06estado,
             a93nombre,
             Pk_Ope_Admusuario.Fn_Darciudadesnom(a06codigo) ciudades,
             A06PERFIL,
             A06clave,
             nvl(a06coordinador, 0) a06coordinador,
             a05nombre
        FROM T06_USUARIOS, T07_PERSONAS, T93_ESTADOSUSUARIO, t05_roles
       WHERE a06codigo = a07usuario
         AND a06estado = a93codigo
         and a06rol = a05codigo
         AND (UPPER(a06usuario) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a07primernombre) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a07segundonombre) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a07primerapellido) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a07segundoapellido) LIKE
             '%' || UPPER(p_consulta) || '%' OR
             UPPER(a07email) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a07identificacion) LIKE '%' || UPPER(p_consulta) || '%');

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  usuarios ok ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarUsuarios;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los roles registrados
  PARAMETROS    :
  IN    :
          p_consulta

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 04/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarRoles(p_consulta  IN VARCHAR2,
                        p_resultado OUT PK_UTILS.ty_cursor,
                        p_codError  OUT NUMBER,
                        p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarRoles';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar roles ');

    OPEN p_resultado FOR
      SELECT a05codigo, a05nombre, a05estado, a91nombre
        FROM T05_ROLES, T91_ESTADOSITEM
       WHERE UPPER(a05nombre) LIKE '%' || UPPER(p_consulta) || '%'
         AND a05estado = a91codigo;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta roles OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarRoles;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los coordinadores activos registrados
  PARAMETROS    :
  IN    :


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarCoordinadores(p_resultado OUT PK_UTILS.ty_cursor,
                                p_codError  OUT NUMBER,
                                p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarCoordinadores';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar cordinadores ');

    OPEN p_resultado FOR
      SELECT a06codigo,
             a07primernombre || ' ' || a07segundonombre || ' ' ||
             a07primerapellido || ' ' || a07segundoapellido nombre
        FROM T05_ROLES, T06_USUARIOS, T07_PERSONAS
       WHERE a05codigo = a06rol
         AND a05nombre = 'COORDINADOR TERRITORIAL'
         AND a06codigo = a07usuario;
        -- AND a06estado = PK_UTILS.COD_ACTIVO;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta cordinadores OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarCoordinadores;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los municipios
  PARAMETROS    :
  IN    :


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarMunicipios(p_resultado OUT PK_UTILS.ty_cursor,
                             p_codError  OUT NUMBER,
                             p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarMunicipios';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar municipios ');

    SELECT COUNT(*)
      INTO numReg
      FROM T03_MUNICIPIOS t
     WHERE t.a03estado = PK_UTILS.COD_ACTIVO;

    if (numReg = 0) then
      p_codError := 26;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      select a03codigo,
             a03departamento,
             upper(a03nombre) || ' - ' || upper(d.a02nombre) a03nombre,
             a03dane,
             a03estado,
             a03fechacreacion,
             a03fechamodificacion,
             a03usuariocreacion,
             a03usuariomodificacion
        FROM T03_MUNICIPIOS t, t02_departamentos d
       WHERE t.a03estado = PK_UTILS.COD_ACTIVO
         and t.a03departamento = d.a02codigo
       order by t.a03nombre;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta municipios OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarMunicipios;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la persona y las ciudades asignadas
  PARAMETROS    :
  IN    :
         p_idusuario


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ConsultarUsuario(p_idusuario IN NUMBER,
                                p_resultado OUT PK_UTILS.ty_cursor,
                                p_codError  OUT NUMBER,
                                p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ConsultarUsuario';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar usuarios ');

    SELECT COUNT(*)
      INTO numReg
      FROM T06_USUARIOS, T07_PERSONAS
     WHERE a06codigo = a07usuario
       AND a06codigo = p_idusuario;
    --AND a06estado = PK_UTILS.COD_ACTIVO;

    if (numReg = 0) then
      p_codError := 27;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT a06codigo,
             a06rol,
             a06usuario,
             a07codigo,
             a07tipodocumento,
             a07identificacion,
             a07primernombre,
             a07segundonombre,
             a07primerapellido,
             a07segundoapellido,
             TO_CHAR(a07fechanacimiento, 'YYYY-MM-DD') a07fechanacimiento,
             a07email,
             a07telefono,
             a07movil,
             a07movilalt,
             a06estado,
             a93nombre,
             Pk_Ope_Admusuario.Fn_Darciudades(a06codigo) ciudades,
             A06PERFIL,
             a06clave,
             nvl(a06coordinador, 0) a06coordinador,
             a05nombre
        FROM T06_USUARIOS, T07_PERSONAS, T93_ESTADOSUSUARIO, t05_roles
       WHERE a06codigo = a07usuario
         AND a06estado = a93codigo
         and a06rol = a05codigo
         AND a06codigo = p_idusuario;
    --AND a06estado = PK_UTILS.COD_ACTIVO;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta usuarios OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ConsultarUsuario;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar las ciudades asignadas al usuario
  PARAMETROS    :
  IN    :
         p_idusuario


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Darciudades(p_idusuario IN NUMBER,
                           p_resultado OUT PK_UTILS.ty_cursor,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_Darciudades';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar usuarios ');

    SELECT COUNT(*)
      INTO numReg
      FROM T06_USUARIOS, T30_CIUDADESUSUARIO, T03_MUNICIPIOS
     WHERE a06codigo = p_idusuario
       AND a06estado = PK_UTILS.COD_ACTIVO
       AND a06codigo = a30usuario
       AND a30ciudad = a03codigo;

    if (numReg = 0) then
      p_codError := 28;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT a03codigo, a03departamento, a03nombre, a03dane, a03estado
        FROM T06_USUARIOS, T30_CIUDADESUSUARIO, T03_MUNICIPIOS
       WHERE a06codigo = p_idusuario
         AND a06estado = PK_UTILS.COD_ACTIVO
         AND a06codigo = a30usuario
         AND a30ciudad = a03codigo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta usuarios OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_Darciudades;

  /********************************************************************************
  DESCRIPCION    : Funcion para consultar los ID de las ciudades asignadas al usuario
  PARAMETROS    :
  IN    :
          p_idusuario


  OUT    :
          ciudades


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  FUNCTION Fn_DarCiudades(p_idusuario IN NUMBER) RETURN VARCHAR2 IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Fn_DarCiudades';
    numReg               NUMBER;
    ciudades             VARCHAR2(2000);

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar ciudades ');

    FOR j IN (SELECT a03codigo
                FROM T06_USUARIOS, T30_CIUDADESUSUARIO, T03_MUNICIPIOS
               WHERE a06codigo = p_idusuario
                 AND a06estado = PK_UTILS.COD_ACTIVO
                 AND a06codigo = a30usuario
                 AND a30ciudad = a03codigo) LOOP

      ciudades := ciudades || j.a03codigo || ',';

    END LOOP;

    ciudades := SUBSTR(ciudades, 1, LENGTH(ciudades) - 1);

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta ciudades OK ');

    RETURN ciudades;

  END Fn_DarCiudades;

  /********************************************************************************
  DESCRIPCION    : Funcion para consultar los nombres de las ciudades asignadas al usuario
  PARAMETROS    :
  IN    :
          p_idusuario


  OUT    :
          ciudades


  REALIZADO POR    : 
  FECHA CREACION    : 08/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  FUNCTION Fn_DarCiudadesNom(p_idusuario IN NUMBER) RETURN VARCHAR2 IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Fn_DarCiudades';
    numReg               NUMBER;
    ciudades             VARCHAR2(2000);

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar ciudades ');

    FOR j IN (SELECT a03nombre
                FROM T06_USUARIOS, T30_CIUDADESUSUARIO, T03_MUNICIPIOS
               WHERE a06codigo = p_idusuario
                 AND a06estado = PK_UTILS.COD_ACTIVO
                 AND a06codigo = a30usuario
                 AND a30ciudad = a03codigo) LOOP

      ciudades := ciudades || j.a03nombre || ',';

    END LOOP;

    ciudades := SUBSTR(ciudades, 1, LENGTH(ciudades) - 1);

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta ciudades OK ');

    RETURN ciudades;

  END Fn_DarCiudadesNom;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los menus activos
  PARAMETROS    :
  IN    :


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarMenus(p_resultado OUT PK_UTILS.ty_cursor,
                        p_codError  OUT NUMBER,
                        p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarMenus';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar menus ');

    SELECT COUNT(*)
      INTO numReg
      FROM T09_MENU t
     WHERE t.a09estado = PK_UTILS.COD_ACTIVO;

    if (numReg = 0) then
      p_codError := 29;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT *
        FROM T09_MENU t
       WHERE t.a09estado = PK_UTILS.COD_ACTIVO
       ORDER BY t.a09orden;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta menus OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarMenus;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar las opciones activas del menu
  PARAMETROS    :
  IN    :
          p_idmenu


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarOpcionesMenu(p_idmenu    IN NUMBER,
                               p_resultado OUT PK_UTILS.ty_cursor,
                               p_codError  OUT NUMBER,
                               p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarOpcionesMenu';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar opciones menu ');

    SELECT COUNT(*)
      INTO numReg
      FROM T11_MENUOPCIONES t, T10_OPCIONES t10
     WHERE t.a11menu = p_idmenu
       AND t.a11opcion = t10.a10codigo
       AND t10.a10estado = PK_UTILS.COD_ACTIVO;

    if (numReg = 0) then
      p_codError := 30;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT *
        FROM T11_MENUOPCIONES t, T10_OPCIONES t10
       WHERE t.a11menu = p_idmenu
         AND t.a11opcion = t10.a10codigo
         AND t10.a10estado = PK_UTILS.COD_ACTIVO
       ORDER BY t10.a10orden;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta opciones menu OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarOpcionesMenu;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los roles
  PARAMETROS    :
  IN    :
          p_rol
          p_opciones

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ConsultarRol(p_idrol     IN NUMBER,
                            p_resultado OUT PK_UTILS.ty_cursor,
                            p_codError  OUT NUMBER,
                            p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ConsultarRol';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar rol ');

    SELECT COUNT(*)
      INTO numReg
      FROM T05_ROLES t
     WHERE t.a05codigo = p_idrol
       AND t.a05estado = PK_UTILS.COD_ACTIVO;

    IF (numReg = 0) THEN
      p_codError := 32;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      RETURN;
    END IF;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT a05codigo, a05nombre, a05estado, a91nombre
        FROM T05_ROLES, T91_ESTADOSITEM
       WHERE a05codigo = p_idrol
         AND a05estado = a91codigo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta role OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ConsultarRol;

  PROCEDURE Pr_DarOpcionesMenuRol(p_idrol     IN NUMBER,
                                  p_idMenu    IN NUMBER,
                                  p_resultado OUT PK_UTILS.ty_cursor,
                                  p_codError  OUT NUMBER,
                                  p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarOpcionesMenuRol';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar opciones de menu rol ');

    SELECT COUNT(*)
      INTO numReg
      FROM t96_opcionrol t96, t10_opciones t10
     WHERE --t96.a96menu = p_idMenu and
       t96.a96rol = p_idrol
       and t96.a96opcion = t10.a10codigo
       and t10.a10estado = PK_UTILS.COD_ACTIVO;

    IF (numReg = 0) THEN
      p_codError := 33;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      RETURN;
    END IF;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT --t96.a96menu   a11menu,
             t96.a96opcion a11opcion,
             t10.a10nombre,
             t10.a10tag,
             t10.a10orden
        FROM t96_opcionrol t96, t10_opciones t10
       WHERE --t96.a96menu = p_idMenu
          t96.a96rol = p_idrol
         and t96.a96opcion = t10.a10codigo
         and t10.a10estado = PK_UTILS.COD_ACTIVO;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta opciones menu rol OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarOpcionesMenuRol;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar los datos del usuario
  PARAMETROS    :
  IN    :
          p_rol
          p_coordinador
          p_login
          p_clave
          p_tipodocumento
          p_identificacion
          p_primernombre
          p_segundonombre
          p_primerapellido
          p_segundoapellido
          p_fechanacimiento
          p_email
          p_telefono
          p_movil
          p_movilalt
          p_estado
          p_perfil
          p_ciudades
          p_usuario
          p_codError
          p_msjError

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 08/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ActualizarUsuario(p_idUsuario       IN NUMBER, -- Si es cero es nuevo, de lo contrario es edicion
                                 p_rol             IN NUMBER,
                                 p_coordinador     IN NUMBER,
                                 p_login           IN VARCHAR2,
                                 p_clave           IN VARCHAR2,
                                 p_tipodocumento   IN VARCHAR2,
                                 p_identificacion  IN VARCHAR2,
                                 p_primernombre    IN VARCHAR2,
                                 p_segundonombre   IN VARCHAR2,
                                 p_primerapellido  IN VARCHAR2,
                                 p_segundoapellido IN VARCHAR2,
                                 p_fechanacimiento IN VARCHAR2, --- yyyy-mm-dd
                                 p_email           IN VARCHAR2,
                                 p_telefono        IN VARCHAR2,
                                 p_movil           IN VARCHAR2,
                                 p_movilalt        IN VARCHAR2,
                                 p_estado          IN VARCHAR2,
                                 p_perfil          IN NUMBER,
                                 p_ciudades        IN VARCHAR2,
                                 p_usuario         IN NUMBER,
                                 p_codError        OUT NUMBER,
                                 p_msjError        OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ActualizarUsuario';
    numReg               NUMBER;
    codUsuario           NUMBER;
    codPersona           NUMBER;
    codCiudad            NUMBER;
    ciudades             VARCHAR2(4000);
    valorCadena          VARCHAR2(4000);
    idCiudad             NUMBER;
    numCiclo             NUMBER;
    v_coordinador        NUMBER;

    aliasUsuario varchar2(15);
    correoUsuario varchar2(200);

  BEGIN
    -- si la contrasena esta '' no se cambia solo si es modificacion si es nuevo debe enviarla

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a actualizar usuario ' || p_ciudades);

    v_coordinador := p_coordinador;

    IF p_coordinador = 0 THEN
      v_coordinador := NULL;
    END IF;

    if (p_idUsuario = 0) then

      SELECT COUNT(1)
        INTO numReg
        FROM t07_personas t
       WHERE t.a07email = p_email;

      IF numReg > 0 THEN
        p_codError := 6;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      END IF;

      SELECT COUNT(1)
        INTO numReg
        FROM t06_usuarios t
       WHERE t.a06usuario = p_login;

      IF numReg > 0 THEN
        p_codError := 45;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      END IF;

    end if;

    -- Es una actualizacion
    if (p_idUsuario <> 0) then

      -- Si el alias de usuario cambiar validar que no se haya utilizado
      select a06usuario
        into aliasUsuario
        from t06_usuarios
       where a06codigo = p_idUsuario;

      -- El usuario CAT no permite cambios
      if upper(aliasUsuario) = 'CAT' then
        p_codError := 83;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;

      end if;


      if (upper(aliasUsuario) <> upper(p_login)) then

        SELECT COUNT(*)
          INTO numReg
          FROM t06_usuarios
         WHERE upper(a06usuario) = upper(p_login)
           and a06codigo <> p_idUsuario;

        IF numReg > 0 THEN
          p_codError := 45;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        END IF;

      end if;

      -- Si el correo de usuario cambiar validar que no se haya utilizado
      select a07email
        into correoUsuario
        from t07_personas
       where a07usuario = p_idUsuario;

      if (upper(correoUsuario) <> upper(p_email)) then

        SELECT COUNT(*)
          INTO numReg
          FROM t07_personas
         WHERE upper(a07email) = upper(p_email)
           and a07usuario <> p_idUsuario;

        IF numReg > 0 THEN
          p_codError := 6;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        END IF;

      end if;

    end if;

    IF (p_idUsuario = 0) THEN

      Pk_T06_Usuarios.Pr_Insertar(p_rol,
                                  v_coordinador,
                                  p_perfil,
                                  p_login,
                                  p_clave,
                                  p_estado,
                                  p_usuario,
                                  codUsuario);

      Pk_T07_Personas.Pr_Insertar(codUsuario,
                                  p_tipodocumento,
                                  p_identificacion,
                                  p_primernombre,
                                  p_segundonombre,
                                  p_primerapellido,
                                  p_segundoapellido,
                                  TO_DATE(p_fechanacimiento, 'yyyy-mm-dd'),
                                  p_email,
                                  p_telefono,
                                  p_movil,
                                  p_movilalt,
                                  p_usuario,
                                  codPersona);

      UPDATE T06_USUARIOS
         SET a06intentos = 0, a06fechaclave = TRUNC(SYSDATE)
       WHERE a06codigo = codUsuario;

    ELSE

      Pk_T06_Usuarios.Pr_Actualizar(p_idUsuario,
                                    p_rol,
                                    p_perfil,
                                    v_coordinador,
                                    p_login,
                                    p_clave,
                                    p_estado,
                                    p_usuario);

      codUsuario := p_idUsuario;

      SELECT t.a07codigo
        INTO codPersona
        FROM t07_personas t
       WHERE t.a07usuario = p_idUsuario;

      Pk_T07_Personas.Pr_Actualizar(codPersona,
                                    p_idUsuario,
                                    p_tipodocumento,
                                    p_identificacion,
                                    p_primernombre,
                                    p_segundonombre,
                                    p_primerapellido,
                                    p_segundoapellido,
                                    TO_DATE(p_fechanacimiento, 'yyyy-mm-dd'),
                                    p_email,
                                    p_telefono,
                                    p_movil,
                                    p_movilalt,
                                    p_usuario);

    END IF;

    COMMIT;

    DELETE FROM T30_CIUDADESUSUARIO WHERE a30usuario = p_idUsuario;

    if not p_ciudades is null then

      SELECT (LENGTH(p_ciudades) - LENGTH(REPLACE(p_ciudades, ',')))
        INTO numCiclo
        FROM DUAL;

      ciudades := p_ciudades;
      numCiclo := numCiclo + 1;

      FOR j IN 1 .. numCiclo LOOP

        IF j = numCiclo THEN
          idCiudad := ciudades;
        ELSE
          valorCadena := SUBSTR(ciudades, 1, INSTR(ciudades, ',', 1, 1));

          idCiudad := SUBSTR(valorCadena,
                             1,
                             INSTR(valorCadena, ',', 1, 1) - 1);

          ciudades := SUBSTR(ciudades, LENGTH(valorCadena) + 1);
        END IF;

        Pk_T30_Ciudadesusuario.Pr_Insertar(idCiudad,
                                           p_estado,
                                           codUsuario,
                                           p_usuario,
                                           codCiudad);

      END LOOP;
    end if;

    commit;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Actualizar usuario OK ');

  EXCEPTION
    WHEN OTHERS THEN
      ROLLBACK;
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      COMMIT;

  END Pr_ActualizarUsuario;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar los datos del usuario
  PARAMETROS    :
  IN    :
          p_rol
          p_coordinador
          p_login
          p_clave
          p_tipodocumento
          p_identificacion
          p_primernombre
          p_segundonombre
          p_primerapellido
          p_segundoapellido
          p_fechanacimiento
          p_email
          p_telefono
          p_movil
          p_movilalt
          p_estado
          p_perfil
          p_ciudades
          p_usuario
          p_codError
          p_msjError

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 09/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ActualizarRol(p_idRol    in number, -- Si es cero es nuevo , de lo contrario es edicion
                             p_nombre   IN VARCHAR2,
                             p_estado   IN VARCHAR2,
                             p_opciones IN VARCHAR2, -- conjunto idMenu, idOpcion
                             p_usuario  IN NUMBER,
                             p_codError OUT NUMBER,
                             p_msjError OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ActualizarRol';
    codRol               NUMBER;
    opciones             VARCHAR2(4000);
    valorCadena          VARCHAR2(4000);
    idMenu               NUMBER;
    idOpcion             NUMBER;
    numCiclo             NUMBER;
    longitud             NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a actualizar rol ');

    IF (p_idRol = 0) THEN

      Pk_T05_Roles.Pr_Insertar(p_nombre, p_estado, p_usuario, codRol);

    ELSE

      codRol := p_idRol;

      Pk_T05_Roles.Pr_Actualizar(codRol, p_nombre, p_estado, p_usuario);

      DELETE FROM T96_OPCIONROL WHERE a96rol = codRol;

    END IF;

    SELECT (LENGTH(p_opciones) - LENGTH(REPLACE(p_opciones, ',')))
      INTO numCiclo
      FROM dual;

    IF MOD(numCiclo + 1, 2) != 0 THEN
      p_codError := 35;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    END IF;

    opciones := p_opciones;

    numCiclo := (numCiclo + 1) / 2;

    FOR j IN 1 .. numCiclo LOOP

      IF j = numCiclo THEN
        valorCadena := opciones;
      ELSE
        valorCadena := SUBSTR(opciones, 1, INSTR(opciones, ',', 1, 2));
      END IF;

      longitud := LENGTH(SUBSTR(valorCadena,
                                1,
                                INSTR(valorCadena, ',', 1, 1))) + 1;

      idMenu := SUBSTR(valorCadena, 1, INSTR(valorCadena, ',', 1, 1) - 1);

      idOpcion := REPLACE(SUBSTR(valorCadena, longitud), ',');

      opciones := SUBSTR(opciones, LENGTH(valorCadena) + 1);

      pk_t96_opcionrol.Pr_Insertar( idOpcion, codRol, p_usuario);

    END LOOP;



    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Actualizar rol OK ');

  EXCEPTION
    WHEN OTHERS THEN
      ROLLBACK;
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ActualizarRol;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para restablecer contrasena
  PARAMETROS    :
  IN    :

          p_email


  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 02/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_RestaurarContrasena(p_email    IN VARCHAR2,
                                   p_codError OUT NUMBER,
                                   p_msjError OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    numReg               NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_RestaurarContrasena';

    idUsuario number;
    token     varchar2(200);

    codErrorEnvioCorreo number;
    msjErrorEnvioCorreo varchar2(2000);

  BEGIN
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a restaurar contrasena ' || p_email);

    select COUNT(*)
      into numReg
      from t07_personas p
     where upper(p.a07email) = upper(p_email);

    if numReg = 0 then
      p_codError := 68;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    select a07usuario
      into idUsuario
      from t07_personas p
     where upper(p.a07email) = upper(p_email);

    select count(*)
      into numReg
      from t06_usuarios u
     where u.a06codigo = idUsuario
       and u.a06estado = 'I';

    -- Solo se permite restaurar contrasena a usuarios activos o bloqueados por clave
    if numReg > 0 then
      p_codError := 71;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    select rawtohex(DBMS_CRYPTO.Hash(UTL_I18N.STRING_TO_RAW(p_email ||
                                                            to_char(sysdate,
                                                                    'hh24miss'),
                                                            'AL32UTF8'),
                                     2))
      into token
      from dual;

    update t54_tokenusuario
       set a54estado = 'I'
     where a54usuario = idUsuario
       and a54usotoken = 'RESTOREPWD';

    numReg := Pk_Utils.Fn_Obtenerid('t54_tokenusuario_seq');

    insert into t54_tokenusuario
      (a54codigo,
       a54usuario,
       a54token,
       a54fechageneracion,
       a54usotoken,
       a54estado)
    values
      (numReg, idUsuario, token, sysdate, 'RESTOREPWD', 'A');

    commit;

    pk_utils.Pr_EnviarCorreoWS(p_email,
                               'RESTOREPWD',
                               numReg,
                               codErrorEnvioCorreo,
                               msjErrorEnvioCorreo);

    if (codErrorEnvioCorreo <> 0) then
      p_codError := 69;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError) || ' ' ||
                    msjErrorEnvioCorreo;
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio de restaurar contrasena  ');

  EXCEPTION
    WHEN OTHERS THEN
      ROLLBACK;
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_RestaurarContrasena;

  PROCEDURE Pr_AsignarContrasenaXToken(p_token      IN VARCHAR2,
                                       p_contrasena IN VARCHAR2,
                                       p_codError   OUT NUMBER,
                                       p_msjError   OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    numReg               NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'r_AsignarContrasenaXToken';

    idUsuario number;
    token     varchar2(200);

    codErrorEnvioCorreo number;
    msjErrorEnvioCorreo varchar2(2000);

  BEGIN
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a asignar clave con token ' || p_token);

    select count(*)
      into numReg
      from t54_tokenusuario t
     where t.a54token = p_token
       and t.a54estado = 'A'
       and t.a54usotoken = 'RESTOREPWD'
       and t.a54fechageneracion + 1 > sysdate;

    if numReg = 0 then
      p_codError := 70;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    select t.a54usuario
      into idUsuario
      from t54_tokenusuario t
     where t.a54token = p_token;

    update t06_usuarios
       set a06clave              = p_contrasena,
           a06intentos           = 0,
           a06fechaclave         = sysdate,
           a06fechaultimoingreso = sysdate,
           a06estado             = decode(a06estado, 'B', 'A', a06estado),
           a06fechamodificacion  = sysdate
     where a06codigo = idUsuario;

    update t54_tokenusuario t
       set t.a54estado = 'I'
     where t.a54token = p_token;

    commit;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio de asignar clave x token ');

  EXCEPTION
    WHEN OTHERS THEN
      ROLLBACK;
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_AsignarContrasenaXToken;

END PK_OPE_ADMUSUARIO;
/

prompt
prompt Creating package body PK_OPE_ASISTENCIA
prompt =======================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_OPE_ASISTENCIA IS

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la informacion del encabezado del listado
                   de asistencia para un facilitador, para un grupo dado y un taller especifico
                   en el perido vigente
  PARAMETROS    :
  IN    : p_idFacilitador
          p_idGrupo
          p_idTaller

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 30/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_DarAsistenciaEncabezado(p_idFacilitador IN NUMBER,
                                       p_idGrupo       IN NUMBER,
                                       p_idTaller      IN NUMBER,
                                       p_idPeriodo     IN NUMBER,
                                       p_resultado     OUT PK_UTILS.TY_CURSOR,
                                       p_codError      OUT NUMBER,
                                       p_msjError      OUT VARCHAR2) IS

    CURSOR c_taller IS
      SELECT a17codigo, a17nombre, a17descripcion
        FROM T17_TALLERES
       WHERE a17codigo = p_idTaller;

    CURSOR c_periodo(idPeriodo IN NUMBER) IS
      SELECT a12nombre FROM T12_PERIODOS WHERE a12codigo = idPeriodo;

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarAsistenciaEncabezado';

    codPeriodo  NUMBER;
    idTaller    NUMBER;
    nomTaller   VARCHAR2(100);
    descripcion VARCHAR2(500);
    nomPeriodo  VARCHAR2(50);

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar encabezado lista de asistenacia ');

    if (p_idPeriodo is null) then
      codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
    else
      codPeriodo := p_idPeriodo;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN c_taller;
    FETCH c_taller
      INTO idTaller, nomTaller, descripcion;
    CLOSE c_taller;

    OPEN c_periodo(codPeriodo);
    FETCH c_periodo
      INTO nomPeriodo;
    CLOSE c_periodo;

    OPEN p_resultado FOR
      SELECT a02codigo iddepartamento,
             a02nombre nomdepartamento,
             a26ciudad idmunicipio,
             a03nombre nommunicipio,
             a26facilitador idfacilitador,
             pf.a07primernombre || ' ' || pf.a07segundonombre || ' ' ||
             pf.a07primerapellido || ' ' || pf.a07segundoapellido nomfacilitador,
             a06coordinador idCoordinador,
             pc.a07primernombre || ' ' || pc.a07segundonombre || ' ' ||
             pc.a07primerapellido || ' ' || pc.a07segundoapellido nomCoordinador,
             idTaller idTaller,
             nomTaller nomTaller,
             descripcion descripcionTaller,
             nomPeriodo nomPeriodoVigente,
             a26sigla siglagrupo,
             a26horario idhorario,
             a23nombre || ', ' || a24horario nomhorario,
             a26grupo idgrupo,
             a25nombre nomgrupo,
             a26lugar lugar,
             a26direccion direccion,
             a26motivorechazo motivorechazo
        FROM T26_GRUPOSFACILITADOR,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS,
             T07_PERSONAS          PF,
             T07_PERSONAS          PC
       WHERE a26facilitador = p_idFacilitador
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = p_idGrupo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = pf.a07usuario
         AND a26periodo = codperiodo
         AND a06coordinador = pc.a07usuario;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta encabezado lista de asistenacia OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarAsistenciaEncabezado;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la lista de inscritos para el detalle
                  del listado de asistencia
  PARAMETROS    :
  IN    : p_idFacilitador
          p_idGrupo

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 30/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_DarAsistenciaDetalle(p_idFacilitador IN NUMBER,
                                    p_idGrupo       IN NUMBER,
                                    p_idPeriodo     IN NUMBER,
                                    p_resultado     OUT PK_UTILS.TY_CURSOR,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarAsistenciaDetalle';
    numReg               NUMBER;

    codPeriodo NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar lista de asistenacia detalle ');

    if (p_idPeriodo is null) then
      codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
    else
      codPeriodo := p_idPeriodo;
    end if;

    SELECT COUNT(*)
      INTO numreg
      FROM T15_INSCRITOS, T26_GRUPOSFACILITADOR
     WHERE a15grupofacilitador = a26codigo
       AND a26estado = PK_UTILS.COD_ACTIVO
       AND a15Estado = PK_UTILS.COD_ACTIVO
       AND a26periodo = codPeriodo;

    IF (numReg = 0) THEN
      p_codError := 52;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      RETURN;
    END IF;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT ROWNUM idRegistro, A.*
        FROM (SELECT a15codigo idInscrito,
                     a15tipodocumento tipoDocumento,
                     a15documento Documento,
                     nvl(a15codigobeneficiario, 0) CodigoBeneficiario,
                     a15primerapellido || ' ' || a15segundoapellido || ' ' ||
                     a15primernombre || ' ' || a15segundonombre Nombre
                FROM T15_INSCRITOS, T26_GRUPOSFACILITADOR
               WHERE a15grupofacilitador = a26codigo
                 AND a26periodo = codPeriodo
                 AND a26facilitador = p_idFacilitador
                 AND a26grupo = p_idGrupo
                 AND a26estado = PK_UTILS.COD_ACTIVO
                 AND a15Estado = PK_UTILS.COD_ACTIVO
               ORDER BY TRIM(a15primerapellido),
                        TRIM(a15segundoapellido),
                        TRIM(a15primernombre),
                        TRIM(a15segundonombre)) A;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta lista de asistenacia detalle OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarAsistenciaDetalle;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar todos los facilitadores asociados
                   a un coordinador
  PARAMETROS    :
  IN    : p_idCoordinador


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 29/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_DarFacilitadorXCoordinador(p_idCoordinador IN NUMBER,
                                          p_idPeriodo     IN NUMBER,
                                          p_resultado     OUT PK_UTILS.TY_CURSOR,
                                          p_codError      OUT NUMBER,
                                          p_msjError      OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarFacilitadorXCoordinador';
    numReg               NUMBER;
    idRol                NUMBER;

    codPeriodo number;
  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar facilitadores del coordinador ' ||
                            p_idCoordinador);

    if (p_idPeriodo is null) then
      codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
    else
      codPeriodo := p_idPeriodo;
    end if;

    select a06rol
      into idRol
      from t06_usuarios
     where a06codigo = p_idCoordinador;

    -- validar que exista informacion activa (solo para coordinadores)
    if (idRol = 2) then

      SELECT COUNT(*)
        INTO numreg
        FROM T05_ROLES, T06_USUARIOS, T07_PERSONAS
       WHERE a06rol = a05codigo
         AND a05nombre = 'FACILITADOR'
         AND a06codigo = a07usuario
         AND a06coordinador = p_idCoordinador
         AND a06estado = PK_UTILS.COD_ACTIVO;

      if (numReg = 0) then
        p_codError := 49;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;

    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    -- Si es coordinador retornar todos los facilitadores a su cargo activos
    if (idRol = 2) then
      OPEN p_resultado FOR
        SELECT a06codigo idFacilitador,
               a07primernombre || ' ' || a07segundonombre || ' ' ||
               a07primerapellido || ' ' || a07segundoapellido nomFacilitador
          FROM T05_ROLES, T06_USUARIOS, T07_PERSONAS
         WHERE a06rol = a05codigo
           AND a05nombre = 'FACILITADOR'
           AND a06codigo = a07usuario
           AND a06coordinador = p_idCoordinador
           and a06codigo in (select distinct a26facilitador
                               from t26_gruposfacilitador
                              where a26periodo = codPeriodo)
           AND a06estado = PK_UTILS.COD_ACTIVO;
    end if;

    -- Si es coordinador retornar todos los facilitadores a su cargo activos
    if (idRol = 2) then
      OPEN p_resultado FOR
        SELECT a06codigo idFacilitador,
               a07primernombre || ' ' || a07segundonombre || ' ' ||
               a07primerapellido || ' ' || a07segundoapellido nomFacilitador
          FROM T05_ROLES, T06_USUARIOS, T07_PERSONAS
         WHERE a06rol = a05codigo
           AND a05nombre = 'FACILITADOR'
           AND a06codigo = a07usuario
           AND a06coordinador = p_idCoordinador
           and a06codigo in (select distinct a26facilitador
                               from t26_gruposfacilitador
                              where a26periodo = codPeriodo)
           AND a06estado = PK_UTILS.COD_ACTIVO;
    end if;

    -- Si es supervisor,administrador retornar todos los facilitadores del sistema (activos e inactivos)
    if (idRol = 6 or idRol = 7) then
      OPEN p_resultado FOR
        SELECT a06codigo idFacilitador,
               a07primernombre || ' ' || a07segundonombre || ' ' ||
               a07primerapellido || ' ' || a07segundoapellido nomFacilitador
          FROM T05_ROLES, T06_USUARIOS, T07_PERSONAS
         WHERE a06rol = a05codigo
           AND a05nombre = 'FACILITADOR'
           AND a06codigo = a07usuario
           and a06codigo in (select distinct a26facilitador
                               from t26_gruposfacilitador
                              where a26periodo = codPeriodo)
           AND a06estado = PK_UTILS.COD_ACTIVO;
    end if;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta faciliadores del coordinador OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarFacilitadorXCoordinador;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar todos los grupos que tiene un
                   facilitador en el periodo vigente
  PARAMETROS    :
  IN    : p_idFacilitador


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 29/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_DarGruposXFacilitador(p_idFacilitador IN NUMBER,
                                     p_idPeriodo     IN NUMBER,
                                     p_resultado     OUT PK_UTILS.TY_CURSOR,
                                     p_codError      OUT NUMBER,
                                     p_msjError      OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarGruposXFacilitador';
    numReg               NUMBER;

    codPeriodo NUMBER;
    idRol      number;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro consultar grupos del facilitador ' ||
                            p_idFacilitador);

    if (p_idPeriodo is null) then
      codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
    else
      codPeriodo := p_idPeriodo;
    end if;

    if (p_idFacilitador > 0) then

      select a06rol
        into idRol
        from t06_usuarios
       where a06codigo = p_idFacilitador;

      if (idRol = 1) then

        SELECT COUNT(*)
          INTO numreg
          FROM T26_GRUPOSFACILITADOR
         WHERE a26facilitador = p_idFacilitador
           AND a26periodo = codperiodo;
      end if;

      if (idRol = 2) then
        SELECT COUNT(*)
          INTO numreg
          FROM T26_GRUPOSFACILITADOR, t06_usuarios
         WHERE a26facilitador = a06codigo
           and a06coordinador = p_idFacilitador
           AND a26periodo = codperiodo;
      end if;

      if (idRol <> 1 and idRol <> 2) then
        SELECT COUNT(*)
          INTO numreg
          FROM T26_GRUPOSFACILITADOR
         WHERE a26periodo = codperiodo;
      end if;

      if (numReg = 0) then
        p_codError := 50;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    if (p_idFacilitador > 0) then

      if (idRol = 1) then

        OPEN p_resultado FOR
          SELECT a26grupo idgrupo,
                 a25nombre || ' ' || upper(a26sigla) nombre,
                 a26horario idhorario,
                 a24horario nomHorario,
                 a26dia iddia,
                 a23nombre nomDia,
                 a26codigo idGrupoFacilitador,
                 upper(a26sigla) sigla
            FROM T26_GRUPOSFACILITADOR, T23_DIAS, T24_HORARIOS, T25_GRUPOS
           WHERE a26facilitador = p_idFacilitador
             AND a26dia = a23codigo
             AND a26horario = a24codigo
             AND a26grupo = a25codigo
             AND a26periodo = codperiodo
           order by upper(a26sigla);
      end if;

      if (idRol = 2) then

        OPEN p_resultado FOR
          SELECT a26grupo idgrupo,
                 a25nombre || ' ' || upper(a26sigla) nombre,
                 a26horario idhorario,
                 a24horario nomHorario,
                 a26dia iddia,
                 a23nombre nomDia,
                 a26codigo idGrupoFacilitador,
                 upper(a26sigla) sigla
            FROM T26_GRUPOSFACILITADOR,
                 T23_DIAS,
                 T24_HORARIOS,
                 T25_GRUPOS,
                 t06_usuarios
           WHERE a26facilitador = a06codigo
             and a06coordinador = p_idFacilitador
             AND a26dia = a23codigo
             AND a26horario = a24codigo
             AND a26grupo = a25codigo
             AND a26periodo = codperiodo
           order by upper(a26sigla);
      end if;

      if (idRol = 6) then

        OPEN p_resultado FOR
          SELECT a26grupo idgrupo,
                 a25nombre || ' ' || upper(a26sigla) nombre,
                 a26horario idhorario,
                 a24horario nomHorario,
                 a26dia iddia,
                 a23nombre nomDia,
                 a26codigo idGrupoFacilitador,
                 upper(a26sigla) sigla
            FROM T26_GRUPOSFACILITADOR t, T23_DIAS, T24_HORARIOS, T25_GRUPOS
           WHERE a26dia = a23codigo
             AND a26horario = a24codigo
             AND a26grupo = a25codigo
             AND a26periodo = codperiodo
           order by upper(a26sigla);
      end if;

    else
      OPEN p_resultado FOR
        SELECT a26grupo idgrupo,
               a25nombre || ' ' || upper(a26sigla) nombre,
               a26horario idhorario,
               a24horario nomHorario,
               a26dia iddia,
               a23nombre nomDia,
               a26codigo idGrupoFacilitador,
               upper(a26sigla) sigla
          FROM T26_GRUPOSFACILITADOR, T23_DIAS, T24_HORARIOS, T25_GRUPOS
         WHERE a26dia = a23codigo
           AND a26horario = a24codigo
           AND a26grupo = a25codigo
           AND a26periodo = codperiodo
         order by upper(a26sigla);
    end if;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta grupos del facilitador OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarGruposXFacilitador;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar todos los talleres activos del sistema
  PARAMETROS    :
  IN    :


  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 29/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_DarTalleres(p_resultado OUT PK_UTILS.TY_CURSOR,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarTalleres';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar talleres ');

    SELECT COUNT(*)
      INTO numreg
      FROM T17_TALLERES
     WHERE a17estado = PK_UTILS.COD_ACTIVO;

    if (numReg = 0) then
      p_codError := 51;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT a17codigo      idTaller,
             a17nombre      nombre,
             a17descripcion descripcion,
             a17orden       orden
        FROM T17_TALLERES
       WHERE a17estado = PK_UTILS.COD_ACTIVO
       ORDER BY a17orden;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  talleres OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarTalleres;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para cargar los entregable de un facilitador,
                   para un grupo, para un taller en el periodo actual
  PARAMETROS    :
  IN    : p_idFacilitador
          p_idGrupo
          p_idTaller
          p_idEntregable
          p_fechaRealizacion
          p_rutaArchivo

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 29/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_CargarEntregable(p_idFacilitador    IN NUMBER,
                                p_idGrupo          IN NUMBER,
                                p_idTaller         IN NUMBER,
                                p_idEntregable     IN NUMBER, -- va un 1 para indicar que es lista de asistencia
                                p_fechaRealizacion IN VARCHAR2, --yyyy-mm-dd
                                p_rutaArchivo      IN VARCHAR2,
                                p_codError         OUT NUMBER,
                                p_msjError         OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_CargarEntregable';
    numReg               NUMBER;
    idEntregable         NUMBER;

    codPeriodo NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a cargar entregable ');

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;

    Pk_T20_Entregablescargados.Pr_Insertar(p_idFacilitador,
                                           p_idGrupo,
                                           p_idTaller,
                                           p_idEntregable,
                                           p_rutaArchivo,
                                           codPeriodo,
                                           PK_UTILS.ENT_PENDIENTE,
                                           p_idFacilitador,
                                           idEntregable);

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Cargar entregable OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_CargarEntregable;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar el estado de las asistencias
                   para un facilitador en un grupo

  PARAMETROS    :
  IN    : p_idFacilitador
          p_idGrupo

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 30/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_DarInfoAsistencia(p_idFacilitador IN NUMBER,
                                 p_idGrupo       IN NUMBER,
                                 p_resultado     OUT PK_UTILS.TY_CURSOR,
                                 p_codError      OUT NUMBER,
                                 p_msjError      OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarInfoAsistencia';
    numReg               NUMBER;

    codPeriodo NUMBER;

  BEGIN

    /* select
    r.a21taller IdTaller,
    t.a17nombre NomTaller,
    t.a17descripcion DescripcionTaller,
    g.a26codigo IdGrupoFacilitador,
    gr.a25nombre NombreGrupo,
    to_char(r.a21fechataller,'yyyy-mm-dd') FechaRealizacion
    from
    t21_realizaciontaller r,
    t06_usuarios u,
    t07_personas p,
    t26_gruposfacilitador g,
    t25_grupos gr,
    t17_talleres t
    where
    r.a21facilitador = u.a06codigo
    and p.a07usuario = u.a06codigo
    and g.a26codigo = r.a21grupo
    and g.a26grupo = gr.a25codigo
    and r.a21taller = t.a17codigo
    and r.a21periodo = 1
    and u.a06codigo = 40


    */
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar información asistencia ');

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT a89codigo        codEstado,
             a89nombre        nomEstado,
             a17codigo        idTaller,
             a17nombre        nomTaller,
             a17descripcion   descripcionTaller,
             a18codigo        idEntregable,
             a18nombre        nomEntregable,
             a21fechataller   fechaRealizacion,
             a20ruta          ruta,
             a20motivorechazo motivorechazo,
             a17orden
        FROM T17_TALLERES,
             T18_ENTREGABLES,
             T19_TALLERENTREGABLES,
             T20_ENTREGABLESCARGADOS,
             T21_REALIZACIONTALLER,
             T89_ESTADOSENTREGABLES
       WHERE a17codigo = a19taller
         AND a18codigo = a19entregable
         AND a19taller = a20taller
         AND a19entregable = a20entregable
         AND a20facilitador = a21facilitador
         AND a20grupo = a21grupo
         AND a19taller = a21taller
         AND a20facilitador = p_idFacilitador
         AND a20grupo = p_idGrupo
         AND a20periodo = codPeriodo
         AND a20estado = a89codigo
      --AND nvl(a20estado,PK_UTILS.ENT_ACTIVO) = PK_UTILS.ENT_ACTIVO
      UNION
      SELECT NULL           codEstado,
             NULL           nomEstado,
             a17codigo      idTaller,
             a17nombre      nomTaller,
             a17descripcion descripcionTaller,
             a18codigo      idEntregable,
             a18nombre      nomEntregable,
             NULL           fechaRealizacion,
             NULL           ruta,
             NULL           motivorechazo,
             a17orden
        FROM T17_TALLERES, T18_ENTREGABLES, T19_TALLERENTREGABLES
       WHERE a17codigo = a19taller
         AND a18codigo = a19entregable
         AND a19taller NOT IN (SELECT a17codigo
                                 FROM T17_TALLERES,
                                      T18_ENTREGABLES,
                                      T19_TALLERENTREGABLES,
                                      T20_ENTREGABLESCARGADOS,
                                      T21_REALIZACIONTALLER,
                                      T89_ESTADOSENTREGABLES
                                WHERE a17codigo = a19taller
                                  AND a18codigo = a19entregable
                                  AND a19taller = a20taller
                                  AND a19entregable = a20entregable
                                  AND a20facilitador = a21facilitador
                                  AND a20grupo = a21grupo
                                  AND a19taller = a21taller
                                  AND a20facilitador = p_idFacilitador
                                  AND a20grupo = p_idGrupo
                                  AND a20periodo = codPeriodo
                                  AND a20estado = a89codigo
                               --AND nvl(a20estado,PK_UTILS.ENT_ACTIVO) = PK_UTILS.ENT_ACTIVO
                               )
       ORDER BY a17orden;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consultar información asistencia OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarInfoAsistencia;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la lista de todos los entregables
                   pendientes de aprobar por un coordinador en el perido vigente

  PARAMETROS    :
  IN    : p_idFacilitador
          p_idGrupo

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 30/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_DarAsistenciasXAprobar(p_idCoodinador IN NUMBER,
                                      p_resultado    OUT PK_UTILS.TY_CURSOR,
                                      p_codError     OUT NUMBER,
                                      p_msjError     OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarAsistenciasXAprobar';
    numReg               NUMBER;

    codPeriodo NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar información asistencia por aprobar ');

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT a20codigo idRegistro,
             a26facilitador idfacilitador,
             a07primernombre || ' ' || a07segundonombre || ' ' ||
             a07primerapellido || ' ' || a07segundoapellido nombrefacilitador,
             a26ciudad idmunicipio,
             a03nombre nommunicipio,
             a26grupo idgrupo,
             a25nombre nomgrupo,
             a26horario idhorario,
             a24horario nomhorario,
             a23codigo iddia,
             a23nombre nomdia,
             a89codigo codEstado,
             a89nombre nomEstado,
             a17codigo idTaller,
             a17nombre nomTaller,
             a17descripcion descripcionTaller,
             a18codigo idEntregable,
             a18nombre nomEntregable,
             a21fechataller fechaRealizacion,
             a20ruta ruta,
             Pk_Ope_Asistencia.Fn_Asistenciasreg(a26facilitador, a26grupo) totalasistencias
        FROM T17_TALLERES,
             T18_ENTREGABLES,
             T19_TALLERENTREGABLES,
             T20_ENTREGABLESCARGADOS,
             T21_REALIZACIONTALLER,
             T89_ESTADOSENTREGABLES,
             T26_GRUPOSFACILITADOR,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS,
             T07_PERSONAS
       WHERE a17codigo = a19taller
         AND a18codigo = a19entregable
         AND a19taller = a20taller
         AND a19entregable = a20entregable
         AND a20facilitador = a21facilitador
         AND a20grupo = a21grupo
         AND a19taller = a21taller
         AND a20periodo = codPeriodo
         AND a20estado = a89codigo
         AND a20estado = PK_UTILS.ENT_PENDIENTE
         AND a20grupo = a26grupo
         AND a26facilitador = a20facilitador
         AND a26ciudad = a03codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = a07usuario
         AND a26periodo = codperiodo
         AND a06coordinador = p_idCoodinador
       ORDER BY a17orden;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consultar información asistencia por aprobar OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarAsistenciasXAprobar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para aprobar asistencia
  PARAMETROS    :
  IN    :
           p_idCoordinador
           p_idRegistro

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 29/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_AprobarAsistencia(p_idCoordinador IN NUMBER,
                                 p_idRegistro    IN NUMBER,
                                 p_codError      OUT NUMBER,
                                 p_msjError      OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_AprobarAsistencia';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a aprobar asistencia ');

    UPDATE T20_ENTREGABLESCARGADOS
       SET a20estado              = PK_UTILS.ENT_ACTIVO,
           a20fechamodificacion   = SYSDATE,
           a20usuariomodificacion = p_idCoordinador
     WHERE a20codigo = p_idRegistro;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Aprobar asistencia OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_AprobarAsistencia;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para rechazar asistencia
  PARAMETROS    :
  IN    :
           p_idCoordinador
           p_idRegistro
           p_motivoRechazo

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 29/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_RechazarAsistencia(p_idCoordinador IN NUMBER,
                                  p_idRegistro    IN NUMBER,
                                  p_motivoRechazo IN VARCHAR2,
                                  p_codError      OUT NUMBER,
                                  p_msjError      OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_RechazarAsistencia';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a rechazar asistencia ');

    UPDATE T20_ENTREGABLESCARGADOS
       SET a20estado              = PK_UTILS.ENT_RECHAZO,
           a20motivorechazo       = p_motivoRechazo,
           a20fechamodificacion   = SYSDATE,
           a20usuariomodificacion = p_idCoordinador
     WHERE a20codigo = p_idRegistro;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Rechazar asistencia OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_RechazarAsistencia;

  /********************************************************************************
  DESCRIPCION    : Funcion para consultar el total de asistencias registradas
                  a ese grupo de ese facilitador
  PARAMETROS    :
  IN    :
          p_idusuario


  OUT    :
          ciudades


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  FUNCTION Fn_AsistenciasReg(p_idFacilitador IN NUMBER,
                             p_idGrupo       IN NUMBER) RETURN NUMBER IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Fn_AsistenciasReg';
    numReg               NUMBER;

    codPeriodo NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar asistencias registradas ');

    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;

    SELECT COUNT(*)
      INTO numreg
      FROM T51_ASISTENCIATALLER
     WHERE a51facilitadorreporta = p_idFacilitador
       AND a51grupoFacilitador = p_idGrupo
       AND a51periodo = codPeriodo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta asistencias registradas OK ');

    RETURN numReg;

  END Fn_AsistenciasReg;

  /********************************************************************************
  DESCRIPCION    : Funcion para consultar el numero de talleres dictados donde
                   esta el inscrito
  PARAMETROS    :
  IN    :
          p_idParticiante


  OUT    :
          numReg


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  FUNCTION Fn_TalleresInscrito(p_idParticiante IN VARCHAR2) RETURN NUMBER IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Fn_TalleresInscrito';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar talleres donde esta el inscrito ');

    select count(*)
      INTO numreg
      from (SELECT a21taller
               FROM T21_REALIZACIONTALLER,
                    T26_GRUPOSFACILITADOR,
                    T15_INSCRITOS
              WHERE --a21grupo = a26grupo
              a21facilitador = a26facilitador
           AND a26codigo = a15grupofacilitador
           AND (a15documento = p_idParticiante OR
              a15codigobeneficiario = to_number(p_idParticiante))
              group by a21taller);

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta talleres donde esta el inscrito OK ');

    RETURN numReg;

  END Fn_TalleresInscrito;

  /********************************************************************************
  DESCRIPCION    : Funcion para consultar numero de asistencias del participante
                   en el periodo en curso

  PARAMETROS    :
  IN    :
          p_idParticiante


  OUT    :
          numReg


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  FUNCTION Fn_AsistenciasInscrito(p_idParticiante IN VARCHAR2) RETURN NUMBER IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Fn_TalleresInscrito';
    numReg               NUMBER;

    --    codPeriodo NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar asistencias inscrito ');

    --    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;

    SELECT COUNT(*)
      INTO numreg
      FROM T51_ASISTENCIATALLER, T15_INSCRITOS
     WHERE a51inscrito = a15codigo
          --   AND a51periodo = codPeriodo
       AND a51Asistencia = 'A'
       AND (a15documento = p_idParticiante OR
           a15codigobeneficiario = p_idParticiante);

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta asistencias inscrito OK ');

    RETURN numReg;

  END Fn_AsistenciasInscrito;

  FUNCTION Fn_MaxAsistInscritoPer(p_idParticiante IN VARCHAR2) RETURN NUMBER IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Fn_MaxAsistInscritoPer';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Fn_MaxAsistInscritoPer');

--    select max(NumAsist)
    select COUNT(1)
      INTO numreg
--      from (SELECT COUNT(1) NumAsist, a51periodo Periodo
      from (SELECT COUNT(1) NumAsist, A51TALLERREALIZADO
              FROM T51_ASISTENCIATALLER, T15_INSCRITOS
             WHERE a51inscrito = a15codigo
               AND a51Asistencia = 'A'
               AND (a15documento = p_idParticiante OR
                   a15codigobeneficiario = p_idParticiante)
--             group by a51periodo);
             group by A51TALLERREALIZADO);

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Fn_MaxAsistInscritoPer OK ');

    RETURN numReg;

  END Fn_MaxAsistInscritoPer;

  PROCEDURE Pr_DarEntregableEstado(p_idUsuario          IN NUMBER,
                                   p_idTaller           IN NUMBER,
                                   p_idEntregable       IN NUMBER,
                                   p_idPeriodo          IN NUMBER,
                                   p_idEstadoDocumento  IN VARCHAR2,
                                   p_idEstadoAsistencia IN VARCHAR2,
                                   p_filtroBusqueda     IN VARCHAR2,
                                   p_resultado          OUT PK_UTILS.TY_CURSOR,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarEntregableEstado';
    numReg               NUMBER;
    idRol                number;
    p_codErrorIni        number;
    p_msjErrorIni        varchar2(1000);

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarEntregableEstado ');

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    -- Crear registros para t20_entregablescargados, t21_realizaciontaller para poblar los datos requeridos
    -- La primera consulta del periodo crea los registros requeridos, luego de creado ya no los crea nuevamente

    -- Pr_IniciarAsistencia(p_idPeriodo, p_codErrorIni, p_msjErrorIni);

    select a06rol
      into idRol
      from t06_usuarios
     where a06codigo = p_idUsuario;

    -- Si esfacilitador
    if (idRol = 1) then

      OPEN p_resultado FOR
        SELECT *
          from vw_estadorealizaciontaller v
         where v.IDFACILITADOR = p_idUsuario
           and v.IDTALLER = decode(p_idTaller, 0, v.IDTALLER, p_idTaller)
           and v.IDENTREGABLE = p_idEntregable
           and v.IDPERIODO = p_idPeriodo
           and (v.IdEstadoDocumento =
               decode(p_idEstadoDocumento,
                       'T',
                       v.IdEstadoDocumento,
                       p_idEstadoDocumento) or
               v.IDESTADOASISTENCIA =
               decode(p_idEstadoDocumento,
                       'T',
                       v.IDESTADOASISTENCIA,
                       p_idEstadoDocumento))
           AND (UPPER(v.NOMTALLER) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' OR
               UPPER(v.NOMBREGRUPO) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' OR
               UPPER(v.NOMBREFACILITADOR) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' OR
               UPPER(v.ESTADOASISTENCIA) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' OR
               UPPER(v.EstadoDocumento) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%')

         order by v.IDTALLER, v.idGrupo;
    end if;

    -- Si es coordinador
    if (idRol = 2) then

      OPEN p_resultado FOR
        select *
          from (SELECT *
                  from vw_estadorealizaciontaller v
                 where v.IDCOORDINADOR = p_idUsuario
                   and v.IDTALLER =
                       decode(p_idTaller, 0, v.IDTALLER, p_idTaller)
                   and v.IDENTREGABLE = p_idEntregable
                   and v.IDPERIODO = p_idPeriodo
                   and (v.IdEstadoDocumento =
                       decode(p_idEstadoDocumento,
                               'T',
                               v.IdEstadoDocumento,
                               p_idEstadoDocumento) or
                       v.IDESTADOASISTENCIA =
                       decode(p_idEstadoDocumento,
                               'T',
                               v.IDESTADOASISTENCIA,
                               p_idEstadoDocumento))
                   AND (UPPER(v.NOMTALLER) LIKE
                       '%' || UPPER(p_filtroBusqueda) || '%' OR
                       UPPER(v.NOMBREGRUPO) LIKE
                       '%' || UPPER(p_filtroBusqueda) || '%' OR
                       UPPER(v.NOMBREFACILITADOR) LIKE
                       '%' || UPPER(p_filtroBusqueda) || '%' OR
                       UPPER(v.ESTADOASISTENCIA) LIKE
                       '%' || UPPER(p_filtroBusqueda) || '%' OR
                       UPPER(v.EstadoDocumento) LIKE
                       '%' || UPPER(p_filtroBusqueda) || '%')
                 order by v.NOMBREFACILITADOR, v.IDTALLER, v.idGrupo)
         where rownum <= 50;
    end if;

    -- No es facilitador ni coordinador
    if (idRol <> 1 and idRol <> 2) then
      OPEN p_resultado FOR
        select *
          from (SELECT *
                  from vw_estadorealizaciontaller v
                 where v.IDTALLER =
                       decode(p_idTaller, 0, v.IDTALLER, p_idTaller)
                   and v.IDENTREGABLE = p_idEntregable
                   and v.IDPERIODO = p_idPeriodo
                   and (v.IdEstadoDocumento =
                       decode(p_idEstadoDocumento,
                               'T',
                               v.IdEstadoDocumento,
                               p_idEstadoDocumento) or
                       v.IDESTADOASISTENCIA =
                       decode(p_idEstadoDocumento,
                               'T',
                               v.IDESTADOASISTENCIA,
                               p_idEstadoDocumento))
                   AND (UPPER(v.NOMTALLER) LIKE
                       '%' || UPPER(p_filtroBusqueda) || '%' OR
                       UPPER(v.NOMBREGRUPO) LIKE
                       '%' || UPPER(p_filtroBusqueda) || '%' OR
                       UPPER(v.NOMBREFACILITADOR) LIKE
                       '%' || UPPER(p_filtroBusqueda) || '%' OR
                       UPPER(v.ESTADOASISTENCIA) LIKE
                       '%' || UPPER(p_filtroBusqueda) || '%' OR
                       UPPER(v.EstadoDocumento) LIKE
                       '%' || UPPER(p_filtroBusqueda) || '%')
                 order by v.NOMBREFACILITADOR, v.IDTALLER, v.idGrupo)
         where rownum <= 50;
    end if;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_DarEntregableEstado OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarEntregableEstado;

  PROCEDURE Pr_DarEntregableEstadoDetalle(p_idEntregable       IN NUMBER,
                                          p_idPeriodo          IN NUMBER,
                                          p_idTaller           IN NUMBER,
                                          p_idGrupoFacilitador IN NUMBER,
                                          p_resultado          OUT PK_UTILS.TY_CURSOR,
                                          p_codError           OUT NUMBER,
                                          p_msjError           OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarEntregableEstadoDetalle';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarEntregableEstado ');

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT *
        from vw_estadorealizaciontaller v
       where v.IDTALLER = p_idTaller
         and v.IDGRUPOFACILITADOR = p_idGrupoFacilitador
         and v.IDENTREGABLE = p_idEntregable
         and v.IDPERIODO = p_idPeriodo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_DarEntregableEstadoDetalle OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarEntregableEstadoDetalle;

  PROCEDURE Pr_DarInscritos(p_idGrupoFacilitador IN NUMBER,
                            p_resultado          OUT PK_UTILS.TY_CURSOR,
                            p_codError           OUT NUMBER,
                            p_msjError           OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarInscritos';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarInscritos ');

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      select i.a15grupofacilitador idGrupoFacilitador,
             i.a15codigo IdInscrito,
             (i.a15primerapellido || ' ' || i.a15segundoapellido || ' ' ||
             i.a15primernombre || ' ' || i.a15segundonombre) NombreInscrito,
             i.a15tipodocumento TipoDocumento,
             i.a15documento Documento,
             1 IndAsistencia
        from t15_inscritos i, t53_grupoinscrito g
       where i.a15codigo = g.a53inscrito
         and g.a53estado = 'A'
         and g.a53grupofacilitador = p_idGrupoFacilitador
       ORDER BY TRIM(i.a15primerapellido),
                TRIM(i.a15segundoapellido),
                TRIM(i.a15primernombre),
                TRIM(i.a15segundonombre);

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_DarInscritos OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarInscritos;

  PROCEDURE Pr_DarAsistenciaEstado(p_idPeriodo          IN NUMBER,
                                   p_idEntregable       IN NUMBER,
                                   p_idTaller           IN NUMBER,
                                   p_idGrupoFacilitador IN NUMBER,
                                   p_resultado          OUT PK_UTILS.TY_CURSOR,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarAsistenciaEstado';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarEntregableEstado ');

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    select count(*)
      into numReg
      from t51_asistenciataller
     where a51tallerrealizado = p_idTaller
       and a51grupofacilitador = p_idGrupoFacilitador
       and a51periodo = p_idPeriodo;

    -- si no hay asistencia registrada enviar inscritos
    if (numReg = 0) then
      OPEN p_resultado FOR
        select i.a15grupofacilitador idGrupoFacilitador,
               i.a15codigo IdInscrito,
               (i.a15primerapellido || ' ' || i.a15segundoapellido || ' ' ||
               i.a15primernombre || ' ' || i.a15segundonombre) NombreInscrito,
               i.a15tipodocumento TipoDocumento,
               i.a15documento Documento,
               1 IndAsistencia
          from t15_inscritos i, t53_grupoinscrito g
         where i.a15codigo = g.a53inscrito
              /*BUG160714 inicio
                         and g.a53estado = 'A'
              */
           and g.a53estado in ('A', 'R')
           and g.a53grupofacilitador = p_idGrupoFacilitador
           and g.a53periodo = p_idPeriodo
         ORDER BY TRIM(i.a15primerapellido),
                  TRIM(i.a15segundoapellido),
                  TRIM(i.a15primernombre),
                  TRIM(i.a15segundonombre);
    end if;

    -- Si hay asistencia registrada enviar lo que se registro
    if (numReg > 0) then
      OPEN p_resultado FOR

        select a.a51grupofacilitador idGrupoFacilitador,
               i.a15codigo IdInscrito,
               (i.a15primerapellido || ' ' || i.a15segundoapellido || ' ' ||
               i.a15primernombre || ' ' || i.a15segundonombre) NombreInscrito,
               i.a15tipodocumento TipoDocumento,
               i.a15documento Documento,
               decode(a.a51asistencia, 'A', 1, 0) IndAsistencia
          from t51_asistenciataller a, t15_inscritos i
         where a.a51inscrito = i.a15codigo
           and a.a51estado = 'A'
           and a.a51tallerrealizado = p_idTaller
           and a.a51periodo = p_idPeriodo
           and a.a51grupofacilitador = p_idGrupoFacilitador

         ORDER BY a.a51orden;
    end if;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_DarEntregableEstadoDetalle OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarAsistenciaEstado;

  PROCEDURE Pr_DarAsistenteXFacilitador(p_idPeriodo     IN NUMBER,
                                        p_idFacilitador IN NUMBER,
                                        p_resultado     OUT PK_UTILS.TY_CURSOR,
                                        p_codError      OUT NUMBER,
                                        p_msjError      OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarAsistenteXFacilitador';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarAsistenteXFacilitador ');

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      select i.a15grupofacilitador idGrupoFacilitador,
             i.a15codigo IdInscrito,
             (i.a15primerapellido || ' ' || i.a15segundoapellido || ' ' ||
             i.a15primernombre || ' ' || i.a15segundonombre) NombreInscrito,
             i.a15tipodocumento TipoDocumento,
             i.a15documento Documento
        from t15_inscritos i, t53_grupoinscrito g, t26_gruposfacilitador f
       where i.a15codigo = g.a53inscrito
            /*BUG160714 inicio
                     and g.a53estado = 'A'
            */
         and g.a53estado IN ('A', 'R')
         and g.a53grupofacilitador = f.a26codigo
         and f.a26facilitador = p_idFacilitador
         and g.a53periodo = p_idPeriodo
       ORDER BY TRIM(i.a15primerapellido),
                TRIM(i.a15segundoapellido),
                TRIM(i.a15primernombre),
                TRIM(i.a15segundonombre);

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_DarAsistenteXFacilitador OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarAsistenteXFacilitador;

  PROCEDURE Pr_RegistrarAsistencia(p_idFacilitador      IN NUMBER,
                                   p_idPeriodo          IN NUMBER,
                                   p_idEntregable       IN NUMBER,
                                   p_idTaller           IN NUMBER,
                                   p_idGrupoFacilitador IN NUMBER,
                                   p_fechaRealizacion   IN VARCHAR2, -- yyyy-mm-dd
                                   p_arrAsistencia      IN VARCHAR2,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarAsistenciaEstado';
    numReg               NUMBER;

    listAsistencia pk_utils.token_list;
    datoAsistente  pk_utils.token_list;
    i              number;
    numAsistentes  number;
    asistio        number;
    noAsistio      number;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_RegistrarAsistencia ');
    if (p_arrAsistencia is null) then
      return;
    end if;

    asistio   := 0;
    noAsistio := 0;

    listAsistencia := pk_utils.fn_splitStr(p_arrAsistencia, ';');

    i             := 1;
    numAsistentes := pk_utils.splitter_count(p_arrAsistencia, ';') + 1;

    while i <= numAsistentes loop

      datoAsistente := pk_utils.fn_splitStr(listAsistencia(i), ',');

      select count(*)
        into numReg
        from t51_asistenciataller
       where a51tallerrealizado = p_idTaller
         and a51inscrito = to_number(datoAsistente(1))
         and a51facilitadorreporta = p_idFacilitador
         and a51grupofacilitador = p_idGrupoFacilitador
         and a51periodo = p_idPeriodo;

      if (numReg = 0) then

        insert into t51_asistenciataller
          (a51codigo,
           a51tallerrealizado,
           a51inscrito,
           a51facilitadorreporta,
           a51grupofacilitador,
           a51periodo,
           a51fechareporte,
           a51fechacreacion,
           a51fechamodificacion,
           a51usuariocreacion,
           a51usuariomodificacion,
           a51asistencia,
           a51estado,
           a51orden)
          select t51_asistencia_seq.nextval,
                 p_idTaller,
                 to_number(datoAsistente(1)),
                 p_idFacilitador,
                 p_idGrupoFacilitador,
                 p_idPeriodo,
                 sysdate,
                 sysdate,
                 sysdate,
                 p_idFacilitador,
                 p_idFacilitador,
                 decode(datoAsistente(2), '1', 'A', 'N'),
                 'A',
                 i
            from dual;
      else
        update t51_asistenciataller
           set a51fechareporte        = sysdate,
               a51fechamodificacion   = sysdate,
               a51usuariomodificacion = p_idFacilitador,
               a51asistencia          = decode(datoAsistente(2),
                                               '1',
                                               'A',
                                               'N'),
               a51estado              = 'A',
               a51orden               = i
         where a51tallerrealizado = p_idTaller
           and a51inscrito = to_number(datoAsistente(1))
           and a51facilitadorreporta = p_idFacilitador
           and a51grupofacilitador = p_idGrupoFacilitador
           and a51periodo = p_idPeriodo;

      end if;

      if (datoAsistente(2) = '1') then
        asistio := asistio + 1;
      else
        noAsistio := noAsistio + 1;
      end if;

      i := i + 1;

    end loop;

    if (numAsistentes > 0) then

      update t21_realizaciontaller
         set a21fechataller         = to_date(p_fechaRealizacion,
                                              'yyyy-mm-dd'),
             a21estado              = 'P',
             a21fechamodificacion   = sysdate,
             a21usuariomodificacion = p_idFacilitador,
             a21motivorechazo       = '',
             a21asistentes          = asistio,
             a21noasistentes        = noAsistio
       where a21grupo = p_idGrupoFacilitador
         and a21taller = p_idTaller
         and a21facilitador = p_idFacilitador
         and a21periodo = p_idPeriodo;

    end if;

    commit;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_RegistrarAsistencia OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_RegistrarAsistencia;

  PROCEDURE Pr_RegistrarAprobacion(p_idFacilitador      IN NUMBER,
                                   p_idPeriodo          IN NUMBER,
                                   p_idEntregable       IN NUMBER,
                                   p_idTaller           IN NUMBER,
                                   p_idGrupoFacilitador IN NUMBER,
                                   p_categoria          IN VARCHAR2, -- D:Documento A:Asistencia
                                   p_estado             IN VARCHAR2, --  A:Aprobar R:Rechazar P:Pendiente aprobacion
                                   p_motivoRechazo      IN VARCHAR2,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_RegistrarAprobacion';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_RegistrarAprobacion ');

    -- Es una aprobacio de asistencia
    if (p_categoria = 'A') then

      update t21_realizaciontaller
         set a21estado              = p_estado,
             a21fechamodificacion   = sysdate,
             a21usuariomodificacion = p_idFacilitador,
             a21motivorechazo       = p_motivoRechazo
       where a21grupo = p_idGrupoFacilitador
         and a21taller = p_idTaller
         and a21periodo = p_idPeriodo;

    end if;

    -- Es una aprobacio de documento
    if (p_categoria = 'D') then

      update t20_entregablescargados
         set a20estado              = p_estado,
             a20motivorechazo       = p_motivoRechazo,
             a20fechamodificacion   = sysdate,
             a20usuariomodificacion = p_idFacilitador
       where a20grupo = p_idGrupoFacilitador
         and a20taller = p_idTaller
         and a20entregable = p_idEntregable
         and a20periodo = p_idPeriodo;
    end if;

    commit;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_RegistrarAprobacion OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_RegistrarAprobacion;

  PROCEDURE Pr_IniciarAsistencia(p_idPeriodo in number,
                                 p_codError  OUT NUMBER,
                                 p_msjError  OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_IniciarAsistencia';
    numReg               NUMBER;
    totalReg             number;
    idTaller             number;

    cursor curFacilitador is
      SELECT a26facilitador, MIN(a26ciudad) a26ciudad
        FROM t26_gruposfacilitador
       WHERE a26periodo = p_idPeriodo
         and a26estado = 'A'
       group by a26facilitador;

    CURSOR curGrupoFacilitador IS
      SELECT a26codigo, a26facilitador
        FROM t26_gruposfacilitador
       WHERE a26periodo = p_idPeriodo
         and a26estado = 'A';

    CURSOR curTallere IS
      SELECT a17codigo FROM t17_talleres WHERE a17estado = 'A';

    CURSOR curEntregable IS
      SELECT a19entregable
        FROM t19_tallerentregables
       WHERE a19estado = 'A'
         and a19taller = idTaller;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_IniciarAsistencia ');

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    /*    delete from t20_entregablescargados t where t.a20periodo = p_idPeriodo;
        delete from t21_realizaciontaller t where t.a21periodo = p_idPeriodo;
        delete from t51_asistenciataller t where t.a51periodo = p_idPeriodo;
        delete from t26_gruposfacilitador t
         where t.a26periodo = p_idPeriodo
           and a26grupo = 11;

    */

    -- Crea grupo de nivelacion a todos los facilitadores para el periodo

    FOR regFacilitador IN curFacilitador LOOP
      select count(*)
        into numReg
        from t26_gruposfacilitador
       where a26facilitador = regFacilitador.a26facilitador
         and a26grupo = 11 -- grupo nivelacion
         and a26periodo = p_idPeriodo;

      if (numReg = 0) then
        insert into t26_gruposfacilitador
          (a26codigo,
           a26facilitador,
           a26ciudad,
           a26grupo,
           a26dia,
           a26horario,
           a26lugar,
           a26direccion,
           a26sigla,
           a26periodo,
           a26condicion,
           a26observaciones,
           a26motivorechazo,
           a26estado,
           a26fechacreacion,
           a26fechamodificacion,
           a26usuariocreacion,
           a26usuariomodificacion,
           a26inscritos)
          select t26_gruposfacilitador_seq.nextval,
                 regFacilitador.a26facilitador,
                 regFacilitador.a26ciudad,
                 11,
                 6,
                 1,
                 '',
                 '',
                 upper(substr(Pk_T03_Municipios.Fn_Obtenernombre(regFacilitador.a26ciudad),
                              1,
                              3)) || 'P' || p_idPeriodo || 'F' ||
                 to_char(regFacilitador.a26facilitador) || 'G11', -- sigla
                 p_idPeriodo,
                 '',
                 '',
                 '',
                 'A',
                 sysdate,
                 sysdate,
                 0,
                 0,
                 0
            from dual;
      end if;
    END LOOP;

    -- Crea grupo de contingencia a todos los facilitadores para el periodo
/*
    FOR regFacilitador IN curFacilitador LOOP

      select count(*)
        into numReg
        from t26_gruposfacilitador
       where a26facilitador = regFacilitador.a26facilitador
         and a26grupo = 12 -- grupo nivelacion
         and a26periodo = p_idPeriodo;

      if (numReg = 0) then
        insert into t26_gruposfacilitador
          (a26codigo,
           a26facilitador,
           a26ciudad,
           a26grupo,
           a26dia,
           a26horario,
           a26lugar,
           a26direccion,
           a26sigla,
           a26periodo,
           a26condicion,
           a26observaciones,
           a26motivorechazo,
           a26estado,
           a26fechacreacion,
           a26fechamodificacion,
           a26usuariocreacion,
           a26usuariomodificacion,
           a26inscritos)
          select t26_gruposfacilitador_seq.nextval,
                 regFacilitador.a26facilitador,
                 regFacilitador.a26ciudad,
                 12,
                 6,
                 1,
                 '',
                 '',
                 upper(substr(Pk_T03_Municipios.Fn_Obtenernombre(regFacilitador.a26ciudad),
                              1,
                              3)) || 'P' || p_idPeriodo || 'F' ||
                 to_char(regFacilitador.a26facilitador) || 'G12', -- sigla
                 p_idPeriodo,
                 '',
                 '',
                 '',
                 'A',
                 sysdate,
                 sysdate,
                 0,
                 0,
                 0
            from dual;
      end if;
    END LOOP;
*/
    totalReg := 0;

    FOR regGrupo IN curGrupoFacilitador LOOP

      FOR regTaller IN curTallere LOOP

        select count(*)
          into numReg
          from t21_realizaciontaller
         where a21grupo = regGrupo.a26codigo
           and a21taller = regTaller.a17codigo;

        if (numReg = 0) then

          insert into t21_realizaciontaller
            (a21codigo,
             a21grupo,
             a21taller,
             a21fechataller,
             a21facilitador,
             a21periodo,
             a21estado,
             a21fechacreacion,
             a21fechamodificacion,
             a21usuariocreacion,
             a21usuariomodificacion,
             a21motivorechazo,
             a21asistentes,
             a21noasistentes)
            select t21_realizaciontaller_seq.nextval,
                   regGrupo.a26codigo,
                   regTaller.a17codigo,
                   null,
                   regGrupo.a26facilitador,
                   p_idPeriodo,
                   'S',
                   sysdate,
                   sysdate,
                   0,
                   0,
                   '',
                   0,
                   0
              from dual;

          commit;
          totalReg := totalReg + 1;

        end if;

        idTaller := regTaller.a17codigo;

        FOR regEntregable IN curEntregable LOOP
          select count(*)
            into numReg
            from t20_entregablescargados
           where a20grupo = regGrupo.a26codigo
             and a20taller = regTaller.a17codigo
             and a20entregable = regEntregable.a19Entregable;

          if numReg = 0 then
            insert into t20_entregablescargados
              (a20codigo,
               a20grupo,
               a20taller,
               a20entregable,
               a20ruta,
               a20facilitador,
               a20periodo,
               a20estado,
               a20motivorechazo,
               a20fechacreacion,
               a20fechamodificacion,
               a20usuariocreacion,
               a20usuariomodificacion)
              select t20_entregablescargados_seq.nextval,
                     regGrupo.a26codigo,
                     regTaller.a17codigo,
                     regEntregable.a19Entregable,
                     '',
                     regGrupo.a26facilitador,
                     p_idPeriodo,
                     'S',
                     '',
                     sysdate,
                     sysdate,
                     0,
                     0
                from dual;

          end if;

        END LOOP;

      END LOOP;
    END LOOP;

    commit;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;

    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA ||
                  ' Se crearon registros:' || to_char(totalReg);

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_IniciarAsistencia OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      p_msjError := SQLERRM;

  END Pr_IniciarAsistencia;

  /********************************************************************************
  DESCRIPCION    : Funcion para consultar el numero de talleres dictados donde
                   esta el inscrito
  PARAMETROS    :
  IN    :
          p_idParticiante


  OUT    :
          numReg


  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  FUNCTION Fn_InscritosGrupo(p_idGrupoFacilitador IN NUMBER) RETURN NUMBER IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Fn_InscritosGrupo';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Fn_InscritosGrupo ');

    select count(*)
      into numReg
      from t53_grupoinscrito
     where a53grupofacilitador = p_idGrupoFacilitador
       and a53estado = 'A';

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Fn_InscritosGrupo OK ');

    RETURN numReg;

  END Fn_InscritosGrupo;

END PK_OPE_ASISTENCIA;
/

prompt
prompt Creating package body PK_OPE_AUDIT
prompt ==================================
prompt
create or replace package body hpv.pk_ope_audit is

  PROCEDURE Pr_DarTransac(p_idFuncion IN NUMBER,
                          p_idUsuario IN NUMBER,
                          p_fec_ini   IN varchar2,
                          p_fec_fin   IN varchar2,
                          p_resultado OUT PK_UTILS.TY_CURSOR,
                          p_codError  OUT NUMBER,
                          p_msjError  OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarTransac';
    numReg               NUMBER;
    V_FUNCION            varchar2(50);

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarTransac ');

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    SELECT A.NOMBRE
      INTO V_FUNCION
      FROM T111_OPCIONESAUDIT A
     WHERE A.CODIGO = p_idFuncion;

    IF V_FUNCION = 'CASOSEXITO' THEN
      OPEN p_resultado FOR
        select ROWNUM           IdTrx,
               a58fechacreacion Fecha,
               -- a58codigo|| '#' ||
               a58periodo || '#' || a58grupofacilitador || '#' || a58estado || '#' ||
                a58idlogro || '#' ||
               -- a58fechacreacion|| '#' ||
               -- a58fechamodificacion|| '#' ||
               -- a58usuariocreacion|| '#' ||
               -- a58usuariomodificacion|| '#' ||
                a58inscrito || '#' || a58facilitador || '#' ||
                a58observacion || '#' || a58motivorechazo || '#' || a58numsi || '#' ||
                a58numno Tx
          from T58_CASOEXITO L
         WHERE (L.A58USUARIOCREACION = p_idUsuario
           AND L.A58FECHACREACION >= TO_DATE(p_fec_ini, 'YYYY/MM/DD')
           AND L.A58FECHACREACION <= TO_DATE(p_fec_fin, 'YYYY/MM/DD')
           ) or
           (L.A58USUARIOMODIFICACION = p_idUsuario
           AND L.A58FECHAMODIFICACION >= TO_DATE(p_fec_ini, 'YYYY/MM/DD')
           AND L.A58FECHAMODIFICACION <= TO_DATE(p_fec_fin, 'YYYY/MM/DD')
           )
         order by L.A58FECHACREACION, L.A58PERIODO;
         return;
    END IF;

    IF V_FUNCION = 'HISTORIAVIDA' THEN
      OPEN p_resultado FOR
        select ROWNUM           IdTrx,
               a57fechacreacion Fecha,
               -- a57codigo|| '#' ||
               a57periodo || '#' || a57grupofacilitador || '#' || a57estado || '#' ||
                a57tipo || '#' || a57razondeconsideracion || '#' ||
                a57circunstanciassuperadas || '#' ||
                a57habilidadespracticadas || '#' || a57leccion || '#' ||
               -- a57fechacreacion|| '#' ||
               -- a57fechamodificacion|| '#' ||
               -- a57usuariocreacion|| '#' ||
               -- a57usuariomodificacion|| '#' ||
                a57inscrito || '#' || a57facilitador || '#' ||
                a57motivorechazo Tx
          from T57_HISTORIAVIDA L
         WHERE (L.A57USUARIOCREACION = p_idUsuario
           AND L.a57FECHACREACION >= TO_DATE(p_fec_ini, 'YYYY/MM/DD')
           AND L.a57FECHACREACION <= TO_DATE(p_fec_fin, 'YYYY/MM/DD')
           ) or
           (L.a57USUARIOMODIFICACION = p_idUsuario
           AND L.a57FECHAMODIFICACION >= TO_DATE(p_fec_ini, 'YYYY/MM/DD')
           AND L.a57FECHAMODIFICACION <= TO_DATE(p_fec_fin, 'YYYY/MM/DD')
           )
         order by L.A57FECHACREACION, L.A57PERIODO;
         return;
    END IF;

    IF V_FUNCION = 'EJEMLIDERAZGO' THEN
      OPEN p_resultado FOR
        select ROWNUM           IdTrx,
               a60fechacreacion Fecha,
               -- a60codigo|| '#' ||
               a60periodo || '#' || a60grupofacilitador || '#' || a60estado || '#' ||
               -- a60fechacreacion|| '#' ||
               -- a60fechamodificacion|| '#' ||
               -- a60usuariocreacion|| '#' ||
               -- a60usuariomodificacion|| '#' ||
                a60inscrito || '#' || a60facilitador || '#' ||
                a60observacion || '#' || a60motivorechazo || '#' || a60numsi || '#' ||
                a60numno Tx
          from T60_LIDERAZGO L
         WHERE (L.A60USUARIOCREACION = p_idUsuario
           AND L.A60FECHACREACION >= TO_DATE(p_fec_ini, 'YYYY/MM/DD')
           AND L.A60FECHACREACION <= TO_DATE(p_fec_fin, 'YYYY/MM/DD')
           ) or
           (L.A60USUARIOMODIFICACION = p_idUsuario
           AND L.A60FECHAMODIFICACION >= TO_DATE(p_fec_ini, 'YYYY/MM/DD')
           AND L.A60FECHAMODIFICACION <= TO_DATE(p_fec_fin, 'YYYY/MM/DD')
           )
         order by L.A60FECHACREACION, L.A60PERIODO;
         return;
    END IF;

    IF V_FUNCION = 'MARCACIONASISTENCIA' THEN
      OPEN p_resultado FOR
        select ROWNUM           IdTrx,
               a21fechacreacion Fecha,
                -- a21codigo|| '#' ||
                a21grupo|| '#' ||
                a21taller|| '#' ||
                a21fechataller|| '#' ||
                a21facilitador|| '#' ||
                a21periodo|| '#' ||
                a21estado|| '#' ||
                -- a21fechacreacion|| '#' ||
                -- a21fechamodificacion|| '#' ||
                -- a21usuariocreacion|| '#' ||
                -- a21usuariomodificacion|| '#' ||
                a21motivorechazo|| '#' ||
                a21asistentes|| '#' ||
                a21noasistentes|| '#' ||
                a21fechaencuesta Tx
          from t21_realizaciontaller L
         WHERE (L.A21USUARIOCREACION = p_idUsuario
           AND L.A21FECHACREACION >= TO_DATE(p_fec_ini, 'YYYY/MM/DD')
           AND L.A21FECHACREACION <= TO_DATE(p_fec_fin, 'YYYY/MM/DD')
           ) or
           (L.A21USUARIOMODIFICACION = p_idUsuario
           AND L.A21FECHAMODIFICACION >= TO_DATE(p_fec_ini, 'YYYY/MM/DD')
           AND L.A21FECHAMODIFICACION <= TO_DATE(p_fec_fin, 'YYYY/MM/DD')
           )
         order by L.A21FECHACREACION, L.A21PERIODO;
         return;
    END IF;

    IF V_FUNCION = 'ESPACIOSFISICOS' THEN
      OPEN p_resultado FOR
        select ROWNUM           IdTrx,
               a26fechacreacion Fecha,
              -- a26codigo|| '#' ||
              a26facilitador|| '#' ||
              a26ciudad|| '#' ||
              a26grupo|| '#' ||
              a26dia|| '#' ||
              a26horario|| '#' ||
              a26lugar|| '#' ||
              a26direccion|| '#' ||
              a26sigla|| '#' ||
              a26periodo|| '#' ||
              a26condicion|| '#' ||
              a26observaciones|| '#' ||
              a26motivorechazo|| '#' ||
              a26estado|| '#' ||
              -- a26fechacreacion|| '#' ||
              -- a26fechamodificacion|| '#' ||
              -- a26usuariocreacion|| '#' ||
              -- a26usuariomodificacion|| '#' ||
              a26inscritos Tx
          from t26_gruposfacilitador L
         WHERE (L.A26USUARIOCREACION = p_idUsuario
           AND L.A26FECHACREACION >= TO_DATE(p_fec_ini, 'YYYY/MM/DD')
           AND L.A26FECHACREACION <= TO_DATE(p_fec_fin, 'YYYY/MM/DD')
           ) or
           (L.A26USUARIOMODIFICACION = p_idUsuario
           AND L.A26FECHAMODIFICACION >= TO_DATE(p_fec_ini, 'YYYY/MM/DD')
           AND L.A26FECHAMODIFICACION <= TO_DATE(p_fec_fin, 'YYYY/MM/DD')
           )
         order by L.A26FECHACREACION, L.A26PERIODO;
         return;
    END IF;

      OPEN p_resultado FOR
        select 0           IdTrx,
               sysdate Fecha,
              'LOG NO PARAMETRIZADO' Tx
          from dual L;


    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarTransac OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarTransac;

end pk_ope_audit;
/

prompt
prompt Creating package body PK_OPE_CASOEXITO
prompt ======================================
prompt
create or replace package body hpv.PK_OPE_CASOEXITO is

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la lista delogros con sus atributos
  PARAMETROS    :
  IN    :
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarLogros(p_resultado OUT PK_UTILS.ty_cursor,
                         p_codError  OUT NUMBER,
                         p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarLogros';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarLogros ');
  
    OPEN p_resultado FOR
      select a82codigo   IdLogro,
             a82nombre   NomLogro,
             a82verbo    Verbo,
             a82adjetivo Adjetivo,
             a82medio    Medio
        from t82_logrocasoexito
       where a82estado = 'A';
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_DarLogros ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarLogros;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar las casos de exito de un usuario dado
  PARAMETROS    :
  IN    :
           p_IdUSuario
           P_FiltroBusqueda
           p_EstadoXConsultar
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarCasosDeExito(p_idUsuario        IN number,
                               p_filtroBusqueda   IN varchar2,
                               p_estadoXConsultar IN varchar2,
                               p_idPeriodo        IN NUMBER,
                               p_resultado        OUT PK_UTILS.ty_cursor,
                               p_codError         OUT NUMBER,
                               p_msjError         OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarCasosDeExito';
    numReg               NUMBER;
  
    codPeriodo number;
    idRol      number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarCasosDeExito ');
  
    if (p_idPeriodo is null) then
      codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
    else
      codPeriodo := p_idPeriodo;
    end if;
  
    select count(*)
      into numReg
      from t06_usuarios
     where a06codigo = p_idUsuario;
  
    if (numReg = 0) then
      p_codError := 22;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    select a06rol
      into idRol
      from t06_usuarios
     where a06codigo = p_idUsuario;
  
    --es un facilitador
    if (idRol = 1) then
    
      select count(*)
        into numReg
        from t58_casoexito, t26_gruposfacilitador
       where a58periodo = codPeriodo
         and a58grupofacilitador = a26codigo
         and a26facilitador = p_idUsuario;
    
      if (numReg = 0) then
        p_codError := 80;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      OPEN p_resultado FOR
        select a58codigo IdCasoDeExito,
               a58periodo IdPeriodo,
               a26codigo IdGrupoFacilitador,
               a26sigla SiglaGrupo,
               a26grupo IdGrupo,
               a25nombre NomGrupo,
               a26facilitador IdFacilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
               a06coordinador IdCoordinador,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) NomCoordinador,
               a26ciudad IdMunicipio,
               a03nombre NomMunicipio,
               a03departamento IdDepartamento,
               a02nombre NomDepartamento,
               a58estado Idestado,
               a83nombre NomEstado,
               a58IdLogro IdLogro,
               '' NomLogro,
               '' Criterios,
               '' NomVerbo,
               '' NomAdjetivo,
               '' NomMedio,
               a58observacion Observaciones,
               a58motivoRechazo MotivoRechazo,
               a58inscrito IdInscrito,
               (a15primernombre || ' ' || a15segundonombre || ' ' ||
               a15primerapellido || ' ' || a15segundoapellido) NomInscrito,
               '' Logros
          from t58_casoExito,
               t26_gruposfacilitador,
               t25_grupos,
               t07_personas          p1,
               t07_personas          p2,
               t06_usuarios,
               t03_municipios,
               t02_departamentos,
               t83_estadocasoExito,
               --t82_logrocasoexito,
               t15_inscritos
         where a58periodo = codPeriodo
           and a58grupofacilitador = a26codigo
           AND a26grupo = a25codigo
           AND a26facilitador = p1.a07usuario
           and a06coordinador = p2.a07usuario
           and a06codigo = a26facilitador
           and a03departamento = a02codigo
           and a58estado = a83codigo
           and a58inscrito = a15codigo
           and a26ciudad = a03codigo
           and a26facilitador = p_idUsuario
           and (UPPER(a26sigla) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primernombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundonombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primerapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundoapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a03nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a83nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%');
    
    end if;
  
    --es un coordinador
    if (idRol = 2) then
    
      select count(*)
        into numReg
        from t58_casoexito, t26_gruposfacilitador, t06_usuarios
       where a58periodo = codPeriodo
         and a58grupofacilitador = a26codigo
         and a26facilitador = a06codigo
         and a06coordinador = p_idUsuario;
    
      if (numReg = 0) then
        p_codError := 80;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      OPEN p_resultado FOR
        select a58codigo IdCasoDeExito,
               a58periodo IdPeriodo,
               a26codigo IdGrupoFacilitador,
               a26sigla SiglaGrupo,
               a26grupo IdGrupo,
               a25nombre NomGrupo,
               a26facilitador IdFacilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
               a06coordinador IdCoordinador,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) NomCoordinador,
               a26ciudad IdMunicipio,
               a03nombre NomMunicipio,
               a03departamento IdDepartamento,
               a02nombre NomDepartamento,
               a58estado Idestado,
               a83nombre NomEstado,
               a58IdLogro IdLogro,
               '' NomLogro,
               '' Criterios,
               '' NomVerbo,
               '' NomAdjetivo,
               '' NomMedio,
               a58observacion Observaciones,
               a58motivoRechazo MotivoRechazo,
               a58inscrito IdInscrito,
               (a15primernombre || ' ' || a15segundonombre || ' ' ||
               a15primerapellido || ' ' || a15segundoapellido) NomInscrito,
               '' Logros
          from t58_casoExito,
               t26_gruposfacilitador,
               t25_grupos,
               t07_personas          p1,
               t07_personas          p2,
               t06_usuarios,
               t03_municipios,
               t02_departamentos,
               t83_estadocasoExito,
               --t82_logrocasoexito,
               t15_inscritos
         where a58periodo = codPeriodo
           and a58grupofacilitador = a26codigo
           AND a26grupo = a25codigo
           AND a26facilitador = p1.a07usuario
           and a06coordinador = p2.a07usuario
           and a06codigo = a26facilitador
           and a03departamento = a02codigo
           and a58estado = a83codigo
              --and a58IdLogro = a82codigo
           and a58inscrito = a15codigo
           and a26ciudad = a03codigo
           and a06coordinador = p_idUsuario
           and (UPPER(a26sigla) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primernombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundonombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primerapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundoapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a03nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a83nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%');
    
    end if;
  
    --es un supervisor
    if (idRol = 6 or idRol = 7) then
    
      select count(*)
        into numReg
        from t58_casoexito, t26_gruposfacilitador
       where a58periodo = codPeriodo
         and a58grupofacilitador = a26codigo;
    
      if (numReg = 0) then
        p_codError := 80;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      OPEN p_resultado FOR
        select a58codigo IdCasoDeExito,
               a58periodo IdPeriodo,
               a26codigo IdGrupoFacilitador,
               a26sigla SiglaGrupo,
               a26grupo IdGrupo,
               a25nombre NomGrupo,
               a26facilitador IdFacilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
               a06coordinador IdCoordinador,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) NomCoordinador,
               a26ciudad IdMunicipio,
               a03nombre NomMunicipio,
               a03departamento IdDepartamento,
               a02nombre NomDepartamento,
               a58estado Idestado,
               a83nombre NomEstado,
               a58IdLogro IdLogro,
               '' NomLogro,
               '' Criterios,
               '' NomVerbo,
               '' NomAdjetivo,
               '' NomMedio,
               a58observacion Observaciones,
               a58motivoRechazo MotivoRechazo,
               a58inscrito IdInscrito,
               (a15primernombre || ' ' || a15segundonombre || ' ' ||
               a15primerapellido || ' ' || a15segundoapellido) NomInscrito,
               '' Logros
          from t58_casoExito,
               t26_gruposfacilitador,
               t25_grupos,
               t07_personas          p1,
               t07_personas          p2,
               t06_usuarios,
               t03_municipios,
               t02_departamentos,
               t83_estadocasoExito,
               --t82_logrocasoexito,
               t15_inscritos
         where a58periodo = codPeriodo
           and a58grupofacilitador = a26codigo
           AND a26grupo = a25codigo
           AND a26facilitador = p1.a07usuario
           and a06coordinador = p2.a07usuario
           and a06codigo = a26facilitador
           and a03departamento = a02codigo
           and a58estado = a83codigo
              --and a58IdLogro = a82codigo
           and a58inscrito = a15codigo
           and a26ciudad = a03codigo
           and (UPPER(a26sigla) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primernombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundonombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primerapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundoapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a03nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a83nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%');
    
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_DarCasosDeExito ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarCasosDeExito;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para validar la cantidad de casos de exito a grabar
  PARAMETROS    :
  IN    :
           p_IdUSuario
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/

  PROCEDURE Pr_ValidarCantidadCasoDeExito(p_idUsuario IN number,
                                          p_codError  OUT NUMBER,
                                          p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ValidarCasoDeExito';
    numReg               NUMBER;
    numMunFac            NUMBER;

  
    codPeriodo number;
    idRol      number;
  
    cantidadGrupos number;
  
    LIMITEGRUPOCE   number;
    CANTIDADCEMENOR number;
    CANTIDADCEMAYOR number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_ValidarCasoDeExito ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    select count(*)
      into cantidadGrupos
      from t26_gruposfacilitador
     where a26facilitador = p_idUsuario
       and a26periodo = codPeriodo
       AND a26estado = 'A'
       and a26grupo <> 11
       and PK_OPE_ASISTENCIA.Fn_InscritosGrupo(a26codigo) > 0;
  
    if (cantidadGrupos = 0) then
      p_codError := 77;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    select count(*)
      into numReg
      from t58_casoexito, t26_gruposfacilitador
     where a58periodo = codPeriodo
       and a58grupofacilitador = a26codigo
       and a26facilitador = p_idUsuario;
  
    /*Se incluye esta validacion para los faccilitadores que tienen mas de 1 ciudad asignada*/
    select count(*)
      into numMunFac
      from T30_CIUDADESUSUARIO t
     where t.a30usuario = p_idUsuario;
    numReg := numReg / numMunFac;

    LIMITEGRUPOCE   := to_number(Pk_Utils.Fn_Obtenervalorparametro('LIMITEGRUPOCE'));
    CANTIDADCEMENOR := to_number(Pk_Utils.Fn_Obtenervalorparametro('CANTIDADCEMENOR'));
    CANTIDADCEMAYOR := to_number(Pk_Utils.Fn_Obtenervalorparametro('CANTIDADCEMAYOR'));
  
    if (cantidadGrupos <= LIMITEGRUPOCE) then
      if (numReg >= CANTIDADCEMENOR) then
        p_codError := 81;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
    else
      if (numReg >= CANTIDADCEMAYOR) then
        p_codError := 81;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ValidarCasoDeExito ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ValidarCantidadCasoDeExito;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para crear caso de exito
  PARAMETROS    :
  IN    :
           p_idCasoDeExito
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/

  PROCEDURE Pr_ActualizarCasoDeExito(p_idCasoExito        IN number, -- 0 Si es nuevo
                                     p_idGrupoFacilitador number,
                                     p_idFacilitador      number,
                                     p_idLogro            number, -- Este campo se deja para compatibilidad con el esquema anterior
                                     p_logros             varchar2,
                                     p_criterios          varchar2, -- idCualidad,S(N);
                                     p_idInscrito         number,
                                     p_observaciones      varchar2,
                                     p_codError           OUT NUMBER,
                                     p_msjError           OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ActualizarCasoDeExito';
    numReg               NUMBER;
  
    codPeriodo  number;
    idCasoExito number;
  
    listCualidades pk_utils.token_list;
    datoCualidad   pk_utils.token_list;
    i              number;
    numCualidades  number;
    numSi          number;
    numNo          number;
  
    listLogros pk_utils.token_list;
    j          number;
    numLogros  number;
  
    numAsistencia       number;
    limiteMinAsistencia number;
  
    limiteMinCualidadesCE number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_ActualizarCasoDeExito ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    -- Validar que cumpla con minimo de asistencia
    select count(*)
      into numAsistencia
      from (select a51tallerrealizado
              from t51_asistenciataller
             where a51inscrito = p_idInscrito
               and a51asistencia = 'A'
             group by a51tallerrealizado);
  
    limiteMinAsistencia := TO_NUMBER(pk_utils.fn_ObtenerValorParametro('LIMNUMASISTENCIA'));
  
    if (numAsistencia < limiteMinAsistencia) then
      p_codError := 84;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    listCualidades := pk_utils.fn_splitStr(p_criterios, ';');
  
    i             := 1;
    numCualidades := pk_utils.splitter_count(p_criterios, ';') + 1;
    numSi         := 0;
    numNo         := 0;
  
    while i <= numCualidades loop
    
      datoCualidad := pk_utils.fn_splitStr(listCualidades(i), ',');
      if (datoCualidad(2) = 'S') then
        numSi := numSi + 1;
      end if;
      if (datoCualidad(2) = 'N') then
        numNo := numNo + 1;
      end if;
    
      i := i + 1;
    end loop;
  
    limiteMinCualidadesCE := TO_NUMBER(pk_utils.fn_ObtenerValorParametro('LIMMINCUALIDADESCE'));
  
    if (numSi < limiteMinCualidadesCE) then
      p_codError := 89;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    if (p_idCasoExito = 0) then
    
      select count(*)
        into numReg
        from t58_casoexito
       where a58periodo = codPeriodo
         and a58grupofacilitador = p_idGrupoFacilitador;
    
      if (numReg > 0) then
        p_codError := 82;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      select t58_casoexito_seq.NEXTVAL into idCasoExito from dual;
    
      insert into t58_casoexito
        (a58codigo,
         a58periodo,
         a58grupofacilitador,
         a58estado,
         a58idlogro,
         a58fechacreacion,
         a58fechamodificacion,
         a58usuariocreacion,
         a58usuariomodificacion,
         a58inscrito,
         a58facilitador,
         a58observacion,
         a58motivorechazo,
         a58NumSi,
         a58NumNo)
      values
        (idCasoExito,
         codPeriodo,
         p_idGrupofacilitador,
         'P',
         p_idLogro,
         sysdate,
         sysdate,
         p_idFacilitador,
         p_idFacilitador,
         p_idInscrito,
         p_idFacilitador,
         p_observaciones,
         null, -- a58motivorechazo
         numSi,
         numNo);
    
      -- Saber qué logros se seleccionaron para relacionarlos
      j          := 1;
      listLogros := pk_utils.fn_splitStr(p_logros, ',');
      numLogros  := pk_utils.splitter_count(p_logros, ',') + 1;
      while j <= numLogros loop
        -- Se inserta la relación en la tabla 63
        INSERT INTO T63_CASOSEXITO_LOGROS
          (A63_IDCASOEXITO,
           A63_IDLOGRO,
           A63_FECHAMODIFICACION,
           A63_USUARIOMODIFICACION)
        VALUES
          (idCasoExito, listLogros(j), SYSDATE, p_idFacilitador);
        j := j + 1;
      end loop;
    else
      idCasoExito := p_idCasoExito;
      update t58_casoexito
         set a58grupofacilitador    = p_idGrupofacilitador,
             a58estado              = 'P',
             a58idLogro             = p_idLogro,
             a58fechamodificacion   = sysdate,
             a58usuariomodificacion = p_idFacilitador,
             a58inscrito            = p_idInscrito,
             a58observacion         = p_observaciones,
             a58NumSi               = numSi,
             a58NumNo               = numNo
       where a58codigo = p_idCasoExito;
    
      delete from T63_CASOSEXITO_LOGROS
       WHERE idCasoExito = A63_IDCASOEXITO;
    
      -- Saber qué logros se seleccionaron para relacionarlos
      j          := 1;
      listLogros := pk_utils.fn_splitStr(p_logros, ',');
      numLogros  := pk_utils.splitter_count(p_logros, ',') + 1;
      while j <= numLogros loop
        -- Se inserta la relación en la tabla 63
        INSERT INTO T63_CASOSEXITO_LOGROS
          (A63_IDCASOEXITO,
           A63_IDLOGRO,
           A63_FECHAMODIFICACION,
           A63_USUARIOMODIFICACION)
        VALUES
          (idCasoExito, listLogros(j), SYSDATE, p_idFacilitador);
        j := j + 1;
      end loop;
    
    end if;
  
    delete from t59_casoexitologro where a59casoexito = idCasoExito;
  
    listCualidades := pk_utils.fn_splitStr(p_criterios, ';');
  
    i             := 1;
    numCualidades := pk_utils.splitter_count(p_criterios, ';') + 1;
  
    while i <= numCualidades loop
    
      datoCualidad := pk_utils.fn_splitStr(listCualidades(i), ',');
    
      insert into t59_casoexitologro
        (a59codigo,
         a59casoexito,
         a59cualidad,
         a59respuesta,
         a59estado,
         a59fechacreacion,
         a59fechamodificacion,
         a59usuariocreacion,
         a59usuariomodificacion)
        select t59_casoexitologro_seq.nextval,
               idCasoExito,
               to_number(datoCualidad(1)),
               datoCualidad(2),
               'A',
               sysdate,
               sysdate,
               p_idFacilitador,
               p_idFacilitador
          from dual;
    
      i := i + 1;
    
    end loop;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ActualizarCasoDeExito ok ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ActualizarCasoDeExito;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar caso de exito
  PARAMETROS    :
  IN    :
           p_idCasoDeExito
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/

  PROCEDURE Pr_consultarCasoDeExito(p_idCasoDeExito IN number,
                                    p_resultado     OUT PK_UTILS.ty_cursor,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_consultarCasoDeExito';
    numReg               NUMBER;
  
    codPeriodo number;
    idRol      number;
    criterios  varchar2(200);
  
    logros varchar2(200);
  
    CURSOR curLogro IS
      SELECT a59cualidad, a59respuesta
        FROM t59_casoexitologro
       WHERE a59casoexito = p_idCasoDeExito
       order by a59cualidad;
  
    CURSOR curCasosLogros IS
      SELECT a63_idlogro
        FROM t63_casosexito_logros
       WHERE a63_idcasoexito = p_idCasoDeExito;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_consultarCasoDeExito ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    criterios := '';
    FOR regLogro IN curLogro LOOP
      criterios := criterios || to_char(regLogro.a59cualidad) || ',' ||
                   regLogro.A59respuesta || ';';
    end loop;
  
    logros := '';
    FOR regCasosLogros IN curCasosLogros LOOP
      logros := logros || to_char(regCasosLogros.a63_idlogro) || ',';
    END LOOP;
  
    OPEN p_resultado FOR
      select a58codigo IdCasoDeExito,
             a58periodo IdPeriodo,
             a26codigo IdGrupoFacilitador,
             a26sigla SiglaGrupo,
             a26grupo IdGrupo,
             a25nombre NomGrupo,
             a26facilitador IdFacilitador,
             (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
             p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
             a06coordinador IdCoordinador,
             (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
             p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomCoordinador,
             a26ciudad IdMunicipio,
             a03nombre NomMunicipio,
             a03departamento IdDepartamento,
             a02nombre NomDepartamento,
             a58estado Idestado,
             a83nombre NomEstado,
             a58IdLogro IdLogro,
             '' NomLogro,
             criterios Criterios,
             '' NomVerbo,
             '' NomAdjetivo,
             '' NomMedio,
             a58observacion Observaciones,
             a58motivoRechazo MotivoRechazo,
             a58inscrito IdInscrito,
             (a15primernombre || ' ' || a15segundonombre || ' ' ||
             a15primerapellido || ' ' || a15segundoapellido) NomInscrito,
             logros Logros
        from t58_casoExito,
             t26_gruposfacilitador,
             t25_grupos,
             t07_personas          p1,
             t07_personas          p2,
             t06_usuarios,
             t03_municipios,
             t02_departamentos,
             t83_estadocasoExito,
             --t82_logrocasoexito,
             t15_inscritos
       where a58codigo = p_idCasoDeExito
         and a58grupofacilitador = a26codigo
         AND a26grupo = a25codigo
         AND a26facilitador = p1.a07usuario
         and a06coordinador = p2.a07usuario
         and a06codigo = a26facilitador
         and a03departamento = a02codigo
         and a58estado = a83codigo
            --and a58IdLogro = a82codigo
         and a58inscrito = a15codigo
         and a26ciudad = a03codigo;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_consultarCasoDeExito ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_consultarCasoDeExito;

  PROCEDURE Pr_RegistrarEstadoCasoDeExito(p_idUsuario     IN NUMBER,
                                          p_idCasoDeExito IN NUMBER,
                                          p_motivoRechazo IN VARCHAR2,
                                          p_estado        IN VARCHAR2, --  A:Aprobar R:Rechazar P:Pendiente aprobacion E:Elejido
                                          p_codError      OUT NUMBER,
                                          p_msjError      OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_RegistrarEstadoCasoDeExito';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_RegistrarEstadoCasoDeExito ');
  
    update t58_casoexito
       set a58estado              = p_estado,
           a58fechamodificacion   = sysdate,
           a58usuariomodificacion = p_idUsuario,
           a58motivorechazo       = p_motivoRechazo
     where a58codigo = p_idCasoDeExito;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_RegistrarEstadoCasoDeExito OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_RegistrarEstadoCasoDeExito;

end PK_OPE_CASOEXITO;
/

prompt
prompt Creating package body PK_OPE_CONSULTAS
prompt ======================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_OPE_CONSULTAS IS
  /********************************************************************************
   DESCRIPCION   : Procedimiento encargado de devolver los inscritos

   PARAMETROS    :
   IN            :
                  p_consulta
                  p_idPeriodo

   OUT           : p_resultado       Retorna los espacios fisicos
                   p_codError        Codigo de error generado
                   p_msjError        Mensaje del error generado

  REALIZADO POR    : 
                      

  FECHA CREACION    : 15/04/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_Consultarinscritos(p_consulta  IN VARCHAR2,
                                  p_idPeriodo IN NUMBER,
                                  p_resultado OUT PK_UTILS.TY_CURSOR,
                                  p_codError  OUT NUMBER,
                                  p_msjError  OUT VARCHAR2) IS

    codExcepcion NUMBER;
    numReg       NUMBER;

    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_Consultarinscritos';
  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar inscritos en el periodo ' ||
                            p_idPeriodo);

    /*   if p_consulta is null or LENGTH(p_consulta) < 5 then
      OPEN p_resultado FOR
          SELECT a15codigo idInscrito,
             a15tipodocumento tipodocumento,
             a15documento documento,
             (a15primernombre || ' ' || a15segundonombre || ' ' ||
             a15primerapellido || ' ' || a15segundoapellido) nombreinscrito,
             a15codigobeneficiario CodigoBeneficiario,
             to_char(a15fechanacimiento, 'yyyy-mm-dd') fechanacimiento,
             a15email Correo,
             a15telefono telefono,
             a15movil movil,
             a15movilalt movilAlt,
             a87condicion condicionEspecial,
             a02nombre nomdepartamento,
             (a03nombre || ' ' || a02nombre) nommunicipio,
             a23nombre dia,
             a24horario horario,
             a25nombre grupo,
             a26sigla siglagrupo,
             a26lugar lugar,
             a26direccion direccion,
             p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
             p1.a07primerapellido || ' ' || p1.a07segundoapellido nombrefacilitador,
             p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
             p2.a07primerapellido || ' ' || p2.a07segundoapellido nombreCoordinador,
             to_char(a15fechacreacion, 'yyyy-mm-dd') fechaRegistro
        FROM T26_GRUPOSFACILITADOR,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS,
             T07_PERSONAS             p1,
             T07_PERSONAS             p2,
             T15_INSCRITOS,
             T04_TIPOSDOCUMENTO,
             T87_CONDICIONESPECIAL
       WHERE 1 = 2;
      p_codError := 0;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if; */

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    -- Se controla cantidad de registros por rownum < 50

    OPEN p_resultado FOR
      SELECT a15codigo idInscrito,
             a15tipodocumento tipodocumento,
             a15documento documento,
             (a15primernombre || ' ' || a15segundonombre || ' ' ||
             a15primerapellido || ' ' || a15segundoapellido) nombreinscrito,
             a15codigobeneficiario CodigoBeneficiario,
             to_char(a15fechanacimiento, 'yyyy-mm-dd') fechanacimiento,
             a15email Correo,
             a15telefono telefono,
             a15movil movil,
             a15movilalt movilAlt,
             a87condicion condicionEspecial,
             UPPER(a02nombre) nomdepartamento,
             UPPER((a03nombre || ' - ' || a02nombre)) nommunicipio,
             a23nombre dia,
             a24horario horario,
             a25nombre grupo,
             a26sigla siglagrupo,
             a26lugar lugar,
             a26direccion direccion,
             p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
             p1.a07primerapellido || ' ' || p1.a07segundoapellido nombrefacilitador,
             p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
             p2.a07primerapellido || ' ' || p2.a07segundoapellido nombreCoordinador,
             to_char(a15fechacreacion, 'yyyy-mm-dd') fechaRegistro,
             '' listaTaller,
             a04nombre NomTipoDocumento,
             '' fechacertificado
        FROM T26_GRUPOSFACILITADOR,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS,
             T07_PERSONAS             p1,
             T07_PERSONAS             p2,
             T15_INSCRITOS,
             T04_TIPOSDOCUMENTO,
             T87_CONDICIONESPECIAL
       WHERE a26estado = a90codigo
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = p1.a07usuario
         AND a26periodo = decode(p_idPeriodo, 0 , a26periodo, p_idPeriodo)
         AND a06coordinador = p2.a07usuario
         AND a15grupofacilitador = a26codigo
         AND a15tipodocumento = a04tipodocumento
         AND a15condicionespecial = a87codigo
         AND a15estado = 'A'
         AND rownum < 51
         AND (UPPER(a02nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a03nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a23nombre) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a24horario) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a26sigla) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a26lugar) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a26direccion) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a15documento) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a15primernombre) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a15segundonombre) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a15primerapellido) LIKE '%' || UPPER(p_consulta) || '%' OR
             UPPER(a15segundoapellido) LIKE
             '%' || UPPER(p_consulta) || '%' OR
             UPPER(a15email) LIKE '%' || UPPER(p_consulta) || '%' OR
             TO_CHAR(a15codigobeneficiario) LIKE
             '%' || UPPER(p_consulta) || '%');

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta inscritos en el periodo OK ');
  EXCEPTION
    WHEN OTHERS THEN

      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_Consultarinscritos;

  /********************************************************************************
   DESCRIPCION   : Procedimiento encargado de devolver el inscrito

   PARAMETROS    :
   IN            :
                  p_idInscrito
                  p_idPeriodo

   OUT           : p_resultado       Retorna los espacios fisicos
                   p_codError        Codigo de error generado
                   p_msjError        Mensaje del error generado

  REALIZADO POR    : 
                      

  FECHA CREACION    : 15/04/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  PROCEDURE Pr_Consultarinscrito(p_idPeriodo  IN NUMBER,
                                 p_idInscrito IN NUMBER,
                                 p_resultado  OUT PK_UTILS.TY_CURSOR,
                                 p_codError   OUT NUMBER,
                                 p_msjError   OUT VARCHAR2) IS

    codExcepcion NUMBER;
    numReg       NUMBER;

    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_Consultarinscrito';

    idGrupo     number;
    idTaller    number;
    fechaTaller char(10);

    CURSOR curTallerGrupo IS
      SELECT * FROM t21_realizaciontaller WHERE a21grupo = idGrupo;

    CURSOR curAsistencia IS
      select *
        from t51_asistenciataller
       where a51inscrito = p_idInscrito
         and a51tallerrealizado = idTaller
         and a51asistencia = 'A';

    cursor curTaller is
      select * from t17_talleres order by a17Orden;

    listaTaller varchar2(1000);

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar inscrito ' || p_idInscrito);

    select a15grupofacilitador
      into idGrupo
      from t15_inscritos
     where a15codigo = p_idInscrito;

    FOR regTaller IN curTaller LOOP

      listaTaller := listaTaller || to_char(regTaller.A17codigo);

      -- buscar si el estudiante asistio al taller
      select count(*)
        into numReg
        from t51_asistenciataller
       where a51inscrito = p_idInscrito
         and a51tallerrealizado = regTaller.A17codigo
         and a51asistencia = 'A';

      if numReg > 0 then

        -- Obtener el grupo al que asistio
        select max(a51grupofacilitador)
          into idGrupo
          from t51_asistenciataller
         where a51inscrito = p_idInscrito
           and a51tallerrealizado = regTaller.A17codigo
           and a51asistencia = 'A';

        -- Obtener la fecha de realizacion del taller
        select to_char(a21fechataller, 'yyyy-mm-dd')
          into fechaTaller
          from t21_realizaciontaller
         where a21grupo = idGrupo
           and a21taller = regTaller.A17codigo;

        listaTaller := listaTaller || ',' || fechaTaller || ',1';
      else
        -- verificar si no asistio
        select count(*)
          into numReg
          from t51_asistenciataller
         where a51inscrito = p_idInscrito
           and a51tallerrealizado = regTaller.A17codigo
           and a51asistencia = 'N';

        if numReg > 0 then

          -- Obtener el grupo al que no asistio
          select max(a51grupofacilitador)
            into idGrupo
            from t51_asistenciataller
           where a51inscrito = p_idInscrito
             and a51tallerrealizado = regTaller.A17codigo
             and a51asistencia = 'N';

          -- Obtener la fecha de realizacion del taller
          select to_char(a21fechataller, 'yyyy-mm-dd')
            into fechaTaller
            from t21_realizaciontaller
           where a21grupo = idGrupo
             and a21taller = regTaller.A17codigo;

          listaTaller := listaTaller || ',' || fechaTaller || ',0';
        else
          listaTaller := listaTaller || ',' || '' || ',-1';
        end if;

      end if;

      listaTaller := listaTaller || ';';

    end loop;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      SELECT a15codigo idInscrito,
             a15tipodocumento tipodocumento,
             a15documento documento,
             (a15primernombre || ' ' || a15segundonombre || ' ' ||
             a15primerapellido || ' ' || a15segundoapellido) nombreinscrito,
             a15codigobeneficiario CodigoBeneficiario,
             to_char(a15fechanacimiento, 'yyyy-mm-dd') fechanacimiento,
             a15email Correo,
             a15telefono telefono,
             a15movil movil,
             a15movilalt movilAlt,
             a87condicion condicionEspecial,
             upper(a02nombre) nomdepartamento,
             upper(a03nombre) nommunicipio,
             a23nombre dia,
             a24horario horario,
             a25nombre grupo,
             a26sigla siglagrupo,
             a26lugar lugar,
             a26direccion direccion,
             p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
             p1.a07primerapellido || ' ' || p1.a07segundoapellido nombrefacilitador,
             p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
             p2.a07primerapellido || ' ' || p2.a07segundoapellido nombreCoordinador,
             to_char(a15fechacreacion, 'yyyy-mm-dd') fechaRegistro,
             listaTaller listaTaller,
             a04nombre NomTipoDocumento,
             to_char(p.a12fechaCertificado,'yyyy-mm-dd') fechacertificado
        FROM T26_GRUPOSFACILITADOR,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS,
             T07_PERSONAS             p1,
             T07_PERSONAS             p2,
             T15_INSCRITOS,
             T04_TIPOSDOCUMENTO,
             T87_CONDICIONESPECIAL,
             t12_periodos p

       WHERE a26estado = a90codigo
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = p1.a07usuario
         --AND a26periodo = decode (p_idPeriodo, 0, a26periodo, p_idPeriodo)
         AND a06coordinador = p2.a07usuario
         AND a15codigo = p_idInscrito
         AND a15grupofacilitador = a26codigo
         AND a15tipodocumento = a04tipodocumento
         AND a15condicionespecial = a87codigo
         and a26periodo = p.a12codigo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta inscrito OK ');
  EXCEPTION
    WHEN OTHERS THEN

      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_Consultarinscrito;

  PROCEDURE Pr_ConsultarHorarios(p_consulta      IN VARCHAR2,
                                 p_idPeriodo     IN NUMBER,
                                 p_idCoordinador IN NUMBER,
                                 p_resultado     OUT PK_UTILS.TY_CURSOR,
                                 p_codError      OUT NUMBER,
                                 p_msjError      OUT VARCHAR2) IS

    codExcepcion NUMBER;
    numReg       NUMBER;
    numCupos     number;

    p_consulta1 varchar2(200);
    p_consulta2 varchar2(200);
    p_consulta3 varchar2(200);

    posicion1 number;
    posicion2 number;
    posicion3 number;

    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ConsultarHorarios';

    idRol number;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar horarios en el periodo ' ||
                            p_idPeriodo);

    numCupos := TO_NUMBER(Pk_Utils.Fn_Obtenervalorparametro('CUPOS'));

    p_consulta1 := p_consulta;
    p_consulta2 := '';
    p_consulta2 := '';

    posicion1 := instr(p_consulta, ',');
    if (posicion1 > 0) then

      p_consulta1 := substr(p_consulta, 1, posicion1 - 1);
      p_consulta2 := substr(p_consulta, posicion1 + 1);

      posicion2 := instr(p_consulta, ',', posicion1 + 1);
      if (posicion2 > 0) then
        p_consulta2 := substr(p_consulta,
                              posicion1 + 1,
                              posicion2 - posicion1 - 1);
        p_consulta3 := substr(p_consulta, posicion2 + 1);
      end if;

    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    -- Se controla cantidad de registros por rownum < 50
    if (p_idCoordinador is null) then
      OPEN p_resultado FOR
        select *
          from (select a07primernombre || ' ' || a07segundonombre || ' ' ||
                       a07primerapellido || ' ' || a07segundoapellido NombreFacilitador,
                       upper(a02nombre) NomDepartamento,
                       upper(a03nombre) NomMunicipio,
                       a23nombre Dia,
                       a24horario Horario,
                       a26sigla SiglaGrupo,
                       a26lugar Lugar,
                       a26direccion Direccion,
                       a26codigo IdGrupoFacilitador,
                       (select numCupos - count(*)
                          from T15_INSCRITOS i
                         where i.a15grupofacilitador = a26codigo
                           and i.a15estado = PK_UTILS.COD_ACTIVO) CupoDisponible
                  from T26_GRUPOSFACILITADOR,
                       T02_DEPARTAMENTOS,
                       T03_MUNICIPIOS,
                       T23_DIAS,
                       T24_HORARIOS,
                       T06_USUARIOS,
                       T07_PERSONAS

                 where a26estado = PK_UTILS.COD_ACTIVO
                   and a26periodo = p_idPeriodo
                   AND a26ciudad = a03codigo
                   AND a03departamento = a02codigo
                   AND a26dia = a23codigo
                   AND a26horario = a24codigo
                   AND a26facilitador = a06codigo
                   AND a06codigo = a07usuario
                   AND a26grupo <> 11
                   AND a26grupo <> 12

                   AND (UPPER(a02nombre) LIKE
                       '%' || UPPER(p_consulta1) || '%' OR
                       UPPER(a03nombre) LIKE
                       '%' || UPPER(p_consulta1) || '%' OR
                       UPPER(a23nombre) LIKE
                       '%' || UPPER(p_consulta1) || '%' OR
                       UPPER(a24horario) LIKE
                       '%' || UPPER(p_consulta1) || '%' OR
                       UPPER(a26sigla) LIKE
                       '%' || UPPER(p_consulta1) || '%' OR
                       UPPER(a26lugar) LIKE
                       '%' || UPPER(p_consulta1) || '%' OR
                       UPPER(a26direccion) LIKE
                       '%' || UPPER(p_consulta1) || '%' OR
                       UPPER(a07primernombre) LIKE
                       '%' || UPPER(p_consulta1) || '%' OR
                       UPPER(a07segundonombre) LIKE
                       '%' || UPPER(p_consulta1) || '%' OR
                       UPPER(a07primerapellido) LIKE
                       '%' || UPPER(p_consulta1) || '%' OR
                       UPPER(a07segundoapellido) LIKE
                       '%' || UPPER(p_consulta1) || '%')

                   AND (UPPER(a02nombre) LIKE
                       '%' || UPPER(p_consulta2) || '%' OR
                       UPPER(a03nombre) LIKE
                       '%' || UPPER(p_consulta2) || '%' OR
                       UPPER(a23nombre) LIKE
                       '%' || UPPER(p_consulta2) || '%' OR
                       UPPER(a24horario) LIKE
                       '%' || UPPER(p_consulta2) || '%' OR
                       UPPER(a26sigla) LIKE
                       '%' || UPPER(p_consulta2) || '%' OR
                       UPPER(a26lugar) LIKE
                       '%' || UPPER(p_consulta2) || '%' OR
                       UPPER(a26direccion) LIKE
                       '%' || UPPER(p_consulta2) || '%' OR
                       UPPER(a07primernombre) LIKE
                       '%' || UPPER(p_consulta2) || '%' OR
                       UPPER(a07segundonombre) LIKE
                       '%' || UPPER(p_consulta2) || '%' OR
                       UPPER(a07primerapellido) LIKE
                       '%' || UPPER(p_consulta2) || '%' OR
                       UPPER(a07segundoapellido) LIKE
                       '%' || UPPER(p_consulta2) || '%')

                   AND (UPPER(a02nombre) LIKE
                       '%' || UPPER(p_consulta3) || '%' OR
                       UPPER(a03nombre) LIKE
                       '%' || UPPER(p_consulta3) || '%' OR
                       UPPER(a23nombre) LIKE
                       '%' || UPPER(p_consulta3) || '%' OR
                       UPPER(a24horario) LIKE
                       '%' || UPPER(p_consulta3) || '%' OR
                       UPPER(a26sigla) LIKE
                       '%' || UPPER(p_consulta3) || '%' OR
                       UPPER(a26lugar) LIKE
                       '%' || UPPER(p_consulta3) || '%' OR
                       UPPER(a26direccion) LIKE
                       '%' || UPPER(p_consulta3) || '%' OR
                       UPPER(a07primernombre) LIKE
                       '%' || UPPER(p_consulta3) || '%' OR
                       UPPER(a07segundonombre) LIKE
                       '%' || UPPER(p_consulta3) || '%' OR
                       UPPER(a07primerapellido) LIKE
                       '%' || UPPER(p_consulta3) || '%' OR
                       UPPER(a07segundoapellido) LIKE
                       '%' || UPPER(p_consulta3) || '%')) a
         where rownum < 51;
    end if;

    if (not p_idCoordinador is null) then
      select a06rol
        into idRol
        from t06_usuarios
       where a06codigo = p_idCoordinador;

      -- Si rol es coordinador mostar solo registros de facilitadores del cooordinador
      if (idRol = 2) then
        OPEN p_resultado FOR
          select *
            from (select a07primernombre || ' ' || a07segundonombre || ' ' ||
                         a07primerapellido || ' ' || a07segundoapellido NombreFacilitador,
                         upper(a02nombre) NomDepartamento,
                         upper(a03nombre) NomMunicipio,
                         a23nombre Dia,
                         a24horario Horario,
                         a26sigla SiglaGrupo,
                         a26lugar Lugar,
                         a26direccion Direccion,
                         a26codigo IdGrupoFacilitador,
                         (select numCupos - count(*)
                            from T15_INSCRITOS i
                           where i.a15grupofacilitador = a26codigo
                             and i.a15estado = PK_UTILS.COD_ACTIVO) CupoDisponible
                    from T26_GRUPOSFACILITADOR,
                         T02_DEPARTAMENTOS,
                         T03_MUNICIPIOS,
                         T23_DIAS,
                         T24_HORARIOS,
                         T06_USUARIOS,
                         T07_PERSONAS

                   where a26estado = PK_UTILS.COD_ACTIVO
                     and a26periodo = p_idPeriodo
                     AND a26ciudad = a03codigo
                     AND a03departamento = a02codigo
                     AND a26dia = a23codigo
                     AND a26horario = a24codigo
                     AND a26facilitador = a06codigo
                     AND a06codigo = a07usuario
                     AND a06coordinador = p_idCoordinador
                     AND a26grupo <> 11
                     AND a26grupo <> 12

                     AND (UPPER(a02nombre) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a03nombre) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a23nombre) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a24horario) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a26sigla) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a26lugar) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a26direccion) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a07primernombre) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a07segundonombre) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a07primerapellido) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a07segundoapellido) LIKE
                         '%' || UPPER(p_consulta1) || '%')

                     AND (UPPER(a02nombre) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a03nombre) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a23nombre) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a24horario) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a26sigla) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a26lugar) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a26direccion) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a07primernombre) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a07segundonombre) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a07primerapellido) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a07segundoapellido) LIKE
                         '%' || UPPER(p_consulta2) || '%')

                     AND (UPPER(a02nombre) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a03nombre) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a23nombre) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a24horario) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a26sigla) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a26lugar) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a26direccion) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a07primernombre) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a07segundonombre) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a07primerapellido) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a07segundoapellido) LIKE
                         '%' || UPPER(p_consulta3) || '%')) a
           where rownum < 51;
      end if;

      if (idRol <> 2) then
        OPEN p_resultado FOR
          select *
            from (select a07primernombre || ' ' || a07segundonombre || ' ' ||
                         a07primerapellido || ' ' || a07segundoapellido NombreFacilitador,
                         upper(a02nombre) NomDepartamento,
                         upper(a03nombre) NomMunicipio,
                         a23nombre Dia,
                         a24horario Horario,
                         a26sigla SiglaGrupo,
                         a26lugar Lugar,
                         a26direccion Direccion,
                         a26codigo IdGrupoFacilitador,
                         (select numCupos - count(*)
                            from T15_INSCRITOS i
                           where i.a15grupofacilitador = a26codigo
                             and i.a15estado = PK_UTILS.COD_ACTIVO) CupoDisponible
                    from T26_GRUPOSFACILITADOR,
                         T02_DEPARTAMENTOS,
                         T03_MUNICIPIOS,
                         T23_DIAS,
                         T24_HORARIOS,
                         T06_USUARIOS,
                         T07_PERSONAS

                   where a26estado = PK_UTILS.COD_ACTIVO
                     and a26periodo = p_idPeriodo
                     AND a26ciudad = a03codigo
                     AND a03departamento = a02codigo
                     AND a26dia = a23codigo
                     AND a26horario = a24codigo
                     AND a26facilitador = a06codigo
                     AND a06codigo = a07usuario
                     AND a26grupo <> 11
                     AND a26grupo <> 12

                     AND (UPPER(a02nombre) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a03nombre) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a23nombre) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a24horario) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a26sigla) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a26lugar) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a26direccion) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a07primernombre) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a07segundonombre) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a07primerapellido) LIKE
                         '%' || UPPER(p_consulta1) || '%' OR
                         UPPER(a07segundoapellido) LIKE
                         '%' || UPPER(p_consulta1) || '%')

                     AND (UPPER(a02nombre) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a03nombre) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a23nombre) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a24horario) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a26sigla) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a26lugar) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a26direccion) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a07primernombre) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a07segundonombre) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a07primerapellido) LIKE
                         '%' || UPPER(p_consulta2) || '%' OR
                         UPPER(a07segundoapellido) LIKE
                         '%' || UPPER(p_consulta2) || '%')

                     AND (UPPER(a02nombre) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a03nombre) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a23nombre) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a24horario) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a26sigla) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a26lugar) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a26direccion) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a07primernombre) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a07segundonombre) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a07primerapellido) LIKE
                         '%' || UPPER(p_consulta3) || '%' OR
                         UPPER(a07segundoapellido) LIKE
                         '%' || UPPER(p_consulta3) || '%')) a
           where rownum < 51;
      end if;

    end if;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta inscritos en el periodo OK ');
  EXCEPTION
    WHEN OTHERS THEN

      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ConsultarHorarios;

END PK_OPE_CONSULTAS;
/

prompt
prompt Creating package body PK_OPE_HISTORIAVIDA
prompt =========================================
prompt
create or replace package body hpv.PK_OPE_HISTORIAVIDA is

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar las historias de vida de un usuario dado
  PARAMETROS    :
  IN    :
           p_IdUSuario
           P_FiltroBusqueda
           p_EstadoXConsultar
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarHistoriasDeVida(p_idUsuario        IN number,
                                  p_filtroBusqueda   IN varchar2,
                                  p_estadoXConsultar IN varchar2,
                                  p_idPeriodo        IN NUMBER,
                                  p_resultado        OUT PK_UTILS.ty_cursor,
                                  p_codError         OUT NUMBER,
                                  p_msjError         OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarHistoriasDeVida';
    numReg               NUMBER;
  
    codPeriodo number;
    idRol      number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarHistoriasDeVida ');
  
    if (p_idPeriodo is null) then
      codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
    else
      codPeriodo := p_idPeriodo;
    end if;
  
    select count(*)
      into numReg
      from t06_usuarios
     where a06codigo = p_idUsuario;
  
    if (numReg = 0) then
      p_codError := 22;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    select a06rol
      into idRol
      from t06_usuarios
     where a06codigo = p_idUsuario;
  
    --es un facilitador
    if (idRol = 1) then
    
      select count(*)
        into numReg
        from t57_historiavida, t26_gruposfacilitador
       where a57periodo = codPeriodo
         and a57grupofacilitador = a26codigo
         and a26facilitador = p_idUsuario;
    
      if (numReg = 0) then
        p_codError := 76;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      OPEN p_resultado FOR
        select a57codigo IdHistoriaDeVida,
               a57periodo IdPeriodo,
               a26codigo IdGrupoFacilitador,
               a26sigla SiglaGrupo,
               a26grupo IdGrupo,
               a25nombre NomGrupo,
               a26facilitador IdFacilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
               a06coordinador IdCoordinador,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) NomCoordinador,
               a26ciudad IdMunicipio,
               a03nombre NomMunicipio,
               a03departamento IdDepartamento,
               a02nombre NomDepartamento,
               a57estado Idestado,
               a84nombre NomEstado,
               a57tipo IdTipoHistoriaDeVida,
               a85descripcion NomTipoHistoriaDeVida,
               a57razondeconsideracion RazonDeConsideracion,
               a57circunstanciassuperadas CircunstanciasSuperadas,
               a57habilidadespracticadas HabilidadesPracticadas,
               a57leccion Leccion,
               a57inscrito IdInscrito,
               (a15primernombre || ' ' || a15segundonombre || ' ' ||
               a15primerapellido || ' ' || a15segundoapellido) NomInscrito,
               a57motivoRechazo MotivoRechazo
          from t57_historiavida,
               t26_gruposfacilitador,
               t25_grupos,
               t07_personas           p1,
               t07_personas           p2,
               t06_usuarios,
               t03_municipios,
               t02_departamentos,
               t84_estadohistoriavida,
               t85_tipohistoriavida,
               t15_inscritos
         where a57periodo = codPeriodo
           and a57grupofacilitador = a26codigo
           AND a26grupo = a25codigo
           AND a26facilitador = p1.a07usuario
           and a06coordinador = p2.a07usuario
           and a06codigo = a26facilitador
           and a03departamento = a02codigo
           and a57estado = a84codigo
           and a57tipo = a85codigo
           and a57inscrito = a15codigo
           and a26ciudad = a03codigo
           and a26facilitador = p_idUsuario
           AND (UPPER(a26sigla) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primernombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundonombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primerapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundoapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a03nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a84nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               A15DOCUMENTO LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               to_char(a15codigobeneficiario) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%');
    
    end if;
  
    --es un coordinador
    if (idRol = 2) then
    
      select count(*)
        into numReg
        from t57_historiavida, t26_gruposfacilitador, t06_usuarios
       where a57periodo = codPeriodo
         and a57grupofacilitador = a26codigo
         and a26facilitador = a06codigo
         and a06coordinador = p_idUsuario;
    
      if (numReg = 0) then
        p_codError := 76;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      OPEN p_resultado FOR
        select a57codigo IdHistoriaDeVida,
               a57periodo IdPeriodo,
               a26codigo IdGrupoFacilitador,
               a26sigla SiglaGrupo,
               a26grupo IdGrupo,
               a25nombre NomGrupo,
               a26facilitador IdFacilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
               a06coordinador IdCoordinador,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) NomCoordinador,
               a26ciudad IdMunicipio,
               a03nombre NomMunicipio,
               a03departamento IdDepartamento,
               a02nombre NomDepartamento,
               a57estado Idestado,
               a84nombre NomEstado,
               a57tipo IdTipoHistoriaDeVida,
               a85descripcion NomTipoHistoriaDeVida,
               a57razondeconsideracion RazonDeConsideracion,
               a57circunstanciassuperadas CircunstanciasSuperadas,
               a57habilidadespracticadas HabilidadesPracticadas,
               a57leccion Leccion,
               a57inscrito IdInscrito,
               (a15primernombre || ' ' || a15segundonombre || ' ' ||
               a15primerapellido || ' ' || a15segundoapellido) NomInscrito,
               a57motivoRechazo MotivoRechazo
          from t57_historiavida,
               t26_gruposfacilitador,
               t25_grupos,
               t07_personas           p1,
               t07_personas           p2,
               t06_usuarios,
               t03_municipios,
               t02_departamentos,
               t84_estadohistoriavida,
               t85_tipohistoriavida,
               t15_inscritos
         where a57periodo = codPeriodo
           and a57grupofacilitador = a26codigo
           AND a26grupo = a25codigo
           AND a26facilitador = p1.a07usuario
           and a06coordinador = p2.a07usuario
           and a06codigo = a26facilitador
           and a03departamento = a02codigo
           and a57estado = a84codigo
           and a57tipo = a85codigo
           and a57inscrito = a15codigo
           and a26ciudad = a03codigo
           and a06coordinador = p_idUsuario
           AND (UPPER(a26sigla) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primernombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundonombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primerapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundoapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a03nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a84nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               A15DOCUMENTO LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               to_char(a15codigobeneficiario) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%');
    
    end if;
  
    --es un supervisor
    if (idRol = 6 or idRol = 7) then
    
      select count(*)
        into numReg
        from t57_historiavida, t26_gruposfacilitador
       where a57periodo = codPeriodo
         and a57grupofacilitador = a26codigo;
    
      if (numReg = 0) then
        p_codError := 76;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      OPEN p_resultado FOR
        select a57codigo IdHistoriaDeVida,
               a57periodo IdPeriodo,
               a26codigo IdGrupoFacilitador,
               a26sigla SiglaGrupo,
               a26grupo IdGrupo,
               a25nombre NomGrupo,
               a26facilitador IdFacilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
               a06coordinador IdCoordinador,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) NomCoordinador,
               a26ciudad IdMunicipio,
               a03nombre NomMunicipio,
               a03departamento IdDepartamento,
               a02nombre NomDepartamento,
               a57estado Idestado,
               a84nombre NomEstado,
               a57tipo IdTipoHistoriaDeVida,
               a85descripcion NomTipoHistoriaDeVida,
               a57razondeconsideracion RazonDeConsideracion,
               a57circunstanciassuperadas CircunstanciasSuperadas,
               a57habilidadespracticadas HabilidadesPracticadas,
               a57leccion Leccion,
               a57inscrito IdInscrito,
               (a15primernombre || ' ' || a15segundonombre || ' ' ||
               a15primerapellido || ' ' || a15segundoapellido) NomInscrito,
               a57motivoRechazo MotivoRechazo
          from t57_historiavida,
               t26_gruposfacilitador,
               t25_grupos,
               t07_personas           p1,
               t07_personas           p2,
               t06_usuarios,
               t03_municipios,
               t02_departamentos,
               t84_estadohistoriavida,
               t85_tipohistoriavida,
               t15_inscritos
         where a57periodo = codPeriodo
           and a57grupofacilitador = a26codigo
           AND a26grupo = a25codigo
           AND a26facilitador = p1.a07usuario
           and a06coordinador = p2.a07usuario
           and a06codigo = a26facilitador
           and a03departamento = a02codigo
           and a57estado = a84codigo
           and a57tipo = a85codigo
           and a57inscrito = a15codigo
           and a26ciudad = a03codigo
           AND (UPPER(a26sigla) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primernombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundonombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primerapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundoapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a03nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a84nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               A15DOCUMENTO LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               to_char(a15codigobeneficiario) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%');
    
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_DarHistoriasDeVida ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarHistoriasDeVida;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para validar la cantidad de historias a grabar
  PARAMETROS    :
  IN    :
           p_IdUSuario
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/

  PROCEDURE Pr_ValidarCantidadHistorias(p_idUsuario IN number,
                                        p_codError  OUT NUMBER,
                                        p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ValidarCantidadHistorias';
    numReg               NUMBER;
    numMunFac            NUMBER;
  
    codPeriodo number;
    idRol      number;
  
    cantidadGrupos number;
  
    LIMITEGRUPOHV   number;
    CANTIDADHVMENOR number;
    CANTIDADHVMAYOR number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarHistoriasDeVida ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    select count(*)
      into cantidadGrupos
      from t26_gruposfacilitador
     where a26facilitador = p_idUsuario
       and a26periodo = codPeriodo
       AND a26estado = 'A'
       and a26grupo <> 11
       and PK_OPE_ASISTENCIA.Fn_InscritosGrupo(a26codigo) > 0;
  
    if (cantidadGrupos = 0) then
      p_codError := 77;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    select count(*)
      into numReg
      from t57_historiavida, t26_gruposfacilitador
     where a57periodo = codPeriodo
       and a57grupofacilitador = a26codigo
       and a26facilitador = p_idUsuario;
  
    /*Se incluye esta validacion para los faccilitadores que tienen mas de 1 ciudad asignada*/
    select count(*)
      into numMunFac
      from T30_CIUDADESUSUARIO t
     where t.a30usuario = p_idUsuario;
    numReg := numReg / numMunFac;
  
    LIMITEGRUPOHV   := to_number(Pk_Utils.Fn_Obtenervalorparametro('LIMITEGRUPOHV'));
    CANTIDADHVMENOR := to_number(Pk_Utils.Fn_Obtenervalorparametro('CANTIDADHVMENOR'));
    CANTIDADHVMAYOR := to_number(Pk_Utils.Fn_Obtenervalorparametro('CANTIDADHVMAYOR'));
  
    if (cantidadGrupos <= LIMITEGRUPOHV) then
      if (numReg >= CANTIDADHVMENOR) then
        p_codError := 78;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
    else
      if (numReg >= CANTIDADHVMAYOR) then
        p_codError := 78;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ValidarCantidadHistorias ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ValidarCantidadHistorias;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para crear o actualizar una HV
  PARAMETROS    :
  IN    :
           p_idHistoriaDeVida
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/

  PROCEDURE Pr_ActualizarHistoriaVida(p_idHistoriaDeVida        IN number, -- 0 Si es nuevo
                                      p_idGrupoFacilitador      number,
                                      p_idFacilitador           number,
                                      p_idTipoHistoriaDeVida    number,
                                      p_razonDeConsideracion    varchar2,
                                      p_circunstanciasSuperadas varchar2,
                                      p_habilidadesPracticadas  varchar2,
                                      p_leccion                 varchar2,
                                      p_idInscrito              number,
                                      p_codError                OUT NUMBER,
                                      p_msjError                OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ActualizarHistoriaVida';
    numReg               NUMBER;
  
    codPeriodo          number;
    limiteMinAsistencia number;
    numAsistencia       number;
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_ActualizarHistoriaVida ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    -- Validar que cumpla con minimo de asistencia
    select count(*)
      into numAsistencia
      from (select a51tallerrealizado
              from t51_asistenciataller
             where a51inscrito = p_idInscrito
               and a51asistencia = 'A'
             group by a51tallerrealizado);
  
    limiteMinAsistencia := TO_NUMBER(pk_utils.fn_ObtenerValorParametro('LIMNUMASISTENCIA'));
  
    if (numAsistencia < limiteMinAsistencia) then
      p_codError := 84;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    if (p_idHistoriaDeVida = 0) then
    
      select count(*)
        into numReg
        from t57_historiavida
       where a57periodo = codPeriodo
         and a57grupofacilitador = p_idGrupoFacilitador;
    
      if (numReg > 0) then
        p_codError := 79;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      insert into t57_historiavida
        (a57codigo,
         a57periodo,
         a57grupofacilitador,
         a57estado,
         a57tipo,
         a57razondeconsideracion,
         a57circunstanciassuperadas,
         a57habilidadespracticadas,
         a57leccion,
         a57fechacreacion,
         a57fechamodificacion,
         a57usuariocreacion,
         a57usuariomodificacion,
         a57inscrito,
         a57facilitador)
      values
        (T57_HISTORIAVIDA_SEQ.NEXTVAL,
         codPeriodo,
         p_idGrupofacilitador,
         'P',
         p_idTipoHistoriaDeVida,
         p_razonDeConsideracion,
         p_circunstanciasSuperadas,
         p_habilidadesPracticadas,
         p_leccion,
         sysdate,
         sysdate,
         p_idFacilitador,
         p_idFacilitador,
         p_idInscrito,
         p_idFacilitador);
    else
      update t57_historiavida
         set a57grupofacilitador        = p_idGrupofacilitador,
             a57estado                  = 'P',
             a57tipo                    = p_idTipoHistoriaDeVida,
             a57razondeconsideracion    = p_razonDeConsideracion,
             a57circunstanciassuperadas = p_circunstanciasSuperadas,
             a57habilidadespracticadas  = p_habilidadesPracticadas,
             a57leccion                 = p_leccion,
             a57fechamodificacion       = sysdate,
             a57usuariomodificacion     = p_idFacilitador,
             a57inscrito                = p_idInscrito
       where a57codigo = p_idHistoriaDeVida;
    
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ActualizarHistoriaVida ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ActualizarHistoriaVida;

  PROCEDURE Pr_consultarHistoriaVida(p_idHistoriaDeVida IN number,
                                     p_resultado        OUT PK_UTILS.ty_cursor,
                                     p_codError         OUT NUMBER,
                                     p_msjError         OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_consultarHistoriaVida';
    numReg               NUMBER;
  
    codPeriodo number;
    idRol      number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_consultarHistoriaVida ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    OPEN p_resultado FOR
      select a57codigo IdHistoriaDeVida,
             a57periodo IdPeriodo,
             a26codigo IdGrupoFacilitador,
             a26sigla SiglaGrupo,
             a26grupo IdGrupo,
             a25nombre NomGrupo,
             a26facilitador IdFacilitador,
             (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
             p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
             a06coordinador IdCoordinador,
             (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
             p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomCoordinador,
             a26ciudad IdMunicipio,
             a03nombre NomMunicipio,
             a03departamento IdDepartamento,
             a02nombre NomDepartamento,
             a57estado Idestado,
             a84nombre NomEstado,
             a57tipo IdTipoHistoriaDeVida,
             a85descripcion NomTipoHistoriaDeVida,
             a57razondeconsideracion RazonDeConsideracion,
             a57circunstanciassuperadas CircunstanciasSuperadas,
             a57habilidadespracticadas HabilidadesPracticadas,
             a57leccion Leccion,
             a57inscrito IdInscrito,
             (a15primernombre || ' ' || a15segundonombre || ' ' ||
             a15primerapellido || ' ' || a15segundoapellido) NomInscrito,
             a57motivoRechazo MotivoRechazo
        from t57_historiavida,
             t26_gruposfacilitador,
             t25_grupos,
             t07_personas           p1,
             t07_personas           p2,
             t06_usuarios,
             t03_municipios,
             t02_departamentos,
             t84_estadohistoriavida,
             t85_tipohistoriavida,
             t15_inscritos
       where a57grupofacilitador = a26codigo
         AND a26grupo = a25codigo
         AND a26facilitador = p1.a07usuario
         and a06coordinador = p2.a07usuario
         and a06codigo = a26facilitador
         and a03departamento = a02codigo
         and a57estado = a84codigo
         and a57tipo = a85codigo
         and a57inscrito = a15codigo
         and a57codigo = p_idHistoriaDeVida
         and a26ciudad = a03codigo;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_consultarHistoriaVida ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_consultarHistoriaVida;

  PROCEDURE Pr_RegistrarEstadoHistoriaVida(p_idUsuario      IN NUMBER,
                                           p_idHistoriaVida IN NUMBER,
                                           p_estado         IN VARCHAR2, --  A:Aprobar R:Rechazar P:Pendiente aprobacion E:Elejido
                                           p_motivoRechazo  IN VARCHAR2,
                                           p_codError       OUT NUMBER,
                                           p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_RegistrarEstadoHistoriaVida';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_RegistrarAprobacion ');
  
    update t57_historiavida
       set a57estado              = p_estado,
           a57fechamodificacion   = sysdate,
           a57usuariomodificacion = p_idUsuario,
           a57motivorechazo       = p_motivoRechazo
     where a57codigo = p_idHistoriaVida;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_RegistrarAprobacion OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_RegistrarEstadoHistoriaVida;

end PK_OPE_HISTORIAVIDA;
/

prompt
prompt Creating package body PK_OPE_LIDERAZGO
prompt ======================================
prompt
create or replace package body hpv.PK_OPE_LIDERAZGO is

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los liderazgos de un usuario dado
  PARAMETROS    :
  IN    :
           p_IdUSuario
           P_FiltroBusqueda
           p_EstadoXConsultar
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarLiderazgos(p_idUsuario        IN number,
                             p_filtroBusqueda   IN varchar2,
                             p_estadoXConsultar IN varchar2,
                             p_idPeriodo        IN NUMBER,
                             p_resultado        OUT PK_UTILS.ty_cursor,
                             p_codError         OUT NUMBER,
                             p_msjError         OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarLiderazgos';
    numReg               NUMBER;
  
    codPeriodo number;
    idRol      number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarLiderazgos ');
  
    if (p_idPeriodo is null) then
      codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
    else
      codPeriodo := p_idPeriodo;
    end if;
  
    select count(*)
      into numReg
      from t06_usuarios
     where a06codigo = p_idUsuario;
  
    if (numReg = 0) then
      p_codError := 22;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    select a06rol
      into idRol
      from t06_usuarios
     where a06codigo = p_idUsuario;
  
    --es un facilitador
    if (idRol = 1) then
    
      select count(*)
        into numReg
        from t60_liderazgo, t26_gruposfacilitador
       where a60periodo = codPeriodo
         and a60grupofacilitador = a26codigo
         and a26facilitador = p_idUsuario;
    
      if (numReg = 0) then
        p_codError := 86;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      OPEN p_resultado FOR
        select a60codigo IdLiderazgo,
               a60periodo IdPeriodo,
               a26codigo IdGrupoFacilitador,
               a26sigla SiglaGrupo,
               a26grupo IdGrupo,
               a25nombre NomGrupo,
               a26facilitador IdFacilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
               a06coordinador IdCoordinador,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) NomCoordinador,
               a26ciudad IdMunicipio,
               a03nombre NomMunicipio,
               a03departamento IdDepartamento,
               a02nombre NomDepartamento,
               a60estado Idestado,
               a79nombre NomEstado,
               '' Criterios,
               a60observacion Observaciones,
               a60motivoRechazo MotivoRechazo,
               a60inscrito IdInscrito,
               (a15primernombre || ' ' || a15segundonombre || ' ' ||
               a15primerapellido || ' ' || a15segundoapellido) NomInscrito
          from t60_liderazgo,
               t26_gruposfacilitador,
               t25_grupos,
               t07_personas          p1,
               t07_personas          p2,
               t06_usuarios,
               t03_municipios,
               t02_departamentos,
               t79_estadoLiderazgo,
               t15_inscritos
         where a60periodo = codPeriodo
           and a60grupofacilitador = a26codigo
           AND a26grupo = a25codigo
           AND a26facilitador = p1.a07usuario
           and a06coordinador = p2.a07usuario
           and a06codigo = a26facilitador
           and a03departamento = a02codigo
           and a60estado = a79codigo
           and a60inscrito = a15codigo
           and a26ciudad = a03codigo
           and a26facilitador = p_idUsuario
           and (UPPER(a26sigla) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primernombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundonombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primerapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundoapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a03nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a79nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               A15DOCUMENTO LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               to_char(a15codigobeneficiario) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%');
    
    end if;
  
    --es un coordinador
    if (idRol = 2) then
    
      select count(*)
        into numReg
        from t60_liderazgo, t26_gruposfacilitador, t06_usuarios
       where a60periodo = codPeriodo
         and a60grupofacilitador = a26codigo
         and a26facilitador = a06codigo
         and a06coordinador = p_idUsuario;
    
      if (numReg = 0) then
        p_codError := 86;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      OPEN p_resultado FOR
        select a60codigo IdLiderazgo,
               a60periodo IdPeriodo,
               a26codigo IdGrupoFacilitador,
               a26sigla SiglaGrupo,
               a26grupo IdGrupo,
               a25nombre NomGrupo,
               a26facilitador IdFacilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
               a06coordinador IdCoordinador,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) NomCoordinador,
               a26ciudad IdMunicipio,
               a03nombre NomMunicipio,
               a03departamento IdDepartamento,
               a02nombre NomDepartamento,
               a60estado Idestado,
               a79nombre NomEstado,
               '' Criterios,
               a60observacion Observaciones,
               a60motivoRechazo MotivoRechazo,
               a60inscrito IdInscrito,
               (a15primernombre || ' ' || a15segundonombre || ' ' ||
               a15primerapellido || ' ' || a15segundoapellido) NomInscrito
          from t60_liderazgo,
               t26_gruposfacilitador,
               t25_grupos,
               t07_personas          p1,
               t07_personas          p2,
               t06_usuarios,
               t03_municipios,
               t02_departamentos,
               t79_estadoLiderazgo,
               t15_inscritos
         where a60periodo = codPeriodo
           and a60grupofacilitador = a26codigo
           AND a26grupo = a25codigo
           AND a26facilitador = p1.a07usuario
           and a06coordinador = p2.a07usuario
           and a06codigo = a26facilitador
           and a03departamento = a02codigo
           and a60estado = a79codigo
           and a60inscrito = a15codigo
           and a26ciudad = a03codigo
           and a06coordinador = p_idUsuario
           and (UPPER(a26sigla) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primernombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundonombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primerapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundoapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a03nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a79nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               A15DOCUMENTO LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               to_char(a15codigobeneficiario) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%');
    
    end if;
  
    --es un supervisor o administrador
    if (idRol = 6 or idRol = 7) then
    
      select count(*)
        into numReg
        from t60_liderazgo, t26_gruposfacilitador
       where a60periodo = codPeriodo
         and a60grupofacilitador = a26codigo;
    
      if (numReg = 0) then
        p_codError := 86;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      OPEN p_resultado FOR
        select a60codigo IdLiderazgo,
               a60periodo IdPeriodo,
               a26codigo IdGrupoFacilitador,
               a26sigla SiglaGrupo,
               a26grupo IdGrupo,
               a25nombre NomGrupo,
               a26facilitador IdFacilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
               a06coordinador IdCoordinador,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) NomCoordinador,
               a26ciudad IdMunicipio,
               a03nombre NomMunicipio,
               a03departamento IdDepartamento,
               a02nombre NomDepartamento,
               a60estado Idestado,
               a79nombre NomEstado,
               '' Criterios,
               a60observacion Observaciones,
               a60motivoRechazo MotivoRechazo,
               a60inscrito IdInscrito,
               (a15primernombre || ' ' || a15segundonombre || ' ' ||
               a15primerapellido || ' ' || a15segundoapellido) NomInscrito
          from t60_liderazgo,
               t26_gruposfacilitador,
               t25_grupos,
               t07_personas          p1,
               t07_personas          p2,
               t06_usuarios,
               t03_municipios,
               t02_departamentos,
               t79_estadoLiderazgo,
               t15_inscritos
         where a60periodo = codPeriodo
           and a60grupofacilitador = a26codigo
           AND a26grupo = a25codigo
           AND a26facilitador = p1.a07usuario
           and a06coordinador = p2.a07usuario
           and a06codigo = a26facilitador
           and a03departamento = a02codigo
           and a60estado = a79codigo
           and a60inscrito = a15codigo
           and a26ciudad = a03codigo
           and (UPPER(a26sigla) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primernombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundonombre) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07primerapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(p1.a07segundoapellido) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a03nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               UPPER(a79nombre) LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               A15DOCUMENTO LIKE '%' || UPPER(p_filtroBusqueda) || '%' or
               to_char(a15codigobeneficiario) LIKE
               '%' || UPPER(p_filtroBusqueda) || '%');
    
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_DarLiderazgos ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarLiderazgos;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para validar la cantidad de liderazgos a grabar
  PARAMETROS    :
  IN    :
           p_IdUSuario
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/

  PROCEDURE Pr_ValidarCantidadLiderazgo(p_idUsuario IN number,
                                        p_codError  OUT NUMBER,
                                        p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ValidarCantidadLiderazgo';
    numReg               NUMBER;
    numMunFac            NUMBER;
  
    codPeriodo number;
    idRol      number;
  
    cantidadGrupos number;
  
    LIMITEGRUPOLI   number;
    CANTIDADLIMENOR number;
    CANTIDADLIMAYOR number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_ValidarCantidadLiderazgo ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    select count(*)
      into cantidadGrupos
      from t26_gruposfacilitador
     where a26facilitador = p_idUsuario
       and a26periodo = codPeriodo
       AND a26estado = 'A'
       and a26grupo <> 11
       and PK_OPE_ASISTENCIA.Fn_InscritosGrupo(a26codigo) > 0;
  
    if (cantidadGrupos = 0) then
      p_codError := 77;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    select count(*)
      into numReg
      from t60_liderazgo, t26_gruposfacilitador
     where a60periodo = codPeriodo
       and a60grupofacilitador = a26codigo
       and a26facilitador = p_idUsuario;
  
    /*Se incluye esta validacion para los faccilitadores que tienen mas de 1 ciudad asignada*/
    select count(*)
      into numMunFac
      from T30_CIUDADESUSUARIO t
     where t.a30usuario = p_idUsuario;
    numReg := numReg / numMunFac;
  
    LIMITEGRUPOLI   := to_number(Pk_Utils.Fn_Obtenervalorparametro('LIMITEGRUPOLI'));
    CANTIDADLIMENOR := to_number(Pk_Utils.Fn_Obtenervalorparametro('CANTIDADLIMENOR'));
    CANTIDADLIMAYOR := to_number(Pk_Utils.Fn_Obtenervalorparametro('CANTIDADLIMAYOR'));
  
    if (cantidadGrupos <= LIMITEGRUPOLI) then
      if (numReg >= CANTIDADLIMENOR) then
        p_codError := 87;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
    else
      if (numReg >= CANTIDADLIMAYOR) then
        p_codError := 87;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ValidarCantidadLiderazgo ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ValidarCantidadLiderazgo;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para creaR LIDERAZGO
  PARAMETROS    :
  IN    :
           p_IdLiderazgo
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/

  PROCEDURE Pr_ActualizarLiderazgo(p_idLiderazgo        IN number, -- 0 Si es nuevo
                                   p_idGrupoFacilitador number,
                                   p_idFacilitador      number,
                                   p_criterios          varchar2, -- idCualidad,S(N);
                                   p_idInscrito         number,
                                   p_codError           OUT NUMBER,
                                   p_msjError           OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ActualizarLiderazgo';
    numReg               NUMBER;
  
    codPeriodo  number;
    idLiderazgo number;
  
    listCualidades pk_utils.token_list;
    datoCualidad   pk_utils.token_list;
    i              number;
    numCualidades  number;
    numSi          number;
    numNo          number;
  
    numAsistencia         number;
    limiteMinAsistencia   number;
    limiteMinCualidadesLI number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_ActualizarLiderazgo ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    -- Validar que cumpla con minimo de asistencia
    select count(*)
      into numAsistencia
      from (select a51tallerrealizado
              from t51_asistenciataller
             where a51inscrito = p_idInscrito
               and a51asistencia = 'A'
             group by a51tallerrealizado);
  
    limiteMinAsistencia := TO_NUMBER(pk_utils.fn_ObtenerValorParametro('LIMNUMASISTENCIA'));
  
    if (numAsistencia < limiteMinAsistencia) then
      p_codError := 84;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    listCualidades := pk_utils.fn_splitStr(p_criterios, ';');
  
    i             := 1;
    numCualidades := pk_utils.splitter_count(p_criterios, ';') + 1;
    numSi         := 0;
    numNo         := 0;
  
    while i <= numCualidades loop
    
      datoCualidad := pk_utils.fn_splitStr(listCualidades(i), ',');
      if (datoCualidad(2) = 'S') then
        numSi := numSi + 1;
      end if;
      if (datoCualidad(2) = 'N') then
        numNo := numNo + 1;
      end if;
    
      i := i + 1;
    end loop;
  
    limiteMinCualidadesLI := TO_NUMBER(pk_utils.fn_ObtenerValorParametro('LIMMINCUALIDADESLI'));
  
    if (numSi < limiteMinCualidadesLI) then
      p_codError := 89;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    if (p_idLiderazgo = 0) then
    
      select count(*)
        into numReg
        from t60_liderazgo
       where a60periodo = codPeriodo
         and a60grupofacilitador = p_idGrupoFacilitador;
    
      if (numReg > 0) then
        p_codError := 88;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      select t60_liderazgo_seq.NEXTVAL into idLiderazgo from dual;
    
      insert into t60_liderazgo
        (a60codigo,
         a60periodo,
         a60grupofacilitador,
         a60estado,
         a60fechacreacion,
         a60fechamodificacion,
         a60usuariocreacion,
         a60usuariomodificacion,
         a60inscrito,
         a60facilitador,
         a60observacion,
         a60motivoRechazo,
         a60numSi,
         a60numNo)
      values
        (idLiderazgo,
         codPeriodo,
         p_idGrupofacilitador,
         'P',
         sysdate,
         sysdate,
         p_idFacilitador,
         p_idFacilitador,
         p_idInscrito,
         p_idFacilitador,
         null, --p_observaciones,
         null, -- a60motivoRechazo
         numSi,
         numNo);
    else
      idLiderazgo := p_idLiderazgo;
    
      update t60_liderazgo
         set a60grupofacilitador    = p_idGrupofacilitador,
             a60estado              = 'P',
             a60fechamodificacion   = sysdate,
             a60usuariomodificacion = p_idFacilitador,
             a60inscrito            = p_idInscrito,
             a60observacion         = '',
             a60numSi               = numSi,
             a60numNo               = numNo
       where a60codigo = p_idLiderazgo;
    
    end if;
  
    delete from t61_liderazgocualidad where a61liderazgo = idLiderazgo;
  
    listCualidades := pk_utils.fn_splitStr(p_criterios, ';');
  
    i             := 1;
    numCualidades := pk_utils.splitter_count(p_criterios, ';') + 1;
  
    while i <= numCualidades loop
    
      datoCualidad := pk_utils.fn_splitStr(listCualidades(i), ',');
    
      insert into t61_liderazgocualidad
        (a61codigo,
         a61liderazgo,
         a61cualidad,
         a61respuesta,
         a61estado,
         a61fechacreacion,
         a61fechamodificacion,
         a61usuariocreacion,
         a61usuariomodificacion)
        select t61_liderazgoCualidad_seq.nextval,
               idLiderazgo,
               to_number(datoCualidad(1)),
               datoCualidad(2),
               'A',
               sysdate,
               sysdate,
               p_idFacilitador,
               p_idFacilitador
          from dual;
    
      i := i + 1;
    
    end loop;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ActualizarLiderazgo ok ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ActualizarLiderazgo;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar caso de exito
  PARAMETROS    :
  IN    :
           p_IdLiderazgo
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 20/05/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/

  PROCEDURE Pr_consultarLiderazgo(p_IdLiderazgo IN number,
                                  p_resultado   OUT PK_UTILS.ty_cursor,
                                  p_codError    OUT NUMBER,
                                  p_msjError    OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_consultarLiderazgo';
    numReg               NUMBER;
  
    codPeriodo number;
    idRol      number;
    criterios  varchar2(200);
  
    CURSOR curLogro IS
      SELECT a61cualidad, a61respuesta
        FROM t61_liderazgoCualidad
       WHERE a61liderazgo = p_IdLiderazgo
       order by a61cualidad;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_consultarCasoDeExito ');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    criterios := '';
    FOR regLogro IN curLogro LOOP
      criterios := criterios || to_char(regLogro.a61cualidad) || ',' ||
                   regLogro.A61respuesta || ';';
    end loop;
  
    OPEN p_resultado FOR
      select a60codigo IdLiderazgo,
             a60periodo IdPeriodo,
             a26codigo IdGrupoFacilitador,
             a26sigla SiglaGrupo,
             a26grupo IdGrupo,
             a25nombre NomGrupo,
             a26facilitador IdFacilitador,
             (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
             p1.a07primerapellido || ' ' || p1.a07segundoapellido) NomFacilitador,
             a06coordinador IdCoordinador,
             (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
             p2.a07primerapellido || ' ' || p2.a07segundoapellido) NomCoordinador,
             a26ciudad IdMunicipio,
             a03nombre NomMunicipio,
             a03departamento IdDepartamento,
             a02nombre NomDepartamento,
             a60estado Idestado,
             a79nombre NomEstado,
             criterios Criterios,
             a60observacion Observaciones,
             a60motivoRechazo MotivoRechazo,
             a60inscrito IdInscrito,
             (a15primernombre || ' ' || a15segundonombre || ' ' ||
             a15primerapellido || ' ' || a15segundoapellido) NomInscrito
        from t60_liderazgo,
             t26_gruposfacilitador,
             t25_grupos,
             t07_personas          p1,
             t07_personas          p2,
             t06_usuarios,
             t03_municipios,
             t02_departamentos,
             t79_estadoLiderazgo,
             t15_inscritos
       where a60codigo = p_IdLiderazgo
         and a60grupofacilitador = a26codigo
         AND a26grupo = a25codigo
         AND a26facilitador = p1.a07usuario
         and a06coordinador = p2.a07usuario
         and a06codigo = a26facilitador
         and a03departamento = a02codigo
         and a60estado = a79codigo
         and a60inscrito = a15codigo
         and a26ciudad = a03codigo;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_consultarLiderazgo ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_consultarLiderazgo;

  PROCEDURE Pr_RegistrarEstadoLiderazgo(p_idUsuario     IN NUMBER,
                                        p_IdLiderazgo   IN NUMBER,
                                        p_motivoRechazo IN VARCHAR2,
                                        p_estado        IN VARCHAR2, --  A:Aprobar R:Rechazar P:Pendiente aprobacion E:Elejido
                                        p_codError      OUT NUMBER,
                                        p_msjError      OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_RegistrarEstadoLiderazgo';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_RegistrarEstadoLiderazgo ');
  
    update t60_liderazgo
       set a60estado              = p_estado,
           a60fechamodificacion   = sysdate,
           a60usuariomodificacion = p_idUsuario,
           a60motivoRechazo       = p_motivoRechazo
     where a60codigo = p_IdLiderazgo;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio Pr_RegistrarEstadoLiderazgo OK ');
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_RegistrarEstadoLiderazgo;

end PK_OPE_LIDERAZGO;
/

prompt
prompt Creating package body PK_PAR_ADMPARAMETRO
prompt =========================================
prompt
create or replace package body hpv.PK_PAR_ADMPARAMETRO is

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los parametros
  
  PARAMETROS    :
  IN    :
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR     :   P
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarParametros(p_resultado OUT PK_UTILS.ty_cursor,
                             p_codError  OUT NUMBER,
                             p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarParametros';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_DarParametros ');
  
    select count(*)
      into numReg
      from t08_parametros
     WHERE a08estado = PK_UTILS.COD_ACTIVO;
  
    if (numReg = 0) then
      p_codError := 90;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select a08codigo Codigo,
             a08nombre Nombre,
             a08valor Valor,
             a08descripcion Descripcion,
             nvl(a08estado, 'A') Estado
        from t08_parametros
       order by a08nombre;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_DarParametros OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarParametros;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar un parametro dado
  PARAMETROS    :
  IN    : p_codigo               parametro a consultar
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ConsultarParametro(p_codigo    IN NUMBER,
                                  p_resultado OUT PK_UTILS.ty_cursor,
                                  p_codError  OUT NUMBER,
                                  p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ConsultarParametro';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_ConsultarParametro ');
  
    select count(*)
      into numReg
      from t08_parametros
     WHERE a08Codigo = p_codigo;
  
    if (numReg = 0) then
      p_codError := 91;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select a08codigo Codigo,
             a08nombre Nombre,
             a08valor Valor,
             a08descripcion Descripcion,
             nvl(a08estado, 'A') Estado
        from t08_parametros
       where a08codigo = p_codigo;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ConsultarParametro OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ConsultarParametro;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar o crear un parametro dado
  PARAMETROS    :
  IN     : p_codigo               parametro a actualizar , 0 para creacion
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ActualizarParametro(p_codigo          IN NUMBER,
                                   p_nombre          IN VARCHAR2,
                                   p_valor           IN VARCHAR2,
                                   p_descripcion     IN VARCHAR2,
                                   p_estado          IN VARCHAR2,
                                   p_usuarioregistra IN NUMBER,
                                   p_codError        OUT NUMBER,
                                   p_msjError        OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ActualizarParametro';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_ConsultarParametro ');
  
    if (p_codigo = 0) then
    
      select count(*)
        into numReg
        from t08_parametros
       WHERE a08nombre = p_nombre;
    
      if (numReg > 0) then
        p_codError := 92;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      insert into t08_parametros
        (a08codigo,
         a08nombre,
         a08valor,
         a08descripcion,
         a08estado,
         a08fechacreacion,
         a08fechamodificacion,
         a08usuariocreacion,
         a08usuariomodificacion)
        select t08_parametros_seq.nextval,
               p_nombre,
               p_valor,
               p_descripcion,
               p_estado,
               sysdate,
               sysdate,
               p_usuarioregistra,
               p_usuarioregistra
          from dual;
    
    else
    
      select count(*)
        into numReg
        from t08_parametros
       WHERE a08nombre = p_nombre
         and a08Codigo <> p_codigo;
    
      if (numReg > 0) then
        p_codError := 92;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      update t08_parametros
         set a08nombre              = p_nombre,
             a08valor               = p_valor,
             a08descripcion         = p_descripcion,
             a08estado              = p_estado,
             a08fechamodificacion   = sysdate,
             a08usuariomodificacion = p_usuarioregistra
       where a08codigo = p_codigo;
    
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ActualizarParametro OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ActualizarParametro;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar peridos
  
  PARAMETROS    :
  IN    :
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR     :   P
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarPeriodos(p_resultado OUT PK_UTILS.ty_cursor,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarPeriodos';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_DarPeriodos ');
  
    select count(*) into numReg from t12_periodos;
  
    if (numReg = 0) then
      p_codError := 93;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select a12codigo Codigo,
             a12nombre Nombre,
             TO_CHAR(a12fechainicio, 'yyyy-mm-dd') FechaInicio,
             TO_CHAR(a12fechafin, 'yyyy-mm-dd') FechaFin,
             a12noperiodo Numero,
             a12estado Estado,
             TO_CHAR(a12fechainitaller, 'yyyy-mm-dd') FechaIniTaller
        from t12_periodos;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_DarPeriodos OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarPeriodos;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar un periodo
  
  PARAMETROS    :
  IN    : p_codigo COdigo del periodo a consultar
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR     :   P
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ConsultarPeriodo(p_codigo    IN NUMBER,
                                p_resultado OUT PK_UTILS.ty_cursor,
                                p_codError  OUT NUMBER,
                                p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ConsultarPeriodo';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_ConsultarPeriodo ');
  
    select count(*)
      into numReg
      from t12_periodos
     where a12codigo = p_codigo;
  
    if (numReg = 0) then
      p_codError := 94;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select a12codigo Codigo,
             a12nombre Nombre,
             TO_CHAR(a12fechainicio, 'yyyy-mm-dd') FechaInicio,
             TO_CHAR(a12fechafin, 'yyyy-mm-dd') FechaFin,
             a12noperiodo Numero,
             a12estado Estado,
             TO_CHAR(a12fechainitaller, 'yyyy-mm-dd') FechaIniTaller
        from t12_periodos
       WHERE a12codigo = p_codigo;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_DarPeriodos OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ConsultarPeriodo;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar o crear un periodo
  PARAMETROS    :
  IN     : p_codigo               parametro a actualizar , 0 para creacion
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ActualizarPeriodo(p_codigo          IN NUMBER,
                                 p_nombre          IN VARCHAR2,
                                 p_fechainicio     IN VARCHAR2,
                                 p_fechafin        IN VARCHAR2,
                                 p_noperiodo       IN NUMBER,
                                 p_estado          IN VARCHAR2,
                                 p_fechaIniTaller  IN VARCHAr2,
                                 p_usuarioregistra IN NUMBER,
                                 p_codError        OUT NUMBER,
                                 p_msjError        OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ActualizarPeriodo';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_ActualizarPeriodo ');
  
    if (p_codigo = 0) then
    
      select count(*) into numReg from t12_periodos WHERE A12estado = 'A';
    
      if (numReg > 0 AND p_estado = 'A') then
        p_codError := 99;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      select count(*) into numReg from t12_periodos WHERE A12estado = 'P';
    
      if (numReg > 0 AND p_estado = 'P') then
        p_codError := 100;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      select count(*)
        into numReg
        from t12_periodos
       WHERE to_char(a12fechainicio, 'yyyy-mm-dd') = p_fechainicio
         AND to_char(a12fechafin, 'yyyy-mm-dd') = p_fechafin;
    
      if (numReg > 0) then
        p_codError := 95;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      select count(*)
        into numReg
        from t12_periodos
       WHERE p_fechainicio >= to_char(a12fechainicio, 'yyyy-mm-dd')
         AND p_fechainicio <= to_char(a12fechafin, 'yyyy-mm-dd');
    
      if (numReg > 0) then
        p_codError := 96;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      select count(*)
        into numReg
        from t12_periodos
       WHERE p_fechafin >= to_char(a12fechainicio, 'yyyy-mm-dd')
         AND p_fechafin <= to_char(a12fechafin, 'yyyy-mm-dd');
    
      if (numReg > 0) then
        p_codError := 96;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      if (p_fechainicio > p_fechafin) then
        p_codError := 98;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      if (p_fechaIniTaller < p_fechainicio or p_fechaIniTaller > p_fechafin) then
        p_codError := 97;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      insert into t12_periodos
        (a12codigo,
         a12nombre,
         a12fechainicio,
         a12fechafin,
         a12noperiodo,
         a12estado,
         a12fechacreacion,
         a12fechamodificacion,
         a12usuariocreacion,
         a12usuariomodificacion,
         a12fechainitaller)
        select t12_periodos_seq.nextval,
               p_nombre,
               to_date(p_fechainicio, 'yyyy-mm-dd'),
               to_date(p_fechafin, 'yyyy-mm-dd'),
               p_noperiodo,
               p_estado,
               sysdate,
               sysdate,
               p_usuarioregistra,
               p_usuarioregistra,
               to_date(p_fechaIniTaller, 'yyyy-mm-dd')
          from dual;
    
    else
    
      select count(*)
        into numReg
        from t12_periodos
       WHERE A12estado = 'A'
         AND a12codigo <> p_codigo;
    
      if (numReg > 0 AND p_estado = 'A') then
        p_codError := 99;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      select count(*)
        into numReg
        from t12_periodos
       WHERE A12estado = 'P'
         AND a12codigo <> p_codigo;
    
      if (numReg > 0 AND p_estado = 'P') then
        p_codError := 100;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      select count(*)
        into numReg
        from t12_periodos
       WHERE to_char(a12fechainicio, 'yyyy-mm-dd') = p_fechainicio
         AND to_char(a12fechafin, 'yyyy-mm-dd') = p_fechafin
         AND a12codigo <> p_codigo;
    
      if (numReg > 0) then
        p_codError := 95;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      select count(*)
        into numReg
        from t12_periodos
       WHERE p_fechainicio >= to_char(a12fechainicio, 'yyyy-mm-dd')
         AND p_fechainicio <= to_char(a12fechafin, 'yyyy-mm-dd')
         AND a12codigo <> p_codigo;
    
      if (numReg > 0) then
        p_codError := 96;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      select count(*)
        into numReg
        from t12_periodos
       WHERE p_fechafin >= to_char(a12fechainicio, 'yyyy-mm-dd')
         AND p_fechafin <= to_char(a12fechafin, 'yyyy-mm-dd')
         AND a12codigo <> p_codigo;
    
      if (numReg > 0) then
        p_codError := 96;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      if (p_fechainicio > p_fechafin) then
        p_codError := 98;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      if (p_fechaIniTaller < p_fechainicio or p_fechaIniTaller > p_fechafin) then
        p_codError := 97;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    
      update t12_periodos
         set a12nombre              = p_nombre,
             a12fechainicio         = to_date(p_fechainicio, 'yyyy-mm-dd'),
             a12fechafin            = to_date(p_fechafin, 'yyyy-mm-dd'),
             a12noperiodo           = p_noperiodo,
             a12estado              = p_estado,
             a12fechamodificacion   = sysdate,
             a12usuariomodificacion = p_usuarioregistra,
             a12fechainitaller      = to_date(p_fechaIniTaller, 'yyyy-mm-dd')
       where a12codigo = p_codigo;
    
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ActualizarPeriodo OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_ActualizarPeriodo;
  PROCEDURE Pr_DarFechasCorte(p_idperiodo number,
                              p_resultado OUT PK_UTILS.ty_cursor,
                              p_codError  OUT NUMBER,
                              p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarFechasCorte';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro>' || NOMBRE_PROCEDIMIENTO);
  
    SELECT COUNT(*)
      INTO NUMREG
      from user_SCHEDULER_JOBS
     where JOB_NAME = 'JOBT101'
       and STATE = 'RUNNING';
  
    IF NUMREG > 0 THEN
      OPEN p_resultado FOR
        select distinct 0 Codigo,
                        'Reproceso' Descripcion,
                        'Reproceso' FechaCorte
          from dual;
    else
    
      -- Se consulta un periodo especifico
      if (p_idperiodo > 0) then
      
        select count(distinct FEC_CORTE)
          into numReg
          from T101_RPT_TRAZABILIDAD t
         where t.periodo = p_idperiodo;
      
        if (numReg = 0) then
          p_codError := 93;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        end if;
      
        p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
        p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
      
        OPEN p_resultado FOR
          select distinct 0         Codigo,
                          fec_corte Descripcion,
                          fec_corte FechaCorte
            from T101_RPT_TRAZABILIDAD
           where fec_corte IS NOT NULL
             and periodo = p_idperiodo
           order by fec_corte desc;
      end if;
    
      -- Se consultan todos los periodos
      if (p_idperiodo = 0) then
      
        select count(distinct FEC_CORTE)
          into numReg
          from T101_RPT_TRAZABILIDAD t;
      
        if (numReg = 0) then
          p_codError := 93;
          p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
          return;
        end if;
      
        OPEN p_resultado FOR
          select distinct 0         Codigo,
                          fec_corte Descripcion,
                          fec_corte FechaCorte
            from T101_RPT_TRAZABILIDAD
           where fec_corte IS NOT NULL
             and periodo = p_idperiodo
           order by fec_corte desc;
      end if;
    END IF;
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio>' || NOMBRE_PROCEDIMIENTO);
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarFechasCorte;

end PK_PAR_ADMPARAMETRO;
/

prompt
prompt Creating package body PK_PAR_ADMROL
prompt ===================================
prompt
create or replace package body hpv.PK_PAR_ADMROL is

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los parametros

  PARAMETROS    :
  IN    :

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR     :   P
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarRoles(p_resultado OUT PK_UTILS.ty_cursor,
                        p_codError  OUT NUMBER,
                        p_msjError  OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRoles';
    numReg               NUMBER;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_DarRoles ');

    select count(*) into numReg from t05_roles;

    if (numReg = 0) then
      p_codError := 100;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      select a05codigo Codigo,
             a05nombre Nombre,
             a05estado Estado,
             '' Opciones
        from t05_roles
       order by Nombre;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_DarRoles OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarRoles;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar un rol
  PARAMETROS    :
  IN    : p_codigo               rol a consultar

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ConsultarRol(p_codigo    IN NUMBER,
                            p_resultado OUT PK_UTILS.ty_cursor,
                            p_codError  OUT NUMBER,
                            p_msjError  OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ConsultarRol';
    numReg               NUMBER;

    Opciones varchar2(1000);
  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_ConsultarRol ');

    select count(*) into numReg from t05_roles WHERE a05Codigo = p_codigo;

    if (numReg = 0) then
      p_codError := 102;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    Opciones := '';
    FOR regOpcion IN (select a96opcion
                        from t96_opcionrol
                       where a96rol = p_codigo) LOOP
      Opciones := Opciones || to_char(regOpcion.a96opcion) || ',';
    end loop;

    OPEN p_resultado FOR
      select a05codigo Codigo,
             a05nombre Nombre,
             a05estado Estado,
             opciones  Opciones
        from t05_roles
       WHERE a05codigo = p_codigo
       order by Nombre;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ConsultarRol OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ConsultarRol;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar o crear un rol
  PARAMETROS    :
  IN     : p_codigo               parametro a actualizar , 0 para creacion

  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado


  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ActualizarRol(p_codigo          IN NUMBER,
                             p_nombre          IN VARCHAR2,
                             p_estado          IN VARCHAR2,
                             p_opciones        IN VARCHAR2,
                             p_usuarioRegistra IN NUMBER,
                             p_codError        OUT NUMBER,
                             p_msjError        OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ActualizarRol';
    numReg               NUMBER;

    listOpciones pk_utils.token_list;
    numOpciones  number;
    i            number;

    idRol number;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_ActualizarRol ');

    if (p_codigo = 0) then

      select count(*)
        into numReg
        from t05_roles
       WHERE upper(a05nombre) = upper(p_nombre);

      if (numReg > 0) then
        p_codError := 103;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
      idRol := t05_roles_SEQ.Nextval;
      insert into t05_roles
        (a05codigo,
         a05nombre,
         a05estado,
         a05fechacreacion,
         a05fechamodificacion,
         a05usuariocreacion,
         a05usuariomodificacion)
        SELECT idRol,
               p_nombre,
               p_estado,
               sysdate,
               sysdate,
               p_usuarioRegistra,
               p_usuarioRegistra
          from dual;

    else

      select count(*)
        into numReg
        from t05_roles
       WHERE upper(a05nombre) = upper(p_nombre)
         and a05Codigo <> p_codigo;

      if (numReg > 0) then
        p_codError := 103;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;

      update t05_roles
         set a05nombre              = p_nombre,
             a05estado              = p_estado,
             a05fechamodificacion   = sysdate,
             a05usuariomodificacion = p_usuarioRegistra
       where a05codigo = p_codigo;

      idRol := p_codigo;

    end if;

    delete from t96_opcionrol where a96rol = idRol;

    if (length(p_opciones) > 0) then

      listOpciones := pk_utils.fn_splitStr(p_opciones, ',');

      i           := 1;
      numOpciones := pk_utils.splitter_count(p_opciones, ',') + 1;

      while i <= numOpciones loop

        insert into t96_opcionrol
          (a96opcion,
           a96rol,
           a96fechacreacion,
           a96usuariocreacion,
           a96fechamodificacion,
           a96usuariomodificacion,
           a96estado)
          select listOpciones(i),
                 idRol,
                 sysdate,
                 p_usuarioRegistra,
                 sysdate,
                 p_usuarioRegistra,
                 'A'
            from dual;

        i := i + 1;

      end loop;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_ActualizarRol OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ActualizarRol;

  PROCEDURE Pr_DarOpcionesXUsuario(p_idUsuario IN NUMBER,
                                   p_idRol     OUT number,
                                   p_nomRol    OUT varchar2,
                                   p_opciones  OUT varchar2,
                                   p_codError  OUT NUMBER,
                                   p_msjError  OUT VARCHAR2) IS

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarOpcionesXUsuario';
    numReg               NUMBER;

    opciones varchar2(1000);
    idRol    number;
    nomRol   varchar2(100);

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_DarOpcionesXUsuario ');

    if (p_idUsuario = -1) then
      p_idRol    := -1;
      p_nomRol   := '';
      p_opciones := '';

      p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
      p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

      PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                              NOMBRE_PAQUETE,
                              NOMBRE_PROCEDIMIENTO,
                              PK_UTILS.COD_USUARIO_DEFECTO,
                              'Consulta Pr_DarOpcionesXUsuario OK ');
      return;
    end if;

    select a06rol, a05nombre
      into idRol, nomRol
      from t06_usuarios, t05_roles
     WHERE a06Codigo = p_idUsuario
       and a06rol = a05codigo;

    if (idRol is null) then
      p_codError := 22;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    opciones := '';
    FOR regOpcion IN (select a96opcion
                        from t96_opcionrol
                       where a96rol = idRol
                         and a96estado = 'A'
                       ORDER BY a96opcion) LOOP

      opciones := opciones || to_char(regOpcion.a96opcion) || ',';

    end loop;

    p_idRol    := idRol;
    p_nomRol   := nomRol;
    p_opciones := opciones;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_DarOpcionesXUsuario OK ');

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarOpcionesXUsuario;

end PK_PAR_ADMROL;
/

prompt
prompt Creating package body PK_PRC_BATCH
prompt ==================================
prompt
create or replace package body hpv.PK_PRC_BATCH is

  PROCEDURE Pr_ReprocesaEncEntSal(p_codError OUT NUMBER,
                                  p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ReprocesaEncEntSal';
    numReg               NUMBER;
  
    sql_stmt varchar2(4000);
    i        number := 1;
    v_fecha  varchar2(10) := '2016-10-17';
    v_per    number := 3;
    v_col    varchar2(10);
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_GenerarRptTrazabilidad  ');
  
    update t104_rpt_enc_ent_sal x
       set x.primeraee =
           (select MIN(E.A16ENCUESTA)
              from t16_inscritoencuesta e
             where e.a16inscrito = x.idinscrito
               and e.a16encuesta in
                   (select Y.A50CODIGO
                      from t50_encuesta y
                     where y.a50tipoencuesta = 'I'))
     WHERE x.fec_corte = V_FECHA
       and x.periodo = V_PER;
  
    update t104_rpt_enc_ent_sal x
       set x.primeraes =
           (select MIN(E.A16ENCUESTA)
              from t16_inscritoencuesta e
             where e.a16inscrito = x.idinscrito
               and e.a16encuesta in
                   (select Y.A50CODIGO
                      from t50_encuesta y
                     where y.a50tipoencuesta = 'F'))
     WHERE x.fec_corte = V_FECHA
       and x.periodo = V_PER;
    commit;
  
    -- Test statements here
    while (i <= 21) loop
      --    v_col := to_char(i, '00');
    
      select replace('x.E' || to_char(i, '00'), ' ') into v_col from dual;
      sql_stmt := 'update t104_rpt_enc_ent_sal x set ' || v_col || ' = ' ||
                  ' (select r.a14letra ' ||
                  '   from t16_inscritoencuesta   e, t13_encuestapreguntas  p, t14_encuestarespuestas r ' ||
                  '  where e.a16encuesta = X.PRIMERAEE and e.a16pregunta = p.a13codigo and e.a16respuesta = r.a14codigo' ||
                  '    and p.a13numero = ' || i ||
                  ' and e.a16inscrito = x.idinscrito)' ||
                  ' where x.periodo = ' || v_per || ' and x.fec_corte = ' ||
                  chr(39) || v_fecha || chr(39);
    
      -- dbms_output.put_line(sql_stmt);
      execute immediate (sql_stmt);
      i := i + 1;
    
    end loop;
    dbms_output.put_line(i);
    i := 1;
  
    while (i <= 16) loop
      --    v_col := to_char(i, '00');
    
      select replace('x.S' || to_char(i, '00'), ' ') into v_col from dual;
      sql_stmt := 'update t104_rpt_enc_ent_sal x set ' || v_col || ' = ' ||
                  ' (select r.a14letra ' ||
                  '   from t16_inscritoencuesta   e, t13_encuestapreguntas  p, t14_encuestarespuestas r ' ||
                  '  where e.a16encuesta = X.PRIMERAES and e.a16pregunta = p.a13codigo and e.a16respuesta = r.a14codigo' ||
                  '    and p.a13numero = ' || i ||
                  ' and e.a16inscrito = x.idinscrito)' ||
                  ' where x.periodo = ' || v_per || ' and x.fec_corte = ' ||
                  chr(39) || v_fecha || chr(39);
    
      -- dbms_output.put_line(sql_stmt);
      execute immediate (sql_stmt);
      i := i + 1;
    
    end loop;
    dbms_output.put_line(i);
    update t104_rpt_enc_ent_sal x
       set E21 = E16
     where E17 is null
       and fec_corte = V_FECHA
       and periodo = V_PER;
  
    update t104_rpt_enc_ent_sal x
       set E16 = null
     where E17 is null
       and fec_corte = V_FECHA
       and periodo = V_PER;
    commit;
    update t104_rpt_enc_ent_sal x
       set S01 = null,
           S02 = null,
           S03 = null,
           S04 = null,
           S05 = null,
           S06 = null,
           S07 = null,
           S08 = null,
           S09 = null,
           S10 = null,
           S11 = null,
           S12 = null,
           S13 = null,
           S14 = null,
           S15 = null,
           S16 = null
     where fec_corte = V_FECHA
       and periodo = V_PER
       and exists (select 1
              from t101_rpt_trazabilidad t
             where t.periodo = V_PER
               and t.fec_corte = V_FECHA
               and t.idinscrito = x.idinscrito
               and t.ENCUESTA_FINAL is null);
  
    select count(0)
      into numReg
      from t104_rpt_enc_ent_sal t
     where t.fec_corte = V_FECHA
       and t.periodo = V_PER;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio a Pr_ReprocesaEncEntSal ok  ');
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := SQLERRM;
    
  END Pr_ReprocesaEncEntSal;

  PROCEDURE Pr_GenerarEncuestaSatisfaccion(p_codError OUT NUMBER,
                                           p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarEncuestaSatisfaccion';
    numReg               NUMBER;
  
    idPeriodoAct       number;
    idTaller           number;
    idGrupoFacilitador number;
  
    maxCorreosDia varchar2(10);
    numEncuestas  varchar2(10);
  
    idSeleccionado number;
  
    numEnviar number;
    envios    number;
  
    coderrorEnv number;
    msjerrorEnv varchar2(4000);
    emailEnviar varchar2(200);
  
    esValidoSeleccionado boolean;
  
    idReg number;
  
    numIntentosSeleccionar number;
  
    token varchar2(100);
  
    totalEnviosExitosos number;
  
    CURSOR curTallerGrupo IS
      SELECT *
        FROM t21_realizaciontaller
       WHERE a21Periodo = idPeriodoAct
         and a21asistentes > 0;
    -- and a21fechaencuesta is null;
  
    CURSOR curAsistente IS
      SELECT a51inscrito, a15email, a51codigo
        FROM t51_asistenciataller, t15_inscritos
       WHERE a51tallerrealizado = idTaller
         and a51grupofacilitador = idGrupoFacilitador
         and a51asistencia = 'A'
         and a51inscrito = a15codigo
       order by a51orden;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_GenerarEncuestaSatisfaccion ');
  
    totalEnviosExitosos := 0;
  
    idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    maxCorreosDia := Pk_Utils.Fn_Obtenervalorparametro('MAXCORREOSDIAS');
    numEncuestas  := Pk_Utils.Fn_Obtenervalorparametro('CANTENCUESTASATISFACCION');
  
    select count(*)
      into numReg
      from t55_logenviocorreo
     where to_char(a55fechaenvio, 'yyyymmdd') =
           to_char(sysdate, 'yyyymmdd')
       and a55codigorespuesta = 0;
  
    if (numReg > to_number(maxCorreosDia)) then
      p_codError := 72;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    FOR regTallerGrupo IN curTallerGrupo LOOP
    
      idTaller           := regTallerGrupo.A21taller;
      idGrupoFacilitador := regTallerGrupo.A21grupo;
    
      PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                              NOMBRE_PAQUETE,
                              NOMBRE_PROCEDIMIENTO,
                              PK_UTILS.COD_USUARIO_DEFECTO,
                              'Procesa grupo:' ||
                              to_char(idGrupoFacilitador) || ' Taller:' ||
                              to_char(idTaller));
    
      numEnviar := to_number(numEncuestas);
    
      if (regTallerGrupo.a21asistentes < to_number(numEncuestas)) then
        numEnviar := regTallerGrupo.a21asistentes;
      else
        numEnviar := trunc(regTallerGrupo.a21asistentes * 0.25, 0);
      
      end if;
    
      -- si ya se tienen algunos envios exitosos enviar solo los faltantes
      select count(*)
        into numReg
        from t51_asistenciataller
       where a51tallerrealizado = idTaller
         and a51grupofacilitador = idGrupoFacilitador
         and nvl(a51codrptacorreo, -1) = 0;
    
      numEnviar := numEnviar - numReg;
    
      if (numEnviar < 0) then
        numEnviar := 0;
      end if;
    
      PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                              NOMBRE_PAQUETE,
                              NOMBRE_PROCEDIMIENTO,
                              PK_UTILS.COD_USUARIO_DEFECTO,
                              'Correos x enviar:' || to_char(numEnviar));
    
      envios := 0;
    
      LOOP
      
        IF envios >= numEnviar THEN
          EXIT;
        END IF;
      
        -- ubicar un seleccionado valido (que no tenga fecha de envio o que halla fallado antes
      
        numIntentosSeleccionar := 1;
      
        LOOP
        
          SELECT (1 +
                 ABS(MOD(dbms_random.random, regTallerGrupo.a21asistentes)))
            into idSeleccionado
            FROM dual;
        
          esValidoSeleccionado := false;
          idReg                := 1;
        
          FOR regAsistente IN curAsistente LOOP
            if (idReg = idSeleccionado) then
            
              select count(*)
                into numReg
                from t51_asistenciataller
               where a51tallerrealizado = idTaller
                 and a51grupofacilitador = idGrupoFacilitador
                 and a51inscrito = regAsistente.A51inscrito
                 and (a51fechaenvioencuesta is null or
                     nvl(a51codrptacorreo, -1) <> 0);
            
              if (numReg > 0) then
                esValidoSeleccionado := true;
              end if;
            
            end if;
            idReg := idReg + 1;
          
          end loop;
        
          IF esValidoSeleccionado THEN
            EXIT;
          END IF;
        
          numIntentosSeleccionar := numIntentosSeleccionar + 1;
        
          --Si no fue posible ubicar un estudiante valido salir para evitar ciclo infinito
          if numIntentosSeleccionar > regTallerGrupo.a21asistentes then
            exit;
          end if;
        
        end loop;
      
        idReg := 1;
      
        FOR regAsistente IN curAsistente LOOP
          if (idReg = idSeleccionado) then
          
            PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                                    NOMBRE_PAQUETE,
                                    NOMBRE_PROCEDIMIENTO,
                                    PK_UTILS.COD_USUARIO_DEFECTO,
                                    'Selecciono estuciante :' ||
                                    regAsistente.A15email);
          
            emailEnviar := regAsistente.A15email;
            -- emailEnviar := 'rbuitrago@asegest.com';
          
            select rawtohex(DBMS_CRYPTO.Hash(UTL_I18N.STRING_TO_RAW(emailEnviar ||
                                                                    to_char(sysdate,
                                                                            'hh24miss'),
                                                                    'AL32UTF8'),
                                             2))
              into token
              from dual;
          
            update t54_tokenusuario
               set a54estado = 'I'
             where a54usuario = regAsistente.A51inscrito
               and a54usotoken = 'ENCUESTASATISFACION';
          
            numReg := Pk_Utils.Fn_Obtenerid('t54_tokenusuario_seq');
          
            insert into t54_tokenusuario
              (a54codigo,
               a54usuario,
               a54token,
               a54fechageneracion,
               a54usotoken,
               a54estado,
               a54fechauso,
               a54iddato)
            values
              (numReg,
               regAsistente.A51inscrito,
               token,
               sysdate,
               'ENCUESTASATISFACION',
               'A',
               null,
               regAsistente.A51codigo);
          
            commit;
          
            pk_utils.pr_enviarcorreows(p_to       => emailEnviar,
                                       p_tarea    => 'ENCUESTASATISFACCION',
                                       p_idreg    => numReg,
                                       p_coderror => coderrorEnv,
                                       p_msjerror => msjerrorEnv);
          
            update t51_asistenciataller
               set a51fechaenvioencuesta = sysdate,
                   a51codrptacorreo      = coderrorEnv,
                   a51msjrptacorreo      = msjerrorEnv,
                   a51tokenenviado       = token
             where a51tallerrealizado = idTaller
               and a51grupofacilitador = idGrupoFacilitador
               and a51inscrito = regAsistente.A51inscrito;
          
            if (coderrorEnv = 0) then
              totalEnviosExitosos := totalEnviosExitosos + 1;
            end if;
          
            commit;
          
          end if;
        
          idReg := idReg + 1;
        END LOOP;
      
        IF envios >= numEnviar THEN
          EXIT;
        END IF;
      
        envios := envios + 1;
      
      END LOOP;
    
      select count(*)
        into numReg
        from t51_asistenciataller
       where a51tallerrealizado = idTaller
         and a51grupofacilitador = idGrupoFacilitador
         and nvl(a51codrptacorreo, -1) = 0;
    
      if numReg = trunc(regTallerGrupo.a21asistentes * 0.25, 0) or
         numReg = regTallerGrupo.a21asistentes then
      
        update t21_realizaciontaller
           set a21fechaencuesta = sysdate
         where a21grupo = idGrupoFacilitador
           and a21taller = idTaller;
      
        commit;
      
      end if;
    
      select count(*)
        into numReg
        from t55_logenviocorreo
       where to_char(a55fechaenvio, 'yyyymmdd') =
             to_char(sysdate, 'yyyymmdd')
         and a55codigorespuesta = 0;
    
      if (numReg > to_number(maxCorreosDia)) then
        exit;
      end if;
    
      PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                              NOMBRE_PAQUETE,
                              NOMBRE_PROCEDIMIENTO,
                              PK_UTILS.COD_USUARIO_DEFECTO,
                              'Proceso grupo taller');
    
    END LOOP;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total envios: ' ||
                  to_char(totalEnviosExitosos);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Pr_GenerarEncuestaSatisfaccion OK ' ||
                            to_char(totalEnviosExitosos));
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_GenerarEncuestaSatisfaccion;

  PROCEDURE Pr_GenerarCorreoInscripcion(p_codError OUT NUMBER,
                                        p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarCorreoInscripcion';
    numReg               NUMBER;
  
    idPeriodoAct number;
  
    maxCorreosDia varchar2(10);
  
    totalEnvios number;
    envios      number;
  
    coderrorEnv number;
    msjerrorEnv varchar2(4000);
    emailEnviar varchar2(200);
  
    CURSOR curInscritos IS
      SELECT t15_inscritos.*
        FROM t15_inscritos, t26_gruposfacilitador
       WHERE a15grupofacilitador = a26codigo
         and a26periodo = idPeriodoAct
         and a15estado = 'A'
         and (a15fechaenvio is null or a15codigocorreo <> 0)
       order by a15codigo;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_GenerarEncuestaSatisfaccion ');
  
    idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    maxCorreosDia := Pk_Utils.Fn_Obtenervalorparametro('MAXCORREOSDIAS');
  
    select count(*)
      into totalEnvios
      from t55_logenviocorreo
     where to_char(a55fechaenvio, 'yyyymmdd') =
           to_char(sysdate, 'yyyymmdd')
       and a55codigorespuesta = 0;
  
    if (totalEnvios > to_number(maxCorreosDia)) then
      p_codError := 72;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    envios := 0;
  
    FOR regInscrito IN curInscritos LOOP
    
      emailEnviar := regInscrito.A15email;
      -- emailEnviar := ' @ .com';
    
      pk_utils.pr_enviarcorreows(p_to       => emailEnviar,
                                 p_tarea    => 'INSCRIPCION',
                                 p_idreg    => regInscrito.A15codigo,
                                 p_coderror => coderrorEnv,
                                 p_msjerror => msjerrorEnv);
    
      update t15_inscritos
         set a15codigocorreo = coderrorEnv,
             a15msjcorreo    = msjerrorEnv,
             a15fechaenvio   = sysdate
       where a15codigo = regInscrito.A15codigo;
    
      commit;
    
      if (coderrorEnv = 0) then
        envios := envios + 1;
      end if;
    
      IF totalEnvios + envios >= to_number(maxCorreosDia) THEN
        EXIT;
      END IF;
    
    END LOOP;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total envios: ' ||
                  to_char(envios);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Pr_GenerarCorreoInscripcion OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_GenerarCorreoInscripcion;

  PROCEDURE Pr_GenerarRptEncuestaSat(p_codError OUT NUMBER,
                                     p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptEncuestaSatisfaccion';
    numReg               NUMBER;
    p_fec_corte          varchar2(10);
    p_tipo_corte         varchar2(10);
  
    idPeriodoAct number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_GenerarRptEncuestaSatisfaccion  ');
  
    FOR R IN (SELECT * FROM t12_periodos) LOOP
      idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoVigente;
    
      pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                     p_tipo_corte,
                                     p_coderror,
                                     p_msjerror);
    
      if idPeriodoAct <> R.A12CODIGO then
        p_tipo_corte := 'A';
        idPeriodoAct := R.A12CODIGO;
      end if;
    
      delete t102_rpt_encsattmp;
      commit;
    
      insert into t102_rpt_encsattmp
        select a.a51periodo,
               a.a51grupofacilitador,
               a.a51tallerrealizado,
               e.a16inscrito,
               e.a16encuesta,
               e.a16pregunta,
               e.a16respuesta
          from t51_asistenciataller a, t16_inscritoencuesta e
         where a.a51fechadiligenciaencuesta is not null
           and e.a16inscrito = a.a51inscrito
           and a.a51fechadiligenciaencuesta = e.a16fechacreacion
           and exists (select 1
                  from t50_encuesta s
                 where s.a50tipoencuesta = 'S'
                   and e.a16encuesta = s.a50codigo)
           and a.a51periodo = idPeriodoAct;
    
      -- Por si se reprocesa.
      delete from t102_rpt_encuestasatisfaccion t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      insert into t102_rpt_encuestasatisfaccion
        (periodo,
         grupofacilitador,
         idgrupo,
         taller,
         idpregunta,
         idrespuesta,
         NRORPTAS,
         tipo_corte,
         fec_corte)
      
        select t.a51periodo,
               t.a51grupofacilitador,
               t.a51grupofacilitador,
               t.a51tallerrealizado,
               t.a16pregunta,
               t.a16respuesta,
               count(*),
               p_tipo_corte,
               p_fec_corte
          from t102_rpt_encsattmp t
         group by t.a51periodo,
                  t.a51grupofacilitador,
                  t.a51tallerrealizado,
                  t.a16pregunta,
                  t.a16respuesta;
    
      update t102_rpt_encuestasatisfaccion
         set (divipola,
              nomdepartamento,
              nommunicipio,
              nombrecoordinador,
              nombrefacilitador,
              siglagrupo,
              idmunicipio,
              iddepartamento,
              idfacilitador,
              idcoordinador) =
             (select divipola,
                     nomdepartamento,
                     nommunicipio,
                     nomcoordinador,
                     nombrefacilitador,
                     sigla,
                     idmunicipio,
                     iddepartamento,
                     idfacilitador,
                     idcoordinador
                from t103_rpt_cronogramataller c
               where c.periodo = idPeriodoAct
                 and c.fec_corte = p_fec_corte
                 and c.idgrupofacilitador = grupofacilitador)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      update t102_rpt_encuestasatisfaccion
         set (nropregunta, pregunta) =
             (select p.a13numero, p.a13pregunta
                from t13_encuestapreguntas p
               where p.a13codigo = idpregunta)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      update t102_rpt_encuestasatisfaccion
         set (respuesta) =
             (select SUBSTR(r.a14letra, 1, 1)
                from t14_encuestarespuestas r
               where r.a14codigo = idrespuesta)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      -- Se eliminan los datos de calculos de dias anteriores.
      delete from t102_rpt_encuestasatisfaccion t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = 'A'
         and t.fec_corte <> p_fec_corte;
    
      commit;
    
      /*OBSERVACIONES*/
      delete from T102_RPT_ENCSATOBS t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      INSERT INTO T102_RPT_ENCSATOBS
        (periodo,
         grupofacilitador,
         idgrupo,
         taller,
         idinscrito,
         observacion,
         tipo_corte,
         fec_corte)
        select a.a51periodo,
               a.a51grupofacilitador,
               a.a51grupofacilitador,
               a.a51tallerrealizado,
               o.a56inscrito,
               o.a56observacion,
               p_tipo_corte,
               p_fec_corte
        
          from t51_asistenciataller a, T56_OBSERVACIONENCUESTA o
         where a.a51fechadiligenciaencuesta is not null
           and o.a56inscrito = a.a51inscrito
           and a.a51fechadiligenciaencuesta = o.a56fechacreacion
           and exists (select 1
                  from t50_encuesta s
                 where s.a50tipoencuesta = 'S'
                   and o.a56encuesta = s.a50codigo)
           and o.a56observacion is not null
           and a.a51periodo = idPeriodoAct;
    
      update T102_RPT_ENCSATOBS O
         set (divipola,
              nomdepartamento,
              nommunicipio,
              nombrecoordinador,
              nombrefacilitador,
              siglagrupo,
              idmunicipio,
              iddepartamento,
              idfacilitador,
              idcoordinador) =
             (select divipola,
                     nomdepartamento,
                     nommunicipio,
                     nomcoordinador,
                     nombrefacilitador,
                     sigla,
                     idmunicipio,
                     iddepartamento,
                     idfacilitador,
                     idcoordinador
                from t103_rpt_cronogramataller c
               where c.periodo = idPeriodoAct
                 and c.fec_corte = p_fec_corte
                 and c.idgrupofacilitador = O.grupofacilitador)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      delete from T102_RPT_ENCSATOBS t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = 'A'
         and t.fec_corte <> p_fec_corte;
    
      COMMIT;
    
    END LOOP;
  
    select count(0)
      into numReg
      from t102_rpt_encuestasatisfaccion t
     where t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio a Pr_GenerarRptEncuestaSatisfaccion ok  ');
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      -- p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptEncuestaSat;

  PROCEDURE Pr_GenerarRptEncuestaIO(p_codError OUT NUMBER,
                                    p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptEncuestaIO';
    numReg               NUMBER;
  
    idPeriodoAct number;
    idEncuesta   number;
    p_fec_corte  VARCHAR2(10);
    p_tipo_corte VARCHAR2(10);
    sql_stmt     varchar2(4000);
    i            number := 1;
    v_fecha      varchar2(10);
    v_per        number;
    v_col        varchar2(10);
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_GenerarRptEncuestaIO  ');
  
    FOR R IN (SELECT * FROM t12_periodos) LOOP
      idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
    
      pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                     p_tipo_corte,
                                     p_coderror,
                                     p_msjerror);
    
      if idPeriodoAct <> R.A12CODIGO then
        p_tipo_corte := 'A';
        idPeriodoAct := R.A12CODIGO;
      end if;
    
      -- Por si se reprocesa.
      delete from t104_rpt_enc_ent_sal t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      insert into t104_rpt_enc_ent_sal
        SELECT PERIODO,
               IDINSCRITO,
               DIVIPOLA,
               NOMDEPARTAMENTO,
               NOMMUNICIPIO,
               NOMBRECOORDINADOR,
               CC_FACILITADOR,
               NOMBREFACILITADOR,
               GRUPOFACILITADOR,
               SIGLAGRUPO,
               TIPODOCUMENTO,
               DOCUMENTO_INSCRITO,
               CODIGO_BENEFICIARIO,
               GENERO,
               CONDICION,
               ESTADO,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               IDMUNICIPIO,
               IDDEPARTAMENTO,
               IDFACILITADOR,
               IDCOORDINADOR,
               TIPO_CORTE,
               FEC_CORTE,
               NULL,
               TIPOFORMACION,
               NULL,
               NULL,
               null,
               valido
          FROM T101_RPT_TRAZABILIDAD X
         WHERE x.fec_corte = p_fec_corte
           and x.periodo = idPeriodoAct;
    
      update t104_rpt_enc_ent_sal x
         set x.primeraee =
             (select MIN(E.A16ENCUESTA)
                from t16_inscritoencuesta e
               where e.a16inscrito = x.idinscrito
                 and e.a16encuesta in
                     (select Y.A50CODIGO
                        from t50_encuesta y
                       where y.a50tipoencuesta = 'I'))
       WHERE x.fec_corte = p_fec_corte
         and x.periodo = idPeriodoAct;
    
      update t104_rpt_enc_ent_sal x
      --       set x.primeraes =
         set (x.primeraes, X.FEC_ES) =
             (select MAX(E.A16ENCUESTA), MAX(E.A16FECHACREACION)
                from t16_inscritoencuesta e
               where e.a16inscrito = x.idinscrito
                 and e.a16encuesta in
                     (select Y.A50CODIGO
                        from t50_encuesta y
                       where y.a50tipoencuesta = 'F'))
       WHERE x.fec_corte = p_fec_corte
         and x.periodo = idPeriodoAct;
      commit;
    
      v_fecha := p_fec_corte;
      v_per   := idPeriodoAct;
    
      i := 1;
    
      while (i <= 21) loop
      
        select replace('x.E' || to_char(i, '00'), ' ')
          into v_col
          from dual;
        sql_stmt := 'update t104_rpt_enc_ent_sal x set ' || v_col || ' = ' ||
                    ' (select r.a14letra ' ||
                    '   from t16_inscritoencuesta   e, t13_encuestapreguntas  p, t14_encuestarespuestas r ' ||
                    '  where e.a16encuesta = X.PRIMERAEE and e.a16pregunta = p.a13codigo and e.a16respuesta = r.a14codigo' ||
                    '    and p.a13numero = ' || i ||
                    ' and e.a16inscrito = x.idinscrito)' ||
                    ' where x.periodo = ' || v_per || ' and x.fec_corte = ' ||
                    chr(39) || v_fecha || chr(39);
      
        -- dbms_output.put_line(sql_stmt);
        execute immediate (sql_stmt);
        i := i + 1;
      
      end loop;
    
      i := 1;
    
      while (i <= 16) loop
      
        select replace('x.S' || to_char(i, '00'), ' ')
          into v_col
          from dual;
        sql_stmt := 'update t104_rpt_enc_ent_sal x set ' || v_col || ' = ' ||
                    ' (select r.a14letra ' ||
                    '   from t16_inscritoencuesta   e, t13_encuestapreguntas  p, t14_encuestarespuestas r ' ||
                    '  where e.a16encuesta = X.PRIMERAES AND e.A16FECHACREACION = x.fec_es and e.a16pregunta = p.a13codigo and e.a16respuesta = r.a14codigo' ||
                    '    and p.a13numero = ' || i ||
                    ' and e.a16inscrito = x.idinscrito)' ||
                    ' where x.periodo = ' || v_per || ' and x.fec_corte = ' ||
                    chr(39) || v_fecha || chr(39);
      
        -- dbms_output.put_line(sql_stmt);
        execute immediate (sql_stmt);
        i := i + 1;
      
      end loop;
    
      /*Se mueve la preguntas 16 a la 21 para unificar la columna medio*/
      update t104_rpt_enc_ent_sal x
         set E21 = E16
       where E17 is null
         and fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      update t104_rpt_enc_ent_sal x
         set E16 = null
       where E17 is null
         and fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
      commit;
    
      dbms_output.put_line('Mueve E16 a E21');
    
      UPDATE t104_rpt_enc_ent_sal E
         SET s01 = NULL,
             s02 = NULL,
             s03 = NULL,
             s04 = NULL,
             s05 = NULL,
             s06 = NULL,
             s07 = NULL,
             s08 = NULL,
             s09 = NULL,
             s10 = NULL,
             s11 = NULL,
             s12 = NULL,
             s13 = NULL,
             s14 = NULL,
             s15 = NULL,
             s16 = NULL
       WHERE fec_corte = p_fec_corte
         and periodo = idPeriodoAct
         AND S01 IS NOT NULL
         AND EXISTS (SELECT 1
                FROM T101_RPT_TRAZABILIDAD T
               WHERE T.FEC_CORTE = E.FEC_CORTE
                 AND T.PERIODO = E.PERIODO
                 AND E.IDINSCRITO = T.IDINSCRITO
                 AND T.CERTIFICA <> 'S');
    
      -- encuesta final
      update t101_rpt_trazabilidad t
         set (t.encuesta_final) =
             (select min(a16fechacreacion)
                from t16_inscritoencuesta e
               where a16inscrito = t.idinscrito
                 and a16encuesta IN
                     (select a50codigo
                        from t50_encuesta
                       where a50tipoencuesta = 'F'))
       WHERE t.certifica = 'S'
         and fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct
         and exists (select 1
                from t104_rpt_enc_ent_sal x
               where x.fec_corte = t.fec_corte
                 and t.periodo = x.periodo
                 and x.s01 is not null
                 and x.idinscrito = t.idinscrito);
    
      -- Se eliminan los datos de calculos de dias anteriores.
      delete from T104_RPT_ENC_ENT_SAL t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = 'A'
         and t.fec_corte <> p_fec_corte;
    
      /*
          delete from T104_RPT_ENC_ENT_SAL t
           where fec_corte = '2016-10-17'
             and periodo = 3
             and not exists (select 1
                    from t101_rpt_trazabilidad x
                   where x.periodo = t.periodo
                     and x.fec_corte = t.fec_corte
                     and t.idinscrito = x.idinscrito);
      */
      commit;
    END LOOP;
  
    select count(0)
      into numReg
      from T104_RPT_ENC_ENT_SAL t
     where t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio a Pr_GenerarRptEncuestaIO ok  ');
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      -- p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptEncuestaIO;

  PROCEDURE Pr_GenerarRptCronogTalleres(p_codError OUT NUMBER,
                                        p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptCronogTalleres';
    numReg               NUMBER;
  
    idPeriodoAct number;
    idGrupo      number;
    idTaller     number;
    fechaTaller  VARCHAR2(10);
    p_fec_corte  VARCHAR2(10);
    p_tipo_corte VARCHAR2(10);
    asistencia   number;
    i            number;
    sql_stmt     VARCHAR2(3000);
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_GenerarRptCronogTalleres  ');
  
    FOR R IN (SELECT * FROM t12_periodos) LOOP
      idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
    
      pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                     p_tipo_corte,
                                     p_coderror,
                                     p_msjerror);
    
      if idPeriodoAct <> R.A12CODIGO then
        p_tipo_corte := 'A';
        idPeriodoAct := R.A12CODIGO;
      end if;
    
      -- Por si se reprocesa.
      delete from T103_RPT_CRONOGRAMATALLER t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      insert into t103_rpt_cronogramataller
        (periodo,
         idgrupofacilitador,
         divipola,
         nomdepartamento,
         nommunicipio,
         nomcoordinador,
         nombrefacilitador,
         idgrupo,
         dia,
         horario,
         LUGAR,
         DIRECCION,
         SIGLA,
         inscritos,
         taller1,
         taller2,
         taller3,
         taller4,
         taller5,
         taller6,
         taller7,
         taller8,
         iddepartamento,
         idmunicipio,
         idfacilitador,
         idcoordinador,
         TIPO_CORTE,
         FEC_CORTE,
         ESTADO)
        SELECT a26periodo periodo,
               a26codigo idGrupoFacilitador,
               a03dane Divipola,
               a02nombre nomdepartamento,
               a03nombre nommunicipio,
               (select b.a07primernombre || ' ' || b.a07segundonombre || ' ' ||
                       b.a07primerapellido || ' ' || b.a07segundoapellido
                  from T06_USUARIOS a, T07_PERSONAS b
                 where a.a06codigo = u.a06coordinador
                   and a.a06codigo = b.a07usuario) nomCoordinador,
               (a07primernombre || ' ' || a07segundonombre || ' ' ||
               a07primerapellido || ' ' || a07segundoapellido) nombrefacilitador,
               a26grupo idgrupo,
               a23nombre dia,
               a24horario horario,
               a26lugar,
               a26direccion,
               a26sigla,
               0 Inscritos,
               (a12fechainitaller + a23Codigo - 2 + 0) Taller1,
               (a12fechainitaller + a23Codigo - 2 + 7) Taller2,
               (a12fechainitaller + a23Codigo - 2 + 14) Taller3,
               (a12fechainitaller + a23Codigo - 2 + 21) Taller4,
               (a12fechainitaller + a23Codigo - 2 + 28) Taller5,
               (a12fechainitaller + a23Codigo - 2 + 35) Taller6,
               (a12fechainitaller + a23Codigo - 2 + 42) Taller7,
               (a12fechainitaller + a23Codigo - 2 + 49) Taller8,
               a02codigo IdDepartamento,
               a03codigo IdMunicipio,
               a07Usuario IdFacilitador,
               a06Coordinador IdCoordinador,
               p_tipo_corte,
               p_fec_corte,
               A26ESTADO
          FROM T26_GRUPOSFACILITADOR,
               T90_ESTADOSESPACIOFISICO,
               T02_DEPARTAMENTOS,
               T03_MUNICIPIOS,
               T23_DIAS,
               T24_HORARIOS,
               T25_GRUPOS,
               T06_USUARIOS u,
               T07_PERSONAS,
               T12_PERIODOS
         WHERE a26estado = a90codigo
           AND a26ciudad = a03codigo
           AND a03departamento = a02codigo
           AND a26dia = a23codigo
           AND a26horario = a24codigo
           AND a26grupo = a25codigo
           AND a26facilitador = a06codigo
           AND a06codigo = a07usuario
           AND a26periodo = a12codigo
           and a26periodo = idPeriodoAct;
    
      update t103_rpt_cronogramataller t
         set t.inscritos =
             (select count(*)
                from T15_INSCRITOS I
               where i.a15grupofacilitador = t.idgrupofacilitador
                 and i.a15estado = 'A'
               group by i.a15grupofacilitador)
       where EXISTS (select 1
                from T15_INSCRITOS I
               where i.a15grupofacilitador = t.idgrupofacilitador
                 and i.a15estado = 'A')
         and t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set T1PLANE = TALLER1,
             T2PLANE = TALLER2,
             T3PLANE = TALLER3,
             T4PLANE = TALLER4,
             T5PLANE = TALLER5,
             T6PLANE = TALLER6,
             T7PLANE = TALLER7,
             T8PLANE = TALLER8
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T1EJECU, T1ASIST, T1NOASI) =
             (select r.a21fechataller, r.a21asistentes, r.a21noasistentes
                from t21_realizaciontaller r
               where r.a21periodo = t.periodo
                 and r.a21fechataller is not null
                 and r.a21grupo = t.idgrupofacilitador
                 and r.a21taller = 1)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T2EJECU, T2ASIST, T2NOASI) =
             (select r.a21fechataller, r.a21asistentes, r.a21noasistentes
                from t21_realizaciontaller r
               where r.a21periodo = t.periodo
                 and r.a21fechataller is not null
                 and r.a21grupo = t.idgrupofacilitador
                 and r.a21taller = 2)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T3EJECU, T3ASIST, T3NOASI) =
             (select r.a21fechataller, r.a21asistentes, r.a21noasistentes
                from t21_realizaciontaller r
               where r.a21periodo = t.periodo
                 and r.a21fechataller is not null
                 and r.a21grupo = t.idgrupofacilitador
                 and r.a21taller = 3)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T4EJECU, T4ASIST, T4NOASI) =
             (select r.a21fechataller, r.a21asistentes, r.a21noasistentes
                from t21_realizaciontaller r
               where r.a21periodo = t.periodo
                 and r.a21fechataller is not null
                 and r.a21grupo = t.idgrupofacilitador
                 and r.a21taller = 4)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T5EJECU, T5ASIST, T5NOASI) =
             (select r.a21fechataller, r.a21asistentes, r.a21noasistentes
                from t21_realizaciontaller r
               where r.a21periodo = t.periodo
                 and r.a21fechataller is not null
                 and r.a21grupo = t.idgrupofacilitador
                 and r.a21taller = 5)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T6EJECU, T6ASIST, T6NOASI) =
             (select r.a21fechataller, r.a21asistentes, r.a21noasistentes
                from t21_realizaciontaller r
               where r.a21periodo = t.periodo
                 and r.a21fechataller is not null
                 and r.a21grupo = t.idgrupofacilitador
                 and r.a21taller = 6)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T7EJECU, T7ASIST, T7NOASI) =
             (select r.a21fechataller, r.a21asistentes, r.a21noasistentes
                from t21_realizaciontaller r
               where r.a21periodo = t.periodo
                 and r.a21fechataller is not null
                 and r.a21grupo = t.idgrupofacilitador
                 and r.a21taller = 7)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T8EJECU, T8ASIST, T8NOASI) =
             (select r.a21fechataller, r.a21asistentes, r.a21noasistentes
                from t21_realizaciontaller r
               where r.a21periodo = t.periodo
                 and r.a21fechataller is not null
                 and r.a21grupo = t.idgrupofacilitador
                 and r.a21taller = 8)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      /*Encuestas de satisfaccion*/
    
      update t103_rpt_cronogramataller t
         set (T1SATEN) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHAENVIOENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 1
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T1SATCO) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHADILIGENCIAENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 1
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T2SATEN) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHAENVIOENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 2
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T2SATCO) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHADILIGENCIAENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 2
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T3SATEN) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHAENVIOENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 3
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T3SATCO) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHADILIGENCIAENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 3
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T4SATEN) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHAENVIOENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 4
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T4SATCO) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHADILIGENCIAENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 4
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T5SATEN) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHAENVIOENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 5
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T5SATCO) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHADILIGENCIAENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 5
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T6SATEN) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHAENVIOENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 6
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T6SATCO) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHADILIGENCIAENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 6
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T7SATEN) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHAENVIOENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 7
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T7SATCO) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHADILIGENCIAENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 7
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T8SATEN) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHAENVIOENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 8
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      update t103_rpt_cronogramataller t
         set (T8SATCO) =
             (select COUNT(*)
                from T51_ASISTENCIATALLER A
               WHERE A.A51PERIODO = idPeriodoAct
                 AND A.A51FECHADILIGENCIAENCUESTA IS NOT NULL
                 AND A.A51TALLERREALIZADO = 8
                 AND A.A51GRUPOFACILITADOR = T.IDGRUPOFACILITADOR
               GROUP BY A.A51GRUPOFACILITADOR)
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      -- Se eliminan los datos de calculos de dias anteriores.
      delete from t103_rpt_cronogramataller t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = 'A'
         and t.fec_corte <> p_fec_corte;
    
      commit;
    
    END LOOP;
  
    i := 1;
    idPeriodoAct := 1;
    while (i <= 8) loop
    
      sql_stmt := 'update t103_rpt_cronogramataller x ' || ' set x.t' || i ||
                  'saten = ' || '     (select t.enviadas ' ||
                  '        from ENC_SATISFACP1_ENV t ' ||
                  '       where t.periodo = x.periodo ' ||
                  '         and t.grupo = x.idgrupofacilitador ' ||
                  '         and t.taller = ' || i || ') ' ||
                  ' where x.fec_corte = ' || chr(39) || p_fec_corte ||
                  chr(39) || ' and x.periodo = ' || idPeriodoAct;
      -- dbms_output.put_line(sql_stmt);
      execute immediate (sql_stmt);
    
      sql_stmt := 'update t103_rpt_cronogramataller x ' || ' set x.t' || i ||
                  'satco = ' || '     (select t.contestadas ' ||
                  '        from ENC_SATISFACP1_CON t ' ||
                  '       where t.periodo = x.periodo ' ||
                  '         and t.grupo = x.idgrupofacilitador ' ||
                  '         and t.taller = ' || i || ') ' ||
                  ' where x.fec_corte = ' || chr(39) || p_fec_corte ||
                  chr(39) || ' and x.periodo = ' || idPeriodoAct;
    
      -- dbms_output.put_line(sql_stmt);
      execute immediate (sql_stmt);
      i := i + 1;
    end loop;
  
    pk_prc_batch.pr_generarrptencuestasat(p_coderror, p_msjerror);
  
    select count(0)
      into numReg
      from t103_rpt_cronogramataller t
     where t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio a Pr_GenerarRptCronogTalleres ok  ');
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      -- p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptCronogTalleres;

  PROCEDURE Pr_GenerarRptCandidatos(p_codError OUT NUMBER,
                                    p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptCandidatos';
    numReg               NUMBER;
  
    idPeriodoAct number;
    p_fec_corte  VARCHAR2(10);
    p_tipo_corte VARCHAR2(10);
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro>' || NOMBRE_PROCEDIMIENTO);
  
    idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                   p_tipo_corte,
                                   p_coderror,
                                   p_msjerror);
  
    -- Por si se reprocesa.
    delete from t105_rpt_candidatos t
     where t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
  
    insert into t105_rpt_candidatos
      (periodo,
       tipodocumento,
       documento,
       primernombre,
       segundonombre,
       primerapellido,
       segundoapellido,
       fechanacimiento,
       email,
       telefono,
       movil,
       movilalt,
       condicionespecial,
       codigobeneficiario,
       estado,
       fechacreacion,
       tipo_corte,
       fec_corte)
      select g.a53periodo,
             i.a15tipodocumento,
             i.a15documento,
             i.a15primernombre,
             i.a15segundonombre,
             i.a15primerapellido,
             i.a15segundoapellido,
             i.a15fechanacimiento,
             i.a15email,
             i.a15telefono,
             i.a15movil,
             i.a15movilalt,
             i.a15condicionespecial,
             i.a15codigobeneficiario,
             g.a53estado,
             g.a53fechacreacion,
             p_tipo_corte,
             p_fec_corte
        from t53_grupoinscrito g, T15_INSCRITOS I
       where I.A15CODIGO = g.a53inscrito
         and g.a53periodo = idPeriodoAct
         and g.a53estado <> 'A';
  
    -- Se eliminan los datos de calculos de dias anteriores.
    delete from t105_rpt_candidatos t
     where t.periodo = idPeriodoAct
       and t.tipo_corte = 'A'
       and t.fec_corte <> p_fec_corte;
  
    commit;
  
    select count(0)
      into numReg
      from t105_rpt_candidatos t
     where t.periodo = idPeriodoAct
       and t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio a Pr_GenerarRptCandidatos ok  ');
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptCandidatos;

  PROCEDURE Pr_TipoFechaCorte(p_fec_corte  OUT VARCHAR2,
                              p_tipo_corte OUT VARCHAR2,
                              p_codError   OUT NUMBER,
                              p_msjError   OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_TipoFechaCorte';
    v_Fecha              varchar2(10);
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro>' || NOMBRE_PROCEDIMIENTO);
  
    p_fec_corte  := to_char(sysdate - 1, 'yyyy-mm-dd');
    p_tipo_corte := 'A';
  
    select to_char(Last_day(sysdate - 1), 'yyyy-mm-dd')
      into v_Fecha
      from dual;
    if v_Fecha = p_fec_corte then
      p_tipo_corte := 'M';
    
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio>' || NOMBRE_PROCEDIMIENTO);
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := SQLERRM;
    
  END Pr_TipoFechaCorte;

  PROCEDURE Pr_GenerarRptCasoExito(p_periodo  IN NUMBER,
                                   p_codError OUT NUMBER,
                                   p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptCasoExito';
    numReg               NUMBER;
  
    idPeriodoAct number;
    idEncuesta   number;
    p_fec_corte  VARCHAR2(10);
    p_tipo_corte VARCHAR2(10);
    vrPorc       NUMBER := 10;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro:' || NOMBRE_PROCEDIMIENTO);
  
    FOR R IN (SELECT * FROM t12_periodos) LOOP
      idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoVigente;
    
      pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                     p_tipo_corte,
                                     p_coderror,
                                     p_msjerror);
    
      if idPeriodoAct <> R.A12CODIGO then
        p_tipo_corte := 'A';
        idPeriodoAct := R.A12CODIGO;
      end if;
    
      -- Por si se reprocesa.
      delete from T107_RPT_CASOSEXITO t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      insert into T107_RPT_CASOSEXITO
        (periodo,
         divipola,
         nombre_departamento,
         nombre_municipio,
         nombre_coordinador,
         cedula_facilitador,
         nombre_facilitador,
         sigla_grupo,
         tipo_documento_participante,
         documento_participante,
         codigo_beneficiario,
         primernombre_participante,
         segundonombre_participante,
         primerapellido_participante,
         segundoapellido_participante,
         estado,
         observaciones,
         idmunicipio,
         iddepartamento,
         idfacilitador,
         idcoordinador,
         idcodigogrupo,
         idinscrito,
         idcasoexito,
         tipo_corte,
         fec_corte)
        select e.a58periodo,
               A03DANE,
               a02nombre,
               a03nombre,
               (select b.a07primernombre || ' ' || b.a07segundonombre || ' ' ||
                       b.a07primerapellido || ' ' || b.a07segundoapellido
                  from T06_USUARIOS a, T07_PERSONAS b
                 where a.a06codigo = u.a06coordinador
                   and a.a06codigo = b.a07usuario) nomCoordinador,
               a07identificacion,
               (a07primernombre || ' ' || a07segundonombre || ' ' ||
               a07primerapellido || ' ' || a07segundoapellido) nombrefacilitador,
               a26sigla,
               i.a15tipodocumento,
               i.a15documento,
               i.a15codigobeneficiario,
               i.a15primernombre,
               i.a15segundonombre,
               i.a15primerapellido,
               i.a15segundoapellido,
               x.a83nombre estado,
               E.A58OBSERVACION,
               a03codigo,
               a02codigo,
               a07usuario,
               a06coordinador,
               I.A15GRUPOFACILITADOR,
               i.a15codigo,
               e.a58codigo,
               p_tipo_corte,
               p_fec_corte
          from t15_inscritos         i,
               t58_casoexito         e,
               t26_gruposfacilitador g,
               t03_municipios        m,
               t02_departamentos     d,
               T06_USUARIOS          u,
               T07_PERSONAS,
               t83_estadocasoexito   x
        
         where i.a15estado = PK_UTILS.COD_ACTIVO
           and a26codigo = a15grupofacilitador
           and a03codigo = a26ciudad
           and a02codigo = a03departamento
           AND a26facilitador = a06codigo
           AND a06codigo = a07usuario
           and g.a26periodo = idPeriodoAct
           and e.a58inscrito = i.a15codigo
           AND e.a58estado = x.a83codigo;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET (x.genero, x.condicion, X.TIPO_FORMACION, X.NIVEL_FORMACION) =
             (select p.a01genero,
                     p.a01condicion,
                     p.a01tipoformcion,
                     p.a01nivelformacion
                from t01_participantes p
               where x.documento_participante = p.a01documento)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.ASISTENCIAS =
             (SELECT COUNT(1)
                FROM T51_ASISTENCIATALLER
               WHERE a51inscrito = x.idinscrito
                 AND a51Asistencia = 'A'
                 and a51periodo = x.PERIODO)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.ASISTENCIAS = 8
       where x.ASISTENCIAS > 8
         and fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r1 =
             (SELECT t.a59respuesta
                FROM T59_CASOEXITOLOGRO t
               WHERE t.a59casoexito = x.idcasoexito
                 AND t.a59cualidad = 1)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r2 =
             (SELECT t.a59respuesta
                FROM T59_CASOEXITOLOGRO t
               WHERE t.a59casoexito = x.idcasoexito
                 AND t.a59cualidad = 2)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r3 =
             (SELECT t.a59respuesta
                FROM T59_CASOEXITOLOGRO t
               WHERE t.a59casoexito = x.idcasoexito
                 AND t.a59cualidad = 3)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r4 =
             (SELECT t.a59respuesta
                FROM T59_CASOEXITOLOGRO t
               WHERE t.a59casoexito = x.idcasoexito
                 AND t.a59cualidad = 4)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r5 =
             (SELECT t.a59respuesta
                FROM T59_CASOEXITOLOGRO t
               WHERE t.a59casoexito = x.idcasoexito
                 AND t.a59cualidad = 5)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r6 =
             (SELECT t.a59respuesta
                FROM T59_CASOEXITOLOGRO t
               WHERE t.a59casoexito = x.idcasoexito
                 AND t.a59cualidad = 6)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r7 =
             (SELECT t.a59respuesta
                FROM T59_CASOEXITOLOGRO t
               WHERE t.a59casoexito = x.idcasoexito
                 AND t.a59cualidad = 7)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r8 =
             (SELECT t.a59respuesta
                FROM T59_CASOEXITOLOGRO t
               WHERE t.a59casoexito = x.idcasoexito
                 AND t.a59cualidad = 8)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r9 =
             (SELECT t.a59respuesta
                FROM T59_CASOEXITOLOGRO t
               WHERE t.a59casoexito = x.idcasoexito
                 AND t.a59cualidad = 9)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r10 =
             (SELECT t.a59respuesta
                FROM T59_CASOEXITOLOGRO t
               WHERE t.a59casoexito = x.idcasoexito
                 AND t.a59cualidad = 10)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      /*Calculo porcentajes*/
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.r1p  = decode(x.r1, 'S', vrPorc, 0),
             x.r2p  = decode(x.r2, 'S', vrPorc, 0),
             x.r3p  = decode(x.r3, 'S', vrPorc, 0),
             x.r4p  = decode(x.r4, 'S', vrPorc, 0),
             x.r5p  = decode(x.r5, 'S', vrPorc, 0),
             x.r6p  = decode(x.r6, 'S', vrPorc, 0),
             x.r7p  = decode(x.r7, 'S', vrPorc, 0),
             x.r8p  = decode(x.r8, 'S', vrPorc, 0),
             x.r9p  = decode(x.r9, 'S', vrPorc, 0),
             x.r10p = decode(x.r10, 'S', vrPorc, 0)
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      UPDATE T107_RPT_CASOSEXITO X
         SET x.rTp = r1p + r2p + r3p + r4p + r5p + r6p + r7p + r8p + r9p + r10p
       where fec_corte = p_fec_corte
         and periodo = idPeriodoAct;
    
      /* Se calculan los poorcentajes de los logros*/
      UPDATE T107_RPT_CASOSEXITO r
         set r.t1_1 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 1
                 and l.a82codigo = 1)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t1_2 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 1
                 and l.a82codigo = 2)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t1_3 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 1
                 and l.a82codigo = 3)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t2_4 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 2
                 and l.a82codigo = 4)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t2_5 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 2
                 and l.a82codigo = 5)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t3_6 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 3
                 and l.a82codigo = 6)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t4_7 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 4
                 and l.a82codigo = 7)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t4_8 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 4
                 and l.a82codigo = 8)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t5_9 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 5
                 and l.a82codigo = 9)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t5_10 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 5
                 and l.a82codigo = 10)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t6_11 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 6
                 and l.a82codigo = 11)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t6_12 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 6
                 and l.a82codigo = 12)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t7_13 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 7
                 and l.a82codigo = 13)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t7_14 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 7
                 and l.a82codigo = 14)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t8_15 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 8
                 and l.a82codigo = 15)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t8_16 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 8
                 and l.a82codigo = 16)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t8_17 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 8
                 and l.a82codigo = 17)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t8_18 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 8
                 and l.a82codigo = 18)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
      UPDATE T107_RPT_CASOSEXITO r
         set r.t8_19 =
             (select nvl(l.a82porc, 0)
                from t63_casosexito_logros x, t82_logrocasoexito l
               where x.a63_idcasoexito = r.idcasoexito
                 and x.a63_idlogro = l.a82codigo
                 and l.a82taller = 8
                 and l.a82codigo = 19)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
    
      UPDATE T107_RPT_CASOSEXITO r
         set r.t1_1  = nvl(r.t1_1, 0),
             r.t1_2  = nvl(r.t1_2, 0),
             r.t1_3  = nvl(r.t1_3, 0),
             r.t2_4  = nvl(r.t2_4, 0),
             r.t2_5  = nvl(r.t2_5, 0),
             r.t3_6  = nvl(r.t3_6, 0),
             r.t4_7  = nvl(r.t4_7, 0),
             r.t4_8  = nvl(r.t4_8, 0),
             r.t5_9  = nvl(r.t5_9, 0),
             r.t5_10 = nvl(r.t5_10, 0),
             r.t6_11 = nvl(r.t6_11, 0),
             r.t6_12 = nvl(r.t6_12, 0),
             r.t7_13 = nvl(r.t7_13, 0),
             r.t7_14 = nvl(r.t7_14, 0),
             r.t8_15 = nvl(r.t8_15, 0),
             r.t8_16 = nvl(r.t8_16, 0),
             r.t8_17 = nvl(r.t8_17, 0),
             r.t8_18 = nvl(r.t8_18, 0),
             r.t8_19 = nvl(r.t8_19, 0)
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
    
      UPDATE T107_RPT_CASOSEXITO r
         set r.t1_t = t1_1 + t1_2 + t1_3,
             r.t2_t = t2_4 + t2_5,
             r.t3_t = t3_6,
             r.t4_t = t4_7 + t4_8,
             r.t5_t = t5_9 + t5_10,
             r.t6_t = t6_11 + t6_12,
             r.t7_t = t7_13 + t7_14,
             r.t8_t = t8_15 + t8_16 + t8_17 + t8_18 + t8_19
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
    
      UPDATE T107_RPT_CASOSEXITO r
         set r.tlogros_t = r.t1_t + r.t2_t + r.t3_t + r.t4_t + r.t5_t +
                           r.t6_t + r.t7_t + r.t8_t
       where r.periodo = idPeriodoAct
         and r.fec_corte = p_fec_corte;
    
      -- Se eliminan los datos de calculos de dias anteriores.
      delete from T107_RPT_CASOSEXITO t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = 'A'
         and t.fec_corte <> p_fec_corte;
    
      commit;
    
    END LOOP;
  
    select count(0)
      into numReg
      from T107_RPT_CASOSEXITO t
     where /*t.periodo = idPeriodoAct
                                   and */
     t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio' || NOMBRE_PROCEDIMIENTO);
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptCasoExito;

  PROCEDURE Pr_GenerarRptEjemLiderazgo(p_periodo  IN NUMBER,
                                       p_codError OUT NUMBER,
                                       p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptEjemLiderazgo';
    numReg               NUMBER;
    vrPorc               NUMBER := 12.5;
  
    idPeriodoAct number;
    idEncuesta   number;
    p_fec_corte  VARCHAR2(10);
    p_tipo_corte VARCHAR2(10);
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro:' || NOMBRE_PROCEDIMIENTO);
  
    FOR R IN (SELECT * FROM t12_periodos) LOOP
      idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoVigente;
    
      pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                     p_tipo_corte,
                                     p_coderror,
                                     p_msjerror);
    
      if idPeriodoAct <> R.A12CODIGO then
        p_tipo_corte := 'A';
        idPeriodoAct := R.A12CODIGO;
      end if;
    
      -- Por si se reprocesa.
      delete from T108_RPT_EJEMLIDERAZGO t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      insert into T108_RPT_EJEMLIDERAZGO
        (periodo,
         divipola,
         nombre_departamento,
         nombre_municipio,
         nombre_coordinador,
         cedula_facilitador,
         nombre_facilitador,
         sigla_grupo,
         tipo_documento_participante,
         documento_participante,
         codigo_beneficiario,
         primernombre_participante,
         segundonombre_participante,
         primerapellido_participante,
         segundoapellido_participante,
         estado,
         observaciones,
         idmunicipio,
         iddepartamento,
         idfacilitador,
         idcoordinador,
         idcodigogrupo,
         idinscrito,
         IDEJEMPLIDER,
         tipo_corte,
         fec_corte)
        select e.a60periodo,
               A03DANE,
               a02nombre,
               a03nombre,
               (select b.a07primernombre || ' ' || b.a07segundonombre || ' ' ||
                       b.a07primerapellido || ' ' || b.a07segundoapellido
                  from T06_USUARIOS a, T07_PERSONAS b
                 where a.a06codigo = u.a06coordinador
                   and a.a06codigo = b.a07usuario) nomCoordinador,
               a07identificacion,
               (a07primernombre || ' ' || a07segundonombre || ' ' ||
               a07primerapellido || ' ' || a07segundoapellido) nombrefacilitador,
               a26sigla,
               i.a15tipodocumento,
               i.a15documento,
               i.a15codigobeneficiario,
               i.a15primernombre,
               i.a15segundonombre,
               i.a15primerapellido,
               i.a15segundoapellido,
               x.a79nombre estado,
               e.a60observacion,
               a03codigo,
               a02codigo,
               a07usuario,
               a06coordinador,
               I.A15GRUPOFACILITADOR,
               i.a15codigo,
               e.a60codigo,
               p_tipo_corte,
               p_fec_corte
          from t15_inscritos         i,
               T60_LIDERAZGO         e,
               t26_gruposfacilitador g,
               t03_municipios        m,
               t02_departamentos     d,
               T06_USUARIOS          u,
               T07_PERSONAS,
               T79_ESTADOLIDERAZGO   x
        
         where i.a15estado = PK_UTILS.COD_ACTIVO
           and a26codigo = a15grupofacilitador
           and a03codigo = a26ciudad
           and a02codigo = a03departamento
           AND a26facilitador = a06codigo
           AND a06codigo = a07usuario
           and e.a60periodo = idPeriodoAct
           and e.a60inscrito = i.a15codigo
           AND e.a60estado = x.a79codigo;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET (x.genero, x.condicion, X.TIPO_FORMACION, X.NIVEL_FORMACION) =
             (select p.a01genero,
                     p.a01condicion,
                     p.a01tipoformcion,
                     p.a01nivelformacion
                from t01_participantes p
               where x.documento_participante = p.a01documento)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.ASISTENCIAS =
             (SELECT COUNT(1)
                FROM T51_ASISTENCIATALLER
               WHERE a51inscrito = x.idinscrito
                 AND a51Asistencia = 'A'
                 and a51periodo = x.PERIODO)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.ASISTENCIAS = 8
       where x.ASISTENCIAS > 8
         and x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r1 =
             (SELECT t.a61respuesta
                FROM T61_LIDERAZGOCUALIDAD t
               WHERE t.a61liderazgo = x.IDEJEMPLIDER
                 AND t.a61cualidad = 1)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r2 =
             (SELECT t.a61respuesta
                FROM T61_LIDERAZGOCUALIDAD t
               WHERE t.a61liderazgo = x.IDEJEMPLIDER
                 AND t.a61cualidad = 2)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r3 =
             (SELECT t.a61respuesta
                FROM T61_LIDERAZGOCUALIDAD t
               WHERE t.a61liderazgo = x.IDEJEMPLIDER
                 AND t.a61cualidad = 3)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r4 =
             (SELECT t.a61respuesta
                FROM T61_LIDERAZGOCUALIDAD t
               WHERE t.a61liderazgo = x.IDEJEMPLIDER
                 AND t.a61cualidad = 4)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r5 =
             (SELECT t.a61respuesta
                FROM T61_LIDERAZGOCUALIDAD t
               WHERE t.a61liderazgo = x.IDEJEMPLIDER
                 AND t.a61cualidad = 5)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r6 =
             (SELECT t.a61respuesta
                FROM T61_LIDERAZGOCUALIDAD t
               WHERE t.a61liderazgo = x.IDEJEMPLIDER
                 AND t.a61cualidad = 6)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r7 =
             (SELECT t.a61respuesta
                FROM T61_LIDERAZGOCUALIDAD t
               WHERE t.a61liderazgo = x.IDEJEMPLIDER
                 AND t.a61cualidad = 7)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r8 =
             (SELECT t.a61respuesta
                FROM T61_LIDERAZGOCUALIDAD t
               WHERE t.a61liderazgo = x.IDEJEMPLIDER
                 AND t.a61cualidad = 8)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      /*Calculo porcentajes*/
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r1p = vrPorc
       where x.r1 = 'S'
         and x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r2p = vrPorc
       where x.r2 = 'S'
         and x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r3p = vrPorc
       where x.r3 = 'S'
         and x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r4p = vrPorc
       where x.r4 = 'S'
         and x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r5p = vrPorc
       where x.r5 = 'S'
         and x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r6p = vrPorc
       where x.r6 = 'S'
         and fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r7p = vrPorc
       where x.r7 = 'S'
         and x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.r8p = vrPorc
       where x.r8 = 'S'
         and x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T108_RPT_EJEMLIDERAZGO X
         SET x.rTp = r1p + r2p + r3p + r4p + r5p + r6p + r7p + r8p
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      commit;
    
      -- Se eliminan los datos de calculos de dias anteriores.
      delete from T108_RPT_EJEMLIDERAZGO t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = 'A'
         and t.fec_corte <> p_fec_corte;
    
      commit;
    END LOOP;
  
    select count(0)
      into numReg
      from T108_RPT_EJEMLIDERAZGO t
     where /*t.periodo = idPeriodoAct
                                   and */
     t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio' || NOMBRE_PROCEDIMIENTO);
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptEjemLiderazgo;

  PROCEDURE Pr_GenerarRptHistVida(p_periodo  IN NUMBER,
                                  p_codError OUT NUMBER,
                                  p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptHistVida';
    numReg               NUMBER;
  
    idPeriodoAct number;
    idEncuesta   number;
    p_fec_corte  VARCHAR2(10);
    p_tipo_corte VARCHAR2(10);
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro:' || NOMBRE_PROCEDIMIENTO);
  
    FOR R IN (SELECT * FROM t12_periodos) LOOP
      idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoVigente;
    
      pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                     p_tipo_corte,
                                     p_coderror,
                                     p_msjerror);
    
      if idPeriodoAct <> R.A12CODIGO then
        p_tipo_corte := 'A';
        idPeriodoAct := R.A12CODIGO;
      end if;
    
      -- Por si se reprocesa.
      delete from T109_RPT_HISTVIDA t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      insert into T109_RPT_HISTVIDA
        (periodo,
         divipola,
         nombre_departamento,
         nombre_municipio,
         nombre_coordinador,
         cedula_facilitador,
         nombre_facilitador,
         sigla_grupo,
         tipo_documento_participante,
         documento_participante,
         codigo_beneficiario,
         primernombre_participante,
         segundonombre_participante,
         primerapellido_participante,
         segundoapellido_participante,
         estado,
         consideracion,
         circunstancias,
         habilidades,
         leccion,
         idmunicipio,
         iddepartamento,
         idfacilitador,
         idcoordinador,
         idcodigogrupo,
         idinscrito,
         IDHISTVIDA,
         tipo_corte,
         fec_corte)
        select e.a57periodo,
               A03DANE,
               a02nombre,
               a03nombre,
               (select b.a07primernombre || ' ' || b.a07segundonombre || ' ' ||
                       b.a07primerapellido || ' ' || b.a07segundoapellido
                  from T06_USUARIOS a, T07_PERSONAS b
                 where a.a06codigo = u.a06coordinador
                   and a.a06codigo = b.a07usuario) nomCoordinador,
               a07identificacion,
               (a07primernombre || ' ' || a07segundonombre || ' ' ||
               a07primerapellido || ' ' || a07segundoapellido) nombrefacilitador,
               a26sigla,
               i.a15tipodocumento,
               i.a15documento,
               i.a15codigobeneficiario,
               i.a15primernombre,
               i.a15segundonombre,
               i.a15primerapellido,
               i.a15segundoapellido,
               x.a84nombre estado,
               e.a57razondeconsideracion,
               e.a57circunstanciassuperadas,
               e.a57habilidadespracticadas,
               e.a57leccion,
               a03codigo,
               a02codigo,
               a07usuario,
               a06coordinador,
               I.A15GRUPOFACILITADOR,
               i.a15codigo,
               e.a57codigo,
               p_tipo_corte,
               p_fec_corte
          from t15_inscritos          i,
               T57_HISTORIAVIDA       e,
               t26_gruposfacilitador  g,
               t03_municipios         m,
               t02_departamentos      d,
               T06_USUARIOS           u,
               T07_PERSONAS,
               T84_ESTADOHISTORIAVIDA x
        
         where i.a15estado = PK_UTILS.COD_ACTIVO
           and a26codigo = a15grupofacilitador
           and a03codigo = a26ciudad
           and a02codigo = a03departamento
           AND a26facilitador = a06codigo
           AND a06codigo = a07usuario
           and g.a26periodo = idPeriodoAct
           and e.a57inscrito = i.a15codigo
           AND e.a57estado = x.a84codigo;
    
      UPDATE T109_RPT_HISTVIDA X
         SET (x.genero, x.condicion, X.TIPO_FORMACION, X.NIVEL_FORMACION) =
             (select p.a01genero,
                     p.a01condicion,
                     p.a01tipoformcion,
                     p.a01nivelformacion
                from t01_participantes p
               where x.documento_participante = p.a01documento)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T109_RPT_HISTVIDA X
         SET x.ASISTENCIAS =
             (SELECT COUNT(1)
                FROM T51_ASISTENCIATALLER
               WHERE a51inscrito = x.idinscrito
                 AND a51Asistencia = 'A'
                 and a51periodo = x.PERIODO)
       where x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T109_RPT_HISTVIDA X
         SET x.ASISTENCIAS = 8
       where x.ASISTENCIAS > 8
         AND x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
      /*Tipos de historias*/
    
      UPDATE T109_RPT_HISTVIDA X
         SET x.hvtipo1 = 'S'
       where exists (select 1
                from t57_historiavida h
               where h.a57tipo = 1
                 and x.periodo = h.a57periodo
                 and x.idinscrito = h.a57inscrito)
         AND x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T109_RPT_HISTVIDA X
         SET x.hvtipo2 = 'S'
       where exists (select 1
                from t57_historiavida h
               where h.a57tipo = 2
                 and x.periodo = h.a57periodo
                 and x.idinscrito = h.a57inscrito)
         AND x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T109_RPT_HISTVIDA X
         SET x.hvtipo3 = 'S'
       where exists (select 1
                from t57_historiavida h
               where h.a57tipo = 3
                 and x.periodo = h.a57periodo
                 and x.idinscrito = h.a57inscrito)
         AND x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T109_RPT_HISTVIDA X
         SET x.hvtipo4 = 'S'
       where exists (select 1
                from t57_historiavida h
               where h.a57tipo = 4
                 and x.periodo = h.a57periodo
                 and x.idinscrito = h.a57inscrito)
         AND x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      UPDATE T109_RPT_HISTVIDA X
         SET x.hvtipo5 = 'S'
       where exists (select 1
                from t57_historiavida h
               where h.a57tipo = 5
                 and x.periodo = h.a57periodo
                 and x.idinscrito = h.a57inscrito)
         AND x.periodo = idPeriodoAct
         and x.tipo_corte = p_tipo_corte
         and x.fec_corte = p_fec_corte;
    
      commit;
    
      -- Se eliminan los datos de calculos de dias anteriores.
      delete from T109_RPT_HISTVIDA t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = 'A'
         and t.fec_corte <> p_fec_corte;
    
      commit;
    
    END LOOP;
  
    select count(0)
      into numReg
      from T109_RPT_HISTVIDA t
     where /*t.periodo = idPeriodoAct
                                   and */
     t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio' || NOMBRE_PROCEDIMIENTO);
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptHistVida;

  PROCEDURE Pr_GenerarRptTrazabilidadP1(p_codError OUT NUMBER,
                                        p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptTrazabilidad';
    numReg               NUMBER;
  
    idPeriodoAct number;
    idGrupo      number;
    idTaller     number;
    fechaTaller  varchar2(10);
    p_fec_corte  varchar2(10);
    p_tipo_corte varchar2(10);
  
    asistencia number;
  
    cursor curTaller is
      select * from t17_talleres order by a17Orden;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_GenerarRptTrazabilidad  ');
  
    idPeriodoAct := 1;
    p_fec_corte  := '2016-05-31';
    p_tipo_corte := 'P';
  
    -- Por si se reprocesa.
    delete from t101_rpt_trazabilidad t
     where t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
  
    insert into t101_rpt_trazabilidad
      (periodo,
       idinscrito,
       nomdepartamento,
       nommunicipio,
       tipodocumento,
       documento_inscrito,
       codigo_beneficiario,
       primernombre,
       segundonombre,
       primerapellido,
       segundoapellido,
       email,
       telefono,
       movil,
       movilalt,
       genero,
       condicion,
       estado,
       siglagrupo,
       GRUPOFACILITADOR,
       IDFACILITADOR,
       IDDEPARTAMENTO,
       IDMUNICIPIO,
       TIPO_CORTE,
       FEC_CORTE,
       divipola,
       FECHA_EXPEDICION,
       IDcondicionespecial,
       fecultinscrip,
       encuesta_inicial)
      SELECT f.a26periodo,
             a15Codigo               idinscrito,
             a02nombre               nomdepartamento,
             a03nombre               nommunicipio,
             t.a04tipodocumento,
             i.a15documento,
             i.a15codigobeneficiario,
             a15primernombre         PrimerNombre,
             a15segundonombre        SegundoNombre,
             a15primerapellido       PrimerApellido,
             a15segundoapellido      SegundoApellido,
             a15email                Email,
             a15telefono             Telefono,
             a15movil                Movil,
             a15movilalt             MovilAlt,
             i.a15genero,
             i.a15condicion,
             A15ESTADO               Estado,
             a26Sigla,
             a26codigo,
             f.a26facilitador,
             a02codigo,
             a03codigo,
             p_tipo_corte,
             p_fec_corte,
             A03DANE,
             i.a15fechacertificacion,
             I.A15CONDICIONESPECIAL,
             i.a15fechacreacion,
             i.a15fechacreacion
      
        FROM T26_GRUPOSFACILITADOR f,
             T02_DEPARTAMENTOS     d,
             T03_MUNICIPIOS        m,
             T15_INSCRITOS         i,
             T04_TIPOSDOCUMENTO    t
      
       WHERE a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a15grupofacilitador = a26codigo
         AND a15tipodocumento = a04tipodocumento
         AND a26periodo = idPeriodoAct;
  
    update t101_rpt_trazabilidad t
       set FECHA_EXPEDICION = null
     WHERE FECHA_EXPEDICION >= to_date('20160601', 'yyyymmdd')
       and t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
  
    update t101_rpt_trazabilidad t
       set (IDCOORDINADOR,
            NOMBRECOORDINADOR,
            CC_FACILITADOR,
            NOMBREFACILITADOR) =
           (select u.a06coordinador,
                   (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
                   p2.a07primerapellido || ' ' || p2.a07segundoapellido) nombreCoordinador,
                   p1.a07identificacion cc_facilitador,
                   (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
                   p1.a07primerapellido || ' ' || p1.a07segundoapellido) nombrefacilitador
              from T06_USUARIOS u, T07_PERSONAS p1, T07_PERSONAS p2
             where a06codigo = p1.a07usuario
               AND a06coordinador = p2.a07usuario
               and t.idfacilitador = p1.a07usuario)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
  
    update t101_rpt_trazabilidad t
       set IDCOORDINADOR     = 1005,
           NOMBRECOORDINADOR = 'DAGOBERTO  RESTREPO ROMERO'
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte
       AND IDCOORDINADOR = 2160; -- 'OLFARAIL  GARZON RIVERA'
    /* -- Por fechas en texto que no se puden convertir, se debe hacer la actualizacion por columna independiente
        update t101_rpt_trazabilidad t
           set (MUNICIPIOESTUDIO,
                TIPOFORMACION,
                NIVELFORMACION,
                FICHASNIES,
                FECHAULTMES,
                FECHAFINSEMESTRESCURSADOS,
                FINFECHAETAPAPRACTICA,
                CODIGOCONVENIO,
                SNIES_IES,
                PROGRAMAESTADO,
                INSTITUCION) =
               (select Substr(p.a01municipioestudio, 1, 100),
                       Substr(p.A01TIPOFORMACION, 1, 100),
                       Substr(p.a01nivelformacion, 1, 100),
                       To_number(p.a01fichasnies),
                       NULL, --TO_DATE(p.A01FECHAULTMES,'YYYY-MM-DD'),
                       NULL, --TO_DATE(p.A01FECHAFINSEMESTRESCURSADOS,'YYYY-MM-DD'),
                       NULL, --TO_DATE(p.a01finfechaetapapractica,'YYYY-MM-DD'),
                       Substr(p.a01codigoconvenio, 1, 50),
                       To_number(p.a01snies_ies),
                       Substr(p.a01programaestado, 1, 20),
                       Substr(p.a01institucion, 1, 200)
                  from mig_t01dbo_participantes p
                 where p.a01documento = t.documento_inscrito)
         WHERE t.periodo = idPeriodoAct
           and t.tipo_corte = p_tipo_corte
           and t.fec_corte = p_fec_corte;
    */
  
    dbms_output.put_line('001');
    update t101_rpt_trazabilidad t
       set (MUNICIPIOESTUDIO) =
           (select Substr(p.a01municipioestudio, 1, 100)
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('002');
    update t101_rpt_trazabilidad t
       set (TIPOFORMACION) =
           (select Substr(p.A01TIPOFORMACION, 1, 100)
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('003');
    update t101_rpt_trazabilidad t
       set (NIVELFORMACION) =
           (select Substr(p.a01nivelformacion, 1, 100)
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('004');
    update t101_rpt_trazabilidad t
       set (FICHASNIES) =
           (select To_number(p.a01fichasnies)
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('005');
    update t101_rpt_trazabilidad t
       set (FECHAULTMES) =
           (select NULL /*TO_DATE(p.A01FECHAULTMES,'YYYY-MM-DD')*/
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('006');
    update t101_rpt_trazabilidad t
       set (FECHAFINSEMESTRESCURSADOS) =
           (select NULL /*TO_DATE(p.A01FECHAFINSEMESTRESCURSADOS,'YYYY-MM-DD')*/
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('007');
    update t101_rpt_trazabilidad t
       set (FINFECHAETAPAPRACTICA) =
           (select NULL /*TO_DATE(p.a01finfechaetapapractica,'YYYY-MM-DD')*/
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('008');
    update t101_rpt_trazabilidad t
       set (CODIGOCONVENIO) =
           (select Substr(p.a01codigoconvenio, 1, 50)
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('009');
    update t101_rpt_trazabilidad t
       set (SNIES_IES) =
           (select To_number(p.a01snies_ies)
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('010');
    update t101_rpt_trazabilidad t
       set (PROGRAMAESTADO) =
           (select Substr(p.a01programaestado, 1, 20)
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('011');
    update t101_rpt_trazabilidad t
       set (INSTITUCION) =
           (select Substr(p.a01institucion, 1, 200)
              from mig_t01dbo_participantes p
             where p.a01documento = t.documento_inscrito)
     WHERE t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
    dbms_output.put_line('012');
  
    /*
        update t101_rpt_trazabilidad t
           set (CONDICION_ESPECIAL) =
               (select E.A87CONDICION
                  from t87_condicionespecial E
                 where E.A87CODIGO = t.idcondicionespecial)
         WHERE t.periodo = idPeriodoAct
           and t.tipo_corte = p_tipo_corte
           and t.fec_corte = p_fec_corte;
    */
    /*
        update t101_rpt_trazabilidad t
           set (t.FECULTINSCRIP) =
               (select max(g.a53fechacreacion)
                  from t53_grupoinscrito g
                 where g.a53inscrito = t.idinscrito)
         WHERE fec_corte = p_fec_corte;
    */
    -- Grupo de inscripcion
  
    update t101_rpt_trazabilidad t
       set (t.GRUPOINSCRIPCION) =
           
           (select s.a26sigla
              from t26_gruposfacilitador s,
                   t53_grupoinscrito u,
                   (select min(g.a53fechacreacion) a53fechacreacion,
                           g.a53periodo,
                           g.a53inscrito
                      from t53_grupoinscrito g
                     group by g.a53periodo, g.a53inscrito) x
             where x.a53fechacreacion = u.a53fechacreacion
               and x.a53periodo = u.a53periodo
               and x.a53inscrito = u.a53inscrito
               and u.a53grupofacilitador = s.a26codigo
               and u.a53inscrito = t.idinscrito
               and u.a53periodo = t.periodo)
    
     WHERE fec_corte = p_fec_corte;
  
    dbms_output.put_line('013');
  
    -- encuesta inicial
    /*
        update t101_rpt_trazabilidad t
           set (t.encuesta_inicial) =
               (select min(a16fechacreacion)
                  from t16_inscritoencuesta e
                 where a16inscrito = t.idinscrito
                   and a16encuesta IN
                       (select a50codigo
                          from t50_encuesta
                         where a50tipoencuesta = 'I')
    
                )
         WHERE fec_corte = p_fec_corte;
    */
    -- encuesta satisfaccion
    update t101_rpt_trazabilidad t
       set (t.encuesta_satisfaccion) =
           (select min(a16fechacreacion)
              from t16_inscritoencuesta e
             where a16inscrito = t.idinscrito
               and a16encuesta =
                   (select a50codigo
                      from t50_encuesta
                     where a50periodo = idPeriodoAct
                       and a50tipoencuesta = 'S')
            
            )
     WHERE EXISTS (SELECT 1
              from t16_inscritoencuesta e
             where a16inscrito = t.idinscrito
               and t.periodo = idPeriodoAct
               and a16encuesta =
                   (select a50codigo
                      from t50_encuesta
                     where a50periodo = idPeriodoAct
                       and a50tipoencuesta = 'S'))
       and fec_corte = p_fec_corte;
  
    dbms_output.put_line('014');
  
    -- encuesta final
    update t101_rpt_trazabilidad t
       set (t.encuesta_final) =
           (select min(a16fechacreacion)
              from t16_inscritoencuesta e
             where a16inscrito = t.idinscrito
               and a16fechacreacion < to_date('2016-06-01', 'yyyy-mm-dd')
               and a16encuesta =
                   (select a50codigo
                      from t50_encuesta
                     where a50periodo = idPeriodoAct
                       and a50tipoencuesta = 'F')
            
            )
     WHERE EXISTS (SELECT 1
              from t16_inscritoencuesta e
             where a16inscrito = t.idinscrito
               and t.periodo = idPeriodoAct
               and a16encuesta =
                   (select a50codigo
                      from t50_encuesta
                     where a50periodo = idPeriodoAct
                       and a50tipoencuesta = 'F'))
       and fec_corte = p_fec_corte;
  
    dbms_output.put_line('015');
  
    for regInscrito in (select * from t101_rpt_trazabilidad) loop
    
      asistencia := 0;
    
      FOR regTaller IN curTaller LOOP
      
        -- buscar si el estudiante asistio al taller
        select count(*)
          into numReg
          from t51_asistenciataller
         where a51inscrito = regInscrito.Idinscrito
           and a51tallerrealizado = regTaller.A17codigo
           and a51asistencia = 'A';
      
        if numReg > 0 then
        
          -- Obtener el grupo al que asistio
          select max(a51grupofacilitador)
            into idGrupo
            from t51_asistenciataller
           where a51inscrito = regInscrito.Idinscrito
             and a51tallerrealizado = regTaller.A17codigo
             and a51asistencia = 'A';
        
          -- Obtener la fecha de realizacion del taller
          begin
          
            select a21fechataller
              into fechaTaller
              from t21_realizaciontaller
             where a21grupo = idGrupo
               and a21taller = regTaller.A17codigo
               AND A21PERIODO = idPeriodoAct;
          EXCEPTION
            WHEN OTHERS THEN
              fechaTaller := null;
          end;
        
          if (not fechaTaller is null) then
            asistencia := asistencia + 1;
          end if;
        
          if (regTaller.A17codigo = 1) then
            update t101_rpt_trazabilidad t
               set t.taller1 = fechaTaller
             where t.idinscrito = regInscrito.Idinscrito
               and t.periodo = idPeriodoAct
               and fec_corte = p_fec_corte;
          end if;
        
          if (regTaller.A17codigo = 2) then
            update t101_rpt_trazabilidad t
               set t.taller2 = fechaTaller
             where t.idinscrito = regInscrito.Idinscrito
               and t.periodo = idPeriodoAct
               and fec_corte = p_fec_corte;
          end if;
        
          if (regTaller.A17codigo = 3) then
            update t101_rpt_trazabilidad t
               set t.taller3 = fechaTaller
             where t.idinscrito = regInscrito.Idinscrito
               and t.periodo = idPeriodoAct
               and fec_corte = p_fec_corte;
          end if;
        
          if (regTaller.A17codigo = 4) then
            update t101_rpt_trazabilidad t
               set t.taller4 = fechaTaller
             where t.idinscrito = regInscrito.Idinscrito
               and t.periodo = idPeriodoAct
               and fec_corte = p_fec_corte;
          end if;
        
          if (regTaller.A17codigo = 5) then
            update t101_rpt_trazabilidad t
               set t.taller5 = fechaTaller
             where t.idinscrito = regInscrito.Idinscrito
               and t.periodo = idPeriodoAct
               and fec_corte = p_fec_corte;
          end if;
        
          if (regTaller.A17codigo = 6) then
            update t101_rpt_trazabilidad t
               set t.taller6 = fechaTaller
             where t.idinscrito = regInscrito.Idinscrito
               and t.periodo = idPeriodoAct
               and fec_corte = p_fec_corte;
          end if;
        
          if (regTaller.A17codigo = 7) then
            update t101_rpt_trazabilidad t
               set t.taller7 = fechaTaller
             where t.idinscrito = regInscrito.Idinscrito
               and t.periodo = idPeriodoAct
               and fec_corte = p_fec_corte;
          end if;
        
          if (regTaller.A17codigo = 8) then
            update t101_rpt_trazabilidad t
               set t.taller8 = fechaTaller
             where t.idinscrito = regInscrito.Idinscrito
               and t.periodo = idPeriodoAct
               and fec_corte = p_fec_corte;
          end if;
        
        end if;
      
        update t101_rpt_trazabilidad t
           set t.porcasistencia = asistencia / 8
         where t.idinscrito = regInscrito.Idinscrito
           and t.periodo = idPeriodoAct
           and fec_corte = p_fec_corte;
      
        update t101_rpt_trazabilidad t
           set t.certifica = 'S'
         where t.idinscrito = regInscrito.Idinscrito
           and t.periodo = idPeriodoAct
           and t.porcasistencia >= (6 / 8)
           and fec_corte = p_fec_corte;
      
      end loop;
    
    end loop;
    dbms_output.put_line('016');
  
    -- Sistematizacion de experiencias (Vida , Exito, Liderazgo)
    update t101_rpt_trazabilidad t
       set t.vida = 'S'
     where fec_corte = p_fec_corte
       AND T.PERIODO = idPeriodoAct
       AND EXISTS (SELECT 'S'
              from t57_historiavida v
             where v.a57inscrito = t.idinscrito
               and v.a57periodo = t.periodo);
  
    dbms_output.put_line('017');
  
    update t101_rpt_trazabilidad t
       set t.Exito = 'S'
     where fec_corte = p_fec_corte
       AND T.PERIODO = idPeriodoAct
       AND EXISTS (SELECT 'S'
              from T58_CASOEXITO e
             where e.a58inscrito = t.idinscrito
               and e.a58periodo = t.periodo);
  
    dbms_output.put_line('018');
  
    update t101_rpt_trazabilidad t
       set t.liderazgo = 'S'
     where fec_corte = p_fec_corte
       AND T.PERIODO = idPeriodoAct
       AND EXISTS (SELECT 'S'
              from t60_liderazgo l
             where l.a60inscrito = t.idinscrito
               and l.a60periodo = t.periodo);
  
    dbms_output.put_line('019');
  
    -- Como se entero
    /*
        update t101_rpt_trazabilidad x
           set x.comoseentero =
               (select r.a14respuesta
                  from t16_inscritoencuesta e, t14_encuestarespuestas r
                 where e.a16encuesta = 4
                   and e.a16pregunta = (select t.a13codigo
                                          from T13_ENCUESTAPREGUNTAS t
                                         where t.a13encuesta = 4
                                           and t.a13numero = 21)
                   and r.a14codigo = e.a16respuesta
                   and e.a16inscrito = x.idinscrito)
         where fec_corte = p_fec_corte;
    
        update t101_rpt_trazabilidad x
           set x.comoseentero =
               (select r.a14respuesta
                  from t16_inscritoencuesta e, t14_encuestarespuestas r
                 where e.a16encuesta = 7
                   and e.a16pregunta = (select t.a13codigo
                                          from T13_ENCUESTAPREGUNTAS t
                                         where t.a13encuesta = 7
                                           and t.a13numero = 16)
                   and r.a14codigo = e.a16respuesta
                   and e.a16inscrito = x.idinscrito)
         where comoseentero IS NULL
           AND fec_corte = p_fec_corte;
        commit;
    */
    -- reinscrito
    /*
        update t101_rpt_trazabilidad x
           set x.reinscrito = 'S'
         where X.IDINSCRITO IN (select G.A53INSCRITO
                                  from t53_grupoinscrito g
                                 WHERE G.A53PERIODO <> idPeriodoAct
                                --          AND G.A53ESTADO = 'A'
                                )
    
           AND fec_corte = p_fec_corte;
    */
    -- Se eliminan los datos de calculos de dias anteriores.
    delete from t101_rpt_trazabilidad t
     where t.periodo = idPeriodoAct
       and t.tipo_corte = 'A'
       and t.fec_corte <> p_fec_corte;
    dbms_output.put_line('020');
  
    commit;
  
    select count(0)
      into numReg
      from t101_rpt_trazabilidad t
     where t.periodo = idPeriodoAct
       and t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio a Pr_GenerarRptTrazabilidad ok  ');
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      -- p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptTrazabilidadP1;

  PROCEDURE Pr_GenerarRptGestionEspacios(p_codError OUT NUMBER,
                                         p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptGestionEspacios';
    numReg               NUMBER;
  
    idPeriodoAct number;
    idGrupo      number;
    idTaller     number;
    fechaTaller  VARCHAR2(10);
    p_fec_corte  VARCHAR2(10);
    p_tipo_corte VARCHAR2(10);
  
    asistencia number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro ' || NOMBRE_PROCEDIMIENTO);
  
    --    idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoVigente;
    idPeriodoAct := PK_UTILS.Fn_ObtenerPeriodoInscripcion;
  
    pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                   p_tipo_corte,
                                   p_coderror,
                                   p_msjerror);
  
    -- Por si se reprocesa.
    delete from T112_RPT_gestespacios t
     where t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
  
    insert into T112_RPT_gestespacios
      (periodo,
       idgrupofacilitador,
       divipola,
       nomdepartamento,
       nommunicipio,
       nomcoordinador,
       nombrefacilitador,
       idgrupo,
       dia,
       horario,
       LUGAR,
       DIRECCION,
       SIGLA,
       iddepartamento,
       idmunicipio,
       idfacilitador,
       idcoordinador,
       TIPO_CORTE,
       FEC_CORTE,
       ESTADO,
       FEC_MODIFICA)
      SELECT a26periodo periodo,
             a26codigo idGrupoFacilitador,
             a03dane Divipola,
             a02nombre nomdepartamento,
             a03nombre nommunicipio,
             (select b.a07primernombre || ' ' || b.a07segundonombre || ' ' ||
                     b.a07primerapellido || ' ' || b.a07segundoapellido
                from T06_USUARIOS a, T07_PERSONAS b
               where a.a06codigo = u.a06coordinador
                 and a.a06codigo = b.a07usuario) nomCoordinador,
             (a07primernombre || ' ' || a07segundonombre || ' ' ||
             a07primerapellido || ' ' || a07segundoapellido) nombrefacilitador,
             a26grupo idgrupo,
             a23nombre dia,
             a24horario horario,
             a26lugar,
             a26direccion,
             a26sigla,
             a02codigo IdDepartamento,
             a03codigo IdMunicipio,
             a07Usuario IdFacilitador,
             a06Coordinador IdCoordinador,
             p_tipo_corte,
             p_fec_corte,
             A26ESTADO,
             A26FECHAMODIFICACION
        FROM T26_GRUPOSFACILITADOR,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS u,
             T07_PERSONAS,
             T12_PERIODOS
       WHERE a26estado = a90codigo
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = a07usuario
         AND a26periodo = a12codigo
         and a06estado = 'A'
         and a26periodo = idPeriodoAct;
  
    insert into T112_RPT_gestespacios
      (periodo,
       idgrupofacilitador,
       divipola,
       nomdepartamento,
       nommunicipio,
       nomcoordinador,
       nombrefacilitador,
       idgrupo,
       dia,
       horario,
       LUGAR,
       DIRECCION,
       SIGLA,
       iddepartamento,
       idmunicipio,
       idfacilitador,
       idcoordinador,
       TIPO_CORTE,
       FEC_CORTE,
       ESTADO,
       FEC_MODIFICA)
      SELECT a26periodo periodo,
             a26codigo idGrupoFacilitador,
             a03dane Divipola,
             a02nombre nomdepartamento,
             a03nombre nommunicipio,
             (select b.a07primernombre || ' ' || b.a07segundonombre || ' ' ||
                     b.a07primerapellido || ' ' || b.a07segundoapellido
                from T06_USUARIOS a, T07_PERSONAS b
               where a.a06codigo = u.a06coordinador
                 and a.a06codigo = b.a07usuario) nomCoordinador,
             (a07primernombre || ' ' || a07segundonombre || ' ' ||
             a07primerapellido || ' ' || a07segundoapellido) nombrefacilitador,
             a26grupo idgrupo,
             a23nombre dia,
             a24horario horario,
             a26lugar,
             a26direccion,
             a26sigla,
             a02codigo IdDepartamento,
             a03codigo IdMunicipio,
             a07Usuario IdFacilitador,
             a06Coordinador IdCoordinador,
             p_tipo_corte,
             p_fec_corte,
             A26ESTADO,
             A26fecha_Audit
        FROM T26_GRUPOSFACILITADOR_aud,
             T90_ESTADOSESPACIOFISICO,
             T02_DEPARTAMENTOS,
             T03_MUNICIPIOS,
             T23_DIAS,
             T24_HORARIOS,
             T25_GRUPOS,
             T06_USUARIOS u,
             T07_PERSONAS,
             T12_PERIODOS
       WHERE a26estado = a90codigo
         AND a26ciudad = a03codigo
         AND a03departamento = a02codigo
         AND a26dia = a23codigo
         AND a26horario = a24codigo
         AND a26grupo = a25codigo
         AND a26facilitador = a06codigo
         AND a06codigo = a07usuario
         AND a26periodo = a12codigo
         and a06estado = 'A'
         and a26periodo = idPeriodoAct;
  
    -- Se eliminan los datos de calculos de dias anteriores.
    delete from T112_RPT_gestespacios t
     where t.periodo = idPeriodoAct
       and t.tipo_corte = 'A'
       and t.fec_corte <> p_fec_corte;
  
    commit;
  
    select count(0)
      into numReg
      from T112_RPT_gestespacios t
     where t.periodo = idPeriodoAct
       and t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio ' || NOMBRE_PROCEDIMIENTO || ' ok  ');
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      -- p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptGestionEspacios;

  /*Actualiza los periodos pasados en la encuesta final y la fecha de generacion del certificado*/
  PROCEDURE Pr_ActPeriodosAnt(p_codError OUT NUMBER,
                              p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ActPeriodosAnt';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro:' || NOMBRE_PROCEDIMIENTO);
  
    -- Por si se reprocesa.
    update t101_rpt_trazabilidad x
       set x.encuesta_final_act = null, x.fecha_expedicion_act = null;
  
    -- encuesta final
    update t101_rpt_trazabilidad t
       set (t.encuesta_final_act) =
           (select min(a16fechacreacion)
              from t16_inscritoencuesta e
             where a16inscrito = t.idinscrito
               and a16encuesta in
                   (select a50codigo
                      from t50_encuesta
                     where a50tipoencuesta = 'F')
            
            )
     WHERE t.tipo_corte = 'P'
       and t.certifica = 'S';
  
    -- Actualiza el periodo actual
    update t101_rpt_trazabilidad t
       set t.encuesta_final_act = t.encuesta_final
     WHERE T.FEC_CORTE =
           (SELECT MAX(X.FEC_CORTE) FROM t101_rpt_trazabilidad X);
  
    -- fecha de certificacion.
    update t101_rpt_trazabilidad t
       set (t.fecha_expedicion_act) =
           (select i.a15fechacertificacion
              from T15_INSCRITOS i
             where i.a15codigo = t.idinscrito)
     WHERE t.encuesta_final_act is not null
       and t.tipo_corte = 'P';
  
    -- Actualiza el periodo actual
    update t101_rpt_trazabilidad t
       set t.fecha_expedicion_act = t.fecha_expedicion
     WHERE T.FEC_CORTE =
           (SELECT MAX(X.FEC_CORTE) FROM t101_rpt_trazabilidad X);
    -- Actualiza la columna Validos, que determina registros duplicados o no autorizados por PS
  
    -- Validos
    update t101_rpt_trazabilidad t
       set valido =
           (select decode(t.periodo || '-' || t.idinscrito,
                          min(x.periodo) || '-' || x.idinscrito,
                          'VALIDO',
                          'DUPLICADO')
              from t101_rpt_trazabilidad x
             where x.idinscrito = t.idinscrito
               and x.porcasistencia >= 6 / 8
               and (x.tipo_corte = 'P' or
                   x.fec_corte =
                   (select max(m.fec_corte) from t101_rpt_trazabilidad m))
             group by x.idinscrito)
     where t.tipo_corte = 'P'
        or t.fec_corte =
           (select max(m.fec_corte) from t101_rpt_trazabilidad m);
  
    update t101_rpt_trazabilidad t
       set valido = 'ASISTENCIA < 75%'
     where (t.tipo_corte = 'P' or
           t.fec_corte =
           (select max(m.fec_corte) from t101_rpt_trazabilidad m))
       AND VALIDO IS NULL;
  
    /* NO VALIDADOS POR PS*/
    update t101_rpt_trazabilidad t
       set valido = 'NO VALIDO'
     where (t.tipo_corte = 'P' or
           t.fec_corte =
           (select max(m.fec_corte) from t101_rpt_trazabilidad m))
       AND EXISTS (SELECT 1
              FROM T15_INSCRITOS I
             WHERE I.A15CODIGO = T.IDINSCRITO
               and i.a15estado = 'N');
  
    commit;
  
    select count(0)
      into numReg
      from t101_rpt_trazabilidad t
     where t.tipo_corte = 'P'
        or T.FEC_CORTE =
           (SELECT MAX(X.FEC_CORTE) FROM t101_rpt_trazabilidad X);
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio' || NOMBRE_PROCEDIMIENTO);
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := SQLERRM;
    
  END Pr_ActPeriodosAnt;

  PROCEDURE Pr_GenerarRptTrazabilidadOLD(p_codError OUT NUMBER,
                                         p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptTrazabilidad';
    numReg               NUMBER;
  
    idPeriodoAct number;
    idGrupo      number;
    idTaller     number;
    fechaTaller  varchar2(10);
    p_fec_corte  varchar2(10);
    p_tipo_corte varchar2(10);
  
    asistencia number;
  
    cursor curTaller is
      select * from t17_talleres order by a17Orden;
  
    CURSOR curPeriodo IS
      select * from t12_periodos p where p.a12estado in ('A', 'P');
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_GenerarRptTrazabilidad  ');
  
    pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                   p_tipo_corte,
                                   p_coderror,
                                   p_msjerror);
  
    FOR recPeriodo IN curPeriodo LOOP
      -- Se recorren los Periodos Activos y en Inscripcion
      idPeriodoAct := recPeriodo.A12codigo;
    
      -- Por si se reprocesa.
      delete from t101_rpt_trazabilidad t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      insert into t101_rpt_trazabilidad
        (periodo,
         idinscrito,
         nomdepartamento,
         nommunicipio,
         nombrecoordinador,
         cc_facilitador,
         nombrefacilitador,
         tipodocumento,
         documento_inscrito,
         codigo_beneficiario,
         primernombre,
         segundonombre,
         primerapellido,
         segundoapellido,
         email,
         telefono,
         movil,
         movilalt,
         genero,
         condicion,
         municipioestudio,
         tipoformacion,
         nivelformacion,
         fichasnies,
         fechaultmes,
         fechafinsemestrescursados,
         finfechaetapapractica,
         codigoconvenio,
         snies_ies,
         programaestado,
         institucion,
         encuesta_inicial,
         encuesta_satisfaccion,
         encuesta_final,
         taller1,
         taller2,
         taller3,
         taller4,
         taller5,
         taller6,
         taller7,
         taller8,
         porcasistencia,
         certifica,
         fecha_expedicion,
         estado,
         vida,
         liderazgo,
         exito,
         siglagrupo,
         GRUPOFACILITADOR,
         IDFACILITADOR,
         IDCOORDINADOR,
         IDDEPARTAMENTO,
         IDMUNICIPIO,
         TIPO_CORTE,
         FEC_CORTE,
         divipola,
         CONDICION_ESPECIAL)
        SELECT a26periodo periodo,
               a15Codigo idinscrito,
               a02nombre nomdepartamento,
               a03nombre nommunicipio,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) nombreCoordinador,
               p1.a07identificacion cc_facilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) nombrefacilitador,
               a01tipodocumento,
               A01DOCUMENTO documento_inscrito,
               A01CODIGOBENEFICIARIO codigo_beneficiario,
               a15primernombre PrimerNombre,
               a15segundonombre SegundoNombre,
               a15primerapellido PrimerApellido,
               a15segundoapellido SegundoApellido,
               a15email Email,
               a15telefono Telefono,
               a15movil Movil,
               a15movilalt MovilAlt,
               Substr(A01GENERO, 1, 1) Genero,
               A01CONDICION Condicion,
               a01municipioestudio MunicipioEstudio,
               a01tipoformcion TipoFormacion,
               a01nivelformacion NivelFormacion,
               a01fichasnies FichaSNIES,
               a01ultimomes FechaUltMes,
               a01finsemestre FechaFinSemestresCursados,
               a01finetapapractica FinFechaEtapaPractica,
               a01noconvenio CodigoConvenio,
               a01sniesies SNIES_IES,
               /*
               decode(a15Estado,
                      'A',
                      'INSCRITO',
                      'S',
                      'SUSPENDIDO',
                      'NO DEFINIDO') ProgramaEstado,
                */
               A01ESTADOPERSONA ProgramaEstado,
               A01NOMBREINSTITUCION Institucion,
               NULL Encuesta_Inicial,
               NULL Encuesta_Satisfaccion,
               NULL Encuesta_Final,
               NULL Taller1,
               NULL Taller2,
               NULL Taller3,
               NULL Taller4,
               NULL Taller5,
               NULL Taller6,
               NULL Taller7,
               NULL Taller8,
               0 porcAsistencia,
               'N' certifica,
               null Fecha_Expedicion,
               A15ESTADO Estado,
               'N' Vida,
               'N' Liderazgo,
               'N' Exito,
               a26Sigla,
               a26codigo,
               p1.a07usuario,
               p2.a07usuario,
               a02codigo,
               a03codigo,
               p_tipo_corte,
               p_fec_corte,
               A03DANE,
               ce.a87condicion -- CONDICION ESPECIAL
        
          FROM T26_GRUPOSFACILITADOR,
               T90_ESTADOSESPACIOFISICO,
               T02_DEPARTAMENTOS,
               T03_MUNICIPIOS,
               T23_DIAS,
               T24_HORARIOS,
               T25_GRUPOS,
               T06_USUARIOS,
               T07_PERSONAS             p1,
               T07_PERSONAS             p2,
               T15_INSCRITOS,
               T04_TIPOSDOCUMENTO,
               T87_CONDICIONESPECIAL    ce,
               t01_participantes
        
         WHERE a26estado = a90codigo
           AND a26ciudad = a03codigo
           AND a03departamento = a02codigo
           AND a26dia = a23codigo
           AND a26horario = a24codigo
           AND a26grupo = a25codigo
           AND a26facilitador = a06codigo
           AND a06codigo = p1.a07usuario
           AND a06coordinador = p2.a07usuario
           AND a15grupofacilitador = a26codigo
           AND a15tipodocumento = a04tipodocumento
           AND a15condicionespecial = a87codigo
           AND a15documento = a01documento
           AND a26periodo = idPeriodoAct;
      commit;
      /*Actualziacion campos SIJA*/
    
      update t101_rpt_trazabilidad t
         set (t.municipioestudio) =
             (select x.a01municipioestudio
                from MIG_T01DBO_PARTICIPANTES x
               where t.codigo_beneficiario = x.a01codigobeneficiario)
       WHERE municipioestudio IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set (t.tipoformacion) =
             (select x.a01tipoformacion
                from MIG_T01DBO_PARTICIPANTES x
               where t.codigo_beneficiario = x.a01codigobeneficiario)
       WHERE tipoformacion IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      /* -- las fechas de sija no son consistentes, tiene el dia en 00
          update t101_rpt_trazabilidad t
             set (t.fechaultmes) =
                 (select to_date(x.a01fechaultmes, 'yyyy-mm-dd')
                    from MIG_T01DBO_PARTICIPANTES x
                   where t.codigo_beneficiario = x.a01codigobeneficiario)
           WHERE fechaultmes IS NULL
             AND fec_corte = p_fec_corte;
      
          update t101_rpt_trazabilidad t
             set (t.fechafinsemestrescursados) =
                 (select to_date(x.a01fechafinsemestrescursados, 'yyyy-mm-dd')
                    from MIG_T01DBO_PARTICIPANTES x
                   where t.codigo_beneficiario = x.a01codigobeneficiario)
           WHERE fechafinsemestrescursados IS NULL
             AND fec_corte = p_fec_corte;
      
          update t101_rpt_trazabilidad t
             set (t.finfechaetapapractica) =
                 (select to_date(x.a01finfechaetapapractica, 'yyyy-mm-dd')
                    from MIG_T01DBO_PARTICIPANTES x
                   where t.codigo_beneficiario = x.a01codigobeneficiario)
           WHERE finfechaetapapractica IS NULL
             AND fec_corte = p_fec_corte;
      */
    
      update t101_rpt_trazabilidad t
         set (t.codigoconvenio) =
             (select x.a01codigoconvenio
                from MIG_T01DBO_PARTICIPANTES x
               where t.codigo_beneficiario = x.a01codigobeneficiario)
       WHERE codigoconvenio IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set (t.programaestado) =
             (select x.a01programaestado
                from MIG_T01DBO_PARTICIPANTES x
               where t.codigo_beneficiario = x.a01codigobeneficiario)
       WHERE programaestado IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set (t.institucion) =
             (select x.a01institucion
                from MIG_T01DBO_PARTICIPANTES x
               where t.codigo_beneficiario = x.a01codigobeneficiario)
       WHERE institucion IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      /*
          update t101_rpt_trazabilidad t
             set (t.xxx) =
                 (select x.yyy
                    from MIG_T01DBO_PARTICIPANTES x
                   where t.codigo_beneficiario = x.a01codigobeneficiario)
           WHERE xxx IS NULL
             AND fec_corte = p_fec_corte;
      */
    
      -- FECHA ultima inscripcion
    
      update t101_rpt_trazabilidad t
         set (t.FECULTINSCRIP) =
             (select min(g.a53fechacreacion)
                from t53_grupoinscrito g
               where g.a53inscrito = t.idinscrito
                 and g.a53periodo = idPeriodoAct)
       WHERE fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- Grupo de inscripcion
    
      update t101_rpt_trazabilidad t
         set (t.GRUPOINSCRIPCION) =
             (select s.a26sigla
                from t26_gruposfacilitador s,
                     t53_grupoinscrito u,
                     (select min(g.a53fechacreacion) a53fechacreacion,
                             g.a53inscrito
                        from t53_grupoinscrito g
                       where g.a53periodo = idPeriodoAct
                       group by g.a53inscrito) x
               where x.a53fechacreacion = u.a53fechacreacion
                 and x.a53inscrito = u.a53inscrito
                 and u.a53grupofacilitador = s.a26codigo
                 and u.a53inscrito = t.idinscrito
                 and u.a53periodo = idPeriodoAct
                 and s.a26periodo = idPeriodoAct)
      
       WHERE fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set t.GRUPOINSCRIPCION = t.siglagrupo
       WHERE GRUPOINSCRIPCION is null
         and fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- encuesta inicial
      update t101_rpt_trazabilidad t
         set (t.encuesta_inicial) =
             (select min(a16fechacreacion)
                from t16_inscritoencuesta e
               where a16inscrito = t.idinscrito
                 and a16encuesta IN
                     (select a50codigo
                        from t50_encuesta
                       where a50tipoencuesta = 'I')
              
              )
       WHERE fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set (t.encuesta_inicial) =
             (select min(i.a15fechacreacion)
                from t15_inscritos i
               where i.a15codigo = t.idinscrito)
       WHERE t.encuesta_inicial is null
         and fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- encuesta satisfaccion
      update t101_rpt_trazabilidad t
         set (t.encuesta_satisfaccion) =
             (select min(e.a51fechadiligenciaencuesta)
                from t51_asistenciataller e
               where e.a51inscrito = t.idinscrito
                 and e.a51periodo = idPeriodoAct)
       WHERE fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      for regInscrito in (select *
                            from t101_rpt_trazabilidad
                           WHERE fec_corte = p_fec_corte
                             and periodo = idPeriodoAct) loop
      
        asistencia := 0;
      
        FOR regTaller IN curTaller LOOP
        
          -- buscar si el estudiante asistio al taller
          select count(*)
            into numReg
            from t51_asistenciataller
           where a51inscrito = regInscrito.Idinscrito
             and a51tallerrealizado = regTaller.A17codigo
             and a51asistencia = 'A';
        
          if numReg > 0 then
          
            -- Obtener el grupo al que asistio
            select max(a51grupofacilitador)
              into idGrupo
              from t51_asistenciataller
             where a51inscrito = regInscrito.Idinscrito
               and a51tallerrealizado = regTaller.A17codigo
               and a51asistencia = 'A';
          
            -- Obtener la fecha de realizacion del taller
            begin
            
              select a21fechataller
                into fechaTaller
                from t21_realizaciontaller
               where a21grupo = idGrupo
                 and a21taller = regTaller.A17codigo;
              --               AND A21PERIODO = idPeriodoAct;
            EXCEPTION
              WHEN OTHERS THEN
                fechaTaller := null;
            end;
          
            if (not fechaTaller is null) then
              asistencia := asistencia + 1;
            end if;
          
            if (regTaller.A17codigo = 1) then
              update t101_rpt_trazabilidad t
                 set t.taller1 = fechaTaller
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 2) then
              update t101_rpt_trazabilidad t
                 set t.taller2 = fechaTaller
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 3) then
              update t101_rpt_trazabilidad t
                 set t.taller3 = fechaTaller
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 4) then
              update t101_rpt_trazabilidad t
                 set t.taller4 = fechaTaller
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 5) then
              update t101_rpt_trazabilidad t
                 set t.taller5 = fechaTaller
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 6) then
              update t101_rpt_trazabilidad t
                 set t.taller6 = fechaTaller
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 7) then
              update t101_rpt_trazabilidad t
                 set t.taller7 = fechaTaller
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 8) then
              update t101_rpt_trazabilidad t
                 set t.taller8 = fechaTaller
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
          end if;
        
          update t101_rpt_trazabilidad t
             set t.porcasistencia = asistencia / 8
           where t.idinscrito = regInscrito.Idinscrito
             and t.periodo = idPeriodoAct
             and fec_corte = p_fec_corte;
        
          update t101_rpt_trazabilidad t
             set t.certifica = 'S'
           where t.idinscrito = regInscrito.Idinscrito
             and t.periodo = idPeriodoAct
             and t.porcasistencia >= (6 / 8)
             and fec_corte = p_fec_corte;
        
        end loop;
      
      end loop;
      commit;
      -- encuesta final
      update t101_rpt_trazabilidad t
         set (t.encuesta_final) =
             (select min(a16fechacreacion)
                from t16_inscritoencuesta e
               where a16inscrito = t.idinscrito
                 and a16encuesta IN
                     (select a50codigo
                        from t50_encuesta
                       where a50tipoencuesta = 'F')
              
              )
       WHERE t.certifica = 'S'
         and fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      /*Fecha expedicion Certificado*/
      update t101_rpt_trazabilidad t
         set t.FECHA_EXPEDICION =
             (select i.a15fechacertificacion
                from t15_inscritos i
               where i.a15codigo = t.idinscrito)
       WHERE t.encuesta_final is not null
         and t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- Sistematizacion de experiencias (Vida , Exito, Liderazgo)
      update t101_rpt_trazabilidad t
         set t.vida = 'S'
       where EXISTS (SELECT 'S'
                from t57_historiavida v
               where v.a57inscrito = t.idinscrito
                 and v.a57periodo = t.periodo)
         and t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set t.Exito = 'S'
       where EXISTS (SELECT 'S'
                from T58_CASOEXITO e
               where e.a58inscrito = t.idinscrito
                 and e.a58periodo = t.periodo)
         and t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set t.liderazgo = 'S'
       where EXISTS (SELECT 'S'
                from t60_liderazgo l
               where l.a60inscrito = t.idinscrito
                 and l.a60periodo = t.periodo)
         and t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- Como se entero
      update t101_rpt_trazabilidad t
         set t.comoseentero =
             (select r.a14respuesta
                from t16_inscritoencuesta e, t14_encuestarespuestas r
               where e.a16pregunta IN
                     (select t.a13codigo
                        from T13_ENCUESTAPREGUNTAS t
                       where T.A13COMOSEENTERO = 'S')
                 and r.a14codigo = e.a16respuesta
                 and e.a16inscrito = t.idinscrito)
       where t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- reinscrito
      update t101_rpt_trazabilidad t
         set t.reinscrito = 'S'
       where exists (select 1
                from t53_grupoinscrito g
               WHERE G.A53PERIODO < idPeriodoAct
                 and t.IDINSCRITO = g.a53inscrito
                 and g.a53estado = 'A')
         AND t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- Se eliminan los datos de calculos de dias anteriores.
      delete from t101_rpt_trazabilidad t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = 'A'
         and t.fec_corte <> p_fec_corte;
      commit;
    
    END LOOP;
  
    /*Se recalcula los cortes de periodos anteriores para el reporte TODOS*/
    pk_prc_batch.pr_actperiodosant(p_coderror, p_msjerror);
  
    select count(0)
      into numReg
      from t101_rpt_trazabilidad t
     where t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio a Pr_GenerarRptTrazabilidad ok  ');
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      -- p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptTrazabilidadOLD;

  PROCEDURE Pr_GenerarRptTrazabilidad(p_codError OUT NUMBER,
                                      p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_GenerarRptTrazabilidad';
    numReg               NUMBER;
  
    idPeriodoAct  number;
    idGrupo       number;
    idTaller      number;
    fechaTaller   varchar2(10);
    p_fec_corte   varchar2(10);
    p_tipo_corte  varchar2(10);
    periodoTaller number;
  
    asistencia number;
  
    cursor curTaller is
      select * from t17_talleres order by a17Orden;
  
    CURSOR curPeriodo IS
    --      select * from t12_periodos p where p.a12estado in ('A', 'P');
      select * from t12_periodos p;
    --      select * from t12_periodos p where p.a12codigo = 3;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_GenerarRptTrazabilidad  ');
  
    pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                   p_tipo_corte,
                                   p_coderror,
                                   p_msjerror);
  
    FOR recPeriodo IN curPeriodo LOOP
      -- Se recorren los Periodos Activos y en Inscripcion
      idPeriodoAct := recPeriodo.A12codigo;
    
      -- Por si se reprocesa.
      delete from t101_rpt_trazabilidad t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = p_tipo_corte
         and t.fec_corte = p_fec_corte;
    
      insert into t101_rpt_trazabilidad
        (periodo,
         idinscrito,
         nomdepartamento,
         nommunicipio,
         nombrecoordinador,
         cc_facilitador,
         nombrefacilitador,
         tipodocumento,
         documento_inscrito,
         codigo_beneficiario,
         primernombre,
         segundonombre,
         primerapellido,
         segundoapellido,
         email,
         telefono,
         movil,
         movilalt,
         encuesta_inicial,
         encuesta_satisfaccion,
         encuesta_final,
         taller1,
         taller2,
         taller3,
         taller4,
         taller5,
         taller6,
         taller7,
         taller8,
         porcasistencia,
         certifica,
         fecha_expedicion,
         estado,
         vida,
         liderazgo,
         exito,
         siglagrupo,
         GRUPOFACILITADOR,
         IDFACILITADOR,
         IDCOORDINADOR,
         IDDEPARTAMENTO,
         IDMUNICIPIO,
         TIPO_CORTE,
         FEC_CORTE,
         divipola,
         CONDICION_ESPECIAL)
        SELECT a26periodo periodo,
               a15Codigo idinscrito,
               a02nombre nomdepartamento,
               a03nombre nommunicipio,
               (p2.a07primernombre || ' ' || p2.a07segundonombre || ' ' ||
               p2.a07primerapellido || ' ' || p2.a07segundoapellido) nombreCoordinador,
               p1.a07identificacion cc_facilitador,
               (p1.a07primernombre || ' ' || p1.a07segundonombre || ' ' ||
               p1.a07primerapellido || ' ' || p1.a07segundoapellido) nombrefacilitador,
               i.a15tipodocumento,
               i.a15documento,
               i.a15codigobeneficiario,
               a15primernombre PrimerNombre,
               a15segundonombre SegundoNombre,
               a15primerapellido PrimerApellido,
               a15segundoapellido SegundoApellido,
               a15email Email,
               a15telefono Telefono,
               a15movil Movil,
               a15movilalt MovilAlt,
               NULL Encuesta_Inicial,
               NULL Encuesta_Satisfaccion,
               NULL Encuesta_Final,
               NULL Taller1,
               NULL Taller2,
               NULL Taller3,
               NULL Taller4,
               NULL Taller5,
               NULL Taller6,
               NULL Taller7,
               NULL Taller8,
               0 porcAsistencia,
               'N' certifica,
               null Fecha_Expedicion,
               A15ESTADO Estado,
               'N' Vida,
               'N' Liderazgo,
               'N' Exito,
               a26Sigla,
               a26codigo,
               p1.a07usuario,
               p2.a07usuario,
               a02codigo,
               a03codigo,
               p_tipo_corte,
               p_fec_corte,
               A03DANE,
               ce.a87condicion -- CONDICION ESPECIAL
        
          FROM T26_GRUPOSFACILITADOR,
               T90_ESTADOSESPACIOFISICO,
               T02_DEPARTAMENTOS,
               T03_MUNICIPIOS,
               T23_DIAS,
               T24_HORARIOS,
               T25_GRUPOS,
               T06_USUARIOS,
               T07_PERSONAS             p1,
               T07_PERSONAS             p2,
               T15_INSCRITOS            i,
               T04_TIPOSDOCUMENTO,
               T87_CONDICIONESPECIAL    ce
        
         WHERE a26estado = a90codigo
           AND a26ciudad = a03codigo
           AND a03departamento = a02codigo
           AND a26dia = a23codigo
           AND a26horario = a24codigo
           AND a26grupo = a25codigo
           AND a26facilitador = a06codigo
           AND a06codigo = p1.a07usuario
           AND a06coordinador = p2.a07usuario
           AND a15grupofacilitador = a26codigo
           AND a15tipodocumento = a04tipodocumento
           AND a15condicionespecial = a87codigo
           AND a26periodo = idPeriodoAct;
    
      /*Actualziacion campos SIJA*/
    
      update t101_rpt_trazabilidad t
         set (genero,
              condicion,
              municipioestudio,
              tipoformacion,
              nivelformacion,
              fichasnies,
              fechaultmes,
              fechafinsemestrescursados,
              finfechaetapapractica,
              codigoconvenio,
              snies_ies,
              programaestado,
              institucion) =
             (select Substr(A01GENERO, 1, 1) Genero,
                     A01CONDICION Condicion,
                     a01municipioestudio MunicipioEstudio,
                     a01tipoformcion TipoFormacion,
                     a01nivelformacion NivelFormacion,
                     a01fichasnies FichaSNIES,
                     a01ultimomes FechaUltMes,
                     a01finsemestre FechaFinSemestresCursados,
                     a01finetapapractica FinFechaEtapaPractica,
                     a01noconvenio CodigoConvenio,
                     a01sniesies SNIES_IES,
                     A01ESTADOPERSONA ProgramaEstado,
                     A01NOMBREINSTITUCION Institucion
                from t01_participantes x
               where t.documento_inscrito = x.a01documento)
       WHERE genero IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set (t.municipioestudio) =
             (select x.a01municipioestudio
                from MIG_T01DBO_PARTICIPANTES x
               where t.codigo_beneficiario = x.a01codigobeneficiario)
       WHERE municipioestudio IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set (t.tipoformacion) =
             (select x.a01tipoformacion
                from MIG_T01DBO_PARTICIPANTES x
               where t.codigo_beneficiario = x.a01codigobeneficiario)
       WHERE tipoformacion IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      /* -- las fechas de sija no son consistentes, tiene el dia en 00
          update t101_rpt_trazabilidad t
             set (t.fechaultmes) =
                 (select to_date(x.a01fechaultmes, 'yyyy-mm-dd')
                    from MIG_T01DBO_PARTICIPANTES x
                   where t.codigo_beneficiario = x.a01codigobeneficiario)
           WHERE fechaultmes IS NULL
             AND fec_corte = p_fec_corte;
      
          update t101_rpt_trazabilidad t
             set (t.fechafinsemestrescursados) =
                 (select to_date(x.a01fechafinsemestrescursados, 'yyyy-mm-dd')
                    from MIG_T01DBO_PARTICIPANTES x
                   where t.codigo_beneficiario = x.a01codigobeneficiario)
           WHERE fechafinsemestrescursados IS NULL
             AND fec_corte = p_fec_corte;
      
          update t101_rpt_trazabilidad t
             set (t.finfechaetapapractica) =
                 (select to_date(x.a01finfechaetapapractica, 'yyyy-mm-dd')
                    from MIG_T01DBO_PARTICIPANTES x
                   where t.codigo_beneficiario = x.a01codigobeneficiario)
           WHERE finfechaetapapractica IS NULL
             AND fec_corte = p_fec_corte;
      */
    
      update t101_rpt_trazabilidad t
         set (t.codigoconvenio) =
             (select x.a01codigoconvenio
                from MIG_T01DBO_PARTICIPANTES x
               where t.codigo_beneficiario = x.a01codigobeneficiario)
       WHERE codigoconvenio IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set (t.programaestado) =
             (select x.a01programaestado
                from MIG_T01DBO_PARTICIPANTES x
               where t.codigo_beneficiario = x.a01codigobeneficiario)
       WHERE programaestado IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set (t.institucion) =
             (select x.a01institucion
                from MIG_T01DBO_PARTICIPANTES x
               where t.codigo_beneficiario = x.a01codigobeneficiario)
       WHERE institucion IS NULL
         AND fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      /*
          update t101_rpt_trazabilidad t
             set (t.xxx) =
                 (select x.yyy
                    from MIG_T01DBO_PARTICIPANTES x
                   where t.codigo_beneficiario = x.a01codigobeneficiario)
           WHERE xxx IS NULL
             AND fec_corte = p_fec_corte;
      */
    
      -- FECHA ultima inscripcion
    
      update t101_rpt_trazabilidad t
         set (t.FECULTINSCRIP) =
             (select min(g.a53fechacreacion)
                from t53_grupoinscrito g
               where g.a53inscrito = t.idinscrito
                 and g.a53periodo = idPeriodoAct)
       WHERE fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- Grupo de inscripcion
    
      update t101_rpt_trazabilidad t
         set (t.GRUPOINSCRIPCION) =
             (select s.a26sigla
                from t26_gruposfacilitador s,
                     t53_grupoinscrito u,
                     (select min(g.a53fechacreacion) a53fechacreacion,
                             g.a53inscrito
                        from t53_grupoinscrito g
                       where g.a53periodo = idPeriodoAct
                       group by g.a53inscrito) x
               where x.a53fechacreacion = u.a53fechacreacion
                 and x.a53inscrito = u.a53inscrito
                 and u.a53grupofacilitador = s.a26codigo
                 and u.a53inscrito = t.idinscrito
                 and u.a53periodo = idPeriodoAct
                 and s.a26periodo = idPeriodoAct)
      
       WHERE fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set t.GRUPOINSCRIPCION = t.siglagrupo
       WHERE GRUPOINSCRIPCION is null
         and fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- encuesta inicial
      update t101_rpt_trazabilidad t
         set (t.encuesta_inicial) =
             (select min(a16fechacreacion)
                from t16_inscritoencuesta e
               where a16inscrito = t.idinscrito
                 and a16encuesta IN
                     (select a50codigo
                        from t50_encuesta
                       where a50tipoencuesta = 'I')
              
              )
       WHERE fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set (t.encuesta_inicial) =
             (select min(i.a15fechacreacion)
                from t15_inscritos i
               where i.a15codigo = t.idinscrito)
       WHERE t.encuesta_inicial is null
         and fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- encuesta satisfaccion
      update t101_rpt_trazabilidad t
         set (t.encuesta_satisfaccion) =
             (select min(e.a51fechadiligenciaencuesta)
                from t51_asistenciataller e
               where e.a51inscrito = t.idinscrito
                 and e.a51periodo = idPeriodoAct)
       WHERE fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      for regInscrito in (select *
                            from t101_rpt_trazabilidad
                           WHERE fec_corte = p_fec_corte
                             and periodo = idPeriodoAct) loop
      
        asistencia := 0;
      
        FOR regTaller IN curTaller LOOP
        
          -- buscar si el estudiante asistio al taller
          select count(*)
            into numReg
            from t51_asistenciataller
           where a51inscrito = regInscrito.Idinscrito
             and a51tallerrealizado = regTaller.A17codigo
             and a51asistencia = 'A';
        
          if numReg > 0 then
          
            -- Obtener el grupo al que asistio
            select max(a51grupofacilitador)
              into idGrupo
              from t51_asistenciataller
             where a51inscrito = regInscrito.Idinscrito
               and a51tallerrealizado = regTaller.A17codigo
               and a51asistencia = 'A';
          
            -- Obtener la fecha de realizacion del taller
            begin
            
              select a21fechataller, a21periodo
                into fechaTaller, periodoTaller
                from t21_realizaciontaller
               where a21grupo = idGrupo
                 and a21taller = regTaller.A17codigo;
              --               AND A21PERIODO = idPeriodoAct;
            EXCEPTION
              WHEN OTHERS THEN
                fechaTaller := null;
            end;
          
            if (not fechaTaller is null) then
              asistencia := asistencia + 1;
            end if;
          
            if (regTaller.A17codigo = 1) then
              update t101_rpt_trazabilidad t
                 set t.taller1 = fechaTaller,
                     T.T1      = DECODE(periodoTaller,
                                        idPeriodoAct,
                                        fechaTaller,
                                        '*' || fechaTaller)
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            
            end if;
          
            if (regTaller.A17codigo = 2) then
              update t101_rpt_trazabilidad t
                 set t.taller2 = fechaTaller,
                     T.T2      = DECODE(periodoTaller,
                                        idPeriodoAct,
                                        fechaTaller,
                                        '*' || fechaTaller)
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 3) then
              update t101_rpt_trazabilidad t
                 set t.taller3 = fechaTaller,
                     T.T3      = DECODE(periodoTaller,
                                        idPeriodoAct,
                                        fechaTaller,
                                        '*' || fechaTaller)
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 4) then
              update t101_rpt_trazabilidad t
                 set t.taller4 = fechaTaller,
                     T.T4      = DECODE(periodoTaller,
                                        idPeriodoAct,
                                        fechaTaller,
                                        '*' || fechaTaller)
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 5) then
              update t101_rpt_trazabilidad t
                 set t.taller5 = fechaTaller,
                     T.T5      = DECODE(periodoTaller,
                                        idPeriodoAct,
                                        fechaTaller,
                                        '*' || fechaTaller)
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 6) then
              update t101_rpt_trazabilidad t
                 set t.taller6 = fechaTaller,
                     T.T6      = DECODE(periodoTaller,
                                        idPeriodoAct,
                                        fechaTaller,
                                        '*' || fechaTaller)
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 7) then
              update t101_rpt_trazabilidad t
                 set t.taller7 = fechaTaller,
                     T.T7      = DECODE(periodoTaller,
                                        idPeriodoAct,
                                        fechaTaller,
                                        '*' || fechaTaller)
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
            if (regTaller.A17codigo = 8) then
              update t101_rpt_trazabilidad t
                 set t.taller8 = fechaTaller,
                     T.T8      = DECODE(periodoTaller,
                                        idPeriodoAct,
                                        fechaTaller,
                                        '*' || fechaTaller)
               where t.idinscrito = regInscrito.Idinscrito
                 and t.periodo = idPeriodoAct
                 and fec_corte = p_fec_corte;
            end if;
          
          end if;
        
          update t101_rpt_trazabilidad t
             set t.porcasistencia = asistencia / 8
           where t.idinscrito = regInscrito.Idinscrito
             and t.periodo = idPeriodoAct
             and fec_corte = p_fec_corte;
        
          update t101_rpt_trazabilidad t
             set t.certifica = 'S'
           where t.idinscrito = regInscrito.Idinscrito
             and t.periodo = idPeriodoAct
             and t.porcasistencia >= (6 / 8)
             and fec_corte = p_fec_corte;
        
        end loop;
      
      end loop;
      commit;
      -- encuesta final
      update t101_rpt_trazabilidad t
         set (t.encuesta_final) =
             (select MAX(a16fechacreacion)
                from t16_inscritoencuesta e
               where a16inscrito = t.idinscrito
                 and a16encuesta IN
                     (select a50codigo
                        from t50_encuesta
                       where a50tipoencuesta = 'F')
              
              )
       WHERE t.certifica = 'S'
         and fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      /*Fecha expedicion Certificado*/
      update t101_rpt_trazabilidad t
         set t.FECHA_EXPEDICION =
             (select i.a15fechacertificacion
                from t15_inscritos i
               where i.a15codigo = t.idinscrito)
       WHERE t.encuesta_final is not null
         and t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- Sistematizacion de experiencias (Vida , Exito, Liderazgo)
      update t101_rpt_trazabilidad t
         set t.vida = 'S'
       where EXISTS (SELECT 'S'
                from t57_historiavida v
               where v.a57inscrito = t.idinscrito
                 and v.a57periodo = t.periodo)
         and t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set t.Exito = 'S'
       where EXISTS (SELECT 'S'
                from T58_CASOEXITO e
               where e.a58inscrito = t.idinscrito
                 and e.a58periodo = t.periodo)
         and t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      update t101_rpt_trazabilidad t
         set t.liderazgo = 'S'
       where EXISTS (SELECT 'S'
                from t60_liderazgo l
               where l.a60inscrito = t.idinscrito
                 and l.a60periodo = t.periodo)
         and t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- Como se entero
      update t101_rpt_trazabilidad t
         set t.comoseentero =
             (select r.a14respuesta
                from t16_inscritoencuesta e, t14_encuestarespuestas r
               where e.a16pregunta IN
                     (select t.a13codigo
                        from T13_ENCUESTAPREGUNTAS t
                       where T.A13COMOSEENTERO = 'S')
                 and r.a14codigo = e.a16respuesta
                 and e.a16inscrito = t.idinscrito)
       where t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- reinscrito
      update t101_rpt_trazabilidad t
         set t.reinscrito = 'S'
       where exists (select 1
                from t53_grupoinscrito g
               WHERE G.A53PERIODO < idPeriodoAct
                 and t.IDINSCRITO = g.a53inscrito)
         AND t.fec_corte = p_fec_corte
         and t.periodo = idPeriodoAct;
    
      -- Se eliminan los datos de calculos de dias anteriores.
      delete from t101_rpt_trazabilidad t
       where t.periodo = idPeriodoAct
         and t.tipo_corte = 'A'
         and t.fec_corte <> p_fec_corte;
      commit;
    
    END LOOP;
  
    /*Se recalcula los cortes de periodos anteriores para el reporte TODOS*/
    pk_prc_batch.pr_actperiodosant(p_coderror, p_msjerror);
  
    pk_prc_batch.pr_generarrptencuestaio(p_coderror, p_msjerror);
  
    select count(0)
      into numReg
      from t101_rpt_trazabilidad t
     where t.fec_corte = p_fec_corte;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio a Pr_GenerarRptTrazabilidad ok  ');
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      -- p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      p_msjError := SQLERRM;
    
  END Pr_GenerarRptTrazabilidad;

  PROCEDURE Pr_ActEnc_SatisP1(p_codError OUT NUMBER,
                              p_msjError OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ActEnc_SatisP1';
    numReg               NUMBER;
    p_fec_corte          varchar2(10);
    p_tipo_corte         varchar2(10);
  
    idPeriodoAct number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro:' || NOMBRE_PROCEDIMIENTO);
  
    idPeriodoAct := 1;
    pk_prc_batch.pr_tipofechacorte(p_fec_corte,
                                   p_tipo_corte,
                                   p_coderror,
                                   p_msjerror);
    p_tipo_corte := 'A';
  
    -- Por si se reprocesa.
    delete from t102_rpt_encuestasatisfaccion t
     where t.periodo = idPeriodoAct
       and t.tipo_corte = p_tipo_corte
       and t.fec_corte = p_fec_corte;
  
    insert into t102_rpt_encuestasatisfaccion
      (periodo,
       grupofacilitador,
       idgrupo,
       taller,
       idpregunta,
       idrespuesta,
       NRORPTAS,
       tipo_corte,
       fec_corte,
       nropregunta,
       pregunta,
       respuesta)
    
      select s.periodo, -- t.a51periodo,
             s.grupo, -- t.a51grupofacilitador,
             s.grupo, -- t.a51grupofacilitador,
             s.taller, -- t.a51tallerrealizado,
             0, -- t.a16pregunta,
             0, --t.a16respuesta,
             s.no_rtas, -- count(*),
             p_tipo_corte,
             p_fec_corte,
             s.no_preg,
             s.pregunta,
             s.respuesta
        from enc_SatisfacP1 s;
  
    update t102_rpt_encuestasatisfaccion
       set (divipola,
            nomdepartamento,
            nommunicipio,
            nombrecoordinador,
            nombrefacilitador,
            siglagrupo,
            idmunicipio,
            iddepartamento,
            idfacilitador,
            idcoordinador) =
           (select divipola,
                   nomdepartamento,
                   nommunicipio,
                   nomcoordinador,
                   nombrefacilitador,
                   sigla,
                   idmunicipio,
                   iddepartamento,
                   idfacilitador,
                   idcoordinador
              from t103_rpt_cronogramataller c
             where c.periodo = idPeriodoAct
               and c.fec_corte = p_fec_corte
               and c.idgrupofacilitador = grupofacilitador)
     where fec_corte = p_fec_corte
       and periodo = idPeriodoAct;
  
    commit;
  
    select count(0)
      into numReg
      from t102_rpt_encuestasatisfaccion t
     where t.tipo_corte = 'A'
       AND T.PERIODO = 1;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA || '. Total registros: ' ||
                  to_char(numReg);
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Salio' || NOMBRE_PROCEDIMIENTO);
  EXCEPTION
    WHEN OTHERS THEN
      rollback;
    
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := SQLERRM;
    
  END Pr_ActEnc_SatisP1;

end PK_PRC_BATCH;
/

prompt
prompt Creating package body PK_RPT_ADMREPORTE
prompt =======================================
prompt
create or replace package body hpv.PK_RPT_ADMREPORTE is

  PROCEDURE Pr_DarReportes(p_idUsuario IN NUMBER,
                           p_resultado OUT PK_UTILS.TY_CURSOR,
                           p_codError  OUT NUMBER,
                           p_msjError  OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarReportes';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarReportes ');
  
    SELECT COUNT(*)
      INTO numreg
      FROM t62_reporte
     WHERE a62estado = PK_UTILS.COD_ACTIVO;
  
    if (numReg = 0) then
      p_codError := 105;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select a62codigo      IdReporte,
             a62categoria   Categoria,
             a62nombre      Nombre,
             a62descripcion Descripcion,
             a62url         URL
        from t62_reporte
       WHERE a62estado = PK_UTILS.COD_ACTIVO
       ORDER BY a62categoria, a62nombre;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarReportes OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarReportes;

  PROCEDURE Pr_DarRptTrazabilidad(p_idPeriodo      IN NUMBER,
                                  p_idFacilitador  IN NUMBER,
                                  p_idCoordinador  IN NUMBER,
                                  p_idGrupo        IN NUMBER,
                                  p_idDepartamento IN NUMBER,
                                  p_idMunicipio    IN NUMBER,
                                  p_fec_corte      IN varchar2,
                                  p_resultado      OUT PK_UTILS.TY_CURSOR,
                                  p_codError       OUT NUMBER,
                                  p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptTrazabilidad';
    numReg               NUMBER;
    PIdCoordinador       NUMBER := 0;
    PIdDepartamento      NUMBER := 0;
    PIdMunicipio         NUMBER := 0;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptTrazabilidad ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    --    OPEN p_resultado FOR select 'en reproceso>>'||p_idFacilitador "PROCESO" from dual;
    --    return;
  
    if p_idCoordinador <> -1 then
      PIdCoordinador := p_idCoordinador;
    end if;
    if p_idDepartamento <> -1 then
      PIdDepartamento := p_idDepartamento;
    end if;
    if p_idMunicipio <> -1 then
      PIdMunicipio := p_idMunicipio;
    end if;
  
    OPEN p_resultado FOR
      select periodo "PERIODO",
             nvl(divipola, 0) "DIVIPOLA",
             nomdepartamento "NOMBRE DEPARTAMENTO",
             nommunicipio "NOMBRE MUNICIPIO",
             nombrecoordinador "NOMBRE COORDINADOR",
             cc_facilitador "CEDULA FACILITADOR",
             nombrefacilitador "NOMBRE FACILITADOR",
             TipoDocumento "TIPO DOCUMENTO INSCRITO SIJA",
             documento_inscrito "DOCUMENTO INSCRITO SIJA",
             nvl(codigo_beneficiario, 0) "CODIGO BENEFICIARIO SIJA",
             primernombre "PRIMER NOMBRE SIJA",
             segundonombre "SEGUNDO NOMBRE SIJA",
             primerapellido "PRIMERO APELLIDO SIJA",
             segundoapellido "SEGUNDO APELLIDO SIJA",
             email "EMAIL",
             telefono "TELEFONO",
             movil "MOVIL",
             movilalt "MOVIL ALT",
             condicion_especial "CONDICION ESPECIAL",
             municipioestudio "MUNICIPIO ESTUDIO SIJA",
             tipoformacion "TIPO FORMACION SIJA",
             nivelformacion "NIVEL FORMACION SIJA",
             nvl(fichasnies, 0) "FICHA SNIES SIJA",
             to_char(fechaultmes, 'yyyy-mm-dd') "FECHA ULTIMO MES SIJA",
             to_char(fechafinsemestrescursados, 'yyyy-mm-dd') "FECHA FIN SEMESTRE SIJA",
             to_char(finfechaetapapractica, 'yyyy-mm-dd') "FECHA FIN ETAPA PRACTICA SIJA",
             codigoconvenio "CODIGO CONVENIO SIJA",
             nvl(snies_ies, 0) "SNIES IES SIJA",
             programaestado "PROGRAMA ESTADO SIJA",
             institucion "INSTITUCION SIJA",
             nvl(to_char(fecultinscrip, 'yyyy-mm-dd'), ' ') "FECHA ULTIMA INSCRIPCION",
             to_char(encuesta_inicial, 'yyyy-mm-dd') "FECHA ENCUESTA INICIAL",
             to_char(encuesta_satisfaccion, 'yyyy-mm-dd') "FECHA ENCUESTA SATISFACCION",
             to_char(encuesta_final, 'yyyy-mm-dd') "FECHA ENCUESTA FINAL",
             /*
             decode(p_idPeriodo,
                    '0',
                    to_char(encuesta_final_act, 'yyyy-mm-dd'),
                    to_char(encuesta_final, 'yyyy-mm-dd')) "FECHA ENCUESTA FINAL",
             to_char(taller1, 'yyyy/mm/dd') "FECHA TALLER 1",
             to_char(taller2, 'yyyy/mm/dd') "FECHA TALLER 2",
             to_char(taller3, 'yyyy/mm/dd') "FECHA TALLER 3",
             to_char(taller4, 'yyyy/mm/dd') "FECHA TALLER 4",
             to_char(taller5, 'yyyy/mm/dd') "FECHA TALLER 5",
             to_char(taller6, 'yyyy/mm/dd') "FECHA TALLER 6",
             to_char(taller7, 'yyyy/mm/dd') "FECHA TALLER 7",
             to_char(taller8, 'yyyy/mm/dd') "FECHA TALLER 8",
             */
             t1 "FECHA TALLER 1",
             t2 "FECHA TALLER 2",
             t3 "FECHA TALLER 3",
             t4 "FECHA TALLER 4",
             t5 "FECHA TALLER 5",
             t6 "FECHA TALLER 6",
             t7 "FECHA TALLER 7",
             t8 "FECHA TALLER 8",
             (nvl(porcasistencia, 0) * 100) "PORCENTAJE ASISTENCIA",
             nvl(certifica, 'N') "CERTIFICABLE",
             to_char(fecha_expedicion, 'yyyy-mm-dd') "FECHA DESCARGA CERTIFICADO",
             /*
             decode(p_idPeriodo,
                    '0',
                    to_char(fecha_expedicion_act, 'yyyy-mm-dd'),
                    to_char(fecha_expedicion, 'yyyy-mm-dd')) "FECHA DESCARGA CERTIFICADO",
             */
             nvl(estado, 'A') "ESTADO",
             comoseentero "COMO SE ENTERO?",
             reinscrito "REINSCRITO",
             nvl(vida, 'N') "VIDA",
             nvl(liderazgo, 'N') "LIDERAZGO",
             nvl(exito, 'N') "EXITO",
             genero "GENERO",
             condicion "CONDICION",
             GRUPOINSCRIPCION "GRUPO INSCRIPCION",
             siglagrupo "GRUPO ACTUAL",
             valido "VALIDO",
             idinscrito "ID PARTICIPANTE"
        from t101_rpt_trazabilidad
       where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
         and idfacilitador =
             decode(p_idFacilitador, 0, idfacilitador, p_idFacilitador)
         and idCoordinador =
             decode(PIdCoordinador, 0, idCoordinador, PIdCoordinador)
         and grupofacilitador =
             decode(p_idGrupo, 0, grupofacilitador, p_idGrupo)
         and idDepartamento =
             decode(PIdDepartamento, 0, idDepartamento, PIdDepartamento)
         and idMunicipio =
             decode(PIdMunicipio, 0, idMunicipio, PIdMunicipio)
         and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
         and TIPO_CORTE = decode(p_fec_corte, '0', 'F', TIPO_CORTE)
      
      /*) or
                   (FEC_CORTE =
                   decode(p_fec_corte,
                            '0',
                            (select max(FEC_CORTE) from t101_rpt_trazabilidad),
                            p_fec_corte)))
      */
      
       order by periodo, nomdepartamento, nommunicipio;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptTrazabilidad OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptTrazabilidad;

  PROCEDURE Pr_DarRptSatisfaccion(p_idPeriodo      IN NUMBER,
                                  p_idFacilitador  IN NUMBER,
                                  p_idCoordinador  IN NUMBER,
                                  p_idGrupo        IN NUMBER,
                                  p_idDepartamento IN NUMBER,
                                  p_idMunicipio    IN NUMBER,
                                  p_fec_corte      IN varchar2,
                                  p_resultado      OUT PK_UTILS.TY_CURSOR,
                                  p_codError       OUT NUMBER,
                                  p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptSatisfaccion';
    numReg               NUMBER;
    PIdCoordinador       NUMBER := 0;
    PIdDepartamento      NUMBER := 0;
    PIdMunicipio         NUMBER := 0;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptSatisfaccion ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    if p_idCoordinador <> -1 then
      PIdCoordinador := p_idCoordinador;
    end if;
    if p_idDepartamento <> -1 then
      PIdDepartamento := p_idDepartamento;
    end if;
    if p_idMunicipio <> -1 then
      PIdMunicipio := p_idMunicipio;
    end if;
  
    OPEN p_resultado FOR
      select periodo "PERIODO",
             nvl(divipola, 0) "DIVIPOLA",
             nomdepartamento "NOMBRE DEPARTAMENTO",
             nommunicipio "NOMBRE MUNICIPIO",
             nombrecoordinador "NOMBRE COORDINADOR",
             --           cc_facilitador "CEDULA FACILITADOR",
             nombrefacilitador "NOMBRE FACILITADOR",
             siglagrupo        "GRUPO",
             taller            "TALLER",
             nropregunta       "NUMERO PREGUNTA",
             pregunta          "PREGUNTA",
             respuesta         "RESPUESTA",
             nrorptas          "NUMERO RESPUESTAS"
      --porcrptas "PORCENTAJE RESPUESTAS"
      --idgrupo,
      --idpregunta,
      --idrespuesta,
      --idmunicipio,
      --iddepartamento,
      --idfacilitador,
      --idcoordinador,
      --tipo_corte,
      --fec_corte
      --grupofacilitador,
      
        from t102_rpt_encuestasatisfaccion
       where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
         and idfacilitador =
             decode(p_idFacilitador, 0, idfacilitador, p_idFacilitador)
         and idCoordinador =
             decode(PIdCoordinador, 0, idCoordinador, PIdCoordinador)
         and IDGRUPO = decode(p_idGrupo, 0, IDGRUPO, p_idGrupo)
         and idDepartamento =
             decode(PIdDepartamento, 0, idDepartamento, PIdDepartamento)
         and idMunicipio =
             decode(PIdMunicipio, 0, idMunicipio, PIdMunicipio)
         and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
         and TIPO_CORTE = decode(p_fec_corte, '0', 'F', TIPO_CORTE)
       ORDER BY periodo,
                divipola,
                nombrecoordinador,
                nombrefacilitador,
                siglagrupo,
                taller,
                nropregunta,
                nrorptas;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptSatisfaccion OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptSatisfaccion;

  PROCEDURE Pr_DarRptCronograma(p_idPeriodo      IN NUMBER,
                                p_idFacilitador  IN NUMBER,
                                p_idCoordinador  IN NUMBER,
                                p_idGrupo        IN NUMBER,
                                p_idDepartamento IN NUMBER,
                                p_idMunicipio    IN NUMBER,
                                p_fec_corte      IN varchar2,
                                p_resultado      OUT PK_UTILS.TY_CURSOR,
                                p_codError       OUT NUMBER,
                                p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptCronograma';
    numReg               NUMBER;
    PIdCoordinador       NUMBER := 0;
    PIdDepartamento      NUMBER := 0;
    PIdMunicipio         NUMBER := 0;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptCronograma');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    if p_idCoordinador <> -1 then
      PIdCoordinador := p_idCoordinador;
    end if;
    if p_idDepartamento <> -1 then
      PIdDepartamento := p_idDepartamento;
    end if;
    if p_idMunicipio <> -1 then
      PIdMunicipio := p_idMunicipio;
    end if;
  
    OPEN p_resultado FOR
      select periodo "PERIODO",
             nvl(divipola, 0) "DIVIPOLA",
             nomdepartamento "NOMBRE DEPARTAMENTO",
             nommunicipio "NOMBRE MUNICIPIO",
             nomcoordinador "NOMBRE COORDINADOR",
             nombrefacilitador "NOMBRE FACILITADOR",
             dia "DIA",
             horario "HORARIO",
             inscritos "INSCRITOS",
             lugar "LUGAR",
             direccion "DIRECCION",
             sigla "SIGLA",
             ESTADO "ESTADO",
             t1plane "T1 PLANEADO",
             t1ejecu "T1 EJECUTADO",
             t1asist "T1 ASISTENTES",
             t1noasi "T1 NO ASISTENTES",
             t1saten "T1 ENC SATISFACCION ENVIOS",
             t1satco "T1 ENC SATISFAC CONTESTADOS",
             
             t2plane "T2 PLANEADO",
             t2ejecu "T2 EJECUTADO",
             t2asist "T2 ASISTENTES",
             t2noasi "T2 NO ASISTENTES",
             t2saten "T2 ENC SATISFACCION ENVIOS",
             t2satco "T2 ENC SATISFAC CONTESTADOS",
             
             t3plane "T3 PLANEADO",
             t3ejecu "T3 EJECUTADO",
             t3asist "T3 ASISTENTES",
             t3noasi "T3 NO ASISTENTES",
             t3saten "T3 ENC SATISFACCION ENVIOS",
             t3satco "T3 ENC SATISFAC CONTESTADOS",
             
             t4plane "T4 PLANEADO",
             t4ejecu "T4 EJECUTADO",
             t4asist "T4 ASISTENTES",
             t4noasi "T4 NO ASISTENTES",
             t4saten "T4 ENC SATISFACCION ENVIOS",
             t4satco "T4 ENC SATISFAC CONTESTADOS",
             
             t5plane "T5 PLANEADO",
             t5ejecu "T5 EJECUTADO",
             t5asist "T5 ASISTENTES",
             t5noasi "T5 NO ASISTENTES",
             t5saten "T5 ENC SATISFACCION ENVIOS",
             t5satco "T5 ENC SATISFAC CONTESTADOS",
             
             t6plane "T6 PLANEADO",
             t6ejecu "T6 EJECUTADO",
             t6asist "T6 ASISTENTES",
             t6noasi "T6 NO ASISTENTES",
             t6saten "T6 ENC SATISFACCION ENVIOS",
             t6satco "T6 ENC SATISFAC CONTESTADOS",
             
             t7plane "T7 PLANEADO",
             t7ejecu "T7 EJECUTADO",
             t7asist "T7 ASISTENTES",
             t7noasi "T7 NO ASISTENTES",
             t7saten "T7 ENC SATISFACCION ENVIOS",
             t7satco "T7 ENC SATISFAC CONTESTADOS",
             
             t8plane "T8 PLANEADO",
             t8ejecu "T8 EJECUTADO",
             t8asist "T8 ASISTENTES",
             t8noasi "T8 NO ASISTENTES",
             t8saten "T8 ENC SATISFACCION ENVIOS",
             t8satco "T8 ENC SATISFAC CONTESTADOS"
      
      --idgrupofacilitador,
      --idgrupo,
      --to_char(taller1, 'yyyy-mm-dd') taller1,
      --to_char(taller2, 'yyyy-mm-dd') taller2,
      --to_char(taller3, 'yyyy-mm-dd') taller3,
      --to_char(taller4, 'yyyy-mm-dd') taller4,
      --to_char(taller5, 'yyyy-mm-dd') taller5,
      --to_char(taller6, 'yyyy-mm-dd') taller6,
      --to_char(taller7, 'yyyy-mm-dd') taller7,
      --to_char(taller8, 'yyyy-mm-dd') taller8,
      --t1noved,
      --t2noved,
      --t3noved,
      --t4noved,
      --t5noved,
      --t6noved,
      --t7noved,
      --t8noved,
      --iddepartamento,
      --idmunicipio,
      --idfacilitador,
      --idcoordinador,
      --tipo_corte,
      --fec_corte
      --from vw_rpt_cronogramataller
        from T103_RPT_CRONOGRAMATALLER
       where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
         and idfacilitador =
             decode(p_idFacilitador, 0, idfacilitador, p_idFacilitador)
         and idCoordinador =
             decode(PIdCoordinador, 0, idCoordinador, PIdCoordinador)
         and idGrupoFacilitador =
             decode(p_idGrupo, 0, idGrupoFacilitador, p_idGrupo)
         and idDepartamento =
             decode(PIdDepartamento, 0, idDepartamento, PIdDepartamento)
         and idMunicipio =
             decode(PIdMunicipio, 0, idMunicipio, PIdMunicipio)
         and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
         and TIPO_CORTE = decode(p_fec_corte, '0', 'F', TIPO_CORTE)
       ORDER BY periodo,
                divipola;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptCronograma OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptCronograma;

  PROCEDURE Pr_DarRptEntradaSalida(p_idPeriodo      IN NUMBER,
                                   p_idFacilitador  IN NUMBER,
                                   p_idCoordinador  IN NUMBER,
                                   p_idGrupo        IN NUMBER,
                                   p_idDepartamento IN NUMBER,
                                   p_idMunicipio    IN NUMBER,
                                   p_fec_corte      IN varchar2,
                                   p_resultado      OUT PK_UTILS.TY_CURSOR,
                                   p_codError       OUT NUMBER,
                                   p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptEntradaSalida';
    numReg               NUMBER;
    PIdCoordinador       NUMBER := 0;
    PIdDepartamento      NUMBER := 0;
    PIdMunicipio         NUMBER := 0;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptEntradaSalida ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    if p_idCoordinador <> -1 then
      PIdCoordinador := p_idCoordinador;
    end if;
    if p_idDepartamento <> -1 then
      PIdDepartamento := p_idDepartamento;
    end if;
    if p_idMunicipio <> -1 then
      PIdMunicipio := p_idMunicipio;
    end if;
  
    OPEN p_resultado FOR
      select periodo "PERIODO",
             nvl(divipola, 0) "DIVIPOLA",
             nomdepartamento "NOMBRE DEPARTAMENTO",
             nommunicipio "NOMBRE MUNICIPIO",
             nombrecoordinador "NOMBRE COORDINADOR",
             cc_facilitador "CEDULA FACILITADOR",
             nombrefacilitador "NOMBRE FACILITADOR",
             siglagrupo "SIGLA GRUPO",
             tipodocumento "TIPO DOCUMENTO PARTICIPANTE",
             documento "DOCUMENTO PARTICIPANTE",
             codigobeneficiario "COD BENEFICIARIO PARTICIPANTE",
             genero "GENERO PARTICIPANTE",
             condicion "CONIDICION PARTICIPANTE",
             estado "ESTADO PARTICIPANTE",
             e01 "E01",
             e02 "E02",
             e03 "E03",
             e04 "E04",
             e05 "E05",
             e06 "E06",
             e07 "E07",
             e08 "E08",
             e09 "E09",
             e10 "E10",
             e11 "E11",
             e12 "E12",
             e13 "E13",
             e14 "E14",
             e15 "E15",
             e16 "E16",
             e17 "E17",
             e18 "E18",
             e19 "E19",
             e20 "E20",
             e21 "E21",
             s01 "S01",
             s02 "S02",
             s03 "S03",
             s04 "S04",
             s05 "S05",
             s06 "S06",
             s07 "S07",
             s08 "S08",
             s09 "S09",
             s10 "S10",
             s11 "S11",
             s12 "S12",
             s13 "S13",
             s14 "S14",
             s15 "S15",
             s16 "S16",
             tipoformacion "TIPO FORMACION SIJA",
             valido "VALIDO",
             idinscrito "ID PARTICIPANTE"
      
      --grupofacilitador,
      --idmunicipio,
      --iddepartamento,
      --idfacilitador,
      --idcoordinador,
      --tipo_corte,
      --fec_corte
      --idinscrito,
      
        from t104_rpt_enc_ent_sal
       where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
         and idfacilitador =
             decode(p_idFacilitador, 0, idfacilitador, p_idFacilitador)
         and idCoordinador =
             decode(PIdCoordinador, 0, idCoordinador, PIdCoordinador)
         and grupofacilitador =
             decode(p_idGrupo, 0, grupofacilitador, p_idGrupo)
         and idDepartamento =
             decode(PIdDepartamento, 0, idDepartamento, PIdDepartamento)
         and idMunicipio =
             decode(PIdMunicipio, 0, idMunicipio, PIdMunicipio)
         and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
         and TIPO_CORTE = decode(p_fec_corte, '0', 'F', TIPO_CORTE)
       order by periodo, nomdepartamento, nommunicipio;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptEntradaSalida OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptEntradaSalida;

  PROCEDURE Pr_DarRptCandidatos(p_idPeriodo      IN NUMBER,
                                p_idFacilitador  IN NUMBER,
                                p_idCoordinador  IN NUMBER,
                                p_idGrupo        IN NUMBER,
                                p_idDepartamento IN NUMBER,
                                p_idMunicipio    IN NUMBER,
                                p_fec_corte      IN varchar2,
                                p_resultado      OUT PK_UTILS.TY_CURSOR,
                                p_codError       OUT NUMBER,
                                p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptCandidatos';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptCandidatos ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select periodo "PERIODO",
             tipodocumento "TIPO DOCUMENTO",
             documento "DOCUMENTO",
             primernombre "PRIMER NOMBRE",
             segundonombre "SEGUNDO NOMBRE",
             primerapellido "PRIMER APELLIDO",
             segundoapellido "SEGUNDO APELLIDO",
             to_char(fechanacimiento, 'yyyy-mm-dd') "FECHA NACIMIENTO",
             email "EMAIL",
             telefono "TELEFONO",
             movil "MOVIL",
             movilalt "MOVIL ALT",
             condicionespecial "CONDICION ESPECIAL",
             codigobeneficiario "CODIGO BENEFICIARIO",
             estado "ESTADO",
             to_char(fechacreacion, 'yyyy-mm-dd') "FECHA CREACION"
      
      --tipo_corte,
      --fec_corte
      
        from T105_RPT_CANDIDATOS
       where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
         and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
         and TIPO_CORTE = decode(p_fec_corte, '0', 'F', TIPO_CORTE)
       ORDER BY periodo;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptCandidatos OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptCandidatos;

  PROCEDURE Pr_DarRptCasosExito(p_idPeriodo      IN NUMBER,
                                p_idFacilitador  IN NUMBER,
                                p_idCoordinador  IN NUMBER,
                                p_idGrupo        IN NUMBER,
                                p_idDepartamento IN NUMBER,
                                p_idMunicipio    IN NUMBER,
                                p_fec_corte      IN varchar2,
                                p_resultado      OUT PK_UTILS.TY_CURSOR,
                                p_codError       OUT NUMBER,
                                p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptCasosExito';
    numReg               NUMBER;
    PIdCoordinador       NUMBER := 0;
    PIdDepartamento      NUMBER := 0;
    PIdMunicipio         NUMBER := 0;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptCasosExito ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    if p_idCoordinador <> -1 then
      PIdCoordinador := p_idCoordinador;
    end if;
    if p_idDepartamento <> -1 then
      PIdDepartamento := p_idDepartamento;
    end if;
    if p_idMunicipio <> -1 then
      PIdMunicipio := p_idMunicipio;
    end if;
  
    OPEN p_resultado FOR
      select periodo,
             divipola,
             nombre_departamento,
             nombre_municipio,
             nombre_coordinador,
             cedula_facilitador,
             nombre_facilitador,
             sigla_grupo,
             tipo_documento_participante,
             documento_participante,
             codigo_beneficiario,
             primernombre_participante,
             segundonombre_participante,
             primerapellido_participante,
             segundoapellido_participante,
             genero,
             condicion,
             tipo_formacion,
             nivel_formacion,
             asistencias,
             r1,
             r1p                          "%1",
             r2,
             r2p                          "%2",
             r3,
             r3p                          "%3",
             r4,
             r4p                          "%4",
             r5,
             r5p                          "%5",
             r6,
             r6p                          "%6",
             r7,
             r7p                          "%7",
             r8,
             r8p                          "%8",
             r9,
             r9p                          "%9",
             r10,
             r10p                         "%10",
             rtp                          "%Total",
             observaciones,
             estado,
             t1_1                         "T1_Autoes",
             t1_2                         "T1_Autoc",
             t1_3                         "T1_Autoconf",
             t1_t                         "T1_Total",
             t2_4                         "T2_Resiliencia",
             t2_5                         "T2_Mnejo de Emociones ",
             t2_t                         "T2_Total",
             t3_6                         "T3_Perseverancia",
             t3_t                         "T3_Total",
             t4_7                         "T4_TomaDecisiones",
             t4_8                         "T4_Iniciativa",
             t4_t                         "T4_Total",
             t5_9                         "T5_Adaptabilidad ",
             t5_10                        "T5_Empatía ",
             t5_t                         "T5_Total",
             t6_11                        "T6_Comunasertiva",
             t6_12                        "T6_Gestiònconflictos",
             t6_t                         "T6_Total",
             t7_13                        "T7_Iniciativa ",
             t7_14                        "T7_TomaDecis",
             t7_t                         "T7_Total",
             t8_15                        "T8_Ac-trab",
             t8_16                        "T8_Liderazgo",
             t8_17                        "T8_puntualidad",
             t8_18                        "T8_Gestiòntiempo",
             t8_19                        "T8_Responsabil",
             t8_t                         "T8_Total",
             TLOGROS_T                    "TOTAL_LOGROS"
        from t107_rpt_casosexito
       where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
         and idCoordinador =
             decode(PIdCoordinador, 0, idCoordinador, PIdCoordinador)
         and idDepartamento =
             decode(PIdDepartamento, 0, idDepartamento, PIdDepartamento)
         and idMunicipio =
             decode(PIdMunicipio, 0, idMunicipio, PIdMunicipio)
         and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
         and TIPO_CORTE = decode(p_fec_corte, '0', 'F', TIPO_CORTE)
       ORDER BY periodo,
                divipola;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptCasosExito OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptCasosExito;

  PROCEDURE Pr_DarRptEjemLider(p_idPeriodo      IN NUMBER,
                               p_idFacilitador  IN NUMBER,
                               p_idCoordinador  IN NUMBER,
                               p_idGrupo        IN NUMBER,
                               p_idDepartamento IN NUMBER,
                               p_idMunicipio    IN NUMBER,
                               p_fec_corte      IN varchar2,
                               p_resultado      OUT PK_UTILS.TY_CURSOR,
                               p_codError       OUT NUMBER,
                               p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptEjemLider';
    numReg               NUMBER;
    PIdCoordinador       NUMBER := 0;
    PIdDepartamento      NUMBER := 0;
    PIdMunicipio         NUMBER := 0;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptEjemLider ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    if p_idCoordinador <> -1 then
      PIdCoordinador := p_idCoordinador;
    end if;
    if p_idDepartamento <> -1 then
      PIdDepartamento := p_idDepartamento;
    end if;
    if p_idMunicipio <> -1 then
      PIdMunicipio := p_idMunicipio;
    end if;
  
    OPEN p_resultado FOR
      select periodo,
             divipola,
             nombre_departamento,
             nombre_municipio,
             nombre_coordinador,
             cedula_facilitador,
             nombre_facilitador,
             sigla_grupo,
             tipo_documento_participante,
             documento_participante,
             codigo_beneficiario,
             primernombre_participante,
             segundonombre_participante,
             primerapellido_participante,
             segundoapellido_participante,
             genero,
             condicion,
             tipo_formacion,
             nivel_formacion,
             asistencias,
             r1,
             r1P                          "%1",
             r2,
             r2P                          "%2",
             r3,
             r3P                          "%3",
             r4,
             r4P                          "%4",
             r5,
             r5P                          "%5",
             r6,
             r6P                          "%6",
             r7,
             r7P                          "%7",
             r8,
             r8P                          "%8",
             rTP                          "%TOTAL",
             observaciones,
             estado
        from T108_RPT_EJEMLIDERAZGO
       where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
         and idCoordinador =
             decode(PIdCoordinador, 0, idCoordinador, PIdCoordinador)
         and idDepartamento =
             decode(PIdDepartamento, 0, idDepartamento, PIdDepartamento)
         and idMunicipio =
             decode(PIdMunicipio, 0, idMunicipio, PIdMunicipio)
         and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
         and TIPO_CORTE = decode(p_fec_corte, '0', 'F', TIPO_CORTE)
       ORDER BY periodo,
                divipola;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptEjemLider OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptEjemLider;

  PROCEDURE Pr_DarRptHistVida(p_idPeriodo      IN NUMBER,
                              p_idFacilitador  IN NUMBER,
                              p_idCoordinador  IN NUMBER,
                              p_idGrupo        IN NUMBER,
                              p_idDepartamento IN NUMBER,
                              p_idMunicipio    IN NUMBER,
                              p_fec_corte      IN varchar2,
                              p_resultado      OUT PK_UTILS.TY_CURSOR,
                              p_codError       OUT NUMBER,
                              p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptHistVida';
    numReg               NUMBER;
    PIdCoordinador       NUMBER := 0;
    PIdDepartamento      NUMBER := 0;
    PIdMunicipio         NUMBER := 0;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptHistVida ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    if p_idCoordinador <> -1 then
      PIdCoordinador := p_idCoordinador;
    end if;
    if p_idDepartamento <> -1 then
      PIdDepartamento := p_idDepartamento;
    end if;
    if p_idMunicipio <> -1 then
      PIdMunicipio := p_idMunicipio;
    end if;
  
    OPEN p_resultado FOR
      select periodo,
             divipola,
             nombre_departamento,
             nombre_municipio,
             nombre_coordinador,
             cedula_facilitador,
             nombre_facilitador,
             sigla_grupo,
             tipo_documento_participante,
             documento_participante,
             codigo_beneficiario,
             primernombre_participante,
             segundonombre_participante,
             primerapellido_participante,
             segundoapellido_participante,
             genero,
             condicion,
             tipo_formacion,
             nivel_formacion,
             asistencias,
             hvtipo1 "Tipo1",
             hvtipo2 "Tipo2",
             hvtipo3 "Tipo3",
             hvtipo4 "Tipo4",
             hvtipo5 "Tipo5",
             consideracion,
             circunstancias,
             habilidades,
             leccion,
             'Cargado' "Archivo",
             estado
        from T109_RPT_HISTVIDA
       where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
         and idCoordinador =
             decode(PIdCoordinador, 0, idCoordinador, PIdCoordinador)
         and idDepartamento =
             decode(PIdDepartamento, 0, idDepartamento, PIdDepartamento)
         and idMunicipio =
             decode(PIdMunicipio, 0, idMunicipio, PIdMunicipio)
         and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
         and TIPO_CORTE = decode(p_fec_corte, '0', 'F', TIPO_CORTE)
       ORDER BY periodo,
                divipola;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptHistVida OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptHistVida;

  PROCEDURE Pr_DarRptUsuarSistema(p_idPeriodo      IN NUMBER,
                                  p_idFacilitador  IN NUMBER,
                                  p_idCoordinador  IN NUMBER,
                                  p_idGrupo        IN NUMBER,
                                  p_idDepartamento IN NUMBER,
                                  p_idMunicipio    IN NUMBER,
                                  p_fec_corte      IN varchar2,
                                  p_resultado      OUT PK_UTILS.TY_CURSOR,
                                  p_codError       OUT NUMBER,
                                  p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptUsuarSistema';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptUsuarSistema ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    /* IF p_idPeriodo = 0 THEN
     OPEN p_resultado FOR
       select 0 "DIVIPOLA" FROM DUAL;
       RETURN;
    END IF;
    
     */
  
    OPEN p_resultado FOR
      select a03dane "DIVIPOLA",
             a02nombre "NOMBRE DEPARTAMENTO",
             a03nombre "NOMBRE MUNICIPIO",
             a05nombre "ROL",
             a07identificacion "CEDULA",
             a07primernombre "PRIMER NOMBRE",
             a07segundonombre "SEGUNDO NOMBRE",
             a07primerapellido "PRIMER APELLIDO",
             a07segundoapellido "SEGUNDO APELLIDO",
             TO_CHAR(a07fechanacimiento, 'YYYY-MM-DD') "FECHA NACIMIENTO",
             a07email "EMAIL",
             a07telefono "TELEFONO",
             t06_usuarios.a06estado "ESTADO",
             t06_usuarios.a06fechacreacion "FECHA CREACION",
             t06_usuarios.a06fechamodificacion "FECHA MODIFICACION",
             t06_usuarios.a06fechafin "FECHA FIN CONTRATO",
             t06_usuarios.a06codigo "ID USUARIO"
      
        from t06_usuarios,
             t07_personas,
             t02_departamentos,
             t03_municipios,
             t05_roles,
             t30_ciudadesusuario
       where a06codigo = a07usuario
         and a02codigo = a03departamento
         and a06rol = a05codigo
         and a06codigo = a30usuario
         and a30ciudad = a03codigo;
    /* tmp
           where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
             and FEC_CORTE = p_fec_corte;
    */
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptUsuarSistema OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptUsuarSistema;

  PROCEDURE Pr_DarRptObsEncSatisf(p_idPeriodo      IN NUMBER,
                                  p_idFacilitador  IN NUMBER,
                                  p_idCoordinador  IN NUMBER,
                                  p_idGrupo        IN NUMBER,
                                  p_idDepartamento IN NUMBER,
                                  p_idMunicipio    IN NUMBER,
                                  p_fec_corte      IN varchar2,
                                  p_resultado      OUT PK_UTILS.TY_CURSOR,
                                  p_codError       OUT NUMBER,
                                  p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptObsEncSatisf';
    numReg               NUMBER;
    PIdCoordinador       NUMBER := 0;
    PIdDepartamento      NUMBER := 0;
    PIdMunicipio         NUMBER := 0;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptObsEncSatisf ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    if p_idCoordinador <> -1 then
      PIdCoordinador := p_idCoordinador;
    end if;
    if p_idDepartamento <> -1 then
      PIdDepartamento := p_idDepartamento;
    end if;
    if p_idMunicipio <> -1 then
      PIdMunicipio := p_idMunicipio;
    end if;
  
    OPEN p_resultado FOR
      select periodo "PERIODO",
             nvl(divipola, 0) "DIVIPOLA",
             nomdepartamento "NOMBRE DEPARTAMENTO",
             nommunicipio "NOMBRE MUNICIPIO",
             nombrecoordinador "NOMBRE COORDINADOR",
             nombrefacilitador "NOMBRE FACILITADOR",
             siglagrupo "GRUPO",
             taller "TALLER",
             O.OBSERVACION "OBSERVACION"
      
        from T102_RPT_ENCSATOBS O
      
       where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
         and idfacilitador =
             decode(p_idFacilitador, 0, idfacilitador, p_idFacilitador)
         and idCoordinador =
             decode(PIdCoordinador, 0, idCoordinador, PIdCoordinador)
         and IDGRUPO = decode(p_idGrupo, 0, IDGRUPO, p_idGrupo)
         and idDepartamento =
             decode(PIdDepartamento, 0, idDepartamento, PIdDepartamento)
         and idMunicipio =
             decode(PIdMunicipio, 0, idMunicipio, PIdMunicipio)
         and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
         and TIPO_CORTE = decode(p_fec_corte, '0', 'F', TIPO_CORTE)
       ORDER BY periodo,
             divipola,
             nombrecoordinador,
             nombrefacilitador,
             siglagrupo,
             taller;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptSatisfaccion OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptObsEncSatisf;

  PROCEDURE Pr_DarRptEspaciosFisicos(p_idPeriodo      IN NUMBER,
                                     p_idFacilitador  IN NUMBER,
                                     p_idCoordinador  IN NUMBER,
                                     p_idGrupo        IN NUMBER,
                                     p_idDepartamento IN NUMBER,
                                     p_idMunicipio    IN NUMBER,
                                     p_fec_corte      IN varchar2,
                                     p_resultado      OUT PK_UTILS.TY_CURSOR,
                                     p_codError       OUT NUMBER,
                                     p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptEspaciosFisicos';
    numReg               NUMBER;
    PIdCoordinador       NUMBER := 0;
    PIdDepartamento      NUMBER := 0;
    PIdMunicipio         NUMBER := 0;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptEspaciosFisicos ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    if p_idCoordinador <> -1 then
      PIdCoordinador := p_idCoordinador;
    end if;
    if p_idDepartamento <> -1 then
      PIdDepartamento := p_idDepartamento;
    end if;
    if p_idMunicipio <> -1 then
      PIdMunicipio := p_idMunicipio;
    end if;
  
    OPEN p_resultado FOR
      select PERIODO "PERIODO",
             nvl(divipola, 0) "DIVIPOLA",
             nomdepartamento "NOMBRE DEPARTAMENTO",
             nommunicipio "NOMBRE MUNICIPIO",
             nomcoordinador "NOMBRE COORDINADOR",
             nombrefacilitador "NOMBRE FACILITADOR",
             dia "DIA",
             horario "HORARIO",
             lugar "LUGAR",
             direccion "DIRECCION",
             sigla "SIGLA",
             ESTADO "ESTADO",
             max(fec_modifica) "FECHA MODIFICA"
        from T112_RPT_gestespacios G
       where periodo = decode(P_idPeriodo, 0, periodo, P_idPeriodo)
         and idfacilitador =
             decode(P_idFacilitador, 0, idfacilitador, P_idFacilitador)
         and idCoordinador =
             decode(PIdCoordinador, 0, idCoordinador, PIdCoordinador)
         and idGrupoFacilitador =
             decode(P_idGrupo, 0, idGrupoFacilitador, P_idGrupo)
         and idDepartamento =
             decode(PIdDepartamento, 0, idDepartamento, PIdDepartamento)
         and idMunicipio =
             decode(PIdMunicipio, 0, idMunicipio, PIdMunicipio)
         and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
         and TIPO_CORTE = decode(p_fec_corte, '0', 'F', TIPO_CORTE)
       group by PERIODO,
                nvl(divipola, 0),
                nomdepartamento,
                nommunicipio,
                nomcoordinador,
                nombrefacilitador,
                dia,
                horario,
                lugar,
                direccion,
                sigla,
                ESTADO
       ORDER BY 11, 13;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptEspaciosFisicos OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptEspaciosFisicos;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los departamentos asociados al facilitador
  PARAMETROS    :
  IN    :
         p_idFacilitador
  
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 07/04/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarDptosXProfesional(p_idProfesional IN NUMBER,
                                    p_resultado     OUT PK_UTILS.ty_cursor,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarDptosXProfesional';
    numReg               NUMBER;
    idRol                number;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar departamentos de un profesionla' ||
                            p_idProfesional);
    select a06rol
      into idRol
      from t06_usuarios
     where a06codigo = p_idProfesional;
  
    if (idrol = 8) then
    
      SELECT COUNT(*)
        INTO numReg
        FROM T06_USUARIOS,
             T30_CIUDADESUSUARIO,
             T03_MUNICIPIOS,
             T02_DEPARTAMENTOS
       WHERE a06estado = PK_UTILS.COD_ACTIVO
         AND a06codigo = a30usuario
         AND a30ciudad = a03codigo
         AND a03departamento = a02codigo;
    
      if (numReg = 0) then
        p_codError := 55;
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
        return;
      end if;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    if (idRol = 8) then
      OPEN p_resultado FOR
        SELECT DISTINCT a02codigo,
                        upper(a02nombre) a02nombre,
                        a02dane,
                        a02indicativo,
                        a02estado,
                        a02fechacreacion,
                        a02fechamodificacion,
                        a02usuariocreacion,
                        a02usuariomodificacion
          FROM T06_USUARIOS,
               T30_CIUDADESUSUARIO,
               T03_MUNICIPIOS,
               T02_DEPARTAMENTOS
         WHERE a06estado = PK_UTILS.COD_ACTIVO
           AND a06codigo = a30usuario
           AND a30ciudad = a03codigo
           AND a03departamento = a02codigo
           and a06codigo = p_idProfesional;
    end if;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta departamentos facilitador OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarDptosXProfesional;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar las ciudades asociados al facilitador
                   y departamento
  PARAMETROS    :
  IN    :
         p_idFacilitador
         p_idDepartamento
  
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarMunicipiosXProfesional(p_idProfesional  IN NUMBER,
                                         p_idDepartamento IN NUMBER,
                                         p_resultado      OUT PK_UTILS.ty_cursor,
                                         p_codError       OUT NUMBER,
                                         p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarMunicipiosXProfesional';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar ciudades del facilitador' ||
                            p_idProfesional);
  
    SELECT COUNT(*)
      INTO numReg
      FROM T06_USUARIOS, T30_CIUDADESUSUARIO, T03_MUNICIPIOS
     WHERE a06codigo = p_idProfesional
       and a06estado = PK_UTILS.COD_ACTIVO
       AND a06codigo = a30usuario
       AND a30ciudad = a03codigo
       AND a03departamento = p_idDepartamento;
  
    if (numReg = 0) then
      p_codError := 28;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      SELECT a03codigo,
             a03departamento,
             upper(a03nombre) a03nombre,
             a03dane,
             a03estado,
             a03fechacreacion,
             a03fechamodificacion,
             a03usuariocreacion,
             a03usuariomodificacion
        FROM T06_USUARIOS, T30_CIUDADESUSUARIO, T03_MUNICIPIOS
       WHERE a06codigo = p_idProfesional
         and a06estado = PK_UTILS.COD_ACTIVO
         AND a06codigo = a30usuario
         AND a30ciudad = a03codigo
         AND a03departamento = p_idDepartamento;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta ciudades OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarMunicipiosXProfesional;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar los coordinadores activos registrados
  PARAMETROS    :
  IN    :
  
  
  OUT    :
          p_resultado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado
  
  
  REALIZADO POR    : 
  FECHA CREACION    : 07/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_DarCoordinadoresXPrf(p_idProfesional IN NUMBER,
                                    p_resultado     OUT PK_UTILS.ty_cursor,
                                    p_codError      OUT NUMBER,
                                    p_msjError      OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_DarCoordinadoresXPrf';
    numReg               NUMBER;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar coordinadores del profesional ' ||
                            p_idProfesional);
  
    OPEN p_resultado FOR
      SELECT a06codigo,
             a07primernombre || ' ' || a07segundonombre || ' ' ||
             a07primerapellido || ' ' || a07segundoapellido nombre
        FROM T05_ROLES, T06_USUARIOS, T07_PERSONAS
       WHERE a05codigo = a06rol
         AND a05nombre = 'COORDINADOR TERRITORIAL'
         AND a06codigo = a07usuario;
    -- AND a06estado = PK_UTILS.COD_ACTIVO;
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta cordinadores OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarCoordinadoresXPrf;

  PROCEDURE Pr_DarRptRechazoGrupos(p_idPeriodo      IN NUMBER,
                                   p_idFacilitador  IN NUMBER,
                                   p_idCoordinador  IN NUMBER,
                                   p_idGrupo        IN NUMBER,
                                   p_idDepartamento IN NUMBER,
                                   p_idMunicipio    IN NUMBER,
                                   p_fec_corte      IN varchar2,
                                   p_resultado      OUT PK_UTILS.TY_CURSOR,
                                   p_codError       OUT NUMBER,
                                   p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptRechazoGrupos';
    numReg               NUMBER;
  BEGIN
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    OPEN p_resultado FOR
      select '3' "PERIODO",
             '05001' "DIVIPOLA",
             'Cundinamamrca' "NOMBRE DEPARTAMENTO",
             'Zipaquira' "NOMBRE MUNICIPIO",
             'Juanito Facilitador' "NOMBRE FACILITADOR",
             'PasP2F47G3' "SIGLA GRUPO",
             'Carlos' "PRIMER NOMBRE PARTICIPANTE",
             'Rafael' "SEGUNDO NOMBRE PARTICIPANTE",
             'Beltrán' "PRIMER APELLIDO PARTICIPANTE",
             'Villanueva' "SEGUNDO NOMBRE PARTICIPANTE",
             'Cedula' "TIPO DOCUMENTO",
             '11348169' "DOCUMENTO",
             '104536' "CODIGO BENEFICIARIO",
             '1' "TALLER",
             'Mis observaciones' "OBSERVACIONES"
      
        from dual;
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptRechazoGrupos;

  PROCEDURE Pr_DarRptTrazabilidad(p_idPeriodo      IN NUMBER,
                                  p_idFacilitador  IN NUMBER,
                                  p_idCoordinador  IN NUMBER,
                                  p_idGrupo        IN NUMBER,
                                  p_idDepartamento IN NUMBER,
                                  p_idMunicipio    IN NUMBER,
                                  p_IdUsuario      IN NUMBER,
                                  p_fec_corte      IN varchar2,
                                  p_resultado      OUT PK_UTILS.TY_CURSOR,
                                  p_codError       OUT NUMBER,
                                  p_msjError       OUT VARCHAR2) IS
  
    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarRptTrazabilidad';
    numReg               NUMBER;
    PIdCoordinador       NUMBER := 0;
    PIdDepartamento      NUMBER := 0;
    PIdMunicipio         NUMBER := 0;
  
  BEGIN
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_DarRptTrazabilidad ');
  
    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;
  
    if p_idCoordinador <> -1 then
      PIdCoordinador := p_idCoordinador;
    end if;
    if p_idDepartamento <> -1 then
      PIdDepartamento := p_idDepartamento;
    end if;
    if p_idMunicipio <> -1 then
      PIdMunicipio := p_idMunicipio;
    end if;
  
    OPEN p_resultado FOR
      select p_idPeriodo,
             p_idFacilitador,
             p_idCoordinador,
             p_idGrupo,
             p_idDepartamento,
             p_idMunicipio,
             p_IdUsuario,
             p_fec_corte
        from dual;
    /*    OPEN p_resultado FOR
          select periodo "PERIODO",
                 nvl(divipola, 0) "DIVIPOLA",
                 nomdepartamento "NOMBRE DEPARTAMENTO",
                 nommunicipio "NOMBRE MUNICIPIO",
                 nombrecoordinador "NOMBRE COORDINADOR",
                 cc_facilitador "CEDULA FACILITADOR",
                 nombrefacilitador "NOMBRE FACILITADOR",
                 TipoDocumento "TIPO DOCUMENTO INSCRITO SIJA",
                 documento_inscrito "DOCUMENTO INSCRITO SIJA",
                 nvl(codigo_beneficiario, 0) "CODIGO BENEFICIARIO SIJA",
                 primernombre "PRIMER NOMBRE SIJA",
                 segundonombre "SEGUNDO NOMBRE SIJA",
                 primerapellido "PRIMERO APELLIDO SIJA",
                 segundoapellido "SEGUNDO APELLIDO SIJA",
                 email "EMAIL",
                 telefono "TELEFONO",
                 movil "MOVIL",
                 movilalt "MOVIL ALT",
                 condicion_especial "CONDICION ESPECIAL",
                 municipioestudio "MUNICIPIO ESTUDIO SIJA",
                 tipoformacion "TIPO FORMACION SIJA",
                 nivelformacion "NIVEL FORMACION SIJA",
                 nvl(fichasnies, 0) "FICHA SNIES SIJA",
                 to_char(fechaultmes, 'yyyy-mm-dd') "FECHA ULTIMO MES SIJA",
                 to_char(fechafinsemestrescursados, 'yyyy-mm-dd') "FECHA FIN SEMESTRE SIJA",
                 to_char(finfechaetapapractica, 'yyyy-mm-dd') "FECHA FIN ETAPA PRACTICA SIJA",
                 codigoconvenio "CODIGO CONVENIO SIJA",
                 nvl(snies_ies, 0) "SNIES IES SIJA",
                 programaestado "PROGRAMA ESTADO SIJA",
                 institucion "INSTITUCION SIJA",
                 nvl(to_char(fecultinscrip, 'yyyy-mm-dd'), ' ') "FECHA ULTIMA INSCRIPCION",
                 to_char(encuesta_inicial, 'yyyy-mm-dd') "FECHA ENCUESTA INICIAL",
                 to_char(encuesta_satisfaccion, 'yyyy-mm-dd') "FECHA ENCUESTA SATISFACCION",
                 decode(p_idPeriodo,
                        '0',
                        to_char(encuesta_final_act, 'yyyy-mm-dd'),
                        to_char(encuesta_final, 'yyyy-mm-dd')) "FECHA ENCUESTA FINAL",
                 to_char(taller1, 'yyyy/mm/dd') "FECHA TALLER 1",
                 to_char(taller2, 'yyyy/mm/dd') "FECHA TALLER 2",
                 to_char(taller3, 'yyyy/mm/dd') "FECHA TALLER 3",
                 to_char(taller4, 'yyyy/mm/dd') "FECHA TALLER 4",
                 to_char(taller5, 'yyyy/mm/dd') "FECHA TALLER 5",
                 to_char(taller6, 'yyyy/mm/dd') "FECHA TALLER 6",
                 to_char(taller7, 'yyyy/mm/dd') "FECHA TALLER 7",
                 to_char(taller8, 'yyyy/mm/dd') "FECHA TALLER 8",
                 (nvl(porcasistencia, 0) * 100) "PORCENTAJE ASISTENCIA",
                 nvl(certifica, 'N') "CERTIFICABLE",
                 decode(p_idPeriodo,
                        '0',
                        to_char(fecha_expedicion_act, 'yyyy-mm-dd'),
                        to_char(fecha_expedicion, 'yyyy-mm-dd')) "FECHA DESCARGA CERTIFICADO",
                 nvl(estado, 'A') "ESTADO",
                 comoseentero "COMO SE ENTERO?",
                 reinscrito "REINSCRITO",
                 nvl(vida, 'N') "VIDA",
                 nvl(liderazgo, 'N') "LIDERAZGO",
                 nvl(exito, 'N') "EXITO",
                 genero "GENERO",
                 condicion "CONDICION",
                 GRUPOINSCRIPCION "GRUPO INSCRIPCION",
                 siglagrupo "GRUPO ACTUAL"
            from t101_rpt_trazabilidad
           where periodo = decode(p_idPeriodo, 0, periodo, p_idPeriodo)
             and idfacilitador =
                 decode(p_idFacilitador, 0, idfacilitador, p_idFacilitador)
             and idCoordinador =
                 decode(PIdCoordinador, 0, idCoordinador, PIdCoordinador)
             and grupofacilitador =
                 decode(p_idGrupo, 0, grupofacilitador, p_idGrupo)
             and idDepartamento =
                 decode(PIdDepartamento, 0, idDepartamento, PIdDepartamento)
    --                     and idMunicipio =
    --                         decode(PIdMunicipio, 0, idMunicipio, PIdMunicipio)
             and idMunicipio IN
                 (SELECT c.a30ciudad
                    FROM T30_CIUDADESUSUARIO c
                   WHERE C.A30USUARIO = p_IdUsuario)
                
             and FEC_CORTE = decode(p_fec_corte, '0', FEC_CORTE, p_fec_corte)
             and ((TIPO_CORTE = decode(p_fec_corte, '0', 'P', TIPO_CORTE)) or
                 (FEC_CORTE =
                 decode(p_fec_corte,
                          '0',
                          (select max(FEC_CORTE) from t101_rpt_trazabilidad),
                          p_fec_corte)))
           order by periodo, nomdepartamento, nommunicipio;
    */
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta  Pr_DarRptTrazabilidad OK ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
    
  END Pr_DarRptTrazabilidad;

end PK_RPT_ADMREPORTE;
/

prompt
prompt Creating package body PK_T01_PARTICIPANTES
prompt ==========================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T01_PARTICIPANTES AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T01_PARTICIPANTES
PARAMETROS    :
IN    :
        p_a01municipioestudio
        p_a01tipodocumento
        p_a01documento
        p_a01codigobeneficiario
        p_a01primernombre
        p_a01segundonombre
        p_a01primerapellido
        p_a01segundoapellido
        p_a01fechanacimiento
        p_a01email
        p_a01telefono
        p_a01movil
        p_a01movilalt
        p_a01noconvenio
        p_a01estado
        p_a01finetapapractica
        p_a01finsemestre
        p_a01ultimomes
        p_a01fichasnies
        p_a01nivelformacion
        p_a01sniesies
        p_a01tipoformcion
        p_usuario

OUT    :
        p_a01codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a01municipioestudio    IN T01_PARTICIPANTES.a01municipioestudio%TYPE,
p_a01tipodocumento       IN T01_PARTICIPANTES.a01tipodocumento%TYPE,
p_a01documento           IN T01_PARTICIPANTES.a01documento%TYPE,
p_a01codigobeneficiario  IN T01_PARTICIPANTES.a01codigobeneficiario%TYPE,
p_a01primernombre        IN T01_PARTICIPANTES.a01primernombre%TYPE,
p_a01segundonombre       IN T01_PARTICIPANTES.a01segundonombre%TYPE,
p_a01primerapellido      IN T01_PARTICIPANTES.a01primerapellido%TYPE,
p_a01segundoapellido     IN T01_PARTICIPANTES.a01segundoapellido%TYPE,
p_a01fechanacimiento     IN T01_PARTICIPANTES.a01fechanacimiento%TYPE,
p_a01email               IN T01_PARTICIPANTES.a01email%TYPE,
p_a01telefono            IN T01_PARTICIPANTES.a01telefono%TYPE,
p_a01movil               IN T01_PARTICIPANTES.a01movil%TYPE,
p_a01movilalt            IN T01_PARTICIPANTES.a01movilalt%TYPE,
p_a01noconvenio          IN T01_PARTICIPANTES.a01noconvenio%TYPE,
p_a01estado              IN T01_PARTICIPANTES.a01estado%TYPE,
p_a01finetapapractica    IN T01_PARTICIPANTES.a01finetapapractica%TYPE,
p_a01finsemestre         IN T01_PARTICIPANTES.a01finsemestre%TYPE,
p_a01ultimomes           IN T01_PARTICIPANTES.a01ultimomes%TYPE,
p_a01fichasnies          IN T01_PARTICIPANTES.a01fichasnies%TYPE,
p_a01nivelformacion      IN T01_PARTICIPANTES.a01nivelformacion%TYPE,
p_a01sniesies            IN T01_PARTICIPANTES.a01sniesies%TYPE,
p_a01tipoformcion        IN T01_PARTICIPANTES.a01tipoformcion%TYPE,
p_usuario                IN T01_PARTICIPANTES.a01usuariocreacion%TYPE,
p_a01codigo              OUT T01_PARTICIPANTES.a01codigo%TYPE) IS

BEGIN

p_a01codigo := Pk_Utils.Fn_Obtenerid ('T01_PARTICIPANTES_SEQ');

INSERT INTO T01_PARTICIPANTES(
        a01codigo,
        a01municipioestudio,
        a01tipodocumento,
        a01documento,
        a01codigobeneficiario,
        a01primernombre,
        a01segundonombre,
        a01primerapellido,
        a01segundoapellido,
        a01fechanacimiento,
        a01email,
        a01telefono,
        a01movil,
        a01movilalt,
        a01noconvenio,
        a01estado,
        a01finetapapractica,
        a01finsemestre,
        a01ultimomes,
        a01fichasnies,
        a01nivelformacion,
        a01sniesies,
        a01tipoformcion,
        a01fechacreacion,
        a01fechamodificacion,
        a01usuariocreacion,
        a01usuariomodificacion)
 VALUES (p_a01codigo,
         p_a01municipioestudio,
         p_a01tipodocumento,
         p_a01documento,
         p_a01codigobeneficiario,
         p_a01primernombre,
         p_a01segundonombre,
         p_a01primerapellido,
         p_a01segundoapellido,
         p_a01fechanacimiento,
         p_a01email,
         p_a01telefono,
         p_a01movil,
         p_a01movilalt,
         p_a01noconvenio,
         p_a01estado,
         p_a01finetapapractica,
         p_a01finsemestre,
         p_a01ultimomes,
         p_a01fichasnies,
         p_a01nivelformacion,
         p_a01sniesies,
         p_a01tipoformcion,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T01_PARTICIPANTES
PARAMETROS    :
IN    :
        p_a01codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a01codigo     IN T01_PARTICIPANTES.a01codigo%TYPE,
p_usuario       IN T01_PARTICIPANTES.a01usuariomodificacion%TYPE) IS

BEGIN

UPDATE T01_PARTICIPANTES
   SET a01estado = 2,
       a01fechamodificacion = SYSDATE,
       a01usuariomodificacion = p_usuario
 WHERE a01codigo = p_a01codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T01_PARTICIPANTES
PARAMETROS    :
IN    :
        p_a01codigo
        p_a01municipioestudio
        p_a01tipodocumento
        p_a01documento
        p_a01codigobeneficiario
        p_a01primernombre
        p_a01segundonombre
        p_a01primerapellido
        p_a01segundoapellido
        p_a01fechanacimiento
        p_a01email
        p_a01telefono
        p_a01movil
        p_a01movilalt
        p_a01noconvenio
        p_a01estado
        p_a01finetapapractica
        p_a01finsemestre
        p_a01ultimomes
        p_a01fichasnies
        p_a01nivelformacion
        p_a01sniesies
        p_a01tipoformcion
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a01codigo              IN T01_PARTICIPANTES.a01codigo%TYPE,
p_a01municipioestudio    IN T01_PARTICIPANTES.a01municipioestudio%TYPE,
p_a01tipodocumento       IN T01_PARTICIPANTES.a01tipodocumento%TYPE,
p_a01documento           IN T01_PARTICIPANTES.a01documento%TYPE,
p_a01codigobeneficiario  IN T01_PARTICIPANTES.a01codigobeneficiario%TYPE,
p_a01primernombre        IN T01_PARTICIPANTES.a01primernombre%TYPE,
p_a01segundonombre       IN T01_PARTICIPANTES.a01segundonombre%TYPE,
p_a01primerapellido      IN T01_PARTICIPANTES.a01primerapellido%TYPE,
p_a01segundoapellido     IN T01_PARTICIPANTES.a01segundoapellido%TYPE,
p_a01fechanacimiento     IN T01_PARTICIPANTES.a01fechanacimiento%TYPE,
p_a01email               IN T01_PARTICIPANTES.a01email%TYPE,
p_a01telefono            IN T01_PARTICIPANTES.a01telefono%TYPE,
p_a01movil               IN T01_PARTICIPANTES.a01movil%TYPE,
p_a01movilalt            IN T01_PARTICIPANTES.a01movilalt%TYPE,
p_a01noconvenio          IN T01_PARTICIPANTES.a01noconvenio%TYPE,
p_a01estado              IN T01_PARTICIPANTES.a01estado%TYPE,
p_a01finetapapractica    IN T01_PARTICIPANTES.a01finetapapractica%TYPE,
p_a01finsemestre         IN T01_PARTICIPANTES.a01finsemestre%TYPE,
p_a01ultimomes           IN T01_PARTICIPANTES.a01ultimomes%TYPE,
p_a01fichasnies          IN T01_PARTICIPANTES.a01fichasnies%TYPE,
p_a01nivelformacion      IN T01_PARTICIPANTES.a01nivelformacion%TYPE,
p_a01sniesies            IN T01_PARTICIPANTES.a01sniesies%TYPE,
p_a01tipoformcion        IN T01_PARTICIPANTES.a01tipoformcion%TYPE,
p_usuario                IN T01_PARTICIPANTES.a01usuariocreacion%TYPE) IS

BEGIN

UPDATE T01_PARTICIPANTES
   SET a01municipioestudio = p_a01municipioestudio,
       a01tipodocumento = p_a01tipodocumento,
       a01documento = p_a01documento,
       a01codigobeneficiario = p_a01codigobeneficiario,
       a01primernombre = p_a01primernombre,
       a01segundonombre = p_a01segundonombre,
       a01primerapellido = p_a01primerapellido,
       a01segundoapellido = p_a01segundoapellido,
       a01fechanacimiento = p_a01fechanacimiento,
       a01email = p_a01email,
       a01telefono = p_a01telefono,
       a01movil = p_a01movil,
       a01movilalt = p_a01movilalt,
       a01noconvenio = p_a01noconvenio,
       a01estado = p_a01estado,
       a01finetapapractica = p_a01finetapapractica,
       a01finsemestre = p_a01finsemestre,
       a01ultimomes = p_a01ultimomes,
       a01fichasnies = p_a01fichasnies,
       a01nivelformacion = p_a01nivelformacion,
       a01sniesies = p_a01sniesies,
       a01tipoformcion = p_a01tipoformcion,
       a01fechamodificacion = SYSDATE,
       a01usuariomodificacion = p_usuario
 WHERE a01codigo = p_a01codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T01_PARTICIPANTES
PARAMETROS    :
IN    :
        p_a01codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a01codigo     IN T01_PARTICIPANTES.a01codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T01_PARTICIPANTES
 WHERE a01codigo = NVL(p_a01codigo,a01codigo);

END Pr_Consultar;

END PK_T01_PARTICIPANTES;
/

prompt
prompt Creating package body PK_T02_DEPARTAMENTOS
prompt ==========================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T02_DEPARTAMENTOS AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla     T02_DEPARTAMENTOS
PARAMETROS    :
IN    :
        p_a02nombre
        p_a02dane
        p_a02indicativo
        p_a02estado
        p_usuario

OUT    :
        p_a02codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a02nombre     IN T02_DEPARTAMENTOS.a02nombre%TYPE,
p_a02dane       IN T02_DEPARTAMENTOS.a02dane%TYPE,
p_a02indicativo IN T02_DEPARTAMENTOS.a02indicativo%TYPE,
p_a02estado     IN T02_DEPARTAMENTOS.a02estado%TYPE,
p_usuario       IN T02_DEPARTAMENTOS.a02usuariocreacion%TYPE,
p_a02codigo     OUT T02_DEPARTAMENTOS.a02codigo%TYPE) IS

BEGIN

p_a02codigo := Pk_Utils.Fn_Obtenerid ('T02_DEPARTAMENTOS_SEQ');

INSERT INTO T02_DEPARTAMENTOS(
        a02codigo,
        a02nombre,
        a02dane,
        a02indicativo,
        a02estado,
        a02fechacreacion,
        a02fechamodificacion,
        a02usuariocreacion,
        a02usuariomodificacion)
 VALUES (p_a02codigo,
         p_a02nombre,
         p_a02dane,
         p_a02indicativo,
         p_a02estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T02_DEPARTAMENTOS
PARAMETROS    :
IN    :
        p_a02codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a02codigo     IN T02_DEPARTAMENTOS.a02codigo%TYPE,
p_usuario       IN T02_DEPARTAMENTOS.a02usuariomodificacion%TYPE) IS

BEGIN

UPDATE T02_DEPARTAMENTOS
   SET a02estado = 'I',
       a02fechamodificacion = SYSDATE,
       a02usuariomodificacion = p_usuario
 WHERE a02codigo = p_a02codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T02_DEPARTAMENTOS
PARAMETROS    :
IN    :
        p_a02codigo
        p_a02nombre
        p_a02dane
        p_a02indicativo
        p_a02estado
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a02codigo     IN T02_DEPARTAMENTOS.a02codigo%TYPE,
p_a02nombre     IN T02_DEPARTAMENTOS.a02nombre%TYPE,
p_a02dane       IN T02_DEPARTAMENTOS.a02dane%TYPE,
p_a02indicativo IN T02_DEPARTAMENTOS.a02indicativo%TYPE,
p_a02estado     IN T02_DEPARTAMENTOS.a02estado%TYPE,
p_usuario       IN T02_DEPARTAMENTOS.a02usuariomodificacion%TYPE) IS

BEGIN

UPDATE T02_DEPARTAMENTOS
   SET a02nombre = p_a02nombre,
       a02dane = p_a02dane,
       a02indicativo = p_a02indicativo,
       a02estado = p_a02estado,
       a02fechamodificacion = SYSDATE,
       a02usuariomodificacion = p_usuario
 WHERE a02codigo = p_a02codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T02_DEPARTAMENTOS
PARAMETROS    :
IN    :
        p_a02codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a02codigo     IN T02_DEPARTAMENTOS.a02codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T02_DEPARTAMENTOS
 WHERE a02codigo = NVL(p_a02codigo,a02codigo);

END Pr_Consultar;

END PK_T02_DEPARTAMENTOS;
/

prompt
prompt Creating package body PK_T03_MUNICIPIOS
prompt =======================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T03_MUNICIPIOS AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla 	T03_MUNICIPIOS
PARAMETROS    :
IN    :
        p_a03nombre
        p_a03dane
		p_a03departamento
		p_a03estado
        p_usuario

OUT    :
        p_a03codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a03departamento IN T03_MUNICIPIOS.a03departamento%TYPE,
p_a03nombre       IN T03_MUNICIPIOS.a03nombre%TYPE,
p_a03dane         IN T03_MUNICIPIOS.a03dane%TYPE,
p_a03estado       IN T03_MUNICIPIOS.a03estado%TYPE,
p_usuario         IN T03_MUNICIPIOS.a03usuariocreacion%TYPE,
p_a03codigo       OUT T03_MUNICIPIOS.a03codigo%TYPE) IS

BEGIN

p_a03codigo := Pk_Utils.Fn_Obtenerid ('T03_MUNICIPIOS_SEQ');

INSERT INTO T03_MUNICIPIOS(
        a03codigo,
        a03departamento,
		a03nombre,
        a03dane,
		a03estado,
        a03fechacreacion,
        a03fechamodificacion,
        a03usuariocreacion,
        a03usuariomodificacion)
 VALUES (p_a03codigo,
         p_a03departamento,
		 p_a03nombre,
         p_a03dane,
		 p_a03estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T03_MUNICIPIOS
PARAMETROS    :
IN    :
        p_a03codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a03codigo     IN T03_MUNICIPIOS.a03codigo%TYPE,
p_usuario       IN T03_MUNICIPIOS.a03usuariomodificacion%TYPE) IS

BEGIN

UPDATE T03_MUNICIPIOS
   SET a03estado = 'I',
       a03fechamodificacion = SYSDATE,
       a03usuariomodificacion = p_usuario
 WHERE a03codigo = p_a03codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T03_MUNICIPIOS
PARAMETROS    :
IN    :
        p_a03codigo
        p_a03nombre
        p_a03dane
		p_a03departamento
		p_a03estado
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a03codigo       IN T03_MUNICIPIOS.a03codigo%TYPE,
p_a03departamento IN T03_MUNICIPIOS.a03departamento%TYPE,
p_a03nombre       IN T03_MUNICIPIOS.a03nombre%TYPE,
p_a03dane         IN T03_MUNICIPIOS.a03dane%TYPE,
p_a03estado       IN T03_MUNICIPIOS.a03estado%TYPE,
p_usuario         IN T03_MUNICIPIOS.a03usuariomodificacion%TYPE) IS

BEGIN

UPDATE T03_MUNICIPIOS
   SET a03nombre = p_a03nombre,
       a03departamento = p_a03departamento,
	   a03dane = p_a03dane,
	   a03estado = p_a03estado,
       a03fechamodificacion = SYSDATE,
       a03usuariomodificacion = p_usuario
 WHERE a03codigo = p_a03codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T03_MUNICIPIOS
PARAMETROS    :
IN    :
        p_a03codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a03codigo     IN T03_MUNICIPIOS.a03codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T03_MUNICIPIOS
 WHERE a03codigo = NVL(p_a03codigo,a03codigo);

END Pr_Consultar;

  /********************************************************************************
   DESCRIPCION   : Funcion para devolver el nombre del municipio

   PARAMETROS    :
   IN            : p_a03codigo    Codigo del error

   OUT           : v_nombre    Retorna el nombre del municipio

  REALIZADO POR    : 
                      

  FECHA CREACION    : 26/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/
  FUNCTION fn_ObtenerNombre(p_a03codigo  IN T03_MUNICIPIOS.a03codigo%TYPE) RETURN VARCHAR2 IS

    CURSOR c_nombre IS
      SELECT a03nombre
        FROM T03_MUNICIPIOS
       WHERE a03codigo = p_a03codigo;

    v_nombre T03_MUNICIPIOS.a03nombre%TYPE;

  BEGIN

    OPEN c_nombre;
     FETCH c_nombre INTO v_nombre;
    CLOSE c_nombre;

    RETURN v_nombre;

  END fn_ObtenerNombre;

END PK_T03_MUNICIPIOS;
/

prompt
prompt Creating package body PK_T05_ROLES
prompt ==================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T05_ROLES AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T05_ROLES
PARAMETROS    :
IN    :
        p_a05nombre
        p_a05estado
        p_usuario

OUT    :
        p_a05codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a05nombre     IN T05_ROLES.a05nombre%TYPE,
p_a05estado     IN T05_ROLES.a05estado%TYPE,
p_usuario       IN T05_ROLES.a05usuariocreacion%TYPE,
p_a05codigo     OUT T05_ROLES.a05codigo%TYPE) IS

BEGIN

p_a05codigo := Pk_Utils.Fn_Obtenerid ('T05_ROLES_SEQ');

INSERT INTO T05_ROLES(
        a05codigo,
        a05nombre,
        a05estado,
        a05fechacreacion,
        a05fechamodificacion,
        a05usuariocreacion,
        a05usuariomodificacion)
 VALUES (p_a05codigo,
         p_a05nombre,
         p_a05estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T05_ROLES
PARAMETROS    :
IN    :
        p_a05codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a05codigo     IN T05_ROLES.a05codigo%TYPE,
p_usuario       IN T05_ROLES.a05usuariomodificacion%TYPE) IS

BEGIN

UPDATE T05_ROLES
   SET a05estado = 'I',
       a05fechamodificacion = SYSDATE,
       a05usuariomodificacion = p_usuario
 WHERE a05codigo = p_a05codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T05_ROLES
PARAMETROS    :
IN    :
        p_a05codigo
        p_a05nombre
        p_a05estado
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a05codigo     IN T05_ROLES.a05codigo%TYPE,
p_a05nombre     IN T05_ROLES.a05nombre%TYPE,
p_a05estado     IN T05_ROLES.a05estado%TYPE,
p_usuario       IN T05_ROLES.a05usuariomodificacion%TYPE) IS

BEGIN

UPDATE T05_ROLES
   SET a05nombre = p_a05nombre,
       a05estado = p_a05estado,
       a05fechamodificacion = SYSDATE,
       a05usuariomodificacion = p_usuario
 WHERE a05codigo = p_a05codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T05_ROLES
PARAMETROS    :
IN    :
        p_a05codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a05codigo     IN T05_ROLES.a05codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T05_ROLES
 WHERE a05codigo = NVL(p_a05codigo,a05codigo);

END Pr_Consultar;

END PK_T05_ROLES;
/

prompt
prompt Creating package body PK_T06_USUARIOS
prompt =====================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T06_USUARIOS AS
  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                   registro en la tabla T06_USUARIOS
  PARAMETROS    :
  IN    :
          p_a06rol
          p_a06coordinador
      p_a06usuario
      p_a06clave
      p_a06estado
          p_usuario

  OUT    :
          p_a06codigo

  REALIZADO POR    : 
                      

  FECHA CREACION    : 04/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a06rol         IN T06_USUARIOS.a06rol%TYPE,
                        p_a06coordinador IN T06_USUARIOS.a06coordinador%TYPE,
                        p_a06perfil      IN T06_USUARIOS.a06perfil%TYPE,
                        p_a06usuario     IN T06_USUARIOS.a06usuario%TYPE,
                        p_a06clave       IN T06_USUARIOS.a06clave%TYPE,
                        p_a06estado      IN T06_USUARIOS.a06estado%TYPE,
                        p_usuario        IN T06_USUARIOS.a06usuariocreacion%TYPE,
                        p_a06codigo      OUT T06_USUARIOS.a06codigo%TYPE) IS

  BEGIN

    p_a06codigo := Pk_Utils.Fn_Obtenerid('T06_USUARIOS_SEQ');

    INSERT INTO T06_USUARIOS
      (a06codigo,
       a06rol,
       a06perfil,
       a06coordinador,
       a06usuario,
       a06clave,
       a06estado,
       a06fechacreacion,
       a06fechamodificacion,
       a06usuariocreacion,
       a06usuariomodificacion)
    VALUES
      (p_a06codigo,
       p_a06rol,
       p_a06perfil,
       p_a06coordinador,
       p_a06usuario,
       p_a06clave,
       p_a06estado,
       SYSDATE,
       SYSDATE,
       p_usuario,
       p_usuario);

  END Pr_Insertar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar el estado del registro
                   en la tabla T06_USUARIOS
  PARAMETROS    :
  IN    :
          p_a06codigo
          p_usuario

  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 04/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Eliminar(p_a06codigo IN T06_USUARIOS.a06codigo%TYPE,
                        p_usuario   IN T06_USUARIOS.a06usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T06_USUARIOS
       SET a06estado              = 'I',
           a06fechamodificacion   = SYSDATE,
           a06usuariomodificacion = p_usuario
     WHERE a06codigo = p_a06codigo;

  END Pr_Eliminar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                   registro en la tabla T06_USUARIOS
  PARAMETROS    :
  IN    :
          p_a06codigo
          p_a06rol
          p_a06coordinador
          p_a06usuario
          p_a06estado
          p_usuario

  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 04/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Actualizar(p_a06codigo      IN T06_USUARIOS.a06codigo%TYPE,
                          p_a06rol         IN T06_USUARIOS.a06rol%TYPE,
                          p_a06perfil      IN T06_USUARIOS.a06perfil%TYPE,
                          p_a06coordinador IN T06_USUARIOS.a06coordinador%TYPE,
                          p_a06usuario     IN T06_USUARIOS.a06usuario%TYPE,
                          p_a06clave       IN T06_USUARIOS.a06clave%TYPE,
                          p_a06estado      IN T06_USUARIOS.a06estado%TYPE,
                          p_usuario        IN T06_USUARIOS.a06usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T06_USUARIOS
       SET a06rol                 = p_a06rol,
           a06perfil              = p_a06perfil,
           a06coordinador         = p_a06coordinador,
           a06usuario             = p_a06usuario,
           a06clave               = p_a06clave,
           a06estado              = p_a06estado,
           a06fechamodificacion   = SYSDATE,
           a06usuariomodificacion = p_usuario
     WHERE a06codigo = p_a06codigo;

  END Pr_Actualizar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T06_USUARIOS
  PARAMETROS    :
  IN    :
          p_a06codigo

  OUT    :
          p_resultado

  REALIZADO POR    : 
  FECHA CREACION    : 04/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Consultar(p_a06codigo IN T06_USUARIOS.a06codigo%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor) IS

  BEGIN

    OPEN p_resultado FOR
      SELECT *
        FROM T06_USUARIOS
       WHERE a06codigo = NVL(p_a06codigo, a06codigo);

  END Pr_Consultar;

END PK_T06_USUARIOS;
/

prompt
prompt Creating package body PK_T07_PERSONAS
prompt =====================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T07_PERSONAS AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T07_PERSONAS
PARAMETROS    :
IN    :
        p_a07usuario
        p_a07tipodocumento
        p_a07identificacion
        p_a07primernombre
        p_a07segundonombre
        p_a07primerapellido
        p_a07segundoapellido
        p_a07fechanacimiento
        p_a07email
        p_a07telefono
        p_a07movil
        p_a07movilalt
        p_usuario

OUT    :
        p_a07codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 04/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a07usuario             IN T07_PERSONAS.a07usuario%TYPE,
p_a07tipodocumento       IN T07_PERSONAS.a07tipodocumento%TYPE,
p_a07identificacion      IN T07_PERSONAS.a07identificacion%TYPE,
p_a07primernombre        IN T07_PERSONAS.a07primernombre%TYPE,
p_a07segundonombre       IN T07_PERSONAS.a07segundonombre%TYPE,
p_a07primerapellido      IN T07_PERSONAS.a07primerapellido%TYPE,
p_a07segundoapellido     IN T07_PERSONAS.a07segundoapellido%TYPE,
p_a07fechanacimiento     IN T07_PERSONAS.a07fechanacimiento%TYPE,
p_a07email               IN T07_PERSONAS.a07email%TYPE,
p_a07telefono            IN T07_PERSONAS.a07telefono%TYPE,
p_a07movil               IN T07_PERSONAS.a07movil%TYPE,
p_a07movilalt            IN T07_PERSONAS.a07movilalt%TYPE,
p_usuario                IN T07_PERSONAS.a07usuariocreacion%TYPE,
p_a07codigo              OUT T07_PERSONAS.a07codigo%TYPE) IS

BEGIN

p_a07codigo := Pk_Utils.Fn_Obtenerid ('T07_PERSONAS_SEQ');

INSERT INTO T07_PERSONAS(
        a07codigo,
        a07usuario,
        a07tipodocumento,
        a07identificacion,
        a07primernombre,
        a07segundonombre,
        a07primerapellido,
        a07segundoapellido,
        a07fechanacimiento,
        a07email,
        a07telefono,
        a07movil,
        a07movilalt,
        a07fechacreacion,
        a07fechamodificacion,
        a07usuariocreacion,
        a07usuariomodificacion)
 VALUES (p_a07codigo,
         p_a07usuario,
         p_a07tipodocumento,
         p_a07identificacion,
         p_a07primernombre,
         p_a07segundonombre,
         p_a07primerapellido,
         p_a07segundoapellido,
         p_a07fechanacimiento,
         p_a07email,
         p_a07telefono,
         p_a07movil,
         p_a07movilalt,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T07_PERSONAS
PARAMETROS    :
IN    :
        p_a07codigo
        p_a07usuario
        p_a07tipodocumento
        p_a07identificacion
        p_a07primernombre
        p_a07segundonombre
        p_a07primerapellido
        p_a07segundoapellido
        p_a07fechanacimiento
        p_a07email
        p_a07telefono
        p_a07movil
        p_a07movilalt
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 04/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a07codigo              IN T07_PERSONAS.a07codigo%TYPE,
p_a07usuario             IN T07_PERSONAS.a07usuario%TYPE,
p_a07tipodocumento       IN T07_PERSONAS.a07tipodocumento%TYPE,
p_a07identificacion      IN T07_PERSONAS.a07identificacion%TYPE,
p_a07primernombre        IN T07_PERSONAS.a07primernombre%TYPE,
p_a07segundonombre       IN T07_PERSONAS.a07segundonombre%TYPE,
p_a07primerapellido      IN T07_PERSONAS.a07primerapellido%TYPE,
p_a07segundoapellido     IN T07_PERSONAS.a07segundoapellido%TYPE,
p_a07fechanacimiento     IN T07_PERSONAS.a07fechanacimiento%TYPE,
p_a07email               IN T07_PERSONAS.a07email%TYPE,
p_a07telefono            IN T07_PERSONAS.a07telefono%TYPE,
p_a07movil               IN T07_PERSONAS.a07movil%TYPE,
p_a07movilalt            IN T07_PERSONAS.a07movilalt%TYPE,
p_usuario                IN T07_PERSONAS.a07usuariocreacion%TYPE) IS

BEGIN

UPDATE T07_PERSONAS
   SET a07usuario = p_a07usuario,
       a07tipodocumento = p_a07tipodocumento,
       a07identificacion = p_a07identificacion,
       a07primernombre = p_a07primernombre,
       a07segundonombre = p_a07segundonombre,
       a07primerapellido = p_a07primerapellido,
       a07segundoapellido = p_a07segundoapellido,
       a07fechanacimiento = p_a07fechanacimiento,
       a07email = p_a07email,
       a07telefono = p_a07telefono,
       a07movil = p_a07movil,
       a07movilalt = p_a07movilalt,
       a07fechamodificacion = SYSDATE,
       a07usuariomodificacion = p_usuario
 WHERE a07codigo = p_a07codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T07_PERSONAS
PARAMETROS    :
IN    :
        p_a07codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 04/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a07codigo     IN T07_PERSONAS.a07codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T07_PERSONAS
 WHERE a07codigo = NVL(p_a07codigo,a07codigo);

END Pr_Consultar;

END PK_T07_PERSONAS;
/

prompt
prompt Creating package body PK_T12_PERIODOS
prompt =====================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T12_PERIODOS AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T12_PERIODOS
PARAMETROS    :
IN    :
        p_a12nombre
		p_a12fechainicio
		p_a12fechafin
        p_a12estado
		p_a12noperiodo
        p_usuario

OUT    :
        p_a12codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a12nombre      IN T12_PERIODOS.a12nombre%TYPE,
p_a12fechainicio IN T12_PERIODOS.a12fechainicio%TYPE,
p_a12fechafin    IN T12_PERIODOS.a12fechafin%TYPE,
p_a12estado      IN T12_PERIODOS.a12estado%TYPE,
p_a12noperiodo   IN T12_PERIODOS.a12noperiodo%TYPE,
p_usuario        IN T12_PERIODOS.a12usuariocreacion%TYPE,
p_a12codigo      OUT T12_PERIODOS.a12codigo%TYPE) IS

BEGIN

p_a12codigo := Pk_Utils.Fn_Obtenerid ('T12_PERIODOS_SEQ');

INSERT INTO T12_PERIODOS(
        a12codigo,
        a12nombre,
		a12fechainicio,
		a12fechafin,
        a12estado,
		a12noperiodo,
        a12fechacreacion,
        a12fechamodificacion,
        a12usuariocreacion,
        a12usuariomodificacion)
 VALUES (p_a12codigo,
         p_a12nombre,
		 p_a12fechainicio,
		 p_a12fechafin,
         p_a12estado,
		 p_a12noperiodo,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T12_PERIODOS
PARAMETROS    :
IN    :
        p_a12codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a12codigo     IN T12_PERIODOS.a12codigo%TYPE,
p_usuario       IN T12_PERIODOS.a12usuariomodificacion%TYPE) IS

BEGIN

UPDATE T12_PERIODOS
   SET a12estado = 'I',
       a12fechamodificacion = SYSDATE,
       a12usuariomodificacion = p_usuario
 WHERE a12codigo = p_a12codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T12_PERIODOS
PARAMETROS    :
IN    :
        p_a12codigo
        p_a12nombre
		p_a12fechainicio
		p_a12fechafin
        p_a12estado
		p_a12noperiodo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a12codigo      IN T12_PERIODOS.a12codigo%TYPE,
p_a12nombre      IN T12_PERIODOS.a12nombre%TYPE,
p_a12fechainicio IN T12_PERIODOS.a12fechainicio%TYPE,
p_a12fechafin    IN T12_PERIODOS.a12fechafin%TYPE,
p_a12estado      IN T12_PERIODOS.a12estado%TYPE,
p_a12noperiodo   IN T12_PERIODOS.a12noperiodo%TYPE,
p_usuario        IN T12_PERIODOS.a12usuariomodificacion%TYPE) IS

BEGIN

UPDATE T12_PERIODOS
   SET a12nombre = p_a12nombre,
       a12fechainicio = p_a12fechainicio,
       a12fechafin = p_a12fechafin,
       a12estado = p_a12estado,
       a12noperiodo = p_a12noperiodo,
       a12fechamodificacion = SYSDATE,
       a12usuariomodificacion = p_usuario
 WHERE a12codigo = p_a12codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T12_PERIODOS
PARAMETROS    :
IN    :
        p_a12codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a12codigo     IN T12_PERIODOS.a12codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T12_PERIODOS
 WHERE a12codigo = NVL(p_a12codigo,a12codigo);

END Pr_Consultar;

END PK_T12_PERIODOS;
/

prompt
prompt Creating package body PK_T13_ENCUESTAPREGUNTAS
prompt ==============================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T13_ENCUESTAPREGUNTAS AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T13_ENCUESTAPREGUNTAS
PARAMETROS    :
IN    :
        p_a13numero
		p_a13pregunta
		p_a13encuesta
        p_a13estado
        p_usuario

OUT    :
        p_a13codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a13numero    IN T13_ENCUESTAPREGUNTAS.a13numero%TYPE,
p_a13pregunta  IN T13_ENCUESTAPREGUNTAS.a13pregunta%TYPE,
p_a13encuesta  IN T13_ENCUESTAPREGUNTAS.a13encuesta%TYPE,
p_a13estado    IN T13_ENCUESTAPREGUNTAS.a13estado%TYPE,
p_usuario      IN T13_ENCUESTAPREGUNTAS.a13usuariocreacion%TYPE,
p_a13codigo    OUT T13_ENCUESTAPREGUNTAS.a13codigo%TYPE) IS

BEGIN

p_a13codigo := Pk_Utils.Fn_Obtenerid ('T13_ENCUESTAPREGUNTAS_SEQ');

INSERT INTO T13_ENCUESTAPREGUNTAS(
        a13codigo,
        a13numero,
        a13pregunta,
        a13encuesta,
        a13estado,
        a13fechacreacion,
        a13fechamodificacion,
        a13usuariocreacion,
        a13usuariomodificacion)
 VALUES (p_a13codigo,
         p_a13numero,
         p_a13pregunta,
         p_a13encuesta,
         p_a13estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T13_ENCUESTAPREGUNTAS
PARAMETROS    :
IN    :
        p_a13codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a13codigo     IN T13_ENCUESTAPREGUNTAS.a13codigo%TYPE,
p_usuario       IN T13_ENCUESTAPREGUNTAS.a13usuariomodificacion%TYPE) IS

BEGIN

UPDATE T13_ENCUESTAPREGUNTAS
   SET a13estado = 'I',
       a13fechamodificacion = SYSDATE,
       a13usuariomodificacion = p_usuario
 WHERE a13codigo = p_a13codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T13_ENCUESTAPREGUNTAS
PARAMETROS    :
IN    :
        p_a13codigo
        p_a13numero
        p_a13pregunta
        p_a13encuesta
        p_a13estado
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a13codigo    IN T13_ENCUESTAPREGUNTAS.a13codigo%TYPE,
p_a13numero    IN T13_ENCUESTAPREGUNTAS.a13numero%TYPE,
p_a13pregunta  IN T13_ENCUESTAPREGUNTAS.a13pregunta%TYPE,
p_a13encuesta  IN T13_ENCUESTAPREGUNTAS.a13encuesta%TYPE,
p_a13estado    IN T13_ENCUESTAPREGUNTAS.a13estado%TYPE,
p_usuario      IN T13_ENCUESTAPREGUNTAS.a13usuariomodificacion%TYPE) IS

BEGIN

UPDATE T13_ENCUESTAPREGUNTAS
   SET a13numero = p_a13numero,
       a13pregunta = p_a13pregunta,
       a13encuesta = p_a13encuesta,
       a13estado = p_a13estado,
       a13fechamodificacion = SYSDATE,
       a13usuariomodificacion = p_usuario
 WHERE a13codigo = p_a13codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T13_ENCUESTAPREGUNTAS
PARAMETROS    :
IN    :
        p_a13codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a13codigo     IN T13_ENCUESTAPREGUNTAS.a13codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T13_ENCUESTAPREGUNTAS
 WHERE a13codigo = NVL(p_a13codigo,a13codigo);

END Pr_Consultar;

END PK_T13_ENCUESTAPREGUNTAS;
/

prompt
prompt Creating package body PK_T14_ENCUESTARESPUESTAS
prompt ===============================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T14_ENCUESTARESPUESTAS AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T14_ENCUESTARESPUESTAS
PARAMETROS    :
IN    :
        p_a14pregunta
		p_a14letra
		p_a14respuesta
		p_a14correcta
        p_a14estado
        p_usuario

OUT    :
        p_a14codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a14pregunta    IN T14_ENCUESTARESPUESTAS.a14pregunta%TYPE,
p_a14letra       IN T14_ENCUESTARESPUESTAS.a14letra%TYPE,
p_a14respuesta   IN T14_ENCUESTARESPUESTAS.a14respuesta%TYPE,
p_a14correcta    IN T14_ENCUESTARESPUESTAS.a14correcta%TYPE,
p_a14estado      IN T14_ENCUESTARESPUESTAS.a14estado%TYPE,
p_usuario        IN T14_ENCUESTARESPUESTAS.a14usuariocreacion%TYPE,
p_a14codigo      OUT T14_ENCUESTARESPUESTAS.a14codigo%TYPE) IS

BEGIN

p_a14codigo := Pk_Utils.Fn_Obtenerid ('T14_ENCUESTARESPUESTAS_SEQ');

INSERT INTO T14_ENCUESTARESPUESTAS(
        a14codigo,
        a14pregunta,
        a14letra,
        a14respuesta,
        a14correcta,
        a14estado,
        a14fechacreacion,
        a14fechamodificacion,
        a14usuariocreacion,
        a14usuariomodificacion)
 VALUES (p_a14codigo,
         p_a14pregunta,
         p_a14letra,
         p_a14respuesta,
         p_a14correcta,
         p_a14estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T14_ENCUESTARESPUESTAS
PARAMETROS    :
IN    :
        p_a14codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a14codigo     IN T14_ENCUESTARESPUESTAS.a14codigo%TYPE,
p_usuario       IN T14_ENCUESTARESPUESTAS.a14usuariomodificacion%TYPE) IS

BEGIN

UPDATE T14_ENCUESTARESPUESTAS
   SET a14estado = 'I',
       a14fechamodificacion = SYSDATE,
       a14usuariomodificacion = p_usuario
 WHERE a14codigo = p_a14codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T14_ENCUESTARESPUESTAS
PARAMETROS    :
IN    :
        p_a14codigo
        p_a14pregunta
        p_a14letra
        p_a14respuesta
        p_a14correcta
        p_a14estado
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a14codigo      IN T14_ENCUESTARESPUESTAS.a14codigo%TYPE,
p_a14pregunta    IN T14_ENCUESTARESPUESTAS.a14pregunta%TYPE,
p_a14letra       IN T14_ENCUESTARESPUESTAS.a14letra%TYPE,
p_a14respuesta   IN T14_ENCUESTARESPUESTAS.a14respuesta%TYPE,
p_a14correcta    IN T14_ENCUESTARESPUESTAS.a14correcta%TYPE,
p_a14estado      IN T14_ENCUESTARESPUESTAS.a14estado%TYPE,
p_usuario        IN T14_ENCUESTARESPUESTAS.a14usuariomodificacion%TYPE) IS

BEGIN

UPDATE T14_ENCUESTARESPUESTAS
   SET a14pregunta = p_a14pregunta,
       a14letra = p_a14letra,
       a14respuesta = p_a14respuesta,
       a14correcta = p_a14correcta,
       a14estado = p_a14estado,
       a14fechamodificacion = SYSDATE,
       a14usuariomodificacion = p_usuario
 WHERE a14codigo = p_a14codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T14_ENCUESTARESPUESTAS
PARAMETROS    :
IN    :
        p_a14codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a14codigo     IN T14_ENCUESTARESPUESTAS.a14codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T14_ENCUESTARESPUESTAS
 WHERE a14codigo = NVL(p_a14codigo,a14codigo);

END Pr_Consultar;

END PK_T14_ENCUESTARESPUESTAS;
/

prompt
prompt Creating package body PK_T15_INSCRITOS
prompt ======================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T15_INSCRITOS AS
  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                   registro en la tabla T15_INSCRITOS
  PARAMETROS    :
  IN    :
          p_a15grupofacilitador
          p_a15tipodocumento
          p_a15documento
          p_a15codigobeneficiario
          p_a15primernombre
          p_a15segundonombre
          p_a15primerapellido
          p_a15segundoapellido
          p_a15fechanacimiento
          p_a15email
          p_a15telefono
          p_a15movil
          p_a15movilalt
          p_a15confirmacion
          p_a15estado
          p_usuario

  OUT    :
          p_a15codigo

  REALIZADO POR    : 
                      

  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a15grupofacilitador   IN T15_INSCRITOS.a15grupofacilitador%TYPE,
                        p_a15tipodocumento      IN T15_INSCRITOS.a15tipodocumento%TYPE,
                        p_a15documento          IN T15_INSCRITOS.a15documento%TYPE,
                        p_a15codigobeneficiario IN T15_INSCRITOS.a15codigobeneficiario%TYPE,
                        p_a15primernombre       IN T15_INSCRITOS.a15primernombre%TYPE,
                        p_a15segundonombre      IN T15_INSCRITOS.a15segundonombre%TYPE,
                        p_a15primerapellido     IN T15_INSCRITOS.a15primerapellido%TYPE,
                        p_a15segundoapellido    IN T15_INSCRITOS.a15segundoapellido%TYPE,
                        p_a15fechanacimiento    IN T15_INSCRITOS.a15fechanacimiento%TYPE,
                        p_a15email              IN T15_INSCRITOS.a15email%TYPE,
                        p_a15telefono           IN T15_INSCRITOS.a15telefono%TYPE,
                        p_a15movil              IN T15_INSCRITOS.a15movil%TYPE,
                        p_a15movilalt           IN T15_INSCRITOS.a15movilalt%TYPE,
                        p_a15condicionespecial  IN T15_INSCRITOS.a15condicionespecial%TYPE,
                        p_a15estado             IN T15_INSCRITOS.a15estado%TYPE,
                        p_usuario               IN T15_INSCRITOS.a15usuariocreacion%TYPE,
                        p_a15codigo             OUT T15_INSCRITOS.a15codigo%TYPE) IS

  BEGIN

    p_a15codigo := Pk_Utils.Fn_Obtenerid('T15_INSCRITOS_SEQ');

    INSERT INTO T15_INSCRITOS
      (a15codigo,
       a15grupofacilitador,
       a15tipodocumento,
       a15documento,
       a15codigobeneficiario,
       a15primernombre,
       a15segundonombre,
       a15primerapellido,
       a15segundoapellido,
       a15fechanacimiento,
       a15email,
       a15telefono,
       a15movil,
       a15movilalt,
       a15condicionespecial,
       a15estado,
       a15fechacreacion,
       a15fechamodificacion,
       a15usuariocreacion,
       a15usuariomodificacion)
    VALUES
      (p_a15codigo,
       p_a15grupofacilitador,
       p_a15tipodocumento,
       p_a15documento,
       p_a15codigobeneficiario,
       p_a15primernombre,
       p_a15segundonombre,
       p_a15primerapellido,
       p_a15segundoapellido,
       p_a15fechanacimiento,
       p_a15email,
       p_a15telefono,
       p_a15movil,
       p_a15movilalt,
       p_a15condicionespecial,
       p_a15estado,
       SYSDATE,
       SYSDATE,
       p_usuario,
       p_usuario);

  END Pr_Insertar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar el estado del registro
                   en la tabla T15_INSCRITOS
  PARAMETROS    :
  IN    :
          p_a15codigo
          p_usuario

  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Eliminar(p_a15codigo IN T15_INSCRITOS.a15codigo%TYPE,
                        p_usuario   IN T15_INSCRITOS.a15usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T15_INSCRITOS
       SET a15estado              = 'I',
           a15fechamodificacion   = SYSDATE,
           a15usuariomodificacion = p_usuario
     WHERE a15codigo = p_a15codigo;

  END Pr_Eliminar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                   registro en la tabla T15_INSCRITOS
  PARAMETROS    :
  IN    :
          p_a15codigo
          p_a15grupofacilitador
          p_a15tipodocumento
          p_a15documento
          p_a15codigobeneficiario
          p_a15primernombre
          p_a15segundonombre
          p_a15primerapellido
          p_a15segundoapellido
          p_a15fechanacimiento
          p_a15email
          p_a15telefono
          p_a15movil
          p_a15movilalt
          p_a15confirmacion
          p_a15estado
          p_usuario

  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Actualizar(p_a15codigo             IN T15_INSCRITOS.a15codigo%TYPE,
                          p_a15grupofacilitador   IN T15_INSCRITOS.a15grupofacilitador%TYPE,
                          p_a15tipodocumento      IN T15_INSCRITOS.a15tipodocumento%TYPE,
                          p_a15documento          IN T15_INSCRITOS.a15documento%TYPE,
                          p_a15codigobeneficiario IN T15_INSCRITOS.a15codigobeneficiario%TYPE,
                          p_a15primernombre       IN T15_INSCRITOS.a15primernombre%TYPE,
                          p_a15segundonombre      IN T15_INSCRITOS.a15segundonombre%TYPE,
                          p_a15primerapellido     IN T15_INSCRITOS.a15primerapellido%TYPE,
                          p_a15segundoapellido    IN T15_INSCRITOS.a15segundoapellido%TYPE,
                          p_a15fechanacimiento    IN T15_INSCRITOS.a15fechanacimiento%TYPE,
                          p_a15email              IN T15_INSCRITOS.a15email%TYPE,
                          p_a15telefono           IN T15_INSCRITOS.a15telefono%TYPE,
                          p_a15movil              IN T15_INSCRITOS.a15movil%TYPE,
                          p_a15movilalt           IN T15_INSCRITOS.a15movilalt%TYPE,
                          p_a15condicionespecial  IN T15_INSCRITOS.a15condicionespecial%TYPE,
                          p_a15estado             IN T15_INSCRITOS.a15estado%TYPE,
                          p_usuario               IN T15_INSCRITOS.a15usuariocreacion%TYPE) IS

  BEGIN

    UPDATE T15_INSCRITOS
       SET a15grupofacilitador    = p_a15grupofacilitador,
           a15tipodocumento       = p_a15tipodocumento,
           a15documento           = p_a15documento,
           a15codigobeneficiario  = p_a15codigobeneficiario,
           a15primernombre        = p_a15primernombre,
           a15segundonombre       = p_a15segundonombre,
           a15primerapellido      = p_a15primerapellido,
           a15segundoapellido     = p_a15segundoapellido,
           a15fechanacimiento     = p_a15fechanacimiento,
           a15email               = p_a15email,
           a15telefono            = p_a15telefono,
           a15movil               = p_a15movil,
           a15movilalt            = p_a15movilalt,
           a15condicionespecial   = p_a15condicionespecial,
           a15estado              = p_a15estado,
           a15fechamodificacion   = SYSDATE,
           a15usuariomodificacion = p_usuario
     WHERE a15codigo = p_a15codigo;

  END Pr_Actualizar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T15_INSCRITOS
  PARAMETROS    :
  IN    :
          p_a15codigo

  OUT    :
          p_resultado

  REALIZADO POR    : 
  FECHA CREACION    : 16/02/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Consultar(p_a15codigo IN T15_INSCRITOS.a15codigo%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor) IS

  BEGIN

    OPEN p_resultado FOR
      SELECT *
        FROM T15_INSCRITOS
       WHERE a15codigo = NVL(p_a15codigo, a15codigo);

  END Pr_Consultar;

END PK_T15_INSCRITOS;
/

prompt
prompt Creating package body PK_T16_INSCRITOENCUESTA
prompt =============================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T16_INSCRITOENCUESTA AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T16_INSCRITOENCUESTA
PARAMETROS    :
IN    :
        p_a16inscrito
		p_a16encuesta
		p_a16pregunta
		p_a16respuesta
        p_usuario

OUT    :
        p_a16codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 02/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a16inscrito    IN T16_INSCRITOENCUESTA.a16inscrito%TYPE,
p_a16encuesta    IN T16_INSCRITOENCUESTA.a16encuesta%TYPE,
p_a16pregunta    IN T16_INSCRITOENCUESTA.a16pregunta%TYPE,
p_a16respuesta   IN T16_INSCRITOENCUESTA.a16respuesta%TYPE,
p_usuario        IN T16_INSCRITOENCUESTA.a16usuariocreacion%TYPE,
p_a16codigo      OUT T16_INSCRITOENCUESTA.a16codigo%TYPE) IS

BEGIN

p_a16codigo := Pk_Utils.Fn_Obtenerid ('T16_INSCRITOENCUESTA_SEQ');

INSERT INTO T16_INSCRITOENCUESTA(
        a16codigo,
        a16inscrito,
		a16encuesta,
		a16pregunta,
        a16respuesta,
		a16fechacreacion,
        a16fechamodificacion,
        a16usuariocreacion,
        a16usuariomodificacion)
 VALUES (p_a16codigo,
         p_a16inscrito,
		 p_a16encuesta,
		 p_a16pregunta,
         p_a16respuesta,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T16_INSCRITOENCUESTA
PARAMETROS    :
IN    :
        p_a16codigo
        p_a16inscrito
        p_a16encuesta
        p_a16pregunta
        p_a16respuesta
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 02/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a16codigo      IN T16_INSCRITOENCUESTA.a16codigo%TYPE,
p_a16inscrito    IN T16_INSCRITOENCUESTA.a16inscrito%TYPE,
p_a16encuesta    IN T16_INSCRITOENCUESTA.a16encuesta%TYPE,
p_a16pregunta    IN T16_INSCRITOENCUESTA.a16pregunta%TYPE,
p_a16respuesta   IN T16_INSCRITOENCUESTA.a16respuesta%TYPE,
p_usuario        IN T16_INSCRITOENCUESTA.a16usuariomodificacion%TYPE) IS

BEGIN

UPDATE T16_INSCRITOENCUESTA
   SET a16inscrito = p_a16inscrito,
       a16encuesta = p_a16encuesta,
       a16pregunta = p_a16pregunta,
       a16respuesta = p_a16respuesta,
       a16fechamodificacion = SYSDATE,
       a16usuariomodificacion = p_usuario
 WHERE a16codigo = p_a16codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T16_INSCRITOENCUESTA
PARAMETROS    :
IN    :
        p_a16codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 02/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a16codigo     IN T16_INSCRITOENCUESTA.a16codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T16_INSCRITOENCUESTA
 WHERE a16codigo = NVL(p_a16codigo,a16codigo);

END Pr_Consultar;

END PK_T16_INSCRITOENCUESTA;
/

prompt
prompt Creating package body PK_T17_TALLERES
prompt =====================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T17_TALLERES AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T17_TALLERES
PARAMETROS    :
IN    :
        p_a17nombre
		p_a17descripcion
		p_a17orden
        p_a17estado
        p_usuario

OUT    :
        p_a17codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 30/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a17nombre       IN T17_TALLERES.a17nombre%TYPE,
p_a17descripcion  IN T17_TALLERES.a17descripcion%TYPE,
p_a17orden        IN T17_TALLERES.a17orden%TYPE,
p_a17estado       IN T17_TALLERES.a17estado%TYPE,
p_usuario         IN T17_TALLERES.a17usuariocreacion%TYPE,
p_a17codigo       OUT T17_TALLERES.a17codigo%TYPE) IS

BEGIN

p_a17codigo := Pk_Utils.Fn_Obtenerid ('T17_TALLERES_SEQ');

INSERT INTO T17_TALLERES(
        a17codigo,
        a17nombre,
        a17descripcion,
        a17orden,
        a17estado,
        a17fechacreacion,
        a17fechamodificacion,
        a17usuariocreacion,
        a17usuariomodificacion)
 VALUES (p_a17codigo,
         p_a17nombre,
         p_a17descripcion,
         p_a17orden,
         p_a17estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T17_TALLERES
PARAMETROS    :
IN    :
        p_a17codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 30/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a17codigo     IN T17_TALLERES.a17codigo%TYPE,
p_usuario       IN T17_TALLERES.a17usuariomodificacion%TYPE) IS

BEGIN

UPDATE T17_TALLERES
   SET a17estado = 'I',
       a17fechamodificacion = SYSDATE,
       a17usuariomodificacion = p_usuario
 WHERE a17codigo = p_a17codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T17_TALLERES
PARAMETROS    :
IN    :
        p_a17codigo
        p_a17nombre
        p_a17descripcion
        p_a17orden
        p_a17estado
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 30/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a17codigo       IN T17_TALLERES.a17codigo%TYPE,
p_a17nombre       IN T17_TALLERES.a17nombre%TYPE,
p_a17descripcion  IN T17_TALLERES.a17descripcion%TYPE,
p_a17orden        IN T17_TALLERES.a17orden%TYPE,
p_a17estado       IN T17_TALLERES.a17estado%TYPE,
p_usuario         IN T17_TALLERES.a17usuariomodificacion%TYPE) IS

BEGIN

UPDATE T17_TALLERES
   SET a17nombre = p_a17nombre,
       a17descripcion = p_a17descripcion,
       a17orden = p_a17orden,
       a17estado = p_a17estado,
       a17fechamodificacion = SYSDATE,
       a17usuariomodificacion = p_usuario
 WHERE a17codigo = p_a17codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T17_TALLERES
PARAMETROS    :
IN    :
        p_a17codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 30/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a17codigo     IN T17_TALLERES.a17codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T17_TALLERES
 WHERE a17codigo = NVL(p_a17codigo,a17codigo);

END Pr_Consultar;

END PK_T17_TALLERES;
/

prompt
prompt Creating package body PK_T20_ENTREGABLESCARGADOS
prompt ================================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T20_ENTREGABLESCARGADOS AS
  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                   registro en la tabla T20_ENTREGABLESCARGADOS
  PARAMETROS    :
  IN    :
          p_a20facilitador
      p_a20grupo
      p_a20taller
      p_a20entregable
      p_a20ruta
      p_a20periodo
      p_a20estado
      p_usuario

  OUT    :
          p_a20codigo

  REALIZADO POR    : 
                      

  FECHA CREACION    : 29/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a20facilitador   IN T20_ENTREGABLESCARGADOS.a20facilitador%TYPE,
                        p_a20grupo         IN T20_ENTREGABLESCARGADOS.a20grupo%TYPE,
                        p_a20taller        IN T20_ENTREGABLESCARGADOS.a20taller%TYPE,
                        p_a20entregable    IN T20_ENTREGABLESCARGADOS.a20entregable%TYPE,
                        p_a20ruta          IN T20_ENTREGABLESCARGADOS.a20ruta%TYPE,
                        p_a20periodo       IN T20_ENTREGABLESCARGADOS.a20periodo%TYPE,
                        p_a20estado        IN T20_ENTREGABLESCARGADOS.a20estado%TYPE,
                        p_usuario          IN T20_ENTREGABLESCARGADOS.a20usuariocreacion%TYPE,
                        p_a20codigo        OUT T20_ENTREGABLESCARGADOS.a20codigo%TYPE) IS

  BEGIN

    p_a20codigo := Pk_Utils.Fn_Obtenerid('T20_ENTREGABLESCARGADOS_SEQ');

    INSERT INTO T20_ENTREGABLESCARGADOS
      (a20codigo,
       a20facilitador,
       a20grupo,
       a20taller,
       a20entregable,
       a20ruta,
       a20periodo,
       a20estado,
       a20fechacreacion,
       a20fechamodificacion,
       a20usuariocreacion,
       a20usuariomodificacion)
    VALUES
      (p_a20codigo,
       p_a20facilitador,
       p_a20grupo,
       p_a20taller,
       p_a20entregable,
       p_a20ruta,
       p_a20periodo,
       p_a20estado,
       SYSDATE,
       SYSDATE,
       p_usuario,
       p_usuario);

  END Pr_Insertar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar el estado del registro
                   en la tabla T20_ENTREGABLESCARGADOS
  PARAMETROS    :
  IN    :
          p_a20codigo
          p_usuario

  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 29/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Eliminar(p_a20codigo IN T20_ENTREGABLESCARGADOS.a20codigo%TYPE,
                        p_usuario   IN T20_ENTREGABLESCARGADOS.a20usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T20_ENTREGABLESCARGADOS
       SET a20estado              = PK_UTILS.ENT_RECHAZO,
           a20fechamodificacion   = SYSDATE,
           a20usuariomodificacion = p_usuario
     WHERE a20codigo = p_a20codigo;

  END Pr_Eliminar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                   registro en la tabla T20_ENTREGABLESCARGADOS
  PARAMETROS    :
  IN    :
          p_a20codigo
          p_a20facilitador
          p_a20grupo
          p_a20taller
          p_a20entregable
          p_a20ruta
          p_a20periodo
          p_a20estado
          p_usuario


  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 29/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Actualizar(p_a20codigo        IN T20_ENTREGABLESCARGADOS.a20codigo%TYPE,
                          p_a20facilitador   IN T20_ENTREGABLESCARGADOS.a20facilitador%TYPE,
                          p_a20grupo         IN T20_ENTREGABLESCARGADOS.a20grupo%TYPE,
                          p_a20taller        IN T20_ENTREGABLESCARGADOS.a20taller%TYPE,
                          p_a20entregable    IN T20_ENTREGABLESCARGADOS.a20entregable%TYPE,
                          p_a20ruta          IN T20_ENTREGABLESCARGADOS.a20ruta%TYPE,
                          p_a20periodo       IN T20_ENTREGABLESCARGADOS.a20periodo%TYPE,
                          p_usuario          IN T20_ENTREGABLESCARGADOS.a20usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T20_ENTREGABLESCARGADOS
       SET a20facilitador         = p_a20facilitador,
           a20grupo               = p_a20grupo,
           a20taller              = p_a20taller,
           a20entregable          = p_a20entregable,
           a20ruta                = p_a20ruta,
           a20periodo             = p_a20periodo,
           a20fechamodificacion   = SYSDATE,
           a20usuariomodificacion = p_usuario
     WHERE a20codigo = p_a20codigo;

  END Pr_Actualizar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T20_ENTREGABLESCARGADOS
  PARAMETROS    :
  IN    :
          p_a20codigo

  OUT    :
          p_resultado

  REALIZADO POR    : 
  FECHA CREACION    : 29/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Consultar(p_a20codigo IN T20_ENTREGABLESCARGADOS.a20codigo%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor) IS

  BEGIN

    OPEN p_resultado FOR
      SELECT *
        FROM T20_ENTREGABLESCARGADOS
       WHERE a20codigo = NVL(p_a20codigo, a20codigo);

  END Pr_Consultar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar el estado en la tabla T20_ENTREGABLESCARGADOS
  PARAMETROS    :
  IN    :
          p_a20codigo
          p_a20estado
          p_usuario

  OUT    :

  REALIZADO POR    : 
  FECHA CREACION    : 29/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_ActualizarEstado(p_a20codigo IN T20_ENTREGABLESCARGADOS.a20codigo%TYPE,
                                p_a20estado IN T20_ENTREGABLESCARGADOS.a20estado%TYPE,
                                p_usuario   IN T20_ENTREGABLESCARGADOS.a20usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T20_ENTREGABLESCARGADOS
       SET a20estado              = p_a20estado,
           a20fechamodificacion   = SYSDATE,
           a20usuariomodificacion = p_usuario
     WHERE a20codigo = p_a20codigo;

  END Pr_ActualizarEstado;

END PK_T20_ENTREGABLESCARGADOS;
/

prompt
prompt Creating package body PK_T23_DIAS
prompt =================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T23_DIAS AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T23_DIAS
PARAMETROS    :
IN    :
        p_a23nombre
        p_a23estado
        p_usuario

OUT    :
        p_a23codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a23nombre     IN T23_DIAS.a23nombre%TYPE,
p_a23estado     IN T23_DIAS.a23estado%TYPE,
p_usuario       IN T23_DIAS.a23usuariocreacion%TYPE,
p_a23codigo     OUT T23_DIAS.a23codigo%TYPE) IS

BEGIN

p_a23codigo := Pk_Utils.Fn_Obtenerid ('T23_DIAS_SEQ');

INSERT INTO T23_DIAS(
        a23codigo,
        a23nombre,
        a23estado,
        a23fechacreacion,
        a23fechamodificacion,
        a23usuariocreacion,
        a23usuariomodificacion)
 VALUES (p_a23codigo,
         p_a23nombre,
         p_a23estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T23_DIAS
PARAMETROS    :
IN    :
        p_a23codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a23codigo     IN T23_DIAS.a23codigo%TYPE,
p_usuario       IN T23_DIAS.a23usuariomodificacion%TYPE) IS

BEGIN

UPDATE T23_DIAS
   SET a23estado = 'I',
       a23fechamodificacion = SYSDATE,
       a23usuariomodificacion = p_usuario
 WHERE a23codigo = p_a23codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T23_DIAS
PARAMETROS    :
IN    :
        p_a23codigo
        p_a23nombre
        p_a23estado
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a23codigo     IN T23_DIAS.a23codigo%TYPE,
p_a23nombre     IN T23_DIAS.a23nombre%TYPE,
p_a23estado     IN T23_DIAS.a23estado%TYPE,
p_usuario       IN T23_DIAS.a23usuariomodificacion%TYPE) IS

BEGIN

UPDATE T23_DIAS
   SET a23nombre = p_a23nombre,
       a23estado = p_a23estado,
       a23fechamodificacion = SYSDATE,
       a23usuariomodificacion = p_usuario
 WHERE a23codigo = p_a23codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T23_DIAS
PARAMETROS    :
IN    :
        p_a23codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a23codigo     IN T23_DIAS.a23codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T23_DIAS
 WHERE a23codigo = NVL(p_a23codigo,a23codigo);

END Pr_Consultar;

END PK_T23_DIAS;
/

prompt
prompt Creating package body PK_T24_HORARIOS
prompt =====================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T24_HORARIOS AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T24_HORARIOS
PARAMETROS    :
IN    :
        p_a24horario
        p_a24estado
        p_usuario

OUT    :
        p_a24codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 15/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a24horario    IN T24_HORARIOS.a24horario%TYPE,
p_a24estado     IN T24_HORARIOS.a24estado%TYPE,
p_usuario       IN T24_HORARIOS.a24usuariocreacion%TYPE,
p_a24codigo     OUT T24_HORARIOS.a24codigo%TYPE) IS

BEGIN

p_a24codigo := Pk_Utils.Fn_Obtenerid ('T24_HORARIOS_SEQ');

INSERT INTO T24_HORARIOS(
        a24codigo,
        a24horario,
        a24estado,
        a24fechacreacion,
        a24fechamodificacion,
        a24usuariocreacion,
        a24usuariomodificacion)
 VALUES (p_a24codigo,
         p_a24horario,
         p_a24estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T24_HORARIOS
PARAMETROS    :
IN    :
        p_a24codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 15/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a24codigo     IN T24_HORARIOS.a24codigo%TYPE,
p_usuario       IN T24_HORARIOS.a24usuariomodificacion%TYPE) IS

BEGIN

UPDATE T24_HORARIOS
   SET a24estado = 'I',
       a24fechamodificacion = SYSDATE,
       a24usuariomodificacion = p_usuario
 WHERE a24codigo = p_a24codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T24_HORARIOS
PARAMETROS    :
IN    :
        p_a24codigo
        p_a24horario
        p_a24estado
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 15/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a24codigo     IN T24_HORARIOS.a24codigo%TYPE,
p_a24horario    IN T24_HORARIOS.a24horario%TYPE,
p_a24estado     IN T24_HORARIOS.a24estado%TYPE,
p_usuario       IN T24_HORARIOS.a24usuariomodificacion%TYPE) IS

BEGIN

UPDATE T24_HORARIOS
   SET a24horario = p_a24horario,
       a24estado = p_a24estado,
       a24fechamodificacion = SYSDATE,
       a24usuariomodificacion = p_usuario
 WHERE a24codigo = p_a24codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T24_HORARIOS
PARAMETROS    :
IN    :
        p_a24codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 15/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a24codigo     IN T24_HORARIOS.a24codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T24_HORARIOS
 WHERE a24codigo = NVL(p_a24codigo,a24codigo);

END Pr_Consultar;

PROCEDURE Pr_ObtenerRango(
p_a24codigo  IN T24_HORARIOS.a24codigo%TYPE,
p_hinicio    OUT NUMBER,
p_hfin       OUT NUMBER) IS

CURSOR c_horario IS
 SELECT TO_NUMBER(SUBSTR(a24horario,1,2)), TO_NUMBER(SUBSTR(a24horario,9,2))
   FROM T24_HORARIOS
  WHERE a24codigo = p_a24codigo;

BEGIN

 OPEN c_horario;
  FETCH c_horario INTO p_hinicio,p_hfin;
 CLOSE c_horario;

END Pr_ObtenerRango;

END PK_T24_HORARIOS;
/

prompt
prompt Creating package body PK_T25_GRUPOS
prompt ===================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T25_GRUPOS AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T25_GRUPOS
PARAMETROS    :
IN    :
        p_a25nombre
        p_a25estado
		p_a25numero
        p_usuario

OUT    :
        p_a25codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a25nombre     IN T25_GRUPOS.a25nombre%TYPE,
p_a25estado     IN T25_GRUPOS.a25estado%TYPE,
p_a25numero     IN T25_GRUPOS.a25numero%TYPE,
p_usuario       IN T25_GRUPOS.a25usuariocreacion%TYPE,
p_a25codigo     OUT T25_GRUPOS.a25codigo%TYPE) IS

BEGIN

p_a25codigo := Pk_Utils.Fn_Obtenerid ('T25_GRUPOS_SEQ');

INSERT INTO T25_GRUPOS(
        a25codigo,
        a25nombre,
        a25estado,
		a25numero,
        a25fechacreacion,
        a25fechamodificacion,
        a25usuariocreacion,
        a25usuariomodificacion)
 VALUES (p_a25codigo,
         p_a25nombre,
         p_a25estado,
		 p_a25numero,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T25_GRUPOS
PARAMETROS    :
IN    :
        p_a25codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a25codigo     IN T25_GRUPOS.a25codigo%TYPE,
p_usuario       IN T25_GRUPOS.a25usuariomodificacion%TYPE) IS

BEGIN

UPDATE T25_GRUPOS
   SET a25estado = 'I',
       a25fechamodificacion = SYSDATE,
       a25usuariomodificacion = p_usuario
 WHERE a25codigo = p_a25codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizaci?n del
                 registro en la tabla T25_GRUPOS
PARAMETROS    :
IN    :
        p_a25codigo
        p_a25nombre
        p_a25estado
		p_a25numero
        p_usuario

OUT    :
        p_codError        C?digo de error generado
        p_msjError        Mensaje del error generado

REALIZADO POR    : 
                    

FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a25codigo     IN T25_GRUPOS.a25codigo%TYPE,
p_a25nombre     IN T25_GRUPOS.a25nombre%TYPE,
p_a25estado     IN T25_GRUPOS.a25estado%TYPE,
p_a25numero     IN T25_GRUPOS.a25numero%TYPE,
p_usuario       IN T25_GRUPOS.a25usuariomodificacion%TYPE) IS

BEGIN

UPDATE T25_GRUPOS
   SET a25nombre = p_a25nombre,
       a25estado = p_a25estado,
	   a25numero = p_a25numero,
       a25fechamodificacion = SYSDATE,
       a25usuariomodificacion = p_usuario
 WHERE a25codigo = p_a25codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T25_GRUPOS
PARAMETROS    :
IN    :
        p_a25codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 16/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a25codigo     IN T25_GRUPOS.a25codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T25_GRUPOS
 WHERE a25codigo = NVL(p_a25codigo,a25codigo);

END Pr_Consultar;

END PK_T25_GRUPOS;
/

prompt
prompt Creating package body PK_T26_GRUPOSFACILITADOR
prompt ==============================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T26_GRUPOSFACILITADOR AS
  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                   registro en la tabla T26_GRUPOSFACILITADOR
  PARAMETROS    :
  IN    :
          p_a26facilitador
      p_a26ciudad
      p_a26grupo
      p_a26dia
      p_a26horario
      p_a26lugar
      p_a26direccion
      p_a26periodo
      p_a26condicion
      p_a26observaciones
      p_a26estado
          p_usuario

  OUT    :
          p_a26codigo

  REALIZADO POR    : 
                      

  FECHA CREACION    : 01/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a26facilitador   IN T26_GRUPOSFACILITADOR.a26facilitador%TYPE,
                        p_a26ciudad        IN T26_GRUPOSFACILITADOR.a26ciudad%TYPE,
                        p_a26grupo         IN T26_GRUPOSFACILITADOR.a26grupo%TYPE,
                        p_a26dia           IN T26_GRUPOSFACILITADOR.a26dia%TYPE,
                        p_a26horario       IN T26_GRUPOSFACILITADOR.a26horario%TYPE,
                        p_a26lugar         IN T26_GRUPOSFACILITADOR.a26lugar%TYPE,
                        p_a26direccion     IN T26_GRUPOSFACILITADOR.a26direccion%TYPE,
                        p_a26sigla         IN T26_GRUPOSFACILITADOR.a26sigla%TYPE,
                        p_a26periodo       IN T26_GRUPOSFACILITADOR.a26periodo%TYPE,
                        p_a26condicion     IN T26_GRUPOSFACILITADOR.a26condicion%TYPE,
                        p_a26observaciones IN T26_GRUPOSFACILITADOR.a26observaciones%TYPE,
                        p_a26estado        IN T26_GRUPOSFACILITADOR.a26estado%TYPE,
                        p_usuario          IN T26_GRUPOSFACILITADOR.a26usuariocreacion%TYPE,
                        p_a26codigo        OUT T26_GRUPOSFACILITADOR.a26codigo%TYPE) IS

  BEGIN

    p_a26codigo := Pk_Utils.Fn_Obtenerid('T26_GRUPOSFACILITADOR_SEQ');

    INSERT INTO T26_GRUPOSFACILITADOR
      (a26codigo,
       a26facilitador,
       a26ciudad,
       a26grupo,
       a26dia,
       a26horario,
       a26lugar,
       a26direccion,
       a26sigla,
       a26periodo,
       a26condicion,
       a26observaciones,
       a26estado,
       a26fechacreacion,
       a26fechamodificacion,
       a26usuariocreacion,
       a26usuariomodificacion,
       a26inscritos)
    VALUES
      (p_a26codigo,
       p_a26facilitador,
       p_a26ciudad,
       p_a26grupo,
       p_a26dia,
       p_a26horario,
       p_a26lugar,
       p_a26direccion,
       p_a26sigla,
       p_a26periodo,
       p_a26condicion,
       p_a26observaciones,
       p_a26estado,
       SYSDATE,
       SYSDATE,
       p_usuario,
       p_usuario,
       0);

  END Pr_Insertar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar el estado del registro
                   en la tabla T26_GRUPOSFACILITADOR
  PARAMETROS    :
  IN    :
          p_a26codigo
          p_usuario

  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 01/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Eliminar(p_a26codigo IN T26_GRUPOSFACILITADOR.a26codigo%TYPE,
                        p_usuario   IN T26_GRUPOSFACILITADOR.a26usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T26_GRUPOSFACILITADOR
       SET a26estado              = 'R',
           a26fechamodificacion   = SYSDATE,
           a26usuariomodificacion = p_usuario
     WHERE a26codigo = p_a26codigo;

  END Pr_Eliminar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                   registro en la tabla T26_GRUPOSFACILITADOR
  PARAMETROS    :
  IN    :
          p_a26codigo
          p_a26facilitador
          p_a26ciudad
          p_a26grupo
          p_a26dia
          p_a26horario
          p_a26lugar
          p_a26direccion
          p_a26sigla
          p_a26periodo
          p_a26condicion
          p_a26observaciones
          p_a26estado
          p_usuario
          p_a26codigo
          p_usuario
          p_a26estado
          p_usuario

  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 01/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Actualizar(p_a26codigo        IN T26_GRUPOSFACILITADOR.a26codigo%TYPE,
                          p_a26facilitador   IN T26_GRUPOSFACILITADOR.a26facilitador%TYPE,
                          p_a26ciudad        IN T26_GRUPOSFACILITADOR.a26ciudad%TYPE,
                          p_a26grupo         IN T26_GRUPOSFACILITADOR.a26grupo%TYPE,
                          p_a26dia           IN T26_GRUPOSFACILITADOR.a26dia%TYPE,
                          p_a26horario       IN T26_GRUPOSFACILITADOR.a26horario%TYPE,
                          p_a26lugar         IN T26_GRUPOSFACILITADOR.a26lugar%TYPE,
                          p_a26direccion     IN T26_GRUPOSFACILITADOR.a26direccion%TYPE,
                          p_a26sigla         IN T26_GRUPOSFACILITADOR.a26sigla%TYPE,
                          p_a26periodo       IN T26_GRUPOSFACILITADOR.a26periodo%TYPE,
                          p_a26condicion     IN T26_GRUPOSFACILITADOR.a26condicion%TYPE,
                          p_a26observaciones IN T26_GRUPOSFACILITADOR.a26observaciones%TYPE,
                          p_usuario          IN T26_GRUPOSFACILITADOR.a26usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T26_GRUPOSFACILITADOR
       SET a26facilitador         = p_a26facilitador,
           a26ciudad              = p_a26ciudad,
           a26grupo               = p_a26grupo,
           a26dia                 = p_a26dia,
           a26horario             = p_a26horario,
           a26lugar               = p_a26lugar,
           a26direccion           = p_a26direccion,
           a26sigla               = p_a26sigla,
           a26periodo             = p_a26periodo,
           a26condicion           = p_a26condicion,
           a26observaciones       = p_a26observaciones,
           a26fechamodificacion   = SYSDATE,
           a26usuariomodificacion = p_usuario
     WHERE a26codigo = p_a26codigo;

  END Pr_Actualizar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T26_GRUPOSFACILITADOR
  PARAMETROS    :
  IN    :
          p_a26codigo

  OUT    :
          p_resultado

  REALIZADO POR    : 
  FECHA CREACION    : 01/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Consultar(p_a26codigo IN T26_GRUPOSFACILITADOR.a26codigo%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor) IS

  BEGIN

    OPEN p_resultado FOR
      SELECT *
        FROM T26_GRUPOSFACILITADOR
       WHERE a26codigo = NVL(p_a26codigo, a26codigo);

  END Pr_Consultar;

  PROCEDURE Pr_ActualizarEstado(p_a26codigo IN T26_GRUPOSFACILITADOR.a26codigo%TYPE,
                                p_a26estado IN T26_GRUPOSFACILITADOR.a26estado%TYPE,
                                p_usuario   IN T26_GRUPOSFACILITADOR.a26usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T26_GRUPOSFACILITADOR
       SET a26estado              = p_a26estado,
           a26fechamodificacion   = SYSDATE,
           a26usuariomodificacion = p_usuario
     WHERE a26codigo = p_a26codigo;

  END Pr_ActualizarEstado;

END PK_T26_GRUPOSFACILITADOR;
/

prompt
prompt Creating package body PK_T29_CONSULTAPARTICIPANTES
prompt ==================================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T29_CONSULTAPARTICIPANTES AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T29_CONSULTAPARTICIPANTES
PARAMETROS    :
IN    :
        p_a29participante
        p_a29municipioestudio
        p_a29tipodocumento
        p_a29documento
        p_a29codigobeneficiario
        p_a29primernombre
        p_a29segundonombre
        p_a29primerapellido
        p_a29segundoapellido
        p_a29fechanacimiento
        p_a29email
        p_a29telefono
        p_a29movil
        p_a29movilalt
        p_a29noconvenio
        p_a29estado
        p_a29finetapapractica
        p_a29finsemestre
        p_a29ultimomes
        p_a29fichasnies
        p_a29nivelformacion
        p_a29sniesies
        p_a29tipoformcion
        p_usuario

OUT    :
        p_a29codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 20/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a29participante        IN T29_CONSULTAPARTICIPANTES.a29participante%TYPE,
p_a29municipioestudio    IN T29_CONSULTAPARTICIPANTES.a29municipioestudio%TYPE,
p_a29tipodocumento       IN T29_CONSULTAPARTICIPANTES.a29tipodocumento%TYPE,
p_a29documento           IN T29_CONSULTAPARTICIPANTES.a29documento%TYPE,
p_a29codigobeneficiario  IN T29_CONSULTAPARTICIPANTES.a29codigobeneficiario%TYPE,
p_a29primernombre        IN T29_CONSULTAPARTICIPANTES.a29primernombre%TYPE,
p_a29segundonombre       IN T29_CONSULTAPARTICIPANTES.a29segundonombre%TYPE,
p_a29primerapellido      IN T29_CONSULTAPARTICIPANTES.a29primerapellido%TYPE,
p_a29segundoapellido     IN T29_CONSULTAPARTICIPANTES.a29segundoapellido%TYPE,
p_a29fechanacimiento     IN T29_CONSULTAPARTICIPANTES.a29fechanacimiento%TYPE,
p_a29email               IN T29_CONSULTAPARTICIPANTES.a29email%TYPE,
p_a29telefono            IN T29_CONSULTAPARTICIPANTES.a29telefono%TYPE,
p_a29movil               IN T29_CONSULTAPARTICIPANTES.a29movil%TYPE,
p_a29movilalt            IN T29_CONSULTAPARTICIPANTES.a29movilalt%TYPE,
p_a29noconvenio          IN T29_CONSULTAPARTICIPANTES.a29noconvenio%TYPE,
p_a29estado              IN T29_CONSULTAPARTICIPANTES.a29estado%TYPE,
p_a29finetapapractica    IN T29_CONSULTAPARTICIPANTES.a29finetapapractica%TYPE,
p_a29finsemestre         IN T29_CONSULTAPARTICIPANTES.a29finsemestre%TYPE,
p_a29ultimomes           IN T29_CONSULTAPARTICIPANTES.a29ultimomes%TYPE,
p_a29fichasnies          IN T29_CONSULTAPARTICIPANTES.a29fichasnies%TYPE,
p_a29nivelformacion      IN T29_CONSULTAPARTICIPANTES.a29nivelformacion%TYPE,
p_a29sniesies            IN T29_CONSULTAPARTICIPANTES.a29sniesies%TYPE,
p_a29tipoformcion        IN T29_CONSULTAPARTICIPANTES.a29tipoformcion%TYPE,
p_usuario                IN T29_CONSULTAPARTICIPANTES.a29usuariocreacion%TYPE,
p_a29codigo              OUT T29_CONSULTAPARTICIPANTES.a29codigo%TYPE) IS

BEGIN

p_a29codigo := Pk_Utils.Fn_Obtenerid ('T29_CONSULTAPARTICIPANTES_SEQ');

INSERT INTO T29_CONSULTAPARTICIPANTES(
        a29codigo,
        a29participante,
        a29municipioestudio,
        a29tipodocumento,
        a29documento,
        a29codigobeneficiario,
        a29primernombre,
        a29segundonombre,
        a29primerapellido,
        a29segundoapellido,
        a29fechanacimiento,
        a29email,
        a29telefono,
        a29movil,
        a29movilalt,
        a29noconvenio,
        a29estado,
        a29finetapapractica,
        a29finsemestre,
        a29ultimomes,
        a29fichasnies,
        a29nivelformacion,
        a29sniesies,
        a29tipoformcion,
        a29fechaconsulta,
        a29fechacreacion,
        a29fechamodificacion,
        a29usuariocreacion,
        a29usuariomodificacion)
 VALUES (p_a29codigo,
         p_a29participante,
         p_a29municipioestudio,
         p_a29tipodocumento,
         p_a29documento,
         p_a29codigobeneficiario,
         p_a29primernombre,
         p_a29segundonombre,
         p_a29primerapellido,
         p_a29segundoapellido,
         p_a29fechanacimiento,
         p_a29email,
         p_a29telefono,
         p_a29movil,
         p_a29movilalt,
         p_a29noconvenio,
         p_a29estado,
         p_a29finetapapractica,
         p_a29finsemestre,
         p_a29ultimomes,
         p_a29fichasnies,
         p_a29nivelformacion,
         p_a29sniesies,
         p_a29tipoformcion,
         SYSDATE,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T29_CONSULTAPARTICIPANTES
PARAMETROS    :
IN    :
        p_a29codigo

OUT    :
        p_resultado


REALIZADO POR    : 
FECHA CREACION    : 20/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a29codigo     IN T29_CONSULTAPARTICIPANTES.a29codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T29_CONSULTAPARTICIPANTES
 WHERE a29codigo = NVL(p_a29codigo,a29codigo);

END Pr_Consultar;

END PK_T29_CONSULTAPARTICIPANTES;
/

prompt
prompt Creating package body PK_T30_CIUDADESUSUARIO
prompt ============================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T30_CIUDADESUSUARIO AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T30_CIUDADESUSUARIO
PARAMETROS    :
IN    :
        p_a30ciudad
        p_a30estado
        p_a30usuario
        p_usuario

OUT    :
        p_a30codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 07/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a30ciudad     IN T30_CIUDADESUSUARIO.a30ciudad%TYPE,
p_a30estado     IN T30_CIUDADESUSUARIO.a30estado%TYPE,
p_a30usuario    IN T30_CIUDADESUSUARIO.a30usuario%TYPE,
p_usuario       IN T30_CIUDADESUSUARIO.a30usuariocreacion%TYPE,
p_a30codigo     OUT T30_CIUDADESUSUARIO.a30codigo%TYPE) IS

BEGIN

p_a30codigo := Pk_Utils.Fn_Obtenerid ('T30_CIUDADESUSUARIO_SEQ');

INSERT INTO T30_CIUDADESUSUARIO(
        a30codigo,
        a30ciudad,
        a30estado,
        a30usuario,
        a30fechacreacion,
        a30fechamodificacion,
        a30usuariocreacion,
        a30usuariomodificacion)
 VALUES (p_a30codigo,
         p_a30ciudad,
         p_a30estado,
         p_a30usuario,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T30_CIUDADESUSUARIO
PARAMETROS    :
IN    :
        p_a30codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 07/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a30codigo     IN T30_CIUDADESUSUARIO.a30codigo%TYPE,
p_usuario       IN T30_CIUDADESUSUARIO.a30usuariomodificacion%TYPE) IS

BEGIN

UPDATE T30_CIUDADESUSUARIO
   SET a30estado = 'I',
       a30fechamodificacion = SYSDATE,
       a30usuariomodificacion = p_usuario
 WHERE a30codigo = p_a30codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizaci?n del
                 registro en la tabla T30_CIUDADESUSUARIO
PARAMETROS    :
IN    :
        p_a30codigo
        p_a30ciudad
        p_a30estado
        p_a30usuario
        p_usuario

OUT    :
        p_codError        C?digo de error generado
        p_msjError        Mensaje del error generado

REALIZADO POR    : 
                    

FECHA CREACION    : 07/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a30codigo     IN T30_CIUDADESUSUARIO.a30codigo%TYPE,
p_a30ciudad     IN T30_CIUDADESUSUARIO.a30ciudad%TYPE,
p_a30estado     IN T30_CIUDADESUSUARIO.a30estado%TYPE,
p_a30usuario    IN T30_CIUDADESUSUARIO.a30usuario%TYPE,
p_usuario       IN T30_CIUDADESUSUARIO.a30usuariomodificacion%TYPE) IS

BEGIN

UPDATE T30_CIUDADESUSUARIO
   SET a30ciudad = p_a30ciudad,
       a30estado = p_a30estado,
       a30usuario = p_a30usuario,
       a30fechamodificacion = SYSDATE,
       a30usuariomodificacion = p_usuario
 WHERE a30codigo = p_a30codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T30_CIUDADESUSUARIO
PARAMETROS    :
IN    :
        p_a30codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 07/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a30codigo     IN T30_CIUDADESUSUARIO.a30codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T30_CIUDADESUSUARIO
 WHERE a30codigo = NVL(p_a30codigo,a30codigo);

END Pr_Consultar;

END PK_T30_CIUDADESUSUARIO;
/

prompt
prompt Creating package body PK_T50_ENCUESTA
prompt =====================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T50_ENCUESTA AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T50_ENCUESTA
PARAMETROS    :
IN    :
        p_a50descripcion
		p_a50periodo
		p_a50tipoencuesta
        p_a50estado
        p_usuario

OUT    :
        p_a50codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a50descripcion   IN T50_ENCUESTA.a50descripcion%TYPE,
p_a50periodo       IN T50_ENCUESTA.a50periodo%TYPE,
p_a50tipoencuesta  IN T50_ENCUESTA.a50tipoencuesta%TYPE,
p_a50estado        IN T50_ENCUESTA.a50estado%TYPE,
p_usuario          IN T50_ENCUESTA.a50usuariocreacion%TYPE,
p_a50codigo        OUT T50_ENCUESTA.a50codigo%TYPE) IS

BEGIN

p_a50codigo := Pk_Utils.Fn_Obtenerid ('T50_ENCUESTA_SEQ');

INSERT INTO T50_ENCUESTA(
        a50codigo,
        a50descripcion,
        a50periodo,
        a50tipoencuesta,
        a50estado,
        a50fechacreacion,
        a50fechamodificacion,
        a50usuariocreacion,
        a50usuariomodificacion)
 VALUES (p_a50codigo,
         p_a50descripcion,
         p_a50periodo,
         p_a50tipoencuesta,
         p_a50estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T50_ENCUESTA
PARAMETROS    :
IN    :
        p_a50codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a50codigo     IN T50_ENCUESTA.a50codigo%TYPE,
p_usuario       IN T50_ENCUESTA.a50usuariomodificacion%TYPE) IS

BEGIN

UPDATE T50_ENCUESTA
   SET a50estado = 'I',
       a50fechamodificacion = SYSDATE,
       a50usuariomodificacion = p_usuario
 WHERE a50codigo = p_a50codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T50_ENCUESTA
PARAMETROS    :
IN    :
        p_a50codigo
        p_a50descripcion
        p_a50periodo
        p_a50tipoencuesta
        p_a50estado
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a50codigo        IN T50_ENCUESTA.a50codigo%TYPE,
p_a50descripcion   IN T50_ENCUESTA.a50descripcion%TYPE,
p_a50periodo       IN T50_ENCUESTA.a50periodo%TYPE,
p_a50tipoencuesta  IN T50_ENCUESTA.a50tipoencuesta%TYPE,
p_a50estado        IN T50_ENCUESTA.a50estado%TYPE,
p_usuario          IN T50_ENCUESTA.a50usuariomodificacion%TYPE) IS

BEGIN

UPDATE T50_ENCUESTA
   SET a50descripcion = p_a50descripcion,
       a50periodo = p_a50periodo,
       a50tipoencuesta = p_a50tipoencuesta,
       a50estado = p_a50estado,
       a50fechamodificacion = SYSDATE,
       a50usuariomodificacion = p_usuario
 WHERE a50codigo = p_a50codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T50_ENCUESTA
PARAMETROS    :
IN    :
        p_a50codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 01/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a50codigo     IN T50_ENCUESTA.a50codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T50_ENCUESTA
 WHERE a50codigo = NVL(p_a50codigo,a50codigo);

END Pr_Consultar;

END PK_T50_ENCUESTA;
/

prompt
prompt Creating package body PK_T52_CANDIDATOS
prompt =======================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T52_CANDIDATOS AS
  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                   registro en la tabla T52_CANDIDATOS
  PARAMETROS    :
  IN    :
          p_a52tipodocumento
          p_a52documento
          p_a52codigobeneficiario
          p_a52primernombre
          p_a52segundonombre
          p_a52primerapellido
          p_a52segundoapellido
          p_a52fechanacimiento
          p_a52email
          p_a52telefono
          p_a52movil
          p_a52movilalt
          p_a52confirmacion
          p_a52estado
          p_usuario

  OUT    :
          p_a52codigo

  REALIZADO POR    : 
                      

  FECHA CREACION    : 15/04/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a52tipodocumento      IN T52_CANDIDATOS.a52tipodocumento%TYPE,
                        p_a52documento          IN T52_CANDIDATOS.a52documento%TYPE,
                        p_a52codigobeneficiario IN T52_CANDIDATOS.a52codigobeneficiario%TYPE,
                        p_a52primernombre       IN T52_CANDIDATOS.a52primernombre%TYPE,
                        p_a52segundonombre      IN T52_CANDIDATOS.a52segundonombre%TYPE,
                        p_a52primerapellido     IN T52_CANDIDATOS.a52primerapellido%TYPE,
                        p_a52segundoapellido    IN T52_CANDIDATOS.a52segundoapellido%TYPE,
                        p_a52fechanacimiento    IN T52_CANDIDATOS.a52fechanacimiento%TYPE,
                        p_a52email              IN T52_CANDIDATOS.a52email%TYPE,
                        p_a52telefono           IN T52_CANDIDATOS.a52telefono%TYPE,
                        p_a52movil              IN T52_CANDIDATOS.a52movil%TYPE,
                        p_a52movilalt           IN T52_CANDIDATOS.a52movilalt%TYPE,
                        p_a52condicionespecial  IN T52_CANDIDATOS.a52condicionespecial%TYPE,
                        p_a52estado             IN T52_CANDIDATOS.a52estado%TYPE,
                        p_a52periodo            IN T52_CANDIDATOS.a52periodo%TYPE,
                        p_usuario               IN T52_CANDIDATOS.a52usuariocreacion%TYPE,
                        p_a52codigo             OUT T52_CANDIDATOS.a52codigo%TYPE) IS

  BEGIN

    p_a52codigo := Pk_Utils.Fn_Obtenerid('T52_CANDIDATOS_SEQ');

    INSERT INTO T52_CANDIDATOS
      (a52codigo,
       a52tipodocumento,
       a52documento,
       a52codigobeneficiario,
       a52primernombre,
       a52segundonombre,
       a52primerapellido,
       a52segundoapellido,
       a52fechanacimiento,
       a52email,
       a52telefono,
       a52movil,
       a52movilalt,
       a52condicionespecial,
       a52estado,
       a52fechacreacion,
       a52fechamodificacion,
       a52usuariocreacion,
       a52usuariomodificacion,
       a52periodo)
    VALUES
      (p_a52codigo,
       p_a52tipodocumento,
       p_a52documento,
       p_a52codigobeneficiario,
       p_a52primernombre,
       p_a52segundonombre,
       p_a52primerapellido,
       p_a52segundoapellido,
       p_a52fechanacimiento,
       p_a52email,
       p_a52telefono,
       p_a52movil,
       p_a52movilalt,
       p_a52condicionespecial,
       p_a52estado,
       SYSDATE,
       SYSDATE,
       p_usuario,
       p_usuario,
       p_a52periodo);

  END Pr_Insertar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para actualizar el estado del registro
                   en la tabla T52_CANDIDATOS
  PARAMETROS    :
  IN    :
          p_a52codigo
          p_usuario

  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 15/04/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Eliminar(p_a52codigo IN T52_CANDIDATOS.a52codigo%TYPE,
                        p_usuario   IN T52_CANDIDATOS.a52usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T52_CANDIDATOS
       SET a52estado              = 'I',
           a52fechamodificacion   = SYSDATE,
           a52usuariomodificacion = p_usuario
     WHERE a52codigo = p_a52codigo;

  END Pr_Eliminar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                   registro en la tabla T52_CANDIDATOS
  PARAMETROS    :
  IN    :
          p_a52codigo
          p_a52tipodocumento
          p_a52documento
          p_a52codigobeneficiario
          p_a52primernombre
          p_a52segundonombre
          p_a52primerapellido
          p_a52segundoapellido
          p_a52fechanacimiento
          p_a52email
          p_a52telefono
          p_a52movil
          p_a52movilalt
          p_a52confirmacion
          p_a52estado
          p_usuario

  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 15/04/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Actualizar(p_a52codigo             IN T52_CANDIDATOS.a52codigo%TYPE,
                          p_a52tipodocumento      IN T52_CANDIDATOS.a52tipodocumento%TYPE,
                          p_a52documento          IN T52_CANDIDATOS.a52documento%TYPE,
                          p_a52codigobeneficiario IN T52_CANDIDATOS.a52codigobeneficiario%TYPE,
                          p_a52primernombre       IN T52_CANDIDATOS.a52primernombre%TYPE,
                          p_a52segundonombre      IN T52_CANDIDATOS.a52segundonombre%TYPE,
                          p_a52primerapellido     IN T52_CANDIDATOS.a52primerapellido%TYPE,
                          p_a52segundoapellido    IN T52_CANDIDATOS.a52segundoapellido%TYPE,
                          p_a52fechanacimiento    IN T52_CANDIDATOS.a52fechanacimiento%TYPE,
                          p_a52email              IN T52_CANDIDATOS.a52email%TYPE,
                          p_a52telefono           IN T52_CANDIDATOS.a52telefono%TYPE,
                          p_a52movil              IN T52_CANDIDATOS.a52movil%TYPE,
                          p_a52movilalt           IN T52_CANDIDATOS.a52movilalt%TYPE,
                          p_a52condicionespecial  IN T52_CANDIDATOS.a52condicionespecial%TYPE,
                          p_a52estado             IN T52_CANDIDATOS.a52estado%TYPE,
                          p_usuario               IN T52_CANDIDATOS.a52usuariocreacion%TYPE) IS

  BEGIN

    UPDATE T52_CANDIDATOS
       SET a52tipodocumento       = p_a52tipodocumento,
           a52documento           = p_a52documento,
           a52codigobeneficiario  = p_a52codigobeneficiario,
           a52primernombre        = p_a52primernombre,
           a52segundonombre       = p_a52segundonombre,
           a52primerapellido      = p_a52primerapellido,
           a52segundoapellido     = p_a52segundoapellido,
           a52fechanacimiento     = p_a52fechanacimiento,
           a52email               = p_a52email,
           a52telefono            = p_a52telefono,
           a52movil               = p_a52movil,
           a52movilalt            = p_a52movilalt,
           a52condicionespecial   = p_a52condicionespecial,
           a52estado              = p_a52estado,
           a52fechamodificacion   = SYSDATE,
           a52usuariomodificacion = p_usuario
     WHERE a52codigo = p_a52codigo;

  END Pr_Actualizar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T52_CANDIDATOS
  PARAMETROS    :
  IN    :
          p_a52codigo

  OUT    :
          p_resultado

  REALIZADO POR    : 
  FECHA CREACION    : 15/04/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Consultar(p_a52codigo IN T52_CANDIDATOS.a52codigo%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor) IS

  BEGIN

    OPEN p_resultado FOR
      SELECT *
        FROM T52_CANDIDATOS
       WHERE a52codigo = NVL(p_a52codigo, a52codigo);

  END Pr_Consultar;

END PK_T52_CANDIDATOS;
/

prompt
prompt Creating package body PK_T53_GRUPOINSCRITO
prompt ==========================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T53_GRUPOINSCRITO AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T53_GRUPOINSCRITO
PARAMETROS    :
IN    :
        p_a53grupofacilitador
		p_a53periodo
		p_a53inscrito
        p_a53estado
        p_usuario

OUT    :
        p_a53codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 15/04/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a53grupofacilitador   IN T53_GRUPOINSCRITO.a53grupofacilitador%TYPE,
p_a53periodo            IN T53_GRUPOINSCRITO.a53periodo%TYPE,
p_a53inscrito           IN T53_GRUPOINSCRITO.a53inscrito%TYPE,
p_a53estado             IN T53_GRUPOINSCRITO.a53estado%TYPE,
p_usuario               IN T53_GRUPOINSCRITO.a53usuariocreacion%TYPE,
p_a53codigo             OUT T53_GRUPOINSCRITO.a53codigo%TYPE) IS

BEGIN

p_a53codigo := Pk_Utils.Fn_Obtenerid ('T53_GRUPOINSCRITO_SEQ');

INSERT INTO T53_GRUPOINSCRITO(
        a53codigo,
        a53grupofacilitador,
        a53periodo,
        a53inscrito,
        a53estado,
        a53fechacreacion,
        a53fechamodificacion,
        a53usuariocreacion,
        a53usuariomodificacion)
 VALUES (p_a53codigo,
         p_a53grupofacilitador,
         p_a53periodo,
         p_a53inscrito,
         p_a53estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T53_GRUPOINSCRITO
PARAMETROS    :
IN    :
        p_a53codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 15/04/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a53codigo     IN T53_GRUPOINSCRITO.a53codigo%TYPE,
p_usuario       IN T53_GRUPOINSCRITO.a53usuariomodificacion%TYPE) IS

BEGIN

UPDATE T53_GRUPOINSCRITO
   SET a53estado = 'I',
       a53fechamodificacion = SYSDATE,
       a53usuariomodificacion = p_usuario
 WHERE a53codigo = p_a53codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizacion del
                 registro en la tabla T53_GRUPOINSCRITO
PARAMETROS    :
IN    :
        p_a53codigo
        p_a53grupofacilitador
        p_a53periodo
        p_a53inscrito
        p_a53estado
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 15/04/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a53codigo             IN T53_GRUPOINSCRITO.a53codigo%TYPE,
p_a53grupofacilitador   IN T53_GRUPOINSCRITO.a53grupofacilitador%TYPE,
p_a53periodo            IN T53_GRUPOINSCRITO.a53periodo%TYPE,
p_a53inscrito           IN T53_GRUPOINSCRITO.a53inscrito%TYPE,
p_a53estado             IN T53_GRUPOINSCRITO.a53estado%TYPE,
p_usuario               IN T53_GRUPOINSCRITO.a53usuariomodificacion%TYPE) IS

BEGIN

UPDATE T53_GRUPOINSCRITO
   SET a53grupofacilitador = p_a53grupofacilitador,
       a53periodo = p_a53periodo,
       a53inscrito = p_a53inscrito,
       a53estado = p_a53estado,
       a53fechamodificacion = SYSDATE,
       a53usuariomodificacion = p_usuario
 WHERE a53codigo = p_a53codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T53_GRUPOINSCRITO
PARAMETROS    :
IN    :
        p_a53codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 15/04/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a53codigo     IN T53_GRUPOINSCRITO.a53codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T53_GRUPOINSCRITO
 WHERE a53codigo = NVL(p_a53codigo,a53codigo);

END Pr_Consultar;

END PK_T53_GRUPOINSCRITO;
/

prompt
prompt Creating package body PK_T92_PERFILESUSUARIO
prompt ============================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T92_PERFILESUSUARIO AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T92_PERFILESUSUARIO
PARAMETROS    :
IN    :
        p_a92nombre
        p_a92estado
        p_usuario

OUT    :
        p_a92codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 09/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a92nombre     IN T92_PERFILESUSUARIO.a92nombre%TYPE,
p_a92estado     IN T92_PERFILESUSUARIO.a92estado%TYPE,
p_usuario       IN T92_PERFILESUSUARIO.a92usuariocreacion%TYPE,
p_a92codigo     OUT T92_PERFILESUSUARIO.a92codigo%TYPE) IS

BEGIN

p_a92codigo := Pk_Utils.Fn_Obtenerid ('T92_PERFILESUSUARIO_SEQ');

INSERT INTO T92_PERFILESUSUARIO(
        a92codigo,
        a92nombre,
        a92estado,
        a92fechacreacion,
        a92fechamodificacion,
        a92usuariocreacion,
        a92usuariomodificacion)
 VALUES (p_a92codigo,
         p_a92nombre,
         p_a92estado,
         SYSDATE,
         SYSDATE,
         p_usuario,
         p_usuario);

END Pr_Insertar;

/********************************************************************************
DESCRIPCION    : Procedimiento para actualizar el estado del registro
                 en la tabla T92_PERFILESUSUARIO
PARAMETROS    :
IN    :
        p_a92codigo
        p_usuario

OUT    :

REALIZADO POR    : 
                    

FECHA CREACION    : 09/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Eliminar(
p_a92codigo     IN T92_PERFILESUSUARIO.a92codigo%TYPE,
p_usuario       IN T92_PERFILESUSUARIO.a92usuariomodificacion%TYPE) IS

BEGIN

UPDATE T92_PERFILESUSUARIO
   SET a92estado = 'I',
       a92fechamodificacion = SYSDATE,
       a92usuariomodificacion = p_usuario
 WHERE a92codigo = p_a92codigo;

END Pr_Eliminar;

/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la actualizaci?n del
                 registro en la tabla T92_PERFILESUSUARIO
PARAMETROS    :
IN    :
        p_a92codigo
        p_a92nombre
        p_a92estado
        p_a92usuario
        p_usuario

OUT    :
        p_codError        C?digo de error generado
        p_msjError        Mensaje del error generado

REALIZADO POR    : 
                    

FECHA CREACION    : 09/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Actualizar(
p_a92codigo     IN T92_PERFILESUSUARIO.a92codigo%TYPE,
p_a92nombre     IN T92_PERFILESUSUARIO.a92nombre%TYPE,
p_a92estado     IN T92_PERFILESUSUARIO.a92estado%TYPE,
p_usuario       IN T92_PERFILESUSUARIO.a92usuariomodificacion%TYPE) IS

BEGIN

UPDATE T92_PERFILESUSUARIO
   SET a92nombre = p_a92nombre,
       a92estado = p_a92estado,
       a92fechamodificacion = SYSDATE,
       a92usuariomodificacion = p_usuario
 WHERE a92codigo = p_a92codigo;

END Pr_Actualizar;

/********************************************************************************
DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T92_PERFILESUSUARIO
PARAMETROS    :
IN    :
        p_a92codigo

OUT    :
        p_resultado

REALIZADO POR    : 
FECHA CREACION    : 09/03/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Consultar(
p_a92codigo     IN T92_PERFILESUSUARIO.a92codigo%TYPE,
p_resultado     OUT PK_UTILS.ty_cursor) IS

BEGIN

OPEN p_resultado FOR
SELECT *
  FROM T92_PERFILESUSUARIO
 WHERE a92codigo = NVL(p_a92codigo,a92codigo);

END Pr_Consultar;

END PK_T92_PERFILESUSUARIO;
/

prompt
prompt Creating package body PK_T96_OPCIONROL
prompt ======================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T96_OPCIONROL AS
  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                   registro en la tabla T96_OPCIONROL
  PARAMETROS    :
  IN    :
          p_a96menu
          p_a96opcion
      p_a96rol
          p_usuario

  OUT    :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 09/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Insertar(p_a96opcion IN T96_OPCIONROL.a96opcion%TYPE,
                        p_a96rol    IN T96_OPCIONROL.a96rol%TYPE,
                        p_usuario   IN T96_OPCIONROL.a96usuariocreacion%TYPE) IS

  BEGIN

    INSERT INTO T96_OPCIONROL
      (a96opcion,
       a96rol,
       a96fechacreacion,
       a96fechamodificacion,
       a96usuariocreacion,
       a96usuariomodificacion)
    VALUES
      (
       p_a96opcion,
       p_a96rol,
       SYSDATE,
       SYSDATE,
       p_usuario,
       p_usuario);

  END Pr_Insertar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento basico que permite realizar la actualizaci?n del
                   registro en la tabla T96_OPCIONROL
  PARAMETROS    :
  IN    :
          p_a96menu
          p_a96opcion
          p_a96rol
          p_usuario

  OUT    :
          p_codError        C?digo de error generado
          p_msjError        Mensaje del error generado

  REALIZADO POR    : 
                      

  FECHA CREACION    : 09/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Actualizar(
                          p_a96opcion IN T96_OPCIONROL.a96opcion%TYPE,
                          p_a96rol    IN T96_OPCIONROL.a96rol%TYPE,
                          p_usuario   IN T96_OPCIONROL.a96usuariomodificacion%TYPE) IS

  BEGIN

    UPDATE T96_OPCIONROL
       SET
           a96opcion              = p_a96opcion,
           a96fechamodificacion   = SYSDATE,
           a96usuariomodificacion = p_usuario
     WHERE a96rol = p_a96rol;

  END Pr_Actualizar;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar la informacion en la tabla T96_OPCIONROL
  PARAMETROS    :
  IN    :
          p_a96rol

  OUT    :
          p_resultado

  REALIZADO POR    : 
  FECHA CREACION    : 09/03/2016
  MODIFICADO POR    :
  FECHA MODIFICA    :
  CAMBIOS    :
  *******************************************************************************/
  PROCEDURE Pr_Consultar(p_a96rol    IN T96_OPCIONROL.a96rol%TYPE,
                         p_resultado OUT PK_UTILS.ty_cursor) IS

  BEGIN

    OPEN p_resultado FOR
      SELECT * FROM T96_OPCIONROL WHERE a96rol = NVL(p_a96rol, a96rol);

  END Pr_Consultar;

END PK_T96_OPCIONROL;
/

prompt
prompt Creating package body PK_T98_EXCEPCION
prompt ======================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T98_EXCEPCION AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la inserci?n del
                 registro en la tabla T98_EXCEPCION
PARAMETROS    :
IN    :
        p_a98fechaexcepcion
        p_a98usuario
        p_a98paquete
        p_a98procedimiento
        p_a98coderror
        p_a98msgerror

OUT    :
        p_a98_codigo

REALIZADO POR    : 
                    

FECHA CREACION    : 18/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a98fechaexcepcion   IN T98_EXCEPCION.a98fechaexcepcion%TYPE,
p_a98usuario          IN T98_EXCEPCION.a98usuario%TYPE,
p_a98paquete          IN T98_EXCEPCION.a98paquete%TYPE,
p_a98procedimiento    IN T98_EXCEPCION.a98procedimiento%TYPE,
p_a98coderror         IN T98_EXCEPCION.a98coderror%TYPE,
p_a98msgerror         IN T98_EXCEPCION.a98msgerror%TYPE,
p_a98codigo           OUT T98_EXCEPCION.a98codigo%TYPE) IS

BEGIN

p_a98codigo := Pk_Utils.Fn_Obtenerid ('T98_EXCEPCION_SEQ');

INSERT INTO T98_EXCEPCION(
        a98codigo,
        a98fechaexcepcion,
        a98paquete,
        a98procedimiento,
        a98usuario,
        a98coderror,
        a98msgerror)
 VALUES (p_a98codigo,
         p_a98fechaexcepcion,
         p_a98paquete,
         p_a98procedimiento,
         p_a98usuario,
         p_a98coderror,
         p_a98msgerror);

END Pr_Insertar;

END PK_T98_EXCEPCION;
/

prompt
prompt Creating package body PK_T99_LOGOPERACION
prompt =========================================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_T99_LOGOPERACION AS
/********************************************************************************
DESCRIPCION    : Procedimiento basico que permite realizar la insercion del
                 registro en la tabla T99_LOGOPERACION
PARAMETROS    :
IN    :
        p_a99fechaoperacion
        p_a99usuario
        p_a99paquete
        p_a99procedimiento
        p_a99descripcion
        p_a99nivel

OUT    :
        p_a99codigo        Codigo generado

REALIZADO POR    : 
                    

FECHA CREACION    : 18/02/2016
MODIFICADO POR    :
FECHA MODIFICA    :
CAMBIOS    :
*******************************************************************************/
PROCEDURE Pr_Insertar(
p_a99fechaoperacion   IN T99_LOGOPERACION.a99fechaoperacion%TYPE,
p_a99usuario          IN T99_LOGOPERACION.a99usuario%TYPE,
p_a99paquete          IN T99_LOGOPERACION.a99paquete%TYPE,
p_a99procedimiento    IN T99_LOGOPERACION.a99procedimiento%TYPE,
p_a99descripcion      IN T99_LOGOPERACION.a99descripcion%TYPE,
p_a99nivel            IN T99_LOGOPERACION.a99nivel%TYPE,
p_a99codigo           OUT T99_LOGOPERACION.a99codigo%TYPE) IS

v_a99codigo   T99_LOGOPERACION.a99codigo%TYPE;

BEGIN

p_a99codigo := Pk_Utils.Fn_Obtenerid ('T99_LOGOPERACION_SEQ');

INSERT INTO T99_LOGOPERACION(
        a99codigo,
        a99fechaoperacion,
        a99paquete,
        a99procedimiento,
        a99usuario,
        a99descripcion,
        a99nivel)
 VALUES (p_a99codigo,
         p_a99fechaoperacion,
         p_a99paquete,
         p_a99procedimiento,
         p_a99usuario,
         p_a99descripcion,
         p_a99nivel);

END Pr_Insertar;

END PK_T99_LOGOPERACION;
/

prompt
prompt Creating package body PK_UTILS
prompt ==============================
prompt
CREATE OR REPLACE PACKAGE BODY HPV.PK_UTILS AS
  /********************************************************************************
   DESCRIPCION   : Funcion para asignar los consecutivos a los identificadores
                   de llave primaria

   PARAMETROS    :
   IN            : p_nombreSeq    Nombre de la secuencia correspondiente de la tabla
                                   a la que se le va a generar el consecutivo

   OUT           : v_i    Retorna el consecutivo respectivo de la tabla

  REALIZADO POR    : 
                      

  FECHA CREACION    : 15/02/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  FUNCTION fn_ObtenerId(p_nombreSeq IN VARCHAR2) RETURN NUMBER IS

    v_eseq VARCHAR2(1000);
    v_id   NUMBER;

  BEGIN

    v_eseq := 'SELECT ' || p_nombreSeq || '.NEXTVAL FROM DUAL';
    EXECUTE IMMEDIATE v_eseq
      INTO v_id;

    RETURN v_id;

  END fn_ObtenerId;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para consultar las diferentes listas por categoria
                   en la tabla correspodiente
  PARAMETROS    :
  IN    :
          p_categoria    Valor de la categoria a consultar

  OUT    :
          p_resultado       Cursor con el resultado generado
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado

  REALIZADO POR    : 
                      

  FECHA CREACION    : 15/02/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/
  PROCEDURE Pr_ConsultarLista(p_categoria IN VARCHAR2,
                              p_resultado OUT TY_CURSOR,
                              p_codError  OUT NUMBER,
                              p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ConsultarLista';

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar lista ' || p_categoria);

    -- VALIDAR QUE ESTE PRESENTE LA CATEGORIA
    IF p_categoria IS NULL THEN

      p_codError := 10;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;

    END IF;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    CASE p_categoria
      WHEN 'TIPODOCUMENTO' THEN
        OPEN p_resultado FOR
          SELECT a04tipodocumento codigo, upper(a04nombre) nombre
            FROM T04_TIPOSDOCUMENTO
           WHERE a04estado = PK_UTILS.COD_ACTIVO;
      WHEN 'MENSAJERESPUESTA' THEN
        OPEN p_resultado FOR
          SELECT a95codigo codigo, a95mensaje nombre
            FROM T95_MENSAJERESPUESTA
           WHERE a95estado = PK_UTILS.COD_ACTIVO;
      WHEN 'ESTADOSUSUARIO' THEN
        OPEN p_resultado FOR
          SELECT a93codigo codigo, a93nombre nombre
            FROM T93_ESTADOSUSUARIO
           WHERE a93estado = PK_UTILS.COD_ACTIVO;
      WHEN 'PERFILESUSUARIO' THEN
        OPEN p_resultado FOR
          SELECT a92codigo codigo, a92nombre nombre
            FROM T92_PERFILESUSUARIO
           WHERE a92estado = PK_UTILS.COD_ACTIVO;
      WHEN 'ESTADOSITEM' THEN
        OPEN p_resultado FOR
          SELECT a91codigo codigo, a91nombre nombre
            FROM T91_ESTADOSITEM
           WHERE a91estado = PK_UTILS.COD_ACTIVO;
      WHEN 'ESTADOSESPACIOFISICO' THEN
        OPEN p_resultado FOR
          SELECT a90codigo codigo, a90nombre nombre
            FROM T90_ESTADOSESPACIOFISICO
           WHERE a90estado = PK_UTILS.COD_ACTIVO
          union
          SELECT 'T' codigo, 'TODOS' nombre from dual;
      WHEN 'MOTIVORECHAZO' THEN
        OPEN p_resultado FOR
          SELECT a88codigo codigo, a88motivo nombre
            FROM t88_motivosrechazo
           WHERE a88estado = PK_UTILS.COD_ACTIVO;
      WHEN 'CONDICIONESPECIAL' THEN
        OPEN p_resultado FOR
          SELECT a87codigo codigo, a87condicion nombre
            FROM t87_condicionespecial
           WHERE a87estado = PK_UTILS.COD_ACTIVO
           order by a87codigo;
      WHEN 'PERIODO' THEN
        OPEN p_resultado FOR
          SELECT trim(to_char(a12codigo)) codigo, a12nombre nombre
            FROM t12_periodos
           order by a12codigo;
      WHEN 'NOTICIA' THEN
        OPEN p_resultado FOR
          select to_char(a86codigo) codigo, a86noticia nombre
            FROM t86_noticia
           WHERE a86estado = PK_UTILS.COD_ACTIVO
           order by a86orden;
      WHEN 'ENTREGABLE' THEN
        OPEN p_resultado FOR
          select to_char(a18codigo) codigo, a18nombre nombre
            from t18_entregables
           where a18estado = PK_UTILS.COD_ACTIVO
           order by a18orden;
      WHEN 'ESTADOSDOCUMENTO' THEN
        OPEN p_resultado FOR
          SELECT a89codigo codigo, a89nombre nombre
            FROM t89_estadosentregables
           WHERE a89estado = PK_UTILS.COD_ACTIVO
          union
          SELECT 'T' codigo, 'TODOS' nombre from dual;
      WHEN 'ESTADOSASISTENCIA' THEN
        OPEN p_resultado FOR
          SELECT a89codigo codigo, a89nombre nombre
            FROM t89_estadosentregables
           WHERE a89estado = PK_UTILS.COD_ACTIVO
          union
          SELECT 'T' codigo, 'TODOS' nombre from dual;
      WHEN 'TIPOHISTORIAVIDA' THEN
        OPEN p_resultado FOR
          select to_char(a85codigo) codigo, a85descripcion nombre
            from t85_tipohistoriavida
           where a85estado = PK_UTILS.COD_ACTIVO
           order by a85codigo;
      WHEN 'CUALIDADCASOEXITO' THEN
        OPEN p_resultado FOR
          select to_char(a81codigo) codigo, a81nombre nombre
            from t81_cualidadescasoexito
           where a81estado = PK_UTILS.COD_ACTIVO
           order by a81codigo;
      WHEN 'CUALIDADLIDERAZGO' THEN
        OPEN p_resultado FOR
          select to_char(a80codigo) codigo, a80nombre nombre
            from t80_cualidadesliderazgo
           where a80estado = PK_UTILS.COD_ACTIVO
           order by a80codigo;

      WHEN 'ESTADOPERIODO' THEN
        OPEN p_resultado FOR
          select to_char(a78codigo) codigo, a78nombre nombre
            from t78_estadoperiodo
           where a78estado = PK_UTILS.COD_ACTIVO
           order by a78codigo;
      WHEN 'OPCIONESHPV' THEN
        OPEN p_resultado FOR
          select to_char(a10codigo) codigo, a10nombre nombre
            from t10_opciones
           where a10estado = PK_UTILS.COD_ACTIVO
           order by a10nombre;
      WHEN 'FUNCIONES' THEN
        OPEN p_resultado FOR
          select codigo, nombre from T111_OPCIONESAUDIT ORDER BY NOMBRE;
      ELSE
        p_codError := 9; --LISTA DE VALORES NO DEFINIDA
        p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
    END CASE;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta correcta de lista ' || p_categoria);

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ConsultarLista;

  /********************************************************************************
  DESCRIPCION    : Procedimiento para registrar los logs generados
                   por la aplicaci?n en la tabla T97_PARAMETROSLOG

  PARAMETROS    :
  IN    :
          p_nivelLog                 Nivel de log
          p_paquete                  Nombre del paquete
          p_procedimiento            Nombre del procedimiento
          p_usuario                  Usuario que realiza la operacion
          p_descripcion              Descripcion de la operacion realziada

  OUT    :
          p_codError        Codigo de error generado
          p_msjError        Mensaje del error generado

  REALIZADO POR    : 
                      

  FECHA CREACION    : 20/02/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/
  PROCEDURE pr_RegistraLog(p_nivelLog      IN NUMBER,
                           p_paquete       IN VARCHAR2,
                           p_procedimiento IN VARCHAR2,
                           p_usuario       IN NUMBER,
                           p_descripcion   IN VARCHAR2) IS

    numReg         number;
    nivelActualLog number;

    codExcepcion         number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'pr_RegistraLog';

    p_a99codigo NUMBER;

  BEGIN

    -- validar si el paquete y procedimiento tienen log activo
    select count(*)
      into numReg
      from t97_parametroslog
     where a97paquete = p_paquete
       and a97procedimiento = p_procedimiento
       and a97estado = PK_UTILS.COD_ACTIVO;

    if (numReg = 0) then
      return;
    end if;

    -- validar nivel de log activo

    select a100codigo
      into nivelActualLog
      from t100_nivellog
     where a100estado = PK_UTILS.COD_ACTIVO;

    if (nivelActualLog is null) then
      return;
    end if;

    if (nivelActualLog < p_nivelLog) then
      return;
    end if;

    Pk_T99_Logoperacion.Pr_Insertar(SYSDATE,
                                    p_usuario,
                                    p_paquete,
                                    p_procedimiento,
                                    p_descripcion,
                                    p_nivelLog,
                                    p_a99codigo);

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

  END pr_RegistraLog;

  /********************************************************************************
   DESCRIPCION   : Funcion para devolver el mensaje de respuesta

   PARAMETROS    :
   IN            : p_codError    Codigo del error

   OUT           : v_msj    Retorna el mensaje de respuesta

  REALIZADO POR    : 
                      

  FECHA CREACION    : 20/02/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/
  FUNCTION fn_ObtenerMensaje(p_codError IN VARCHAR2) RETURN VARCHAR2 IS

    CURSOR c_msj IS
      SELECT a95mensaje
        FROM T95_MENSAJERESPUESTA
       WHERE a95codigo = p_codError
         AND a95estado = PK_UTILS.COD_ACTIVO;

    v_msj T95_MENSAJERESPUESTA.a95mensaje%TYPE;

  BEGIN

    OPEN c_msj;
    FETCH c_msj
      INTO v_msj;
    CLOSE c_msj;

    IF v_msj IS NULL THEN

      v_msj := 'MENSAJE NO PARAMETRIZADO ' || p_codError;

    END IF;

    RETURN v_msj;

  END fn_ObtenerMensaje;

  /********************************************************************************
   DESCRIPCION   : Funcion para registrar excepcion del sistema y retornar el codigo asignado

   PARAMETROS    :
   IN            :         p_usuario        Usuario que esta ejecutando la operacion,
                           p_paquete        Paquete donde se genero la excepcion,
                           p_procedimiento  Procedimiento que genero la excepcio,
                           p_codError       Codigo de error generado por oracle,
                           p_msjError       Descripcion de la excepcion generado por oracle

   OUT           : v_codigoExcepcion    Retorna el codigo de excepcion

  REALIZADO POR    : 
                      

  FECHA CREACION    : 20/02/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/
  FUNCTION fn_RegistraExcepcion(p_usuario       IN NUMBER,
                                p_paquete       IN VARCHAR2,
                                p_procedimiento IN VARCHAR2,
                                p_codError      IN NUMBER,
                                p_msjError      IN VARCHAR2) RETURN NUMBER IS

    v_codigoExcepcion number;
  BEGIN

    -- REGISTRA EXCEPCION EN TABLA T98

    pk_t98_excepcion.pr_insertar(SYSDATE,
                                 p_usuario,
                                 p_paquete,
                                 p_procedimiento,
                                 p_codError,
                                 p_msjError,
                                 v_codigoExcepcion);

    return v_codigoExcepcion;

  END fn_RegistraExcepcion;

  /********************************************************************************
   DESCRIPCION   : Funcion encargada de devolver el ID del periodo activo para operacion

   PARAMETROS    :
   IN            :

   OUT           :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 16/02/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  FUNCTION Fn_ObtenerPeriodoVigente RETURN NUMBER IS

    CURSOR c_periodo IS
      SELECT a12codigo
        FROM T12_PERIODOS
       WHERE a12estado = PK_UTILS.COD_ACTIVO;

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Fn_ObtenerPeriodoVigente';
  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar funcion periodo vigente ');

    select count(*)
      into numReg
      from t12_periodos
     WHERE a12estado = PK_UTILS.COD_ACTIVO;

    -- No hay periodo vigente
    if (numReg = 0) then
      return 0;
    end if;

    -- Hay mas de un periodo vigente
    if (numReg > 1) then
      return 0;
    end if;

    OPEN c_periodo;
    FETCH c_periodo
      INTO numReg;
    CLOSE c_periodo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta funcion periodo vigente OK ');

    RETURN numReg;

  END Fn_ObtenerPeriodoVigente;
  /********************************************************************************
   DESCRIPCION   : Funcion encargada de devolver el ID del periodo activo de inscripcion

   PARAMETROS    :
   IN            :

   OUT           :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 16/02/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  FUNCTION Fn_ObtenerPeriodoInscripcion RETURN NUMBER IS

    v_COD_INSCRIPCION varchar2(5) := PK_UTILS.COD_INSCRIPCION;

    CURSOR c_periodo IS
      SELECT a12codigo
        FROM T12_PERIODOS
       WHERE a12estado = v_COD_INSCRIPCION;

    codExcepcion number;
    numReg       number;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_ObtenerPeriodoInscripcion';

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar funcion periodo vigente inscripción ');

    select count(*)
      into numReg
      from t12_periodos
     WHERE a12estado = v_COD_INSCRIPCION;

    -- No hay periodo vigente
    if (numReg = 0) then
      v_COD_INSCRIPCION := PK_UTILS.COD_ACTIVO;
      select count(*)
        into numReg
        from t12_periodos
       WHERE a12estado = v_COD_INSCRIPCION;

    end if;

    if (numReg = 0) then
      return 0;
    end if;

    -- Hay mas de un periodo vigente
    if (numReg > 1) then
      return 0;
    end if;

    OPEN c_periodo;
    FETCH c_periodo
      INTO numReg;
    CLOSE c_periodo;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta funcion periodo vigente inscripcion OK ');

    RETURN numReg;

  END Fn_ObtenerPeriodoInscripcion;

  /********************************************************************************
   DESCRIPCION   : Funcion encargada de devolver el ID de la encuesta asociada a l apregunta

   PARAMETROS    :
   IN            :

   OUT           :

  REALIZADO POR    : 
                      

  FECHA CREACION    : 03/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:
  *******************************************************************************/
  FUNCTION Fn_DarEncuestaXPregunta(p_pregunta IN NUMBER) RETURN NUMBER IS

    CURSOR c_encuesta IS
      SELECT a13encuesta
        FROM T13_ENCUESTAPREGUNTAS
       WHERE a13codigo = p_pregunta;

    codExcepcion NUMBER;
    idEncuesta   NUMBER;

    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Fn_DarEncuestaXPregunta';
  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a consultar funcion obtener ID encuesta por pregunta ');

    OPEN c_encuesta;
    FETCH c_encuesta
      INTO idEncuesta;
    CLOSE c_encuesta;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta funcion obtener ID encuesta por pregunta OK ');

    RETURN idEncuesta;

  END Fn_DarEncuestaXPregunta;

  /********************************************************************************
   DESCRIPCION   : Funcion para devolver el valor del parametro

   PARAMETROS    :
   IN            : p_parametro    Nombre del parametro

   OUT           : v_valor    Retorna el valor del parametro

  REALIZADO POR    : 
                      

  FECHA CREACION    : 03/03/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/
  FUNCTION fn_ObtenerValorParametro(p_parametro IN VARCHAR2) RETURN VARCHAR2 IS

    CURSOR c_valor IS
      SELECT a08valor
        FROM T08_PARAMETROS
       WHERE a08nombre = p_parametro
         AND a08estado = PK_UTILS.COD_ACTIVO;

    v_valor T08_PARAMETROS.a08valor%TYPE;

  BEGIN

    OPEN c_valor;
    FETCH c_valor
      INTO v_valor;
    CLOSE c_valor;

    IF v_valor IS NULL THEN

      v_valor := 'VALOR NO PARAMETRIZADO ' || p_parametro;

    END IF;

    RETURN v_valor;

  END fn_ObtenerValorParametro;

  /*  PROCEDURE Pr_EnviarCorreo(p_from     IN VARCHAR2,
                            p_to       IN VARCHAR2,
                            p_subject  IN VARCHAR2,
                            p_body     IN VARCHAR2,
                            p_codError OUT NUMBER,
                            p_msjError OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_EnviarCorreo';

    mail_conn utl_smtp.connection;
    crlf      VARCHAR2(2) := CHR(13) || CHR(10);
    mailhost  varchar(200);
    mailuser  varchar2(200);
    mailpwd   varchar2(200);

    msj varchar2(10000);

  BEGIN

    -- GRANT EXECUTE ON SYS.UTL_SMTP TO PUBLIC;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Enviar correo ' || p_to || '- ' || p_subject);

    mailhost := fn_ObtenerValorParametro('MAILHOST');
    mailuser := fn_ObtenerValorParametro('MAILUSER');
    mailpwd  := fn_ObtenerValorParametro('MAILHOST');

    msj := 'Date: ' || TO_CHAR(SYSDATE, 'dd Mon yy hh24:mi:ss') || crlf ||
           'From: ' || p_from || crlf || 'Subject: ' || p_subject || crlf ||
           'To: ' || p_to || crlf || crlf || p_body;

    mail_conn := utl_smtp.open_connection(mailhost, 25);
    utl_smtp.helo(mail_conn, mailhost);

    utl_smtp.command(mail_conn, 'AUTH LOGIN');
    utl_smtp.command(mail_conn,
                     utl_raw.cast_to_varchar2(utl_encode.base64_encode(utl_raw.cast_to_raw(mailuser))));
    utl_smtp.command(mail_conn,
                     utl_raw.cast_to_varchar2(utl_encode.base64_encode(utl_raw.cast_to_raw(mailpwd))));
    --utl_smtp.command(mail_conn, utl_raw.cast_to_varchar2(mailpwd));

    utl_smtp.mail(mail_conn, p_from);
    utl_smtp.rcpt(mail_conn, p_to);
    utl_smtp.data(mail_conn, msj);
    utl_smtp.quit(mail_conn);

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Enviar correo ok ' || P_to || '- ' ||
                            p_subject);

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

      p_codError := SQLCODE;
      p_msjError := SQLERRM;

  END Pr_EnviarCorreo;*/

  PROCEDURE Pr_EnviarCorreoWS(p_to       IN varchar2,
                              p_tarea    in varchar2,
                              p_idReg    IN number,
                              p_codError OUT NUMBER,
                              p_msjError OUT VARCHAR2) IS
  
    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_EnviarCorreoWS';
    numReg               NUMBER;
  
    url varchar2(200);
  
    req     UTL_HTTP.req := NULL;
    resp    UTL_HTTP.resp := NULL;
    respVal VARCHAR2(32000);
    reqXML  VARCHAR2(32760);
  
    valor varchar2(200);
  
    codRpta     number;
    mensajeRpta varchar2(2000);
  
    textBody varchar2(32000);
  
    idUsuario number;
    token     varchar2(100);
  
    urlApp             varchar2(200);
    diasRestaurarClave varchar2(200);
    mailhost           varchar2(200);
    mailuser           varchar2(200);
    mailpwd            varchar2(200);
    mailport           varchar2(200);
    mailfrom           varchar2(200);
    primerNombre       varchar2(200);
    asunto             varchar2(200);
    nombrePeriodo      varchar2(200);
    codPeriodo         number;
  
    cuerpo1 varchar2(4000);
    cuerpo2 varchar2(4000);
    cuerpo3 varchar2(4000);
  
    idDatos      number;
    nombreTaller varchar2(500);
  
  BEGIN
  
    -- SE REQUIERE ESTE PERMISO
    -- GRANT EXECUTE ON SYS.UTL_HTTP TO PUBLIC;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro a Pr_EnviarCorreoWS ' || p_to || '-' ||
                            p_tarea);
  
    url := Pk_Utils.Fn_Obtenervalorparametro('URLWSMAIL');
  
    -- Si no esta parametrizado
    if (substr(url, 1, 5) = 'VALOR') then
      p_codError := 64;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;
  
    /*Generamos un Request a la URL destino, el método debe ser POST */
    req := UTL_HTTP.begin_request(url, 'POST');
  
    /*Creamos un mensaje SOAP tal cual se define en el WSDL*/
  
    reqXML := '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:tem="http://tempuri.org/" xmlns:hpv="http://schemas.datacontract.org/2004/07/HPV_Entidades.GeneralWS">
   <soapenv:Header/>
   <soapenv:Body>
      <tem:EnviarCorreo>
          <tem:oe>

            <hpv:Bcc>datoBcc</hpv:Bcc>
            <hpv:Body><![CDATA[datoBody]]></hpv:Body>
            <hpv:Cc>datoCc</hpv:Cc>
            <hpv:From>datoFrom</hpv:From>
            <hpv:Password>datoPassword</hpv:Password>
            <hpv:Port>datoPort</hpv:Port>
            <hpv:Server>datoServer</hpv:Server>
            <hpv:Subject><![CDATA[datoSubject]]></hpv:Subject>
            <hpv:To>datoTo</hpv:To>
            <hpv:UserName>datoUserName</hpv:UserName>

         </tem:oe>
      </tem:EnviarCorreo>
   </soapenv:Body>
</soapenv:Envelope>';
  
    urlApp             := fn_ObtenerValorParametro('URLAPP');
    diasRestaurarClave := fn_ObtenerValorParametro('DIASRESTAURARCLAVE');
  
    mailhost := fn_ObtenerValorParametro('MAILHOST');
    mailuser := fn_ObtenerValorParametro('MAILUSER');
    mailpwd  := fn_ObtenerValorParametro('MAILPWD');
    mailport := fn_ObtenerValorParametro('MAILPORT');
    mailfrom := fn_ObtenerValorParametro('MAILFROM');
  
    codPeriodo := PK_UTILS.Fn_ObtenerPeriodoVigente;
  
    select a12nombre
      into nombrePeriodo
      from t12_periodos p
     where a12codigo = codPeriodo;
  
    if p_tarea = 'RESTOREPWD' then
    
      select t.a54usuario, a54token
        into idUsuario, token
        from t54_tokenusuario t
       where t.a54codigo = p_idReg;
    
      select convert(p.a07primernombre, 'AL32UTF8', 'WE8MSWIN1252')
        into primerNombre
        from t07_personas p
       where p.a07usuario = idUsuario;
    
      select convert(a22asunto, 'AL32UTF8', 'WE8MSWIN1252'),
             a22cuerpo,
             a22cuerpo2,
             a22cuerpo3
        into asunto, cuerpo1, cuerpo2, cuerpo3
        from t22_correos
       where a22tarea = p_tarea;
    
      textBody := cuerpo1 || cuerpo2 || cuerpo3;
    
      textBody := '{RESTOREPWD},{nombreUsuario:&nombreUsuario},{urlApp:&urlApp},{token:&token},{diaClave:&diaClave},{nombrePeriodo:&nombrePeriodo}';
    
      textBody := replace(textBody, '&nombreUsuario', primerNombre);
      textBody := replace(textBody, '&urlApp', urlApp);
      textBody := replace(textBody, '&token', token);
      textBody := replace(textBody, '&diaClave', diasRestaurarClave);
      textBody := replace(textBody, '&nombrePeriodo', nombrePeriodo);
    
      --textBody := urlApp || 'asignarClave/' || token;
    end if;
  
    if p_tarea = 'ENCUESTASATISFACCION' then
    
      select t.a54usuario, a54token, a54iddato
        into idUsuario, token, idDatos
        from t54_tokenusuario t
       where t.a54codigo = p_idReg;
    
      select convert(a15primernombre, 'AL32UTF8', 'WE8MSWIN1252')
        into primerNombre
        from t15_inscritos
       where a15codigo = idUsuario;
    
      select convert(a22asunto, 'AL32UTF8', 'WE8MSWIN1252'),
             a22cuerpo,
             a22cuerpo2,
             a22cuerpo3
        into asunto, cuerpo1, cuerpo2, cuerpo3
        from t22_correos
       where a22tarea = p_tarea;
    
      select convert(a17nombre || ' ' || a17descripcion,
                     'AL32UTF8',
                     'WE8MSWIN1252')
        into nombreTaller
        from t51_asistenciataller, t17_talleres
       where a51codigo = idDatos
         and a51tallerrealizado = a17codigo;
    
      textBody := cuerpo1 || cuerpo2 || cuerpo3;
    
      textBody := '{ENCUESTASATISFACCION},{nombreUsuario:&nombreUsuario},{urlApp:&urlApp},{token:&token},{nombrePeriodo:&nombrePeriodo},{nombreTaller:&nombreTaller}';
    
      textBody := replace(textBody, '&nombreUsuario', primerNombre);
      textBody := replace(textBody, '&urlApp', urlApp);
      textBody := replace(textBody, '&token', token);
      textBody := replace(textBody, '&nombrePeriodo', nombrePeriodo);
      textBody := replace(textBody, '&nombreTaller', nombreTaller);
    
      --textBody := urlApp || 'asignarClave/' || token;
    end if;
  
    if p_tarea = 'INSCRIPCION' then
    
      codPeriodo := PK_UTILS.Fn_ObtenerPeriodoInscripcion;

      select convert(a22asunto, 'AL32UTF8', 'WE8MSWIN1252'),
             a22cuerpo,
             a22cuerpo2,
             a22cuerpo3
        into asunto, cuerpo1, cuerpo2, cuerpo3
        from t22_correos
       where a22tarea = p_tarea;
    
      select a12nombre
        into nombrePeriodo
        from t12_periodos p
       where a12codigo = codPeriodo;
    
      FOR reg IN (select t15_inscritos.*,
                         t26_gruposfacilitador.*,
                         t23_dias.*,
                         t24_horarios.*,
                         t03_municipios.*,
                         t02_departamentos.*,
                         p.*
                    from t15_inscritos,
                         t26_gruposfacilitador,
                         t23_dias,
                         t24_horarios,
                         t03_municipios,
                         t02_departamentos,
                         t07_personas p
                   where a15codigo = p_idReg
                     and a15grupofacilitador = a26codigo
                     and a26dia = a23codigo
                     and a26horario = a24codigo
                     and a26ciudad = a03codigo
                     and a26facilitador = p.a07usuario
                     and a03departamento = a02codigo) LOOP
        textBody := '';
      
        textBody := '{INSCRIPCION},{nombreInscrito:&nombreInscrito},{nombrePeriodo:&nombrePeriodo},{nomDia:&nomDia},{horario:&horario},{lugar:&lugar},{direccion:&direccion},{nomMunicipio:&nomMunicipio},{nomDpto:&nomDpto},{nombreFacilitador:&nombreFacilitador},{siglaGrupo:&siglaGrupo}';
      
        textBody := replace(textBody,
                            '&nombreInscrito',
                            convert(reg.a15primernombre || ' ' ||
                                    reg.a15segundonombre || ' ' ||
                                    reg.a15primerapellido || ' ' ||
                                    reg.a15segundoapellido,
                                    'AL32UTF8',
                                    'WE8MSWIN1252'));
      
        textBody := replace(textBody,
                            '&nombreFacilitador',
                            convert(reg.A07PRIMERNOMBRE || ' ' ||
                                    reg.A07SEGUNDONOMBRE || ' ' ||
                                    reg.A07PRIMERAPELLIDO || ' ' ||
                                    reg.A07SEGUNDOAPELLIDO,
                                    'AL32UTF8',
                                    'WE8MSWIN1252'));
      
        textBody := replace(textBody, '&siglaGrupo', reg.a26sigla);
        textBody := replace(textBody, '&nombrePeriodo', nombrePeriodo);
        textBody := replace(textBody, '&nomDia', reg.a23nombre);
        textBody := replace(textBody, '&horario', reg.a24horario);
        textBody := replace(textBody,
                            '&lugar',
                            convert(reg.a26lugar, 'AL32UTF8', 'WE8MSWIN1252'));
        textBody := replace(textBody,
                            '&direccion',
                            convert(reg.a26direccion,
                                    'AL32UTF8',
                                    'WE8MSWIN1252'));
        textBody := replace(textBody,
                            '&nomMunicipio',
                            convert(reg.a03nombre,
                                    'AL32UTF8',
                                    'WE8MSWIN1252'));
        textBody := replace(textBody,
                            '&nomDpto',
                            convert(reg.a02nombre,
                                    'AL32UTF8',
                                    'WE8MSWIN1252'));
      
      end loop;
    
    end if;
  
    reqXML := replace(reqXML, 'datoBcc', '');
    reqXML := replace(reqXML, 'datoBody', textBody);
    reqXML := replace(reqXML, 'datoCc', '');
    reqXML := replace(reqXML, 'datoFrom', mailfrom);
    reqXML := replace(reqXML, 'datoPassword', mailpwd);
    reqXML := replace(reqXML, 'datoPort', mailport);
    reqXML := replace(reqXML, 'datoServer', mailhost);
    reqXML := replace(reqXML, 'datoSubject', asunto);
    reqXML := replace(reqXML, 'datoTo', p_to);
    reqXML := replace(reqXML, 'datoUserName', mailuser);
  
    /*El contenido que enviamos es XML: */
    -- UTL_HTTP.set_header(req, 'Accept-Encoding', 'deflate');
    UTL_HTTP.set_header(req, 'Content-Type', 'text/xml;charset=UTF-8');
    -- UTL_HTTP.set_header(req, 'Content-Type', 'text/xml;charset=Windows-1252');
  
    /*Establecemos el SOAPAction a invocar: */
    UTL_HTTP.set_header(req,
                        'SOAPAction',
                        '"http://tempuri.org/IHPVServiciosGen/EnviarCorreo"');
  
    /*Indicamos en el header el tamano del mensaje enviado: */
    UTL_HTTP.set_header(req, 'Content-Length', LENGTHB(reqXML));
  
    /*Escribimos el body del request */
    --UTL_HTTP.SET_BODY_CHARSET('UTF-8');
    --UTL_HTTP.SET_BODY_CHARSET('Windows-1252');
    UTL_HTTP.WRITE_RAW(req, UTL_RAW.CAST_TO_RAW(reqXML));
  
    /*Obtenemos la respuesta */
    resp := UTL_HTTP.get_response(req);
  
    /*Cargamos en la variable respVal la devolución del servidor */
    UTL_HTTP.read_text(resp, respVal);
  
    /*Finalizamos la conexión HTTP */
    UTL_HTTP.end_response(resp);
  
    -- Hay informacion en respuesta del web services
  
    if instr(respVal, 'Codigo') > 0 then
    
      BEGIN
        codRpta := to_number(fn_darValorXml(respVal, 'b:Codigo'));
      EXCEPTION
        WHEN OTHERS THEN
          codRpta := 9999;
      END;
    
      BEGIN
        mensajeRpta := fn_darValorXml(respVal, 'b:Mensaje');
      EXCEPTION
        WHEN OTHERS THEN
          mensajeRpta := 'Problemas en consumo de WS';
      END;
    else
      codRpta     := 9999;
      mensajeRpta := 'Problemas en consumo de WS:' || respVal;
    end if;
  
    insert into t55_logenviocorreo
      (a55codigo,
       a55fechaenvio,
       a55to,
       a55codigorespuesta,
       a55mensajerespuesta,
       a55asunto,
       a55procesoenvia)
      select t55_logenviocorreo_seq.nextval,
             sysdate,
             p_to,
             codRpta,
             mensajeRpta,
             asunto,
             p_tarea
        from dual;
  
    commit;
  
    p_codError := codRpta;
    p_msjError := mensajeRpta;
  
    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Envio correo ws ok ');
  
  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);
    
      p_codError := PK_UTILS.ERROR_GENERAL;
      --p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);
      p_msjError := SQLERRM;
    
  END Pr_EnviarCorreoWS;


  /********************************************************************************
   DESCRIPCION   : Funcion para devolver el valor de un parametro de un xml

   PARAMETROS    :
   IN            : p_cadena    Cadena con la informacion
                   p_parametro Nombre del parametro a obtener

   OUT           : v_valor    Retorna el valor del parametro

  REALIZADO POR    :   P
                      

  FECHA CREACION    : 01/04/2016

  FECHA MODIFICA    :
  MODIFICADO POR    :
  DESCRIPCION CAMBIO:

  *******************************************************************************/
  FUNCTION fn_darValorXml(p_cadena IN VARCHAR2, p_parametro IN VARCHAR2)
    RETURN VARCHAR2 IS

    v_valor varchar2(200);
    posIni  number;
    posFin  number;
    token   varchar2(200);

  BEGIN

    v_valor := '';

    token  := '<' || p_parametro || '>';
    posIni := instr(p_cadena, token);
    if posIni = 0 then
      RETURN v_valor;
    end if;

    posIni := posIni + LENGTH(token);

    token := '</' || p_parametro || '>';

    posFin := instr(p_cadena, token);

    if posFin = 0 then
      RETURN v_valor;
    end if;

    v_valor := substr(p_cadena, posIni, posFin - posIni);

    RETURN v_valor;

  END fn_darValorXml;

  PROCEDURE Pr_DarParametroInicial(p_resultado OUT PK_UTILS.TY_CURSOR,
                                   p_codError  OUT NUMBER,
                                   p_msjError  OUT VARCHAR2) IS

    codExcepcion         number;
    numReg               number;
    NOMBRE_PROCEDIMIENTO varchar2(50) := 'Pr_DarParametroInicial';
    V_COD_PERIODO    VARCHAR2(5) := PK_UTILS.COD_INSCRIPCION;

    v_dias number;
  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Inicio Pr_DarParametroInicial ');

    SELECT COUNT(*)
      INTO numReg
      FROM T12_PERIODOS
     WHERE a12estado = V_COD_PERIODO;

    -- No hay periodo vigente
    if (numReg = 0) then
      V_COD_PERIODO := PK_UTILS.COD_ACTIVO;

      SELECT COUNT(*)
        INTO numReg
        FROM T12_PERIODOS
       WHERE a12estado = V_COD_PERIODO;

    end if;

    if (numReg = 0) then
      p_codError := 7;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    -- Hay mas de un periodo vigente
    if (numReg > 1) then
      p_codError := 8;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      return;
    end if;

    v_dias := Pk_Utils.Fn_Obtenervalorparametro('DIASPREAVISO');

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    OPEN p_resultado FOR
      select a12codigo IdPeriodo,
             a12nombre NombrePeriodo,
             to_char(a12fechainicio-1, 'yyyy-mm-dd') FechaIniInscripcion,
             to_char(a12fechafin, 'yyyy-mm-dd') FechaFinInscripcion,
             to_char(a12fechainicio - v_dias, 'yyyy-mm-dd') FechaIniPreaviso,
             to_char(a12fechainicio - 1, 'yyyy-mm-dd') FechaFinPreaviso
        FROM T12_PERIODOS
       WHERE a12estado = V_COD_PERIODO;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Consulta Pr_DarParametroInicial ok ');
  EXCEPTION
    WHEN OTHERS THEN

      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_DarParametroInicial;

  function fn_splitStr(str varchar2, delim char) return token_list as

    ret        token_list;
    target     int;
    i          int;
    this_delim int;
    last_delim int;

  BEGIN

    ret := token_list();

    i          := 1;
    last_delim := 0;
    target     := splitter_count(str, delim);
    while i <= target loop
      ret.extend();
      this_delim := instr(str, delim, 1, i);
      ret(i) := substr(str, last_delim + 1, this_delim - last_delim - 1);
      i := i + 1;
      last_delim := this_delim;
    end loop;
    ret.extend();
    ret(i) := substr(str, last_delim + 1);

    return ret;
  end;

  function splitter_count(str in varchar2, delim in char) return int as
    val int;
  begin
    val := length(replace(str, delim, delim || ' '));
    return val - length(str);
  end;

  PROCEDURE Pr_ValidarToken(p_categoria IN VARCHAR2,
                            p_token     IN VARCHAR2,
                            p_codError  OUT NUMBER,
                            p_msjError  OUT VARCHAR2) IS

    codExcepcion         NUMBER;
    NOMBRE_PROCEDIMIENTO VARCHAR2(50) := 'Pr_ValidarToken';

    numReg       number;
    diasEncuesta number;

  BEGIN

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Entro Pr_ValidarToken ' || p_categoria);

    select count(*)
      into numReg
      from t54_tokenusuario
     where a54token = p_token
       and a54usotoken = p_categoria;

    if (numReg = 0) then
      p_codError := 73;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      p_codError := 3;
      return;
    end if;

    select count(*)
      into numReg
      from t54_tokenusuario
     where a54token = p_token
       and a54usotoken = p_categoria
       and a54estado = 'I';

    if (numReg > 0) then
      p_codError := 74;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      p_codError := 2;
      return;
    end if;

    diasEncuesta := to_number(Pk_Utils.Fn_Obtenervalorparametro('DIASENCUESTA'));

    select count(*)
      into numReg
      from t54_tokenusuario t
     where t.a54token = p_token
       and t.a54estado = 'A'
       and t.a54usotoken = p_categoria
       and t.a54fechageneracion + diasEncuesta > sysdate;

    if numReg = 0 then
      p_codError := 75;
      p_msjError := Pk_Utils.Fn_Obtenermensaje(p_codError);
      p_codError := 1;
      return;
    end if;

    p_codError := PK_UTILS.COD_OPERACION_CORRECTA;
    p_msjError := PK_UTILS.MSJ_OPERACION_CORRECTA;

    PK_UTILS.pr_RegistraLog(PK_UTILS.NIVEL_TRACE,
                            NOMBRE_PAQUETE,
                            NOMBRE_PROCEDIMIENTO,
                            PK_UTILS.COD_USUARIO_DEFECTO,
                            'Pr_ValidarToken ok ' || p_categoria);

  EXCEPTION
    WHEN OTHERS THEN
      codExcepcion := pk_utils.fn_RegistraExcepcion(PK_UTILS.COD_USUARIO_DEFECTO,
                                                    NOMBRE_PAQUETE,
                                                    NOMBRE_PROCEDIMIENTO,
                                                    SQLCODE,
                                                    SQLERRM);

      p_codError := PK_UTILS.ERROR_GENERAL;
      p_msjError := PK_UTILS.MSJ_EXCEPCION_GENERAL || TO_CHAR(codExcepcion);

  END Pr_ValidarToken;
END PK_UTILS;
/

prompt
prompt Creating trigger T15_TR
prompt =======================
prompt
CREATE OR REPLACE TRIGGER HPV.t15_tr
  BEFORE UPDATE OR DELETE ON t15_inscritos
  FOR EACH ROW

when (NEW.A15CODIGO > 0)
BEGIN
  INSERT INTO t15_inscritos_aud
  VALUES
    (:old.a15codigo,
:old.a15grupofacilitador,
:old.a15tipodocumento,
:old.a15documento,
:old.a15codigobeneficiario,
:old.a15primernombre,
:old.a15segundonombre,
:old.a15primerapellido,
:old.a15segundoapellido,
:old.a15fechanacimiento,
:old.a15email,
:old.a15telefono,
:old.a15movil,
:old.a15movilalt,
:old.a15estado,
:old.a15fechacreacion,
:old.a15fechamodificacion,
:old.a15usuariocreacion,
:old.a15usuariomodificacion,
:old.a15condicionespecial,
:old.a15genero,
:old.a15condicion,
:old.a15institucion,
:old.a15fechaencuestafinal,
:old.a15numasistencia,
:old.a15fechacertificacion,
:old.a15codigocorreo,
:old.a15msjcorreo,
:old.a15fechaenvio,
sysdate);
END;
/

prompt
prompt Creating trigger T26_TR
prompt =======================
prompt
CREATE OR REPLACE TRIGGER HPV.t26_tr
  BEFORE UPDATE OR DELETE ON t26_gruposfacilitador
  FOR EACH ROW

when (NEW.A26CODIGO > 0)
BEGIN
  INSERT INTO t26_gruposfacilitador_aud
  VALUES
    (:old.A26CODIGO,
     :old.a26FACILITADOR,
     :old.a26CIUDAD,
     :old.a26GRUPO,
     :old.a26DIA,
     :old.a26HORARIO,
     :old.a26LUGAR,
     :old.a26DIRECCION,
     :old.a26SIGLA,
     :old.a26PERIODO,
     :old.a26CONDICION,
     :old.a26OBSERVACIONES,
     :old.a26MOTIVORECHAZO,
     :old.a26ESTADO,
     :old.a26FECHACREACION,
     :old.a26FECHAMODIFICACION,
     :old.a26USUARIOCREACION,
     :old.a26USUARIOMODIFICACION,
     sysdate);
END;
/


spool off
